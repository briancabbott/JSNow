<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.ecmascript.org/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.4+"
          urlbase="https://bugs.ecmascript.org/"
          
          maintainer="dherman@mozilla.com"
>

    <bug>
          <bug_id>113</bug_id>
          
          <creation_ts>2011-06-25 09:05:00 -0700</creation_ts>
          <short_desc>Faster browser runner</short_desc>
          <delta_ts>2014-08-18 04:53:54 -0700</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Test262</product>
          <component>Test262 website</component>
          <version>unspecified</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>CONFIRMED</bug_status>
          <resolution></resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>---</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="David Bruant">bruant.d</reporter>
          <assigned_to name="Dave Fugate">dfugate</assigned_to>
          <cc>brterlso</cc>
    
    <cc>sam.mikes</cc>
          

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>241</commentid>
    <comment_count>0</comment_count>
      <attachid>2</attachid>
    <who name="David Bruant">bruant.d</who>
    <bug_when>2011-06-25 09:05:38 -0700</bug_when>
    <thetext>Created attachment 2
faster sth.js file

I&apos;ve spent some time reading and trying to improve sth.js.
The main improvement I have made is changing how tests are inserted in the iframe. Currently, an iframe is created, its document is opened and HTML &lt;script&gt; elements are inserted on-the-fly (I will refer to it as the &quot;Doc Stream&quot; method). I have taken the following approach: create a document fragment, create script elements (with document.createElement). When all scripts are here, append the document fragment to the iframe document (later references as &quot;Doc Fragment&quot;).

Here are my results (local copy of the website run on Firefox 5):
Doc Stream:
Total Tests Ran: 10865 | Pass: 10587 | Fail: 278 | Failed To Load: 0
Time: 1130551ms (~18m50s)

Doc fragment: 
Total Tests Ran: 10865 | Pass: 10585 | Fail: 280 | Failed To Load: 2
Time: 669876ms (~11m06s) (~41% improvement, YAY!)
(measurements have been done only once in an always active tab)

I haven&apos;t checked every single test id, but it seems that the failures (and consequently passes) in both approach are the same on FF5.
The only difference is the &quot;Failed To Load: 2&quot;. The 2 tests are S15.7.3.2_A1 and S15.9.3.2_A1_T1. After some research, I have noticed that these two tests are the only one triggering the synchronous AJAX load to retrive includes (sth.js ~l100-120). Tests using the same includes, but getting them from the cache (&quot;scriptCache&quot; variable) are not affected. My personal guess is that it&apos;s a Firefox-specific bug, because it cannot really be a coincidence.


Other minor changes:
- Now, sth.js requires &quot;textContent&quot; which takes IE8 out of the game. If we really care about making the test suite run on IE8, maybe that &quot;innerText&quot; can be used as fallback.
- the &quot;iframe&quot; variable has been moved to this.run making &quot;testFinished&quot; independent of how tests are run. The iframe is now removed from the tree in the this.run function
- The &quot;testFinished&quot; function was previously called from the iframe via an additional script. I took rid of it and call the function from the main window (because it doesn&apos;t make any difference).
- Previously: var win = window.frames[window.frames.length - 1];
Now: var win = iframe.contentWindow;
Exact same object, but now retrieved in a way that is independent of where the iframe is on the DOM tree (because it doesn&apos;t matter).

Please, can you test on other browsers and tell me if it works and if there is a performance win.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>242</commentid>
    <comment_count>1</comment_count>
    <who name="David Bruant">bruant.d</who>
    <bug_when>2011-06-25 11:37:12 -0700</bug_when>
    <thetext>After test, Opera 11.11 and Chrome 12 aren&apos;t affected by an inability to load the 2 tests, confirming the idea that it would be Firefox-specific.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>243</commentid>
    <comment_count>2</comment_count>
    <who name="David Bruant">bruant.d</who>
    <bug_when>2011-06-25 14:21:33 -0700</bug_when>
    <thetext>To follow progress on Firefox bug fixing: https://bugzilla.mozilla.org/show_bug.cgi?id=667227</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>252</commentid>
    <comment_count>3</comment_count>
      <attachid>3</attachid>
    <who name="David Bruant">bruant.d</who>
    <bug_when>2011-07-03 13:26:16 -0700</bug_when>
    <thetext>Created attachment 3
faster sth.js file</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>253</commentid>
    <comment_count>4</comment_count>
    <who name="David Bruant">bruant.d</who>
    <bug_when>2011-07-03 13:34:04 -0700</bug_when>
    <thetext>About https://bugzilla.mozilla.org/show_bug.cgi?id=667227 , it turns out it&apos;s an issue with about:blank iframes and synchronous xhr. It&apos;s being worked on at https://bugzilla.mozilla.org/show_bug.cgi?id=543435
Meanwhile, the new attachment has a workaround (doing the include loadng before creating the iframe which doesn&apos;t change anything functionnally speaking).

I have done more performance measures:
-----
On FFAurora (6)
Docstream: 254504
Docfrag: 215367

On Chrome 12:
Docstream: (1) 445254 - (2) 389022
Docfrag: (1) 390611 - (2) 393119

Opera 11.11
Docstream: 1185647
Docfrag: 720235
-----
Chrome is not very convincing. The second run even showed the docstream method being slightly faster.

I have no way to prove it, but I&apos;m under the impression that the garbage collector has an important influence on the actual performance.

This is not very formal measurements, but seems to give a tendency anyway of the docfrag method being faster.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9802</commentid>
    <comment_count>5</comment_count>
    <who name="Sam Mikes">sam.mikes</who>
    <bug_when>2014-08-17 23:45:41 -0700</bug_when>
    <thetext>This seems like a quite useful idea, so I implemented this change, and tested it in modern browsers (Chrome 36, FF 31, IE 11).

I do not see a meaningful speed improvement; either the script loaders have been improved or the current version of sth.js negates the effect of this improvement.

Recommend Resolve - Wontfix</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9803</commentid>
    <comment_count>6</comment_count>
    <who name="Sam Mikes">sam.mikes</who>
    <bug_when>2014-08-18 04:53:54 -0700</bug_when>
    <thetext>Actually, the picture is more complicated than my previous post suggests.

Running more thorough tests, I find

- a large speedup (0.6 mins -&gt; 0.1 mins) with FF
- a moderate speedup (0.3 mins -&gt; 0.2 mins) with IE11
- a slight slowdown (0.2 mins -&gt; 0.3 mins) with Chrome

I have been using ch08, ch09, ch10 (about 700 tests) as my benchmark.</thetext>
  </long_desc>
      
          <attachment
              isobsolete="1"
              ispatch="0"
              isprivate="0"
          >
            <attachid>2</attachid>
            <date>2011-06-25 09:05:00 -0700</date>
            <delta_ts>2011-07-03 13:26:16 -0700</delta_ts>
            <desc>faster sth.js file</desc>
            <filename>sthDocfrag.js</filename>
            <type>application/javascript</type>
            <size>17524</size>
            <attacher name="David Bruant">bruant.d</attacher>
            
              <data encoding="base64">77u/Ly8vIENvcHlyaWdodCAoYykgMjAwOSBNaWNyb3NvZnQgQ29ycG9yYXRpb24gDQovLy8gDQov
Ly8gUmVkaXN0cmlidXRpb24gYW5kIHVzZSBpbiBzb3VyY2UgYW5kIGJpbmFyeSBmb3Jtcywgd2l0
aCBvciB3aXRob3V0IG1vZGlmaWNhdGlvbiwgYXJlIHBlcm1pdHRlZCBwcm92aWRlZA0KLy8vIHRo
YXQgdGhlIGZvbGxvd2luZyBjb25kaXRpb25zIGFyZSBtZXQ6IA0KLy8vICAgICogUmVkaXN0cmli
dXRpb25zIG9mIHNvdXJjZSBjb2RlIG11c3QgcmV0YWluIHRoZSBhYm92ZSBjb3B5cmlnaHQgbm90
aWNlLCB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQNCi8vLyAgICAgIHRoZSBmb2xsb3dpbmcg
ZGlzY2xhaW1lci4gDQovLy8gICAgKiBSZWRpc3RyaWJ1dGlvbnMgaW4gYmluYXJ5IGZvcm0gbXVz
dCByZXByb2R1Y2UgdGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25k
aXRpb25zIGFuZCANCi8vLyAgICAgIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lciBpbiB0aGUgZG9j
dW1lbnRhdGlvbiBhbmQvb3Igb3RoZXIgbWF0ZXJpYWxzIHByb3ZpZGVkIHdpdGggdGhlIGRpc3Ry
aWJ1dGlvbi4gIA0KLy8vICAgICogTmVpdGhlciB0aGUgbmFtZSBvZiBNaWNyb3NvZnQgbm9yIHRo
ZSBuYW1lcyBvZiBpdHMgY29udHJpYnV0b3JzIG1heSBiZSB1c2VkIHRvDQovLy8gICAgICBlbmRv
cnNlIG9yIHByb21vdGUgcHJvZHVjdHMgZGVyaXZlZCBmcm9tIHRoaXMgc29mdHdhcmUgd2l0aG91
dCBzcGVjaWZpYyBwcmlvciB3cml0dGVuIHBlcm1pc3Npb24uDQovLy8gDQovLy8gVEhJUyBTT0ZU
V0FSRSBJUyBQUk9WSURFRCBCWSBUSEUgQ09QWVJJR0hUIEhPTERFUlMgQU5EIENPTlRSSUJVVE9S
UyAiQVMgSVMiIEFORCBBTlkgRVhQUkVTUyBPUg0KLy8vIElNUExJRUQgV0FSUkFOVElFUywgSU5D
TFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFRIRSBJTVBMSUVEIFdBUlJBTlRJRVMgT0YgTUVS
Q0hBTlRBQklMSVRZIEFORCBGSVRORVNTDQovLy8gRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFS
RSBESVNDTEFJTUVELiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQ09QWVJJR0hUIE9XTkVSIE9SIENP
TlRSSUJVVE9SUyBCRSBMSUFCTEUNCi8vLyBGT1IgQU5ZIERJUkVDVCwgSU5ESVJFQ1QsIElOQ0lE
RU5UQUwsIFNQRUNJQUwsIEVYRU1QTEFSWSwgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTIChJTkNM
VURJTkcsIEJVVCBOT1QNCi8vLyBMSU1JVEVEIFRPLCBQUk9DVVJFTUVOVCBPRiBTVUJTVElUVVRF
IEdPT0RTIE9SIFNFUlZJQ0VTOyBMT1NTIE9GIFVTRSwgREFUQSwgT1IgUFJPRklUUzsgT1IgQlVT
SU5FU1MNCi8vLyBJTlRFUlJVUFRJT04pIEhPV0VWRVIgQ0FVU0VEIEFORCBPTiBBTlkgVEhFT1JZ
IE9GIExJQUJJTElUWSwgV0hFVEhFUiBJTiBDT05UUkFDVCwgU1RSSUNUIExJQUJJTElUWSwNCi8v
LyBPUiBUT1JUIChJTkNMVURJTkcgTkVHTElHRU5DRSBPUiBPVEhFUldJU0UpIEFSSVNJTkcgSU4g
QU5ZIFdBWSBPVVQgT0YgVEhFIFVTRSBPRiBUSElTIFNPRlRXQVJFLCBFVkVOIElGDQovLy8gQURW
SVNFRCBPRiBUSEUgUE9TU0lCSUxJVFkgT0YgU1VDSCBEQU1BR0UuIA0KDQoNCi8qDQogKiBSdW4g
YSB0ZXN0IGluIHRoZSBicm93c2VyLiBXb3JrcyBieSBpbmplY3RpbmcgYW4gaWZyYW1lIHdpdGgg
dGhlIHRlc3QgY29kZS4NCiAqDQogKiBQdWJsaWMgTWV0aG9kczoNCiAqICogcnVuKGlkLCB0ZXN0
KTogUnVucyB0aGUgdGVzdCBzcGVjaWZpZWQuDQogKg0KICogQ2FsbGJhY2tzOg0KICogKiBvbkNv
bXBsZXRlKHRlc3QpOiBDYWxsZWQgd2hlbiB0aGUgdGVzdCBpcyBydW4uIFRlc3Qgb2JqZWN0IGNv
bnRhaW5zIHJlc3VsdCBhbmQgZXJyb3Igc3RyaW5ncyBkZXNjcmliaW5nIGhvdyB0aGUNCiAqICAg
ICAgICAgICAgICAgICAgICAgdGVzdCByYW4uDQogKi8NCmZ1bmN0aW9uIEJyb3dzZXJSdW5uZXIo
KSB7DQogICAgdmFyIGN1cnJlbnRUZXN0LCAgICAgICAgLy8gQ3VycmVudCB0ZXN0IGJlaW5nIHJ1
bi4NCiAgICAgICAgc2NyaXB0Q2FjaGUgPSB7fSwgICAvLyBIb2xkcyB0aGUgdmFyaW91cyBpbmNs
dWRlcyByZXF1aXJlZCB0byBydW4gY2VydGFpbiBzcHV0bmlrIHRlc3RzLg0KICAgICAgICBpbnN0
YW5jZSAgICA9IHRoaXM7DQoNCiAgICAvKiBDYWxsZWQgYnkgdGhlIGNoaWxkIHdpbmRvdyB0byBu
b3RpZnkgdGhhdCB0aGUgdGVzdCBoYXMgZmluaXNoZWQuIFRoaXMgZnVuY3Rpb24gY2FsbCBpcyBw
dXQgaW4gYSBzZXBhcmF0ZSBzY3JpcHQNCiAgICAgKiBibG9jayBhdCB0aGUgZW5kIG9mIHRoZSBw
YWdlIHNvIGVycm9ycyBpbiB0aGUgdGVzdCBzY3JpcHQgYmxvY2sgc2hvdWxkIG5vdCBwcmV2ZW50
IHRoaXMgZnVuY3Rpb24gZnJvbSBiZWluZw0KICAgICAqIGNhbGxlZC4NCiAgICAgKi8NCiAgICBm
dW5jdGlvbiB0ZXN0RmluaXNoZWQoKSB7DQogICAgICAgIGlmKHR5cGVvZiBjdXJyZW50VGVzdC5y
ZXN1bHQgPT09ICJ1bmRlZmluZWQiKSB7DQogICAgICAgICAgICAvLyBXZSBkaWRuJ3QgZ2V0IGEg
Y2FsbCB0byB0ZXN0UnVuLCB3aGljaCBsaWtlbHkgbWVhbnMgdGhlIHRlc3QgZmFpbGVkIHRvIGxv
YWQuDQogICAgICAgICAgICBjdXJyZW50VGVzdC5yZXN1bHQgPSAiZmFpbCI7DQogICAgICAgICAg
ICBjdXJyZW50VGVzdC5lcnJvciAgPSAiRmFpbGVkIHRvIExvYWQiOw0KICAgICAgICB9IGVsc2Ug
aWYodHlwZW9mIGN1cnJlbnRUZXN0LmVycm9yICE9PSAidW5kZWZpbmVkIikgew0KICAgICAgICAg
ICAgLy8gV2UgaGF2ZSBhbiBlcnJvciBsb2dnZWQgZnJvbSB0ZXN0UnVuLg0KICAgICAgICAgICAg
aWYoY3VycmVudFRlc3QuZXJyb3IgaW5zdGFuY2VvZiBTcHV0bmlrRXJyb3IpIHsNCiAgICAgICAg
ICAgICAgICBjdXJyZW50VGVzdC5lcnJvciA9IGN1cnJlbnRUZXN0Lm1lc3NhZ2U7DQogICAgICAg
ICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGN1cnJlbnRUZXN0LmVycm9yID0gY3VycmVu
dFRlc3QuZXJyb3IubmFtZSArICI6ICIgKyBjdXJyZW50VGVzdC5lcnJvci5tZXNzYWdlDQogICAg
ICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBpbnN0YW5jZS5vbkNvbXBsZXRlKGN1cnJl
bnRUZXN0KTsNCiAgICB9DQoNCiAgICAvKiBDYWxsZWQgZnJvbSB0aGUgY2hpbGQgd2luZG93IGFm
dGVyIHRoZSB0ZXN0IGhhcyBydW4uICovDQogICAgZnVuY3Rpb24gdGVzdFJ1bihpZCwgcGF0aCwg
ZGVzY3JpcHRpb24sIGNvZGVTdHJpbmcsIHByZWNvbmRpdGlvblN0cmluZywgcmVzdWx0LCBlcnJv
cikgew0KICAgICAgICBjdXJyZW50VGVzdC5pZCA9IGlkOw0KICAgICAgICBjdXJyZW50VGVzdC5w
YXRoID0gcGF0aDsNCiAgICAgICAgY3VycmVudFRlc3QuZGVzY3JpcHRpb24gPSBkZXNjcmlwdGlv
bjsNCiAgICAgICAgY3VycmVudFRlc3QucmVzdWx0ID0gcmVzdWx0Ow0KICAgICAgICBjdXJyZW50
VGVzdC5lcnJvciA9IGVycm9yOw0KICAgICAgICBjdXJyZW50VGVzdC5jb2RlID0gY29kZVN0cmlu
ZzsNCiAgICAgICAgY3VycmVudFRlc3QucHJlID0gcHJlY29uZGl0aW9uU3RyaW5nOw0KICAgIH0N
Cg0KDQogICAgLyogUnVuIHRoZSB0ZXN0LiAqLw0KICAgIHRoaXMucnVuID0gZnVuY3Rpb24oaWQs
IGNvZGUpIHsNCiAgICAgICAgdmFyIGlmcmFtZTsNCiAgICAgICAgdmFyIGluY2x1ZGVzID0gY29k
ZS5tYXRjaCgvXCRJTkNMVURFXCgoW15cKV0rKVwpL2cpLCAvLyBmaW5kIGFsbCBvZiB0aGUgJElO
Q0xVREUgc3RhdGVtZW50cw0KICAgICAgICAgICAgaW5jbHVkZTsNCg0KICAgICAgICBjdXJyZW50
VGVzdCA9IHtpZDogaWR9OyAvLyBkZWZhdWx0IHRlc3QsIGluIGNhc2UgaXQgZG9lc24ndCBnZXQg
cmVnaXN0ZXJlZC4NCg0KICAgICAgICBpZnJhbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJp
ZnJhbWUiKTsNCiAgICAgICAgaWZyYW1lLnNldEF0dHJpYnV0ZSgic3R5bGUiLCAiZGlzcGxheTpu
b25lIik7DQogICAgICAgIGlmcmFtZS5zZXRBdHRyaWJ1dGUoImlkIiwgInJ1bm5lcklmcmFtZSIp
Ow0KDQogICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoaWZyYW1lKTsNCg0KICAgICAg
ICB2YXIgd2luID0gaWZyYW1lLmNvbnRlbnRXaW5kb3c7IA0KICAgICAgICB2YXIgaWZyYW1lRG9j
ID0gd2luLmRvY3VtZW50Ow0KICAgICAgICANCiAgICAgICAgdmFyIHNjcmlwdHMgPSBpZnJhbWVE
b2MuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpOw0KDQogICAgICAgIGZ1bmN0aW9uIGFkZFNjcmlw
dChjb2RlKXsNCiAgICAgICAgICB2YXIgc2NyaXB0RWxlbWVudCA9IGlmcmFtZURvYy5jcmVhdGVF
bGVtZW50KCdzY3JpcHQnKTsNCiAgICAgICAgICBzY3JpcHRFbGVtZW50LnR5cGUgPSAndGV4dC9q
YXZhc2NyaXB0JzsNCiAgICAgICAgICBzY3JpcHRFbGVtZW50LnRleHRDb250ZW50ID0gY29kZTsN
CiAgICAgICAgICBzY3JpcHRzLmFwcGVuZENoaWxkKHNjcmlwdEVsZW1lbnQpOyAvLyBBcHBlbmRp
bmcgYXQgdGhlIGVuZCB0byByZXNwZWN0IHNjcmlwdCBpbnNlcnRpb24gb3JkZXINCiAgICAgICAg
fQ0KDQogICAgICAgIC8vIFNldCB1cCBzb21lIGdsb2JhbHMuDQogICAgICAgIHdpbi50ZXN0UnVu
ID0gdGVzdFJ1bjsNCiAgICAgICAgDQogICAgICAgIC8vVE9ETzogdGhlc2Ugc2hvdWxkIGJlIG1v
dmVkIHRvIHN0YS5qcw0KICAgICAgICB3aW4uU3B1dG5pa0Vycm9yID0gU3B1dG5pa0Vycm9yOw0K
ICAgICAgICB3aW4uJEVSUk9SID0gJEVSUk9SOw0KICAgICAgICB3aW4uJEZBSUwgID0gJEZBSUw7
DQogICAgICAgIHdpbi4kUFJJTlQgPSBmdW5jdGlvbiAoKSB7fTsNCiAgICAgICAgd2luLiRJTkNM
VURFID0gZnVuY3Rpb24oKSB7fTsNCg0KICAgICAgICBpZihpbmNsdWRlcyAhPT0gbnVsbCkgew0K
ICAgICAgICAgICAgLy8gV2UgaGF2ZSBzb21lIGluY2x1ZGVzLCBzbyBsb29wIHRocm91Z2ggZWFj
aCBpbmNsdWRlIGFuZCBwdWxsIGluIHRoZSBkZXBlbmRlbmNpZXMuDQogICAgICAgICAgICBmb3Io
dmFyIGkgPSAwOyBpIDwgaW5jbHVkZXMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgICBp
bmNsdWRlID0gaW5jbHVkZXNbaV0ucmVwbGFjZSgvLipcKCgnfCIpKC4qKSgnfCIpXCkvLCAiJDIi
KTsNCg0KICAgICAgICAgICAgICAgIC8vIEZpcnN0IGNoZWNrIHRvIHNlZSBpZiB3ZSBoYXZlIHRo
aXMgc2NyaXB0IGNhY2hlZCBhbHJlYWR5LCBhbmQgaWYgbm90LCBncmFiIGl0Lg0KICAgICAgICAg
ICAgICAgIGlmKHR5cGVvZiBzY3JpcHRDYWNoZVtpbmNsdWRlXSA9PT0gInVuZGVmaW5lZCIpIHsN
CiAgICAgICAgICAgICAgICAgICAgJC5hamF4KHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGFz
eW5jOiBmYWxzZSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHVybDogJ3Jlc291cmNlcy9zY3Jp
cHRzL2dsb2JhbC8nICsgaW5jbHVkZSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6
IGZ1bmN0aW9uKHMpIHsgc2NyaXB0Q2FjaGVbaW5jbHVkZV0gPSBzOyB9DQogICAgICAgICAgICAg
ICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICANCiAgICAgICAg
ICAgICAgICAvLyBGaW5hbGx5LCB3cml0ZSB0aGUgcmVxdWlyZWQgc2NyaXB0IHRvIHRoZSB3aW5k
b3cuDQogICAgICAgICAgICAgICAgYWRkU2NyaXB0KHNjcmlwdENhY2hlW2luY2x1ZGVdKTsNCiAg
ICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICAgICANCiAgICAgICAgLy9Xcml0ZSBvdXQg
YWxsIG9mIG91ciBoZWxwZXIgZnVuY3Rpb25zDQogICAgICAgIGFkZFNjcmlwdChQaWNrbGVkU2lt
cGxlVGVzdEFQSXMpOw0KICAgICAgICANCiAgICAgICAgLy8tLVNjZW5hcmlvIDE6IHdlJ3JlIGRl
YWxpbmcgd2l0aCBhIGdsb2JhbCBzY29wZSB0ZXN0IGNhc2UNCiAgICAgICAgaWYgKEdsb2JhbFNj
b3BlVGVzdHNbaWRdIT09dW5kZWZpbmVkKSB7DQogICAgICAgICAgICB3aW4uaWZyYW1lRXJyb3Ig
PSB1bmRlZmluZWQ7DQogICAgICAgICAgICB3aW4ub25lcnJvciA9IHVuZGVmaW5lZDsNCiAgICAg
ICAgICAgIHdpbi5vbkVycm9ySGFjayA9IHVuZGVmaW5lZDsNCg0KICAgICAgICAgICAgLy9BZGQg
YW4gZXJyb3IgaGFuZGxlcg0KICAgICAgICAgICAgYWRkU2NyaXB0KCJ3aW5kb3cub25lcnJvciA9
IGZ1bmN0aW9uKGVycm9yTXNnLCB1cmwsIGxpbmVOdW1iZXIpIHt3aW5kb3cuaWZyYW1lRXJyb3Ig
PSBlcnJvck1zZzt9OyIpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAvL1BhcnNlIGFuZCBl
eGVjdXRlIHRoZSBjb2RlDQogICAgICAgICAgICBhZGRTY3JpcHQoIm9uRXJyb3JIYWNrID0gdHJ1
ZTt0cnl7IiArIGNvZGUgKyAifWNhdGNoKHRlc3QyNjJSdW50aW1lRXJyb3Ipe3dpbmRvdy5pZnJh
bWVFcnJvcj10ZXN0MjYyUnVudGltZUVycm9yLm1lc3NhZ2UgfHwgJ05vbmUnO30iKTsNCiAgICAg
ICAgfQ0KICAgICAgICAvLy0tU2NlbmFyaW8gMjogIHdlJ3JlIGRlYWxpbmcgd2l0aCBhIG5vcm1h
bCBwb3NpdGl2ZSg/KSB0ZXN0IGNhc2UNCiAgICAgICAgZWxzZSB7DQogICAgICAgIA0KICAgICAg
ICAgICAgLy8gV3JpdGUgRVM1SGFybmVzcy5yZWdpc3RlclRlc3QgYW5kIGZuR2xvYmFsT2JqZWN0
LCB3aGljaCByZXR1cm5zIHRoZSBnbG9iYWwgb2JqZWN0LCBhbmQgdGhlIHRlc3RGaW5pc2hlZCBj
YWxsLg0KICAgICAgICAgICAgYWRkU2NyaXB0KCJFUzVIYXJuZXNzID0ge307IiArDQogICAgICAg
ICAgICAgICAgICAgICAgIkVTNUhhcm5lc3MucmVnaXN0ZXJUZXN0ID0gZnVuY3Rpb24odGVzdCkg
eyIgKw0KICAgICAgICAgICAgICAgICAgICAgICIgIHZhciBlcnJvcjsiICsNCiAgICAgICAgICAg
ICAgICAgICAgICAiICBpZih0ZXN0LnByZWNvbmRpdGlvbiAmJiAhdGVzdC5wcmVjb25kaXRpb24o
KSkgeyIgKw0KICAgICAgICAgICAgICAgICAgICAgICIgICAgdGVzdFJ1bih0ZXN0LmlkLCB0ZXN0
LnBhdGgsIHRlc3QuZGVzY3JpcHRpb24sIHRlc3QudGVzdC50b1N0cmluZygpLHR5cGVvZiB0ZXN0
LnByZWNvbmRpdGlvbiAhPT0gJ3VuZGVmaW5lZCcgPyB0ZXN0LnByZWNvbmRpdGlvbi50b1N0cmlu
ZygpIDogJycsICdmYWlsJywgJ1ByZWNvbmRpdGlvbiBGYWlsZWQnKTsiICsNCiAgICAgICAgICAg
ICAgICAgICAgICAiICB9IGVsc2UgeyIgKw0KICAgICAgICAgICAgICAgICAgICAgICIgICAgdmFy
IHRlc3RUaGlzID0gdGVzdC5zdHJpY3Q9PT11bmRlZmluZWQgPyB3aW5kb3cgOiB1bmRlZmluZWQ7
IiArDQogICAgICAgICAgICAgICAgICAgICAgIiAgICB0cnkgeyB2YXIgcmVzID0gdGVzdC50ZXN0
LmNhbGwodGVzdFRoaXMpOyB9IGNhdGNoKGUpIHsgcmVzID0gJ2ZhaWwnOyBlcnJvciA9IGU7IH0i
ICsNCiAgICAgICAgICAgICAgICAgICAgICAiICAgIHZhciByZXRWYWwgPSAvXnMvaS50ZXN0KHRl
c3QuaWQpID8gKHJlcyA9PT0gdHJ1ZSB8fCB0eXBlb2YgcmVzID09PSAndW5kZWZpbmVkJyA/ICdw
YXNzJyA6ICdmYWlsJykgOiAocmVzID09PSB0cnVlID8gJ3Bhc3MnIDogJ2ZhaWwnKTsiICsNCiAg
ICAgICAgICAgICAgICAgICAgICAiICAgIHRlc3RSdW4odGVzdC5pZCwgdGVzdC5wYXRoLCB0ZXN0
LmRlc2NyaXB0aW9uLCB0ZXN0LnRlc3QudG9TdHJpbmcoKSwgdHlwZW9mIHRlc3QucHJlY29uZGl0
aW9uICE9PSAndW5kZWZpbmVkJyA/IHRlc3QucHJlY29uZGl0aW9uLnRvU3RyaW5nKCkgOiAnJywg
cmV0VmFsLCBlcnJvcik7IiArDQogICAgICAgICAgICAgICAgICAgICAgIiAgfSIgKw0KICAgICAg
ICAgICAgICAgICAgICAgICJ9Iik7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGFkZFNjcmlw
dChjb2RlKTsgICAgIA0KICAgICAgICB9DQoNCiAgICAgICAgaWZyYW1lRG9jLmhlYWQuYXBwZW5k
Q2hpbGQoc2NyaXB0cyk7IC8vIEFwcGVuZGluZyB0aGUgZG9jdW1lbnQgZnJhZ21lbnQgdG8gbG9h
ZCBhbGwgc2NyaXB0cyBhdCBvbmNlLg0KDQogICAgICAgIGlmIChHbG9iYWxTY29wZVRlc3RzW2lk
XSE9PXVuZGVmaW5lZCkgeyAvLyBHYXRoZXIgcmVzdWx0cw0KICAgICAgICAgICAgdmFyIHRlc3RE
ZXNjcmlwID0gR2xvYmFsU2NvcGVUZXN0c1tpZF07DQogICAgICAgICAgICANCiAgICAgICAgICAg
IGlmICh0ZXN0RGVzY3JpcC5uZWdhdGl2ZSE9PXVuZGVmaW5lZCkgeyAgLy9BbiBleGNlcHRpb24g
aXMgZXhwZWN0ZWQNCiAgICAgICAgICAgICAgICBpZiAod2luLm9uRXJyb3JIYWNrPT09dW5kZWZp
bmVkKSB7ICAvL0hhY2sgZm9yIGJyb3dzZXJzIG5vdCBzdXBwb3J0aW5nIHdpbmRvdy5vbmVycm9y
IFdSVCBlYXJseSBwYXJzZSBlcnJvcnMNCiAgICAgICAgICAgICAgICAgICAgdGVzdFJ1bih0ZXN0
RGVzY3JpcC5pZCwgdGVzdERlc2NyaXAucGF0aCwgdGVzdERlc2NyaXAuZGVzY3JpcHRpb24sIGNv
ZGUsIHR5cGVvZiB0ZXN0RGVzY3JpcC5wcmVjb25kaXRpb24gIT09ICd1bmRlZmluZWQnID8gdGVz
dERlc2NyaXAucHJlY29uZGl0aW9uLnRvU3RyaW5nKCkgOiAnJywgDQogICAgICAgICAgICAgICAg
ICAgICAgICAgICAgJ3Bhc3MnLCAnTm90IHBhcnNhYmxlJyk7DQogICAgICAgICAgICAgICAgfQ0K
ICAgICAgICAgICAgICAgIGVsc2UgaWYgKHdpbi5pZnJhbWVFcnJvcj09PXVuZGVmaW5lZCkgeyAv
L25vIGV4Y2VwdGlvbiB3YXMgdGhyb3duDQogICAgICAgICAgICAgICAgICAgIHRlc3RSdW4odGVz
dERlc2NyaXAuaWQsIHRlc3REZXNjcmlwLnBhdGgsIHRlc3REZXNjcmlwLmRlc2NyaXB0aW9uLCBj
b2RlLCB0eXBlb2YgdGVzdERlc2NyaXAucHJlY29uZGl0aW9uICE9PSAndW5kZWZpbmVkJyA/IHRl
c3REZXNjcmlwLnByZWNvbmRpdGlvbi50b1N0cmluZygpIDogJycsIA0KICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICdmYWlsJywgJ05vIEV4Y2VwdGlvbiBUaHJvd24nKTsNCiAgICAgICAgICAg
ICAgICB9IGVsc2UgaWYoISAobmV3IFJlZ0V4cCh0ZXN0RGVzY3JpcC5uZWdhdGl2ZSwgImkiKS50
ZXN0KHdpbi5pZnJhbWVFcnJvcikpKSB7ICAvL3dyb25nIHR5cGUgb2YgZXhjZXB0aW9uIHRocm93
bg0KICAgICAgICAgICAgICAgICAgICB0ZXN0UnVuKHRlc3REZXNjcmlwLmlkLCB0ZXN0RGVzY3Jp
cC5wYXRoLCB0ZXN0RGVzY3JpcC5kZXNjcmlwdGlvbiwgY29kZSwgdHlwZW9mIHRlc3REZXNjcmlw
LnByZWNvbmRpdGlvbiAhPT0gJ3VuZGVmaW5lZCcgPyB0ZXN0RGVzY3JpcC5wcmVjb25kaXRpb24u
dG9TdHJpbmcoKSA6ICcnLCANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZmFpbCcsICdX
cm9uZyBUeXBlIG9mIEV4Y2VwdGlvbiBUaHJvd24nKTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ug
ew0KICAgICAgICAgICAgICAgICAgICB0ZXN0UnVuKHRlc3REZXNjcmlwLmlkLCB0ZXN0RGVzY3Jp
cC5wYXRoLCB0ZXN0RGVzY3JpcC5kZXNjcmlwdGlvbiwgY29kZSwgdHlwZW9mIHRlc3REZXNjcmlw
LnByZWNvbmRpdGlvbiAhPT0gJ3VuZGVmaW5lZCcgPyB0ZXN0RGVzY3JpcC5wcmVjb25kaXRpb24u
dG9TdHJpbmcoKSA6ICcnLCANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAncGFzcycsIHVu
ZGVmaW5lZCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSBlbHNlIGlmICh3aW4u
aWZyYW1lRXJyb3IhPT11bmRlZmluZWQpIHsgIC8vRXhjZXB0aW9uIHdhcyBub3QgZXhwZWN0ZWQg
dG8gYmUgdGhyb3duDQogICAgICAgICAgICAgICAgdGVzdFJ1bih0ZXN0RGVzY3JpcC5pZCwgdGVz
dERlc2NyaXAucGF0aCwgdGVzdERlc2NyaXAuZGVzY3JpcHRpb24sIGNvZGUsIHR5cGVvZiB0ZXN0
RGVzY3JpcC5wcmVjb25kaXRpb24gIT09ICd1bmRlZmluZWQnID8gdGVzdERlc2NyaXAucHJlY29u
ZGl0aW9uLnRvU3RyaW5nKCkgOiAnJywgDQogICAgICAgICAgICAgICAgICAgICAgICAnZmFpbCcs
ICdVbmV4cGVjdGVkIEV4Y2VwdGlvbicpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAg
ICAgICAgICB0ZXN0UnVuKHRlc3REZXNjcmlwLmlkLCB0ZXN0RGVzY3JpcC5wYXRoLCB0ZXN0RGVz
Y3JpcC5kZXNjcmlwdGlvbiwgY29kZSwgdHlwZW9mIHRlc3REZXNjcmlwLnByZWNvbmRpdGlvbiAh
PT0gJ3VuZGVmaW5lZCcgPyB0ZXN0RGVzY3JpcC5wcmVjb25kaXRpb24udG9TdHJpbmcoKSA6ICcn
LCANCiAgICAgICAgICAgICAgICAgICAgICAgICdwYXNzJywgdW5kZWZpbmVkKTsNCiAgICAgICAg
ICAgIH0NCiAgICAgICAgfQ0KIA0KICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGlm
cmFtZSk7DQogICAgICAgIHRlc3RGaW5pc2hlZCgpOw0KICAgIH0NCn0NCg0KLyogTG9hZHMgdGVz
dHMgZnJvbSB0aGUgc2VjdGlvbnMgc3BlY2lmaWVkIGluIHRlc3RjYXNlc2xpc3QuanNvbi4NCiAq
IFB1YmxpYyBNZXRob2RzOg0KICogKiBnZXROZXh0VGVzdCgpIC0gU3RhcnQgbG9hZGluZyB0aGUg
bmV4dCB0ZXN0Lg0KICogKiByZXNldCgpIC0gU3RhcnQgb3ZlciBhdCB0aGUgZmlyc3QgdGVzdC4N
CiAqDQogKiBDYWxsYmFja3M6DQogKiAqIG9uTG9hZGluZ05leHRTZWN0aW9uKHBhdGgpOiBDYWxs
ZWQgYWZ0ZXIgYSByZXF1ZXN0IGlzIHNlbnQgZm9yIHRoZSBuZXh0IHNlY3Rpb24geG1sLCB3aXRo
IHRoZSBwYXRoIHRvIHRoYXQgeG1sLg0KICogKiBvbkluaXRpYWxpemVkKHRvdGFsVGVzdHMsIHZl
cnNpb24sIGRhdGUpOiBDYWxsZWQgYWZ0ZXIgdGhlIHRlc3RjYXNlc2xpc3QueG1sIGlzIGxvYWRl
ZCBhbmQgcGFyc2VkLg0KICogKiBvblRlc3RSZWFkeShpZCwgY29kZSk6IENhbGxlZCB3aGVuIGEg
dGVzdCBpcyByZWFkeSB3aXRoIHRoZSB0ZXN0J3MgaWQgYW5kIGNvZGUuDQogKiAqIG9uVGVzdHNF
eGhhdXN0ZWQoKTogQ2FsbGVkIHdoZW4gdGhlcmUgYXJlIG5vIG1vcmUgdGVzdHMgdG8gcnVuLg0K
ICovDQpmdW5jdGlvbiBUZXN0TG9hZGVyKCkgew0KICAgIHZhciB0ZXN0R3JvdXBzICAgICAgID0g
W10sDQogICAgICAgIHRlc3RHcm91cEluZGV4ICAgPSAwLA0KICAgICAgICBjdXJyZW50VGVzdElu
ZGV4ID0gMCwNCiAgICAgICAgbG9hZGVyICAgICAgICAgICA9IHRoaXM7DQoNCiAgICB0aGlzLnZl
cnNpb24gICAgPSB1bmRlZmluZWQ7DQogICAgdGhpcy5kYXRlICAgICAgID0gdW5kZWZpbmVkOw0K
ICAgIHRoaXMudG90YWxUZXN0cyA9IDA7DQoNCiAgICAvKiBHZXQgdGhlIFhNTCBmb3IgdGhlIG5l
eHQgc2VjdGlvbiAqLw0KICAgIGZ1bmN0aW9uIGdldE5leHRYTUwoKSB7DQogICAgICAgIHZhciBn
cm91cCA9IHRlc3RHcm91cHNbdGVzdEdyb3VwSW5kZXhdOw0KICAgICAgICBjdXJyZW50VGVzdElu
ZGV4ID0gMDsNCg0KICAgICAgICBpZihncm91cC50ZXN0cy5sZW5ndGggPiAwKSB7DQogICAgICAg
ICAgICAvLyBhbHJlYWR5IGxvYWRlZCB0aGlzIHNlY3Rpb24uDQogICAgICAgICAgICBsb2FkZXIu
Z2V0TmV4dFRlc3QoKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICAk
LmFqYXgoe3VybDogZ3JvdXAucGF0aCwgZGF0YVR5cGU6ICdqc29uJywgc3VjY2VzczogZnVuY3Rp
b24oZGF0YSkgew0KICAgICAgICAgICAgZ3JvdXAudGVzdHMgPSBkYXRhLnRlc3RzQ29sbGVjdGlv
bi50ZXN0czsNCiAgICAgICAgICAgIGxvYWRlci5nZXROZXh0VGVzdCgpOw0KICAgICAgICB9LAkN
CgllcnJvcjogZnVuY3Rpb24gKFhNTEh0dHBSZXF1ZXN0LCB0ZXh0U3RhdHVzLCBlcnJvclRocm93
bikgew0KCQkvL2FsZXJ0KFhNTEh0dHBSZXF1ZXN0KTsgDQoJfQ0KDQoJfSk7DQoNCiAgICAgICAg
bG9hZGVyLm9uTG9hZGluZ05leHRTZWN0aW9uKGdyb3VwLnBhdGgpOw0KICAgIH0NCg0KICAgIC8q
IEdldCB0aGUgdGVzdCBsaXN0IHhtbCAqLw0KICAgIGZ1bmN0aW9uIGxvYWRUZXN0WE1MKCkgew0K
ICAgICAgICB2YXIgdGVzdHNMaXN0TG9hZGVyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7DQoNCiAg
ICAgICAgJC5hamF4KHt1cmw6IFRFU1RfTElTVF9QQVRILCBkYXRhVHlwZTogJ2pzb24nLCBzdWNj
ZXNzOiBmdW5jdGlvbihkYXRhKSB7DQogICAgICAgICAgICB2YXIgdGVzdFN1aXRlID0gZGF0YS50
ZXN0U3VpdGU7DQoNCiAgICAgICAgICAgIGxvYWRlci52ZXJzaW9uICAgID0gZGF0YS52ZXJzaW9u
Ow0KICAgICAgICAgICAgbG9hZGVyLmRhdGUgICAgICAgPSBkYXRhLmRhdGU7DQogICAgICAgICAg
ICBsb2FkZXIudG90YWxUZXN0cyA9IGRhdGEubnVtVGVzdHM7ICAgICAgICAgICAgICAgDQoNCiAg
ICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGVzdFN1aXRlLmxlbmd0aDsgaSsrKSB7DQog
ICAgICAgICAgICAgICAgdGVzdEdyb3Vwc1tpXSA9IHsNCiAgICAgICAgICAgICAgICAgICAgcGF0
aDogdGVzdFN1aXRlW2ldLA0KICAgICAgICAgICAgICAgICAgICB0ZXN0czogW10NCiAgICAgICAg
ICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBsb2FkZXIub25Jbml0aWFsaXpl
ZChsb2FkZXIudG90YWxUZXN0cywgbG9hZGVyLnZlcnNpb24sIGxvYWRlci5kYXRlKTsNCiAgICAg
ICAgICAgIGdldE5leHRYTUwoKTsNCiAgICAgICAgfX0pOw0KICAgIH0NCg0KICAgIC8qIE1vdmUg
b24gdG8gdGhlIG5leHQgdGVzdCAqLw0KICAgIHRoaXMuZ2V0TmV4dFRlc3QgPSBmdW5jdGlvbigp
IHsNCiAgICAgICAgaWYodGVzdEdyb3Vwcy5sZW5ndGggPT0gMCkgew0KICAgICAgICAgICAgLy8g
SW5pdGlhbGl6ZS4NCiAgICAgICAgICAgIGxvYWRUZXN0WE1MKCk7DQogICAgICAgIH0gZWxzZSBp
ZihjdXJyZW50VGVzdEluZGV4IDwgdGVzdEdyb3Vwc1t0ZXN0R3JvdXBJbmRleF0udGVzdHMubGVu
Z3RoKSB7DQogICAgICAgICAgICAvLyBXZSBoYXZlIHRlc3RzIGxlZnQgaW4gdGhpcyB0ZXN0IGdy
b3VwLg0KICAgICAgICAgICAgdmFyIHRlc3QgPSB0ZXN0R3JvdXBzW3Rlc3RHcm91cEluZGV4XS50
ZXN0c1tjdXJyZW50VGVzdEluZGV4KytdOw0KCSAgICB2YXIgc2NyaXB0Q29kZSA9IHRlc3QuY29k
ZTsNCiAgICAgICAgICAgIC8vdmFyIHNjcmlwdENvZGUgPSAodGVzdC5maXJzdENoaWxkLnRleHQg
IT0gdW5kZWZpbmVkKSA/IHRlc3QuZmlyc3RDaGlsZC50ZXh0IDogdGVzdC5maXJzdENoaWxkLnRl
eHRDb250ZW50Ow0KDQogICAgICAgICAgICBsb2FkZXIub25UZXN0UmVhZHkodGVzdC5pZCwgJC5i
YXNlNjREZWNvZGUoc2NyaXB0Q29kZSkpOw0KICAgICAgICB9IGVsc2UgaWYodGVzdEdyb3VwSW5k
ZXggPCB0ZXN0R3JvdXBzLmxlbmd0aCAtIDEpIHsNCiAgICAgICAgICAgIC8vIFdlIGRvbid0IGhh
dmUgdGVzdHMgbGVmdCBpbiB0aGlzIHRlc3QgZ3JvdXAsIHNvIG1vdmUgb24gdG8gdGhlIG5leHQu
DQogICAgICAgICAgICB0ZXN0R3JvdXBJbmRleCsrOw0KICAgICAgICAgICAgZ2V0TmV4dFhNTCgp
Ow0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgLy8gV2UncmUgZG9uZS4NCiAgICAgICAg
ICAgIGxvYWRlci5vblRlc3RzRXhoYXVzdGVkKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAv
KiBTdGFydCBvdmVyIGF0IHRoZSBiZWdpbm5pbmcgKi8NCiAgICB0aGlzLnJlc2V0ID0gZnVuY3Rp
b24oKSB7DQogICAgICAgIGN1cnJlbnRUZXN0SW5kZXggPSAwOw0KICAgICAgICB0ZXN0R3JvdXBJ
bmRleCA9IDA7DQogICAgfQ0KfQ0KDQovKiBDb250cm9scyB0ZXN0IGdlbmVyYXRpb24gYW5kIHJ1
bm5pbmcsIGFuZCBzZW5kcyByZXN1bHRzIHRvIHRoZSBwcmVzZW50ZXIuICovDQpmdW5jdGlvbiBD
b250cm9sbGVyKCkgew0KICAgIHZhciBzdGF0ZSAgPSAnc3RvcHBlZCc7DQogICAgdmFyIHJ1bm5l
ciA9IG5ldyBCcm93c2VyUnVubmVyKCk7DQogICAgdmFyIGxvYWRlciA9IG5ldyBUZXN0TG9hZGVy
KCk7DQogICAgdmFyIGNvbnRyb2xsZXIgPSB0aGlzOw0KICAgIHZhciBzdGFydFRpbWU7DQogICAg
dmFyIGVsYXBzZWQgPSAwOw0KDQogICAgcnVubmVyLm9uQ29tcGxldGUgPSBmdW5jdGlvbih0ZXN0
KSB7DQogICAgICAgIHByZXNlbnRlci5hZGRUZXN0UmVzdWx0KHRlc3QpOw0KDQogICAgICAgIGlm
KHN0YXRlID09PSAncnVubmluZycpDQogICAgICAgICAgICBzZXRUaW1lb3V0KGxvYWRlci5nZXRO
ZXh0VGVzdCwgMTApOw0KICAgIH0NCg0KICAgIGxvYWRlci5vbkluaXRpYWxpemVkID0gZnVuY3Rp
b24odG90YWxUZXN0cywgdmVyc2lvbiwgZGF0ZSkgew0KICAgICAgICBwcmVzZW50ZXIuc2V0VmVy
c2lvbih2ZXJzaW9uKTsNCiAgICAgICAgcHJlc2VudGVyLnNldERhdGUoZGF0ZSk7DQogICAgICAg
IHByZXNlbnRlci5zZXRUb3RhbFRlc3RzKHRvdGFsVGVzdHMpOw0KICAgIH0NCg0KICAgIGxvYWRl
ci5vbkxvYWRpbmdOZXh0U2VjdGlvbiA9IGZ1bmN0aW9uKHBhdGgpIHsNCiAgICAgICAgcHJlc2Vu
dGVyLnVwZGF0ZVN0YXR1cygiTG9hZGluZzogIiArIHBhdGgpOw0KICAgIH0NCg0KICAgIGxvYWRl
ci5vblRlc3RSZWFkeSA9IGZ1bmN0aW9uKGlkLCB0ZXN0KSB7DQogICAgICAgIHByZXNlbnRlci51
cGRhdGVTdGF0dXMoIkV4ZWN1dGluZyBUZXN0OiAiICsgaWQpOw0KICAgICAgICBydW5uZXIucnVu
KGlkLCB0ZXN0KTsNCiAgICB9DQoNCiAgICBsb2FkZXIub25UZXN0c0V4aGF1c3RlZCA9IGZ1bmN0
aW9uKCkgew0KICAgICAgICBzdGF0ZSA9ICdzdG9wcGVkJzsNCiAgICAgICAgZWxhcHNlZCArPSBu
ZXcgRGF0ZSgpIC0gc3RhcnRUaW1lOw0KICAgICAgICBlbGFwc2VkID0gZWxhcHNlZC8oMTAwMCo2
MCk7ICAvL21pbnV0ZXMNCiAgICAgICAgZWxhcHNlZCA9IGVsYXBzZWQudG9GaXhlZCgxKTsNCiAg
ICAgICAgcHJlc2VudGVyLmZpbmlzaGVkKGVsYXBzZWQpOw0KICAgIH0NCg0KICAgIHRoaXMuc3Rh
cnQgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgc3RhdGUgPSAncnVubmluZyc7DQogICAgICAgIHN0
YXJ0VGltZSA9IG5ldyBEYXRlKCk7DQogICAgICAgIGxvYWRlci5nZXROZXh0VGVzdCgpOw0KICAg
ICAgICBwcmVzZW50ZXIuc3RhcnRlZCgpOw0KICAgIH0NCiAgICANCiAgICB0aGlzLnBhdXNlID0g
ZnVuY3Rpb24oKSB7DQogICAgICAgIGVsYXBzZWQgKz0gbmV3IERhdGUoKSAtIHN0YXJ0VGltZTsN
CiAgICAgICAgc3RhdGUgPSAncGF1c2VkJzsNCiAgICAgICAgcHJlc2VudGVyLnBhdXNlZCgpOw0K
ICAgIH0NCg0KICAgIHRoaXMucmVzZXQgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgc3RhcnRUaW1l
ID0gbmV3IERhdGUoKTsNCiAgICAgICAgZWxhcHNlZCA9IDA7DQogICAgICAgIGxvYWRlci5yZXNl
dCgpOw0KICAgICAgICBwcmVzZW50ZXIucmVzZXQoKTsNCiAgICB9DQoNCiAgICB0aGlzLnRvZ2ds
ZSA9IGZ1bmN0aW9uKCkgew0KICAgICAgICBpZihzdGF0ZSA9PT0gJ3J1bm5pbmcnKSB7DQogICAg
ICAgICAgICBjb250cm9sbGVyLnBhdXNlKCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAg
ICBjb250cm9sbGVyLnN0YXJ0KCk7DQogICAgICAgIH0NCiAgICB9DQp9DQoNCnZhciBjb250cm9s
bGVyID0gbmV3IENvbnRyb2xsZXIoKQ0KDQovKiBIZWxwZXIgZnVuY3Rpb24gd2hpY2ggc2hvd3Mg
aWYgd2UncmUgaW4gdGhlICdkZWJ1ZycgbW9kZSBvZiB0aGUgVGVzdDI2MiBzaXRlLg0KICAgVGhp
cyBtb2RlIGlzIG9ubHkgdXNlZnVsIGZvciBkZWJ1Z2dpbmcgaXNzdWVzIHdpdGggdGhlIHRlc3Qg
aGFybmVzcyBhbmQgDQogICB3ZWJzaXRlLiAqLw0KZnVuY3Rpb24gaXNTaXRlRGVidWdNb2RlKCkg
ew0KICAgIHZhciBzdHI9d2luZG93LmxvY2F0aW9uLmhyZWYuc3Vic3RyaW5nKHdpbmRvdy5sb2Nh
dGlvbi5ocmVmLmluZGV4T2YoIj8iKSsxKQ0KICAgIGlmKHN0ci5pbmRleE9mKCJzaXRlZGVidWci
KSA+IC0xKSB7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAg
ICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCn0NCg0KDQokKGZ1bmN0aW9uICgpIHsNCiAgICBwcmVz
ZW50ZXIuc2V0dXAoKTsNCg0KICAgICQoJy5jb250ZW50LWhvbWUnKS5zaG93KCk7DQogICAgLy8g
QWRkaW5nIGF0dHJpYnV0ZSB0byB0aGUgdGFicyAoZS5nLiBIb21lLCBSdW4gZXRjLikgYW5kIGF0
dGFjaGluZyB0aGUgY2xpY2sgZXZlbnQgb24gYnV0dG9ucyAoZS5nLiBSZXNldCwgU3RhcnQgZXRj
LikNCiAgICAkKCcubmF2LWxpbmsnKS5lYWNoKGZ1bmN0aW9uIChpbmRleCkgew0KICAgICAgICAv
L0FkZGluZyAidGFyZ2V0RGl2IiBhdHRyaWJ1dGUgdG8gdGhlIGhlYWRlciB0YWIgYW5kIG9uIHRo
YXQgYmFzaXMgdGhlIGRpdiByZWxhdGVkIHRvIGhlYWRlciB0YWJzIGFyZSBkaXNwbGF5ZWQNCiAg
ICAgICAgaWYgKGluZGV4ID09PSAwKSB7DQogICAgICAgICAgICAkKHRoaXMpLmF0dHIoJ3Rhcmdl
dERpdicsICcuY29udGVudC1ob21lJyk7DQogICAgICAgIH0gZWxzZSBpZiAoaW5kZXggPT09IDEp
IHsNCiAgICAgICAgICAgICQodGhpcykuYXR0cigndGFyZ2V0RGl2JywgJy5jb250ZW50LXRlc3Rz
Jyk7DQogICAgICAgIH0gZWxzZSBpZiAoaW5kZXggPT09IDIpIHsNCiAgICAgICAgICAgICQodGhp
cykuYXR0cigndGFyZ2V0RGl2JywgJy5jb250ZW50LXJlc3VsdHMnKTsNCiAgICAgICAgICAgICQo
dGhpcykuYXR0cigndGVzdFJ1bm5pbmcnLCAnZmFsc2UnKTsNCiAgICAgICAgfSBlbHNlIGlmIChp
bmRleCA9PT0gMykgew0KICAgICAgICAgICAgJCh0aGlzKS5hdHRyKCd0YXJnZXREaXYnLCAnLmNv
bnRlbnQtZGV2Jyk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAkKHRo
aXMpLmF0dHIoJ3RhcmdldERpdicsICcuY29udGVudC1icm93c2VycycpOw0KICAgICAgICB9DQoN
CiAgICAgICAgLy9BdHRhY2hpbmcgdGhlIGNsaWNrIGV2ZW50IHRvIHRoZSBoZWFkZXIgdGFiIHRo
YXQgc2hvd3MgdGhlIHJlc3BlY3RpdmUgZGl2IG9mIGhlYWRlciAgICAgICAgICAgIA0KICAgICAg
ICAkKHRoaXMpLmNsaWNrKGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHZhciB0YXJnZXQgPSAk
KHRoaXMpLmF0dHIoJ3RhcmdldERpdicpOw0KICAgICAgICAgICAgJCgnI2NvbnRlbnRDb250YWlu
ZXIgPiBkaXY6dmlzaWJsZScpLmhpZGUoKTsNCiAgICAgICAgICAgICQoJy5uYXZCYXIgLnNlbGVj
dGVkJykudG9nZ2xlQ2xhc3MoJ3NlbGVjdGVkJyk7DQogICAgICAgICAgICAkKHRoaXMpLmFkZENs
YXNzKCdzZWxlY3RlZCcpOw0KICAgICAgICAgICAgJCh0YXJnZXQpLnNob3coKTsNCg0KICAgICAg
ICAgICAgLy9JZiBjbGlja2VkIHRhYiBpcyBSZXN1bHQsIGl0IGdlbmVyYXRlcyB0aGUgcmVzdWx0
cy4NCiAgICAgICAgICAgIGlmICgkKHRhcmdldCkuaGFzQ2xhc3MoJ2NvbnRlbnQtcmVzdWx0cycp
KSB7DQogICAgICAgICAgICAgICAgcHJlc2VudGVyLnJlZnJlc2goKTsNCiAgICAgICAgICAgIH0N
CiAgICAgICAgfSk7DQogICAgfSk7DQoNCiAgICAvL0F0dGFjaCB0aGUgY2xpY2sgZXZlbnQgdG8g
dGhlIHN0YXJ0IGJ1dHRvbi4gSXQgc3RhcnRzLCBzdG9wcyBhbmQgcGF1c2VzIHRoZSB0ZXN0cw0K
ICAgICQoJy5idXR0b24tc3RhcnQnKS5jbGljayhmdW5jdGlvbiAoKSB7DQogICAgICAgIGNvbnRy
b2xsZXIudG9nZ2xlKCk7DQogICAgfSk7DQoNCiAgICAvL0F0dGFjaCB0aGUgY2xpY2sgZXZlbnQg
dG8gdGhlIHJlc2V0IGJ1dHRvbi4gSXQgcmVzZXQgYWxsIHRoZSB0ZXN0IHRvIHplcm8NCiAgICAk
KCcuYnV0dG9uLXJlc2V0JykuY2xpY2soZnVuY3Rpb24gKCkgew0KICAgICAgICBjb250cm9sbGVy
LnJlc2V0KCk7DQogICAgfSk7DQp9KTsNCg==
</data>

          </attachment>
          <attachment
              isobsolete="0"
              ispatch="0"
              isprivate="0"
          >
            <attachid>3</attachid>
            <date>2011-07-03 13:26:00 -0700</date>
            <delta_ts>2011-07-03 13:26:16 -0700</delta_ts>
            <desc>faster sth.js file</desc>
            <filename>sthDocfrag.js</filename>
            <type>application/javascript</type>
            <size>18262</size>
            <attacher name="David Bruant">bruant.d</attacher>
            
              <data encoding="base64">77u/Ly8vIENvcHlyaWdodCAoYykgMjAwOSBNaWNyb3NvZnQgQ29ycG9yYXRpb24gDQovLy8gDQov
Ly8gUmVkaXN0cmlidXRpb24gYW5kIHVzZSBpbiBzb3VyY2UgYW5kIGJpbmFyeSBmb3Jtcywgd2l0
aCBvciB3aXRob3V0IG1vZGlmaWNhdGlvbiwgYXJlIHBlcm1pdHRlZCBwcm92aWRlZA0KLy8vIHRo
YXQgdGhlIGZvbGxvd2luZyBjb25kaXRpb25zIGFyZSBtZXQ6IA0KLy8vICAgICogUmVkaXN0cmli
dXRpb25zIG9mIHNvdXJjZSBjb2RlIG11c3QgcmV0YWluIHRoZSBhYm92ZSBjb3B5cmlnaHQgbm90
aWNlLCB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQNCi8vLyAgICAgIHRoZSBmb2xsb3dpbmcg
ZGlzY2xhaW1lci4gDQovLy8gICAgKiBSZWRpc3RyaWJ1dGlvbnMgaW4gYmluYXJ5IGZvcm0gbXVz
dCByZXByb2R1Y2UgdGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25k
aXRpb25zIGFuZCANCi8vLyAgICAgIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lciBpbiB0aGUgZG9j
dW1lbnRhdGlvbiBhbmQvb3Igb3RoZXIgbWF0ZXJpYWxzIHByb3ZpZGVkIHdpdGggdGhlIGRpc3Ry
aWJ1dGlvbi4gIA0KLy8vICAgICogTmVpdGhlciB0aGUgbmFtZSBvZiBNaWNyb3NvZnQgbm9yIHRo
ZSBuYW1lcyBvZiBpdHMgY29udHJpYnV0b3JzIG1heSBiZSB1c2VkIHRvDQovLy8gICAgICBlbmRv
cnNlIG9yIHByb21vdGUgcHJvZHVjdHMgZGVyaXZlZCBmcm9tIHRoaXMgc29mdHdhcmUgd2l0aG91
dCBzcGVjaWZpYyBwcmlvciB3cml0dGVuIHBlcm1pc3Npb24uDQovLy8gDQovLy8gVEhJUyBTT0ZU
V0FSRSBJUyBQUk9WSURFRCBCWSBUSEUgQ09QWVJJR0hUIEhPTERFUlMgQU5EIENPTlRSSUJVVE9S
UyAiQVMgSVMiIEFORCBBTlkgRVhQUkVTUyBPUg0KLy8vIElNUExJRUQgV0FSUkFOVElFUywgSU5D
TFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFRIRSBJTVBMSUVEIFdBUlJBTlRJRVMgT0YgTUVS
Q0hBTlRBQklMSVRZIEFORCBGSVRORVNTDQovLy8gRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFS
RSBESVNDTEFJTUVELiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQ09QWVJJR0hUIE9XTkVSIE9SIENP
TlRSSUJVVE9SUyBCRSBMSUFCTEUNCi8vLyBGT1IgQU5ZIERJUkVDVCwgSU5ESVJFQ1QsIElOQ0lE
RU5UQUwsIFNQRUNJQUwsIEVYRU1QTEFSWSwgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTIChJTkNM
VURJTkcsIEJVVCBOT1QNCi8vLyBMSU1JVEVEIFRPLCBQUk9DVVJFTUVOVCBPRiBTVUJTVElUVVRF
IEdPT0RTIE9SIFNFUlZJQ0VTOyBMT1NTIE9GIFVTRSwgREFUQSwgT1IgUFJPRklUUzsgT1IgQlVT
SU5FU1MNCi8vLyBJTlRFUlJVUFRJT04pIEhPV0VWRVIgQ0FVU0VEIEFORCBPTiBBTlkgVEhFT1JZ
IE9GIExJQUJJTElUWSwgV0hFVEhFUiBJTiBDT05UUkFDVCwgU1RSSUNUIExJQUJJTElUWSwNCi8v
LyBPUiBUT1JUIChJTkNMVURJTkcgTkVHTElHRU5DRSBPUiBPVEhFUldJU0UpIEFSSVNJTkcgSU4g
QU5ZIFdBWSBPVVQgT0YgVEhFIFVTRSBPRiBUSElTIFNPRlRXQVJFLCBFVkVOIElGDQovLy8gQURW
SVNFRCBPRiBUSEUgUE9TU0lCSUxJVFkgT0YgU1VDSCBEQU1BR0UuIA0KDQoNCi8qDQogKiBSdW4g
YSB0ZXN0IGluIHRoZSBicm93c2VyLiBXb3JrcyBieSBpbmplY3RpbmcgYW4gaWZyYW1lIHdpdGgg
dGhlIHRlc3QgY29kZS4NCiAqDQogKiBQdWJsaWMgTWV0aG9kczoNCiAqICogcnVuKGlkLCB0ZXN0
KTogUnVucyB0aGUgdGVzdCBzcGVjaWZpZWQuDQogKg0KICogQ2FsbGJhY2tzOg0KICogKiBvbkNv
bXBsZXRlKHRlc3QpOiBDYWxsZWQgd2hlbiB0aGUgdGVzdCBpcyBydW4uIFRlc3Qgb2JqZWN0IGNv
bnRhaW5zIHJlc3VsdCBhbmQgZXJyb3Igc3RyaW5ncyBkZXNjcmliaW5nIGhvdyB0aGUNCiAqICAg
ICAgICAgICAgICAgICAgICAgdGVzdCByYW4uDQogKi8NCmZ1bmN0aW9uIEJyb3dzZXJSdW5uZXIo
KSB7DQogICAgdmFyIGN1cnJlbnRUZXN0LCAgICAgICAgLy8gQ3VycmVudCB0ZXN0IGJlaW5nIHJ1
bi4NCiAgICAgICAgc2NyaXB0Q2FjaGUgPSB7fSwgICAvLyBIb2xkcyB0aGUgdmFyaW91cyBpbmNs
dWRlcyByZXF1aXJlZCB0byBydW4gY2VydGFpbiBzcHV0bmlrIHRlc3RzLg0KICAgICAgICBpbnN0
YW5jZSAgICA9IHRoaXM7DQoNCiAgICAvKiBDYWxsZWQgYnkgdGhlIGNoaWxkIHdpbmRvdyB0byBu
b3RpZnkgdGhhdCB0aGUgdGVzdCBoYXMgZmluaXNoZWQuIFRoaXMgZnVuY3Rpb24gY2FsbCBpcyBw
dXQgaW4gYSBzZXBhcmF0ZSBzY3JpcHQNCiAgICAgKiBibG9jayBhdCB0aGUgZW5kIG9mIHRoZSBw
YWdlIHNvIGVycm9ycyBpbiB0aGUgdGVzdCBzY3JpcHQgYmxvY2sgc2hvdWxkIG5vdCBwcmV2ZW50
IHRoaXMgZnVuY3Rpb24gZnJvbSBiZWluZw0KICAgICAqIGNhbGxlZC4NCiAgICAgKi8NCiAgICBm
dW5jdGlvbiB0ZXN0RmluaXNoZWQoKSB7DQogICAgICAgIGlmKHR5cGVvZiBjdXJyZW50VGVzdC5y
ZXN1bHQgPT09ICJ1bmRlZmluZWQiKSB7DQogICAgICAgICAgICAvLyBXZSBkaWRuJ3QgZ2V0IGEg
Y2FsbCB0byB0ZXN0UnVuLCB3aGljaCBsaWtlbHkgbWVhbnMgdGhlIHRlc3QgZmFpbGVkIHRvIGxv
YWQuDQogICAgICAgICAgICBjdXJyZW50VGVzdC5yZXN1bHQgPSAiZmFpbCI7DQogICAgICAgICAg
ICBjdXJyZW50VGVzdC5lcnJvciAgPSAiRmFpbGVkIHRvIExvYWQiOw0KICAgICAgICB9IGVsc2Ug
aWYodHlwZW9mIGN1cnJlbnRUZXN0LmVycm9yICE9PSAidW5kZWZpbmVkIikgew0KICAgICAgICAg
ICAgLy8gV2UgaGF2ZSBhbiBlcnJvciBsb2dnZWQgZnJvbSB0ZXN0UnVuLg0KICAgICAgICAgICAg
aWYoY3VycmVudFRlc3QuZXJyb3IgaW5zdGFuY2VvZiBTcHV0bmlrRXJyb3IpIHsNCiAgICAgICAg
ICAgICAgICBjdXJyZW50VGVzdC5lcnJvciA9IGN1cnJlbnRUZXN0Lm1lc3NhZ2U7DQogICAgICAg
ICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGN1cnJlbnRUZXN0LmVycm9yID0gY3VycmVu
dFRlc3QuZXJyb3IubmFtZSArICI6ICIgKyBjdXJyZW50VGVzdC5lcnJvci5tZXNzYWdlDQogICAg
ICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBpbnN0YW5jZS5vbkNvbXBsZXRlKGN1cnJl
bnRUZXN0KTsNCiAgICB9DQoNCiAgICAvKiBDYWxsZWQgZnJvbSB0aGUgY2hpbGQgd2luZG93IGFm
dGVyIHRoZSB0ZXN0IGhhcyBydW4uICovDQogICAgZnVuY3Rpb24gdGVzdFJ1bihpZCwgcGF0aCwg
ZGVzY3JpcHRpb24sIGNvZGVTdHJpbmcsIHByZWNvbmRpdGlvblN0cmluZywgcmVzdWx0LCBlcnJv
cikgew0KICAgICAgICBjdXJyZW50VGVzdC5pZCA9IGlkOw0KICAgICAgICBjdXJyZW50VGVzdC5w
YXRoID0gcGF0aDsNCiAgICAgICAgY3VycmVudFRlc3QuZGVzY3JpcHRpb24gPSBkZXNjcmlwdGlv
bjsNCiAgICAgICAgY3VycmVudFRlc3QucmVzdWx0ID0gcmVzdWx0Ow0KICAgICAgICBjdXJyZW50
VGVzdC5lcnJvciA9IGVycm9yOw0KICAgICAgICBjdXJyZW50VGVzdC5jb2RlID0gY29kZVN0cmlu
ZzsNCiAgICAgICAgY3VycmVudFRlc3QucHJlID0gcHJlY29uZGl0aW9uU3RyaW5nOw0KICAgIH0N
Cg0KDQogICAgLyogUnVuIHRoZSB0ZXN0LiAqLw0KICAgIHRoaXMucnVuID0gZnVuY3Rpb24oaWQs
IGNvZGUpIHsNCiAgICAgICAgdmFyIGlmcmFtZTsNCiAgICAgICAgdmFyIGluY2x1ZGVzID0gY29k
ZS5tYXRjaCgvXCRJTkNMVURFXCgoW15cKV0rKVwpL2cpLCAvLyBmaW5kIGFsbCBvZiB0aGUgJElO
Q0xVREUgc3RhdGVtZW50cw0KICAgICAgICAgICAgaW5jbHVkZTsNCiAgICAgICAgdmFyIGluY2x1
ZGVTY3JpcHRzOw0KICAgICAgICANCiAgICAgICAgY3VycmVudFRlc3QgPSB7aWQ6IGlkfTsgLy8g
ZGVmYXVsdCB0ZXN0LCBpbiBjYXNlIGl0IGRvZXNuJ3QgZ2V0IHJlZ2lzdGVyZWQuDQogICAgICAg
IA0KICAgICAgICAvLyBSZXRyaWV2aW5nIGluY2x1ZGVzDQogICAgICAgIC8vIERvIHRoaXMgQkVG
T1JFIGNyZWF0aW5nIHRoZSBpZnJhbWUgaW4gb3JkZXIgdG8gYXZvaWQgaHR0cHM6Ly9idWd6aWxs
YS5tb3ppbGxhLm9yZy9zaG93X2J1Zy5jZ2k/aWQ9NjY3MjI3IG9uIGZpcmVmb3ggNCAmIDUgKCY2
PykNCiAgICAgICAgaWYoaW5jbHVkZXMgIT09IG51bGwpIHsgDQogICAgICAgICAgICBpbmNsdWRl
U2NyaXB0cyA9IFtdOw0KICAgICAgICAgICAgLy8gV2UgaGF2ZSBzb21lIGluY2x1ZGVzLCBzbyBs
b29wIHRocm91Z2ggZWFjaCBpbmNsdWRlIGFuZCBwdWxsIGluIHRoZSBkZXBlbmRlbmNpZXMuDQog
ICAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgaW5jbHVkZXMubGVuZ3RoOyBpKyspIHsNCiAg
ICAgICAgICAgICAgICBpbmNsdWRlID0gaW5jbHVkZXNbaV0ucmVwbGFjZSgvLipcKCgnfCIpKC4q
KSgnfCIpXCkvLCAiJDIiKTsNCg0KICAgICAgICAgICAgICAgIC8vIEZpcnN0IGNoZWNrIHRvIHNl
ZSBpZiB3ZSBoYXZlIHRoaXMgc2NyaXB0IGNhY2hlZCBhbHJlYWR5LCBhbmQgaWYgbm90LCBncmFi
IGl0Lg0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZiBzY3JpcHRDYWNoZVtpbmNsdWRlXSA9PT0g
InVuZGVmaW5lZCIpIHsNCiAgICAgICAgICAgICAgICAgICAgJC5hamF4KHsNCiAgICAgICAgICAg
ICAgICAgICAgICAgIGFzeW5jOiBmYWxzZSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHVybDog
J3Jlc291cmNlcy9zY3JpcHRzL2dsb2JhbC8nICsgaW5jbHVkZSwNCiAgICAgICAgICAgICAgICAg
ICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHMpIHsgc2NyaXB0Q2FjaGVbaW5jbHVkZV0gPSBzOyB9
DQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAg
ICAgICAgIC8vIEZpbmFsbHksIHdyaXRlIHRoZSByZXF1aXJlZCBzY3JpcHQgdG8gdGhlIHdpbmRv
dy4NCiAgICAgICAgICAgICAgICBpbmNsdWRlU2NyaXB0cy5wdXNoKHNjcmlwdENhY2hlW2luY2x1
ZGVdKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaW5jbHVkZVNj
cmlwdHMgPSBpbmNsdWRlU2NyaXB0cy5qb2luKCdcbicpOw0KICAgICAgICB9DQoNCiAgICAgICAg
Ly8gQ3JlYXRpbmcgaWZyYW1lDQogICAgICAgIGlmcmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1l
bnQoImlmcmFtZSIpOw0KICAgICAgICBpZnJhbWUuc2V0QXR0cmlidXRlKCJzdHlsZSIsICJkaXNw
bGF5Om5vbmUiKTsNCiAgICAgICAgaWZyYW1lLnNldEF0dHJpYnV0ZSgiaWQiLCAicnVubmVySWZy
YW1lIik7DQoNCiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChpZnJhbWUpOw0KDQog
ICAgICAgIHZhciB3aW4gPSBpZnJhbWUuY29udGVudFdpbmRvdzsgDQogICAgICAgIHZhciBpZnJh
bWVEb2MgPSB3aW4uZG9jdW1lbnQ7DQogICAgICAgIA0KICAgICAgICB2YXIgc2NyaXB0cyA9IGlm
cmFtZURvYy5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7DQogICAgICAgIA0KICAgICAgICBmdW5j
dGlvbiBhZGRTY3JpcHQoY29kZSl7DQogICAgICAgICAgdmFyIHNjcmlwdEVsZW1lbnQgPSBpZnJh
bWVEb2MuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7DQogICAgICAgICAgc2NyaXB0RWxlbWVudC50
eXBlID0gJ3RleHQvamF2YXNjcmlwdCc7DQogICAgICAgICAgc2NyaXB0RWxlbWVudC50ZXh0Q29u
dGVudCA9IGNvZGU7DQogICAgICAgICAgc2NyaXB0cy5hcHBlbmRDaGlsZChzY3JpcHRFbGVtZW50
KTsgLy8gQXBwZW5kaW5nIGF0IHRoZSBlbmQgdG8gcmVzcGVjdCBzY3JpcHQgaW5zZXJ0aW9uIG9y
ZGVyDQogICAgICAgIH0NCg0KICAgICAgICBpZih0eXBlb2YgaW5jbHVkZVNjcmlwdHMgPT09ICdz
dHJpbmcnKXsNCiAgICAgICAgICBhZGRTY3JpcHQoaW5jbHVkZVNjcmlwdHMpOw0KICAgICAgICB9
DQoNCiAgICAgICAgLy8gU2V0IHVwIHNvbWUgZ2xvYmFscy4NCiAgICAgICAgd2luLnRlc3RSdW4g
PSB0ZXN0UnVuOw0KICAgICAgICANCiAgICAgICAgLy9UT0RPOiB0aGVzZSBzaG91bGQgYmUgbW92
ZWQgdG8gc3RhLmpzDQogICAgICAgIHdpbi5TcHV0bmlrRXJyb3IgPSBTcHV0bmlrRXJyb3I7DQog
ICAgICAgIHdpbi4kRVJST1IgPSAkRVJST1I7DQogICAgICAgIHdpbi4kRkFJTCAgPSAkRkFJTDsN
CiAgICAgICAgd2luLiRQUklOVCA9IGZ1bmN0aW9uICgpIHt9Ow0KICAgICAgICB3aW4uJElOQ0xV
REUgPSBmdW5jdGlvbigpIHt9Ow0KICAgICAgICAgICANCiAgICAgICAgLy9Xcml0ZSBvdXQgYWxs
IG9mIG91ciBoZWxwZXIgZnVuY3Rpb25zDQogICAgICAgIGFkZFNjcmlwdChQaWNrbGVkU2ltcGxl
VGVzdEFQSXMpOw0KICAgICAgICANCiAgICAgICAgLy8tLVNjZW5hcmlvIDE6IHdlJ3JlIGRlYWxp
bmcgd2l0aCBhIGdsb2JhbCBzY29wZSB0ZXN0IGNhc2UNCiAgICAgICAgaWYgKEdsb2JhbFNjb3Bl
VGVzdHNbaWRdIT09dW5kZWZpbmVkKSB7DQogICAgICAgICAgICB3aW4uaWZyYW1lRXJyb3IgPSB1
bmRlZmluZWQ7DQogICAgICAgICAgICB3aW4ub25lcnJvciA9IHVuZGVmaW5lZDsNCiAgICAgICAg
ICAgIHdpbi5vbkVycm9ySGFjayA9IHVuZGVmaW5lZDsNCg0KICAgICAgICAgICAgLy9BZGQgYW4g
ZXJyb3IgaGFuZGxlcg0KICAgICAgICAgICAgYWRkU2NyaXB0KCJ3aW5kb3cub25lcnJvciA9IGZ1
bmN0aW9uKGVycm9yTXNnLCB1cmwsIGxpbmVOdW1iZXIpIHt3aW5kb3cuaWZyYW1lRXJyb3IgPSBl
cnJvck1zZzt9OyIpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAvL1BhcnNlIGFuZCBleGVj
dXRlIHRoZSBjb2RlDQogICAgICAgICAgICBhZGRTY3JpcHQoIm9uRXJyb3JIYWNrID0gdHJ1ZTt0
cnl7IiArIGNvZGUgKyAifWNhdGNoKHRlc3QyNjJSdW50aW1lRXJyb3Ipe3dpbmRvdy5pZnJhbWVF
cnJvcj10ZXN0MjYyUnVudGltZUVycm9yLm1lc3NhZ2UgfHwgJ05vbmUnO30iKTsNCiAgICAgICAg
fQ0KICAgICAgICAvLy0tU2NlbmFyaW8gMjogIHdlJ3JlIGRlYWxpbmcgd2l0aCBhIG5vcm1hbCBw
b3NpdGl2ZSg/KSB0ZXN0IGNhc2UNCiAgICAgICAgZWxzZSB7DQogICAgICAgIA0KICAgICAgICAg
ICAgLy8gV3JpdGUgRVM1SGFybmVzcy5yZWdpc3RlclRlc3QgYW5kIGZuR2xvYmFsT2JqZWN0LCB3
aGljaCByZXR1cm5zIHRoZSBnbG9iYWwgb2JqZWN0LCBhbmQgdGhlIHRlc3RGaW5pc2hlZCBjYWxs
Lg0KICAgICAgICAgICAgYWRkU2NyaXB0KCJFUzVIYXJuZXNzID0ge307IiArDQogICAgICAgICAg
ICAgICAgICAgICAgIkVTNUhhcm5lc3MucmVnaXN0ZXJUZXN0ID0gZnVuY3Rpb24odGVzdCkgeyIg
Kw0KICAgICAgICAgICAgICAgICAgICAgICIgIHZhciBlcnJvcjsiICsNCiAgICAgICAgICAgICAg
ICAgICAgICAiICBpZih0ZXN0LnByZWNvbmRpdGlvbiAmJiAhdGVzdC5wcmVjb25kaXRpb24oKSkg
eyIgKw0KICAgICAgICAgICAgICAgICAgICAgICIgICAgdGVzdFJ1bih0ZXN0LmlkLCB0ZXN0LnBh
dGgsIHRlc3QuZGVzY3JpcHRpb24sIHRlc3QudGVzdC50b1N0cmluZygpLHR5cGVvZiB0ZXN0LnBy
ZWNvbmRpdGlvbiAhPT0gJ3VuZGVmaW5lZCcgPyB0ZXN0LnByZWNvbmRpdGlvbi50b1N0cmluZygp
IDogJycsICdmYWlsJywgJ1ByZWNvbmRpdGlvbiBGYWlsZWQnKTsiICsNCiAgICAgICAgICAgICAg
ICAgICAgICAiICB9IGVsc2UgeyIgKw0KICAgICAgICAgICAgICAgICAgICAgICIgICAgdmFyIHRl
c3RUaGlzID0gdGVzdC5zdHJpY3Q9PT11bmRlZmluZWQgPyB3aW5kb3cgOiB1bmRlZmluZWQ7IiAr
DQogICAgICAgICAgICAgICAgICAgICAgIiAgICB0cnkgeyB2YXIgcmVzID0gdGVzdC50ZXN0LmNh
bGwodGVzdFRoaXMpOyB9IGNhdGNoKGUpIHsgcmVzID0gJ2ZhaWwnOyBlcnJvciA9IGU7IH0iICsN
CiAgICAgICAgICAgICAgICAgICAgICAiICAgIHZhciByZXRWYWwgPSAvXnMvaS50ZXN0KHRlc3Qu
aWQpID8gKHJlcyA9PT0gdHJ1ZSB8fCB0eXBlb2YgcmVzID09PSAndW5kZWZpbmVkJyA/ICdwYXNz
JyA6ICdmYWlsJykgOiAocmVzID09PSB0cnVlID8gJ3Bhc3MnIDogJ2ZhaWwnKTsiICsNCiAgICAg
ICAgICAgICAgICAgICAgICAiICAgIHRlc3RSdW4odGVzdC5pZCwgdGVzdC5wYXRoLCB0ZXN0LmRl
c2NyaXB0aW9uLCB0ZXN0LnRlc3QudG9TdHJpbmcoKSwgdHlwZW9mIHRlc3QucHJlY29uZGl0aW9u
ICE9PSAndW5kZWZpbmVkJyA/IHRlc3QucHJlY29uZGl0aW9uLnRvU3RyaW5nKCkgOiAnJywgcmV0
VmFsLCBlcnJvcik7IiArDQogICAgICAgICAgICAgICAgICAgICAgIiAgfSIgKw0KICAgICAgICAg
ICAgICAgICAgICAgICJ9Iik7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGFkZFNjcmlwdChj
b2RlKTsgICAgIA0KICAgICAgICB9DQoNCiAgICAgICAgaWZyYW1lRG9jLmhlYWQuYXBwZW5kQ2hp
bGQoc2NyaXB0cyk7IC8vIEFwcGVuZGluZyB0aGUgZG9jdW1lbnQgZnJhZ21lbnQgdG8gbG9hZCBh
bGwgc2NyaXB0cyBhdCBvbmNlLg0KDQogICAgICAgIGlmIChHbG9iYWxTY29wZVRlc3RzW2lkXSE9
PXVuZGVmaW5lZCkgeyAvLyBHYXRoZXIgcmVzdWx0cw0KICAgICAgICAgICAgdmFyIHRlc3REZXNj
cmlwID0gR2xvYmFsU2NvcGVUZXN0c1tpZF07DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlm
ICh0ZXN0RGVzY3JpcC5uZWdhdGl2ZSE9PXVuZGVmaW5lZCkgeyAgLy9BbiBleGNlcHRpb24gaXMg
ZXhwZWN0ZWQNCiAgICAgICAgICAgICAgICBpZiAod2luLm9uRXJyb3JIYWNrPT09dW5kZWZpbmVk
KSB7ICAvL0hhY2sgZm9yIGJyb3dzZXJzIG5vdCBzdXBwb3J0aW5nIHdpbmRvdy5vbmVycm9yIFdS
VCBlYXJseSBwYXJzZSBlcnJvcnMNCiAgICAgICAgICAgICAgICAgICAgdGVzdFJ1bih0ZXN0RGVz
Y3JpcC5pZCwgdGVzdERlc2NyaXAucGF0aCwgdGVzdERlc2NyaXAuZGVzY3JpcHRpb24sIGNvZGUs
IHR5cGVvZiB0ZXN0RGVzY3JpcC5wcmVjb25kaXRpb24gIT09ICd1bmRlZmluZWQnID8gdGVzdERl
c2NyaXAucHJlY29uZGl0aW9uLnRvU3RyaW5nKCkgOiAnJywgDQogICAgICAgICAgICAgICAgICAg
ICAgICAgICAgJ3Bhc3MnLCAnTm90IHBhcnNhYmxlJyk7DQogICAgICAgICAgICAgICAgfQ0KICAg
ICAgICAgICAgICAgIGVsc2UgaWYgKHdpbi5pZnJhbWVFcnJvcj09PXVuZGVmaW5lZCkgeyAvL25v
IGV4Y2VwdGlvbiB3YXMgdGhyb3duDQogICAgICAgICAgICAgICAgICAgIHRlc3RSdW4odGVzdERl
c2NyaXAuaWQsIHRlc3REZXNjcmlwLnBhdGgsIHRlc3REZXNjcmlwLmRlc2NyaXB0aW9uLCBjb2Rl
LCB0eXBlb2YgdGVzdERlc2NyaXAucHJlY29uZGl0aW9uICE9PSAndW5kZWZpbmVkJyA/IHRlc3RE
ZXNjcmlwLnByZWNvbmRpdGlvbi50b1N0cmluZygpIDogJycsIA0KICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICdmYWlsJywgJ05vIEV4Y2VwdGlvbiBUaHJvd24nKTsNCiAgICAgICAgICAgICAg
ICB9IGVsc2UgaWYoISAobmV3IFJlZ0V4cCh0ZXN0RGVzY3JpcC5uZWdhdGl2ZSwgImkiKS50ZXN0
KHdpbi5pZnJhbWVFcnJvcikpKSB7ICAvL3dyb25nIHR5cGUgb2YgZXhjZXB0aW9uIHRocm93bg0K
ICAgICAgICAgICAgICAgICAgICB0ZXN0UnVuKHRlc3REZXNjcmlwLmlkLCB0ZXN0RGVzY3JpcC5w
YXRoLCB0ZXN0RGVzY3JpcC5kZXNjcmlwdGlvbiwgY29kZSwgdHlwZW9mIHRlc3REZXNjcmlwLnBy
ZWNvbmRpdGlvbiAhPT0gJ3VuZGVmaW5lZCcgPyB0ZXN0RGVzY3JpcC5wcmVjb25kaXRpb24udG9T
dHJpbmcoKSA6ICcnLCANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZmFpbCcsICdXcm9u
ZyBUeXBlIG9mIEV4Y2VwdGlvbiBUaHJvd24nKTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0K
ICAgICAgICAgICAgICAgICAgICB0ZXN0UnVuKHRlc3REZXNjcmlwLmlkLCB0ZXN0RGVzY3JpcC5w
YXRoLCB0ZXN0RGVzY3JpcC5kZXNjcmlwdGlvbiwgY29kZSwgdHlwZW9mIHRlc3REZXNjcmlwLnBy
ZWNvbmRpdGlvbiAhPT0gJ3VuZGVmaW5lZCcgPyB0ZXN0RGVzY3JpcC5wcmVjb25kaXRpb24udG9T
dHJpbmcoKSA6ICcnLCANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAncGFzcycsIHVuZGVm
aW5lZCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSBlbHNlIGlmICh3aW4uaWZy
YW1lRXJyb3IhPT11bmRlZmluZWQpIHsgIC8vRXhjZXB0aW9uIHdhcyBub3QgZXhwZWN0ZWQgdG8g
YmUgdGhyb3duDQogICAgICAgICAgICAgICAgdGVzdFJ1bih0ZXN0RGVzY3JpcC5pZCwgdGVzdERl
c2NyaXAucGF0aCwgdGVzdERlc2NyaXAuZGVzY3JpcHRpb24sIGNvZGUsIHR5cGVvZiB0ZXN0RGVz
Y3JpcC5wcmVjb25kaXRpb24gIT09ICd1bmRlZmluZWQnID8gdGVzdERlc2NyaXAucHJlY29uZGl0
aW9uLnRvU3RyaW5nKCkgOiAnJywgDQogICAgICAgICAgICAgICAgICAgICAgICAnZmFpbCcsICdV
bmV4cGVjdGVkIEV4Y2VwdGlvbicpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAg
ICAgICB0ZXN0UnVuKHRlc3REZXNjcmlwLmlkLCB0ZXN0RGVzY3JpcC5wYXRoLCB0ZXN0RGVzY3Jp
cC5kZXNjcmlwdGlvbiwgY29kZSwgdHlwZW9mIHRlc3REZXNjcmlwLnByZWNvbmRpdGlvbiAhPT0g
J3VuZGVmaW5lZCcgPyB0ZXN0RGVzY3JpcC5wcmVjb25kaXRpb24udG9TdHJpbmcoKSA6ICcnLCAN
CiAgICAgICAgICAgICAgICAgICAgICAgICdwYXNzJywgdW5kZWZpbmVkKTsNCiAgICAgICAgICAg
IH0NCiAgICAgICAgfQ0KIA0KICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGlmcmFt
ZSk7DQogICAgICAgIHRlc3RGaW5pc2hlZCgpOw0KICAgIH0NCn0NCg0KLyogTG9hZHMgdGVzdHMg
ZnJvbSB0aGUgc2VjdGlvbnMgc3BlY2lmaWVkIGluIHRlc3RjYXNlc2xpc3QuanNvbi4NCiAqIFB1
YmxpYyBNZXRob2RzOg0KICogKiBnZXROZXh0VGVzdCgpIC0gU3RhcnQgbG9hZGluZyB0aGUgbmV4
dCB0ZXN0Lg0KICogKiByZXNldCgpIC0gU3RhcnQgb3ZlciBhdCB0aGUgZmlyc3QgdGVzdC4NCiAq
DQogKiBDYWxsYmFja3M6DQogKiAqIG9uTG9hZGluZ05leHRTZWN0aW9uKHBhdGgpOiBDYWxsZWQg
YWZ0ZXIgYSByZXF1ZXN0IGlzIHNlbnQgZm9yIHRoZSBuZXh0IHNlY3Rpb24geG1sLCB3aXRoIHRo
ZSBwYXRoIHRvIHRoYXQgeG1sLg0KICogKiBvbkluaXRpYWxpemVkKHRvdGFsVGVzdHMsIHZlcnNp
b24sIGRhdGUpOiBDYWxsZWQgYWZ0ZXIgdGhlIHRlc3RjYXNlc2xpc3QueG1sIGlzIGxvYWRlZCBh
bmQgcGFyc2VkLg0KICogKiBvblRlc3RSZWFkeShpZCwgY29kZSk6IENhbGxlZCB3aGVuIGEgdGVz
dCBpcyByZWFkeSB3aXRoIHRoZSB0ZXN0J3MgaWQgYW5kIGNvZGUuDQogKiAqIG9uVGVzdHNFeGhh
dXN0ZWQoKTogQ2FsbGVkIHdoZW4gdGhlcmUgYXJlIG5vIG1vcmUgdGVzdHMgdG8gcnVuLg0KICov
DQpmdW5jdGlvbiBUZXN0TG9hZGVyKCkgew0KICAgIHZhciB0ZXN0R3JvdXBzICAgICAgID0gW10s
DQogICAgICAgIHRlc3RHcm91cEluZGV4ICAgPSAwLA0KICAgICAgICBjdXJyZW50VGVzdEluZGV4
ID0gMCwNCiAgICAgICAgbG9hZGVyICAgICAgICAgICA9IHRoaXM7DQoNCiAgICB0aGlzLnZlcnNp
b24gICAgPSB1bmRlZmluZWQ7DQogICAgdGhpcy5kYXRlICAgICAgID0gdW5kZWZpbmVkOw0KICAg
IHRoaXMudG90YWxUZXN0cyA9IDA7DQoNCiAgICAvKiBHZXQgdGhlIFhNTCBmb3IgdGhlIG5leHQg
c2VjdGlvbiAqLw0KICAgIGZ1bmN0aW9uIGdldE5leHRYTUwoKSB7DQogICAgICAgIHZhciBncm91
cCA9IHRlc3RHcm91cHNbdGVzdEdyb3VwSW5kZXhdOw0KICAgICAgICBjdXJyZW50VGVzdEluZGV4
ID0gMDsNCg0KICAgICAgICBpZihncm91cC50ZXN0cy5sZW5ndGggPiAwKSB7DQogICAgICAgICAg
ICAvLyBhbHJlYWR5IGxvYWRlZCB0aGlzIHNlY3Rpb24uDQogICAgICAgICAgICBsb2FkZXIuZ2V0
TmV4dFRlc3QoKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICAkLmFq
YXgoe3VybDogZ3JvdXAucGF0aCwgZGF0YVR5cGU6ICdqc29uJywgc3VjY2VzczogZnVuY3Rpb24o
ZGF0YSkgew0KICAgICAgICAgICAgZ3JvdXAudGVzdHMgPSBkYXRhLnRlc3RzQ29sbGVjdGlvbi50
ZXN0czsNCiAgICAgICAgICAgIGxvYWRlci5nZXROZXh0VGVzdCgpOw0KICAgICAgICB9LAkNCgll
cnJvcjogZnVuY3Rpb24gKFhNTEh0dHBSZXF1ZXN0LCB0ZXh0U3RhdHVzLCBlcnJvclRocm93bikg
ew0KCQkvL2FsZXJ0KFhNTEh0dHBSZXF1ZXN0KTsgDQoJfQ0KDQoJfSk7DQoNCiAgICAgICAgbG9h
ZGVyLm9uTG9hZGluZ05leHRTZWN0aW9uKGdyb3VwLnBhdGgpOw0KICAgIH0NCg0KICAgIC8qIEdl
dCB0aGUgdGVzdCBsaXN0IHhtbCAqLw0KICAgIGZ1bmN0aW9uIGxvYWRUZXN0WE1MKCkgew0KICAg
ICAgICB2YXIgdGVzdHNMaXN0TG9hZGVyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7DQoNCiAgICAg
ICAgJC5hamF4KHt1cmw6IFRFU1RfTElTVF9QQVRILCBkYXRhVHlwZTogJ2pzb24nLCBzdWNjZXNz
OiBmdW5jdGlvbihkYXRhKSB7DQogICAgICAgICAgICB2YXIgdGVzdFN1aXRlID0gZGF0YS50ZXN0
U3VpdGU7DQoNCiAgICAgICAgICAgIGxvYWRlci52ZXJzaW9uICAgID0gZGF0YS52ZXJzaW9uOw0K
ICAgICAgICAgICAgbG9hZGVyLmRhdGUgICAgICAgPSBkYXRhLmRhdGU7DQogICAgICAgICAgICBs
b2FkZXIudG90YWxUZXN0cyA9IGRhdGEubnVtVGVzdHM7ICAgICAgICAgICAgICAgDQoNCiAgICAg
ICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGVzdFN1aXRlLmxlbmd0aDsgaSsrKSB7DQogICAg
ICAgICAgICAgICAgdGVzdEdyb3Vwc1tpXSA9IHsNCiAgICAgICAgICAgICAgICAgICAgcGF0aDog
dGVzdFN1aXRlW2ldLA0KICAgICAgICAgICAgICAgICAgICB0ZXN0czogW10NCiAgICAgICAgICAg
ICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBsb2FkZXIub25Jbml0aWFsaXplZChs
b2FkZXIudG90YWxUZXN0cywgbG9hZGVyLnZlcnNpb24sIGxvYWRlci5kYXRlKTsNCiAgICAgICAg
ICAgIGdldE5leHRYTUwoKTsNCiAgICAgICAgfX0pOw0KICAgIH0NCg0KICAgIC8qIE1vdmUgb24g
dG8gdGhlIG5leHQgdGVzdCAqLw0KICAgIHRoaXMuZ2V0TmV4dFRlc3QgPSBmdW5jdGlvbigpIHsN
CiAgICAgICAgaWYodGVzdEdyb3Vwcy5sZW5ndGggPT0gMCkgew0KICAgICAgICAgICAgLy8gSW5p
dGlhbGl6ZS4NCiAgICAgICAgICAgIGxvYWRUZXN0WE1MKCk7DQogICAgICAgIH0gZWxzZSBpZihj
dXJyZW50VGVzdEluZGV4IDwgdGVzdEdyb3Vwc1t0ZXN0R3JvdXBJbmRleF0udGVzdHMubGVuZ3Ro
KSB7DQogICAgICAgICAgICAvLyBXZSBoYXZlIHRlc3RzIGxlZnQgaW4gdGhpcyB0ZXN0IGdyb3Vw
Lg0KICAgICAgICAgICAgdmFyIHRlc3QgPSB0ZXN0R3JvdXBzW3Rlc3RHcm91cEluZGV4XS50ZXN0
c1tjdXJyZW50VGVzdEluZGV4KytdOw0KCSAgICB2YXIgc2NyaXB0Q29kZSA9IHRlc3QuY29kZTsN
CiAgICAgICAgICAgIC8vdmFyIHNjcmlwdENvZGUgPSAodGVzdC5maXJzdENoaWxkLnRleHQgIT0g
dW5kZWZpbmVkKSA/IHRlc3QuZmlyc3RDaGlsZC50ZXh0IDogdGVzdC5maXJzdENoaWxkLnRleHRD
b250ZW50Ow0KDQogICAgICAgICAgICBsb2FkZXIub25UZXN0UmVhZHkodGVzdC5pZCwgJC5iYXNl
NjREZWNvZGUoc2NyaXB0Q29kZSkpOw0KICAgICAgICB9IGVsc2UgaWYodGVzdEdyb3VwSW5kZXgg
PCB0ZXN0R3JvdXBzLmxlbmd0aCAtIDEpIHsNCiAgICAgICAgICAgIC8vIFdlIGRvbid0IGhhdmUg
dGVzdHMgbGVmdCBpbiB0aGlzIHRlc3QgZ3JvdXAsIHNvIG1vdmUgb24gdG8gdGhlIG5leHQuDQog
ICAgICAgICAgICB0ZXN0R3JvdXBJbmRleCsrOw0KICAgICAgICAgICAgZ2V0TmV4dFhNTCgpOw0K
ICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgLy8gV2UncmUgZG9uZS4NCiAgICAgICAgICAg
IGxvYWRlci5vblRlc3RzRXhoYXVzdGVkKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKiBT
dGFydCBvdmVyIGF0IHRoZSBiZWdpbm5pbmcgKi8NCiAgICB0aGlzLnJlc2V0ID0gZnVuY3Rpb24o
KSB7DQogICAgICAgIGN1cnJlbnRUZXN0SW5kZXggPSAwOw0KICAgICAgICB0ZXN0R3JvdXBJbmRl
eCA9IDA7DQogICAgfQ0KfQ0KDQovKiBDb250cm9scyB0ZXN0IGdlbmVyYXRpb24gYW5kIHJ1bm5p
bmcsIGFuZCBzZW5kcyByZXN1bHRzIHRvIHRoZSBwcmVzZW50ZXIuICovDQpmdW5jdGlvbiBDb250
cm9sbGVyKCkgew0KICAgIHZhciBzdGF0ZSAgPSAnc3RvcHBlZCc7DQogICAgdmFyIHJ1bm5lciA9
IG5ldyBCcm93c2VyUnVubmVyKCk7DQogICAgdmFyIGxvYWRlciA9IG5ldyBUZXN0TG9hZGVyKCk7
DQogICAgdmFyIGNvbnRyb2xsZXIgPSB0aGlzOw0KICAgIHZhciBzdGFydFRpbWU7DQogICAgdmFy
IGVsYXBzZWQgPSAwOw0KDQogICAgLypmdW5jdGlvbiBuZXh0VGljayhjYWxsYmFjayl7DQogICAg
ICB3aW5kb3cub25tZXNzYWdlID0gY2FsbGJhY2s7DQogICAgICB3aW5kb3cucG9zdE1lc3NhZ2Uo
JyonLCAnKicpOw0KICAgIH0qLw0KICAgIA0KICAgIGZ1bmN0aW9uIG5leHRUaWNrKGNhbGxiYWNr
KXsNCiAgICAgIHNldFRpbWVvdXQoY2FsbGJhY2ssIDEwKTsNCiAgICB9DQoNCiAgICBydW5uZXIu
b25Db21wbGV0ZSA9IGZ1bmN0aW9uKHRlc3QpIHsNCiAgICAgICAgcHJlc2VudGVyLmFkZFRlc3RS
ZXN1bHQodGVzdCk7DQoNCiAgICAgICAgaWYoc3RhdGUgPT09ICdydW5uaW5nJykNCiAgICAgICAg
ICAgIG5leHRUaWNrKGxvYWRlci5nZXROZXh0VGVzdCk7IC8vIHB1dCBuZXh0IHRlc3QgaW4gZXZl
bnQgcXVldWUgc28gdGhhdCBvdGhlciBldmVudHMgKGxpa2UgY2xpY2tzIHRvIHBhdXNlKSBjYW4g
YmUgaGFuZGxlZA0KICAgIH0NCg0KICAgIGxvYWRlci5vbkluaXRpYWxpemVkID0gZnVuY3Rpb24o
dG90YWxUZXN0cywgdmVyc2lvbiwgZGF0ZSkgew0KICAgICAgICBwcmVzZW50ZXIuc2V0VmVyc2lv
bih2ZXJzaW9uKTsNCiAgICAgICAgcHJlc2VudGVyLnNldERhdGUoZGF0ZSk7DQogICAgICAgIHBy
ZXNlbnRlci5zZXRUb3RhbFRlc3RzKHRvdGFsVGVzdHMpOw0KICAgIH0NCg0KICAgIGxvYWRlci5v
bkxvYWRpbmdOZXh0U2VjdGlvbiA9IGZ1bmN0aW9uKHBhdGgpIHsNCiAgICAgICAgcHJlc2VudGVy
LnVwZGF0ZVN0YXR1cygiTG9hZGluZzogIiArIHBhdGgpOw0KICAgIH0NCg0KICAgIGxvYWRlci5v
blRlc3RSZWFkeSA9IGZ1bmN0aW9uKGlkLCB0ZXN0KSB7DQogICAgICAgIHByZXNlbnRlci51cGRh
dGVTdGF0dXMoIkV4ZWN1dGluZyBUZXN0OiAiICsgaWQpOw0KICAgICAgICBydW5uZXIucnVuKGlk
LCB0ZXN0KTsNCiAgICB9DQoNCiAgICBsb2FkZXIub25UZXN0c0V4aGF1c3RlZCA9IGZ1bmN0aW9u
KCkgew0KICAgICAgICBzdGF0ZSA9ICdzdG9wcGVkJzsNCiAgICAgICAgZWxhcHNlZCArPSBuZXcg
RGF0ZSgpIC0gc3RhcnRUaW1lOw0KICAgICAgICBlbGFwc2VkID0gZWxhcHNlZC8oMTAwMCo2MCk7
ICAvL21pbnV0ZXMNCiAgICAgICAgZWxhcHNlZCA9IGVsYXBzZWQudG9GaXhlZCgxKTsNCiAgICAg
ICAgcHJlc2VudGVyLmZpbmlzaGVkKGVsYXBzZWQpOw0KICAgIH0NCg0KICAgIHRoaXMuc3RhcnQg
PSBmdW5jdGlvbigpIHsNCiAgICAgICAgc3RhdGUgPSAncnVubmluZyc7DQogICAgICAgIHN0YXJ0
VGltZSA9IG5ldyBEYXRlKCk7DQogICAgICAgIGxvYWRlci5nZXROZXh0VGVzdCgpOw0KICAgICAg
ICBwcmVzZW50ZXIuc3RhcnRlZCgpOw0KICAgIH0NCiAgICANCiAgICB0aGlzLnBhdXNlID0gZnVu
Y3Rpb24oKSB7DQogICAgICAgIGVsYXBzZWQgKz0gbmV3IERhdGUoKSAtIHN0YXJ0VGltZTsNCiAg
ICAgICAgc3RhdGUgPSAncGF1c2VkJzsNCiAgICAgICAgcHJlc2VudGVyLnBhdXNlZCgpOw0KICAg
IH0NCg0KICAgIHRoaXMucmVzZXQgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgc3RhcnRUaW1lID0g
bmV3IERhdGUoKTsNCiAgICAgICAgZWxhcHNlZCA9IDA7DQogICAgICAgIGxvYWRlci5yZXNldCgp
Ow0KICAgICAgICBwcmVzZW50ZXIucmVzZXQoKTsNCiAgICB9DQoNCiAgICB0aGlzLnRvZ2dsZSA9
IGZ1bmN0aW9uKCkgew0KICAgICAgICBpZihzdGF0ZSA9PT0gJ3J1bm5pbmcnKSB7DQogICAgICAg
ICAgICBjb250cm9sbGVyLnBhdXNlKCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBj
b250cm9sbGVyLnN0YXJ0KCk7DQogICAgICAgIH0NCiAgICB9DQp9DQoNCnZhciBjb250cm9sbGVy
ID0gbmV3IENvbnRyb2xsZXIoKQ0KDQovKiBIZWxwZXIgZnVuY3Rpb24gd2hpY2ggc2hvd3MgaWYg
d2UncmUgaW4gdGhlICdkZWJ1ZycgbW9kZSBvZiB0aGUgVGVzdDI2MiBzaXRlLg0KICAgVGhpcyBt
b2RlIGlzIG9ubHkgdXNlZnVsIGZvciBkZWJ1Z2dpbmcgaXNzdWVzIHdpdGggdGhlIHRlc3QgaGFy
bmVzcyBhbmQgDQogICB3ZWJzaXRlLiAqLw0KZnVuY3Rpb24gaXNTaXRlRGVidWdNb2RlKCkgew0K
ICAgIHZhciBzdHI9d2luZG93LmxvY2F0aW9uLmhyZWYuc3Vic3RyaW5nKHdpbmRvdy5sb2NhdGlv
bi5ocmVmLmluZGV4T2YoIj8iKSsxKQ0KICAgIGlmKHN0ci5pbmRleE9mKCJzaXRlZGVidWciKSA+
IC0xKSB7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAg
cmV0dXJuIGZhbHNlOw0KICAgIH0NCn0NCg0KDQokKGZ1bmN0aW9uICgpIHsNCiAgICBwcmVzZW50
ZXIuc2V0dXAoKTsNCg0KICAgICQoJy5jb250ZW50LWhvbWUnKS5zaG93KCk7DQogICAgLy8gQWRk
aW5nIGF0dHJpYnV0ZSB0byB0aGUgdGFicyAoZS5nLiBIb21lLCBSdW4gZXRjLikgYW5kIGF0dGFj
aGluZyB0aGUgY2xpY2sgZXZlbnQgb24gYnV0dG9ucyAoZS5nLiBSZXNldCwgU3RhcnQgZXRjLikN
CiAgICAkKCcubmF2LWxpbmsnKS5lYWNoKGZ1bmN0aW9uIChpbmRleCkgew0KICAgICAgICAvL0Fk
ZGluZyAidGFyZ2V0RGl2IiBhdHRyaWJ1dGUgdG8gdGhlIGhlYWRlciB0YWIgYW5kIG9uIHRoYXQg
YmFzaXMgdGhlIGRpdiByZWxhdGVkIHRvIGhlYWRlciB0YWJzIGFyZSBkaXNwbGF5ZWQNCiAgICAg
ICAgaWYgKGluZGV4ID09PSAwKSB7DQogICAgICAgICAgICAkKHRoaXMpLmF0dHIoJ3RhcmdldERp
dicsICcuY29udGVudC1ob21lJyk7DQogICAgICAgIH0gZWxzZSBpZiAoaW5kZXggPT09IDEpIHsN
CiAgICAgICAgICAgICQodGhpcykuYXR0cigndGFyZ2V0RGl2JywgJy5jb250ZW50LXRlc3RzJyk7
DQogICAgICAgIH0gZWxzZSBpZiAoaW5kZXggPT09IDIpIHsNCiAgICAgICAgICAgICQodGhpcyku
YXR0cigndGFyZ2V0RGl2JywgJy5jb250ZW50LXJlc3VsdHMnKTsNCiAgICAgICAgICAgICQodGhp
cykuYXR0cigndGVzdFJ1bm5pbmcnLCAnZmFsc2UnKTsNCiAgICAgICAgfSBlbHNlIGlmIChpbmRl
eCA9PT0gMykgew0KICAgICAgICAgICAgJCh0aGlzKS5hdHRyKCd0YXJnZXREaXYnLCAnLmNvbnRl
bnQtZGV2Jyk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAkKHRoaXMp
LmF0dHIoJ3RhcmdldERpdicsICcuY29udGVudC1icm93c2VycycpOw0KICAgICAgICB9DQoNCiAg
ICAgICAgLy9BdHRhY2hpbmcgdGhlIGNsaWNrIGV2ZW50IHRvIHRoZSBoZWFkZXIgdGFiIHRoYXQg
c2hvd3MgdGhlIHJlc3BlY3RpdmUgZGl2IG9mIGhlYWRlciAgICAgICAgICAgIA0KICAgICAgICAk
KHRoaXMpLmNsaWNrKGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHZhciB0YXJnZXQgPSAkKHRo
aXMpLmF0dHIoJ3RhcmdldERpdicpOw0KICAgICAgICAgICAgJCgnI2NvbnRlbnRDb250YWluZXIg
PiBkaXY6dmlzaWJsZScpLmhpZGUoKTsNCiAgICAgICAgICAgICQoJy5uYXZCYXIgLnNlbGVjdGVk
JykudG9nZ2xlQ2xhc3MoJ3NlbGVjdGVkJyk7DQogICAgICAgICAgICAkKHRoaXMpLmFkZENsYXNz
KCdzZWxlY3RlZCcpOw0KICAgICAgICAgICAgJCh0YXJnZXQpLnNob3coKTsNCg0KICAgICAgICAg
ICAgLy9JZiBjbGlja2VkIHRhYiBpcyBSZXN1bHQsIGl0IGdlbmVyYXRlcyB0aGUgcmVzdWx0cy4N
CiAgICAgICAgICAgIGlmICgkKHRhcmdldCkuaGFzQ2xhc3MoJ2NvbnRlbnQtcmVzdWx0cycpKSB7
DQogICAgICAgICAgICAgICAgcHJlc2VudGVyLnJlZnJlc2goKTsNCiAgICAgICAgICAgIH0NCiAg
ICAgICAgfSk7DQogICAgfSk7DQoNCiAgICAvL0F0dGFjaCB0aGUgY2xpY2sgZXZlbnQgdG8gdGhl
IHN0YXJ0IGJ1dHRvbi4gSXQgc3RhcnRzLCBzdG9wcyBhbmQgcGF1c2VzIHRoZSB0ZXN0cw0KICAg
ICQoJy5idXR0b24tc3RhcnQnKS5jbGljayhmdW5jdGlvbiAoKSB7DQogICAgICAgIGNvbnRyb2xs
ZXIudG9nZ2xlKCk7DQogICAgfSk7DQoNCiAgICAvL0F0dGFjaCB0aGUgY2xpY2sgZXZlbnQgdG8g
dGhlIHJlc2V0IGJ1dHRvbi4gSXQgcmVzZXQgYWxsIHRoZSB0ZXN0IHRvIHplcm8NCiAgICAkKCcu
YnV0dG9uLXJlc2V0JykuY2xpY2soZnVuY3Rpb24gKCkgew0KICAgICAgICBjb250cm9sbGVyLnJl
c2V0KCk7DQogICAgfSk7DQp9KTsNCg==
</data>

          </attachment>
      

    </bug>

</bugzilla>