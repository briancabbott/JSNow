---
{"_attributes":{"version":"4.4.4+","urlbase":"https://bugs.ecmascript.org/","maintainer":"dherman@mozilla.com"},"bug":{"bug_id":1433,"creation_ts":"2013-04-11 13:37:00 -0700","short_desc":"15.5.4.11: String.prototype.replace calls function even if no match was found","delta_ts":"2013-05-14 18:13:26 -0700","product":"Draft for 6th Edition","component":"technical issue","version":"Rev 14: March 8, 2013 Draft","rep_platform":"All","op_sys":"All","bug_status":"RESOLVED","resolution":"FIXED","priority":"Normal","bug_severity":"normal","everconfirmed":true,"reporter":{"uid":"andrebargull","name":"André Bargull"},"assigned_to":{"uid":"allen","name":"Allen Wirfs-Brock"},"long_desc":[{"commentid":3629,"comment_count":0,"who":{"uid":"andrebargull","name":"André Bargull"},"bug_when":"2013-04-11 13:37:35 -0700","thetext":"Change algorithm to stop after step 8 if no match was found to ensure compatibility with ES5. \n\nAlso remove assertion in step 5 to handle case when RegExp.prototype.@@isRegExp has been removed.\n\n\nAnd two additional typos in Table 33:\n\"emptry\" -> \"empty\" (twice!) and \"stringLenth\" -> \"stringLength\"\n\n\nAnd for the implementation-defined notes, see bug 1133. Test262 already tests for a certain implementation."},{"commentid":3664,"comment_count":1,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2013-04-19 15:53:52 -0700","thetext":"fixed in rev 15 editor's draft.\n\nRegarding the implementation-defined behavior.  Is there any variation among existing major implementations?"},{"commentid":3709,"comment_count":2,"who":{"uid":"andrebargull","name":"André Bargull"},"bug_when":"2013-05-06 14:38:47 -0700","thetext":"Simply returning after step 8 may not be the right solution due to side effects:\n\"a\".replace(\"b\", {toString: function(){throw 0}})\n\"a\".replace(/b/, {toString: function(){throw 0}})\n\nAll major browsers throw an exception for the second call (search value is RegExp). For the search value is String case, JSC and V8 behave differently compared to the others, i.e. they do not throw an exception.\n\n---\n\nConcerning the implementation-defined behaviour question:\n\n\nBased on the source code at [1,2,3], SpiderMonkey, V8 and JSC all seem to share the same behaviour. Opera seems to be compliant as well, checking the actual source code may be beneficial, though. IE10 has an extension where $0 (and $00) refer to the entire matched pattern, e.g. \"ab\".replace(/(a)b/, \"$1_$01_$0_$00\") === \"a_a_ab_ab\". \n\nFor the case where the referenced capture does not exist, the behaviour seems to be the same across all major browsers (also see referenced source code from SM/V8/JSC): \n\n\"ab\".replace(\"a\", \"$2\") === \"$2b\"\n\"ab\".replace(/(a)/, \"$2\") === \"$2b\"\n\"a\".replace(/((((((((((a))))))))))/, \"$9_$09_$10_$11\") === \"a_a_a_a1\"\n\nMaybe it was allowed to be implementation defined for older SpiderMonkey versions [4], but since [5] SpiderMonkey works like the others. Based on [6], Netscape Navigator also had some quirks, but that isn't important anymore, is it?\n\n\n[1] http://hg.mozilla.org/mozilla-central/file/b842d26dd5f0/js/src/jsstr.cpp#l1934\n[2] http://code.google.com/p/v8/source/browse/branches/bleeding_edge/src/string.js?r=14560#328\n[3] https://trac.webkit.org/browser/trunk/Source/JavaScriptCore/runtime/StringPrototype.cpp?rev=149637#L163\n[4] http://bonsai.mozilla.org/cvsblame.cgi?file=mozilla/js/src/jsstr.c&rev=3.19&root=/cvsroot#975\n[5] https://bugzilla.mozilla.org/show_bug.cgi?id=104375\n[6] https://bugzilla.mozilla.org/show_bug.cgi?id=104375#c5"},{"commentid":3909,"comment_count":3,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2013-05-14 18:13:26 -0700","thetext":"resolved in rev 15, May 14, 2013 draft"}]}}
---
