---
{"_attributes":{"version":"4.4.4+","urlbase":"https://bugs.ecmascript.org/","maintainer":"dherman@mozilla.com"},"bug":{"bug_id":1780,"creation_ts":"2013-08-14 08:10:00 -0700","short_desc":"normalize test logs","delta_ts":"2014-07-18 01:37:25 -0700","product":"Test262","component":"Test Harness","version":"unspecified","rep_platform":"PC","op_sys":"Linux","bug_status":"CONFIRMED","priority":"Normal","bug_severity":"minor","everconfirmed":true,"reporter":{"uid":"Susanne.Oberhauser","name":"Susanne Oberhauser"},"assigned_to":{"uid":"brterlso","name":"Brian Terlson"},"cc":"sam.mikes","long_desc":[{"commentid":4883,"comment_count":0,"who":{"uid":"Susanne.Oberhauser","name":"Susanne Oberhauser"},"bug_when":"2013-08-14 08:10:21 -0700","thetext":"I'm smoke testing and validating updates to our (SUSE) nodejs package using this test suite.\n\nFor that, I'm packaging the test suite into an rpm package.  The package is rebuilt automatically when the nodejs package is updated (<plug>on all architectures and all distributions in the build service.  That includes, if someone has interest, fedora, ubuntu and CentOS, not only SUSE.  If someone has interest I can help enabling these, too.  Oh, and it could easily be extended to other js runtimes, too.</plug>)\n\nTo increase the value of the test builds, I include the result of a manual reviewed run in the package and I compare to that, using goode olde diff -u.\n\nNow the current log of the test suite is garbled if a failing test output doesn't end with a newline.  In those cases the log will contain that last line of the failed test together with the name of the next test.\n\nMy little sed work around shows the issue nicely:\n\n0 froh@byron:/tmp/test262 $ diff -u test262.log <(sed -e \"s,\\^\\([^\\n]\\),^\\n\\1,\" test262.log )\n--- test262.log 2013-08-14 15:40:33.141662499 +0200\n+++ /dev/fd/63  2013-08-14 15:54:35.264134519 +0200\n@@ -1981,7 +1981,8 @@\n --- output --- \n  /tmp/test262-TEST.js:289: Test262 Error: Test case returned non-true value!\n     throw new Test262Error(message);\n-          ^ch11/11.2/11.2.3/11.2.3-3_4 passed in non-strict mode \n+          ^\n+ch11/11.2/11.2.3/11.2.3-3_4 passed in non-strict mode \n ch11/11.2/11.2.3/11.2.3-3_5 passed in non-strict mode \n ch11/11.2/11.2.3/11.2.3-3_6 passed in non-strict mode \n ch11/11.2/11.2.3/11.2.3-3_7 passed in non-strict mode \n@@ -4484,7 +4485,8 @@\n --- output --- \n  /tmp/test262-TEST.js:289: Test262 Error: #1: JSON.parse confused by \"__proto__\"\n     throw new Test262Error(message);\n-          ^ch15/15.12/15.12.3/15.12.3-0-1 passed in non-strict mode \n+          ^\n+ch15/15.12/15.12.3/15.12.3-0-1 passed in non-strict mode \n ch15/15.12/15.12.3/15.12.3-0-2 passed in non-strict mode \n ch15/15.12/15.12.3/15.12.3-0-3 passed in non-strict mode \n ch15/15.12/15.12.3/15.12.3-11-1 passed in non-strict mode \n\n...\n\n\nI'd appreciate a fix for this, probably in tools/packaging/test262.py:TestResult.ReportOutcome(), as my workaround only captures that one kind of borked output that currently is there.\n\nAs I don't know in which scripts you possibly use the log file, I didn't just create a patch.\n\nthx :)\n\n\nS.\nPS: the tempnames can be handled fine with sed, like so:\nsed -e \"s,/tmp/test262-......\\.js:,/tmp/test262-TEST.js:,\""},{"commentid":4907,"comment_count":1,"attachid":"68","who":{"uid":"Susanne.Oberhauser","name":"Susanne Oberhauser"},"bug_when":"2013-08-15 07:02:23 -0700","thetext":"Created attachment 68\nadd newlines after --- output --- in log files\n\nok, I realized that there is nicely obfuscated code duplication, writing to the screen uses 'print' statements, while writing to the log file writes to the log file, and these two are not consistent.\n\nFurthermore, the log file is scattered with trailing whitespace on the lines, which greatly obfuscated the issue :D\n\nanyhow, attached is a patch that fixes exactly one thing:  add newlines after \n--- output --- for failing test cases."},{"commentid":9250,"comment_count":2,"who":{"uid":"sam.mikes","name":"Sam Mikes"},"bug_when":"2014-07-17 22:50:57 -0700","thetext":"As of 2014-July-17, this is not present in test262.py.\n\nI am willing to convert this patch into a github pull request."},{"commentid":9257,"comment_count":3,"who":{"uid":"Susanne.Oberhauser","name":"Susanne Oberhauser"},"bug_when":"2014-07-18 01:37:25 -0700","thetext":"ah you moved to github :)\nhttps://bugs.ecmascript.org/show_bug.cgi?id=2827\n\nI'll happily create a pull request :)"}],"attachment":[{"_attributes":{"isobsolete":"0","ispatch":"1"},"attachid":"68","date":"2013-08-15 07:02:00 -0700","delta_ts":"2013-08-15 07:02:23 -0700","desc":"add newlines after --- output --- in log files","filename":"testcase-output-eol.patch","type":"text/plain","size":"920","attacher":{"_attributes":{"name":"Susanne Oberhauser"},"_text":"Susanne.Oberhauser"},"data":{"_attributes":{"encoding":"base64"},"_text":"SW5kZXg6IHRlc3QyNjItZDA2N2QyZjBjYTMwL3Rvb2xzL3BhY2thZ2luZy90ZXN0MjYyLnB5Cj09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT0KLS0tIHRlc3QyNjItZDA2N2QyZjBjYTMwLm9yaWcvdG9vbHMvcGFja2FnaW5nL3Rl\nc3QyNjIucHkKKysrIHRlc3QyNjItZDA2N2QyZjBjYTMwL3Rvb2xzL3BhY2thZ2luZy90ZXN0MjYy\nLnB5CkBAIC01MTUsMTAgKzUxNSwxMSBAQCBjbGFzcyBUZXN0U3VpdGUob2JqZWN0KToKICAgICAg\nICAgICBzZWxmLmxvZ2Yud3JpdGUoIj09PSAlcyBmYWlsZWQgaW4gJXMgPT09IFxuIiAlIChuYW1l\nLCBtb2RlKSkKICAgICAgICAgICBvdXQgPSByZXN1bHQuc3Rkb3V0LnN0cmlwKCkKICAgICAgICAg\nICBpZiBsZW4ob3V0KSA+IDA6Ci0gICAgICAgICAgICAgc2VsZi5sb2dmLndyaXRlKCItLS0gb3V0\ncHV0IC0tLSBcbiAlcyIgJSBvdXQpCisgICAgICAgICAgICAgc2VsZi5sb2dmLndyaXRlKCItLS0g\nb3V0cHV0IC0tLSBcbiAlc1xuIiAlIG91dCkKICAgICAgICAgICBlcnIgPSByZXN1bHQuc3RkZXJy\nLnN0cmlwKCkKICAgICAgICAgICBpZiBsZW4oZXJyKSA+IDA6Ci0gICAgICAgICAgICAgc2VsZi5s\nb2dmLndyaXRlKCItLS0gZXJyb3JzIC0tLSAgXG4gJXMiICUgZXJyKQorICAgICAgICAgICAgIHNl\nbGYubG9nZi53cml0ZSgiLS0tIGVycm9ycyAtLS0gIFxuICVzXG4iICUgZXJyKQorICAgICAgICAg\nIGlmIGxlbihvdXQpID4gMCBvciBsZW4oZXJyKToKICAgICAgICAgICAgICBzZWxmLmxvZ2Yud3Jp\ndGUoIj09PSBcbiIpCiAgICAgZWxpZiByZXN1bHQuY2FzZS5Jc05lZ2F0aXZlKCk6CiAgICAgICAg\nc2VsZi5sb2dmLndyaXRlKCIlcyBmYWlsZWQgaW4gJXMgYXMgZXhwZWN0ZWQgXG4iICUgKG5hbWUs\nIG1vZGUpKQo=\n"}}]}}
---
