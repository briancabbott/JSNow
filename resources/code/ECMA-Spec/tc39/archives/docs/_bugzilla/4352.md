---
{"_attributes":{"version":"4.4.4+","urlbase":"https://bugs.ecmascript.org/","maintainer":"dherman@mozilla.com"},"bug":{"bug_id":4352,"creation_ts":"2015-05-01 14:33:00 -0700","short_desc":"Annex E: Changed evaluation order in for-in statement","delta_ts":"2015-10-02 13:14:04 -0700","product":"Draft for 6th Edition","component":"technical issue","version":"Rev 38: April 14, 2015 Final Draft","rep_platform":"All","op_sys":"All","bug_status":"RESOLVED","resolution":"FIXED","priority":"Normal","bug_severity":"normal","everconfirmed":true,"reporter":{"uid":"andrebargull","name":"André Bargull"},"assigned_to":{"uid":"allen","name":"Allen Wirfs-Brock"},"long_desc":[{"commentid":14371,"comment_count":0,"who":{"uid":"andrebargull","name":"André Bargull"},"bug_when":"2015-05-01 14:33:20 -0700","thetext":"Annex E does not cover the changed lhs evaluation order in for-in statements.\n\nES5: Prints \"in loop\"\nES6: Does not print \"in loop\"\n\n---\nvar o = {a: 0};\nvar p = {\n  get q() {\n   delete o.a;\n   return {};\n  }\n};\nfor (p.q.v in o) {\n  print(\"in loop\");\n}\n---"},{"commentid":14428,"comment_count":1,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2015-05-20 09:43:34 -0700","thetext":"I think this is a legacy compatibility bug that needs to be corrected and for consistency for-of also needs to work that same way.\n\nThis basically means that in 13.7.5.13 that steps 5.c-g need to move to the top of the loop."},{"commentid":14447,"comment_count":2,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2015-05-25 10:18:52 -0700","thetext":"fixed in rev39 publication draft"},{"commentid":14453,"comment_count":3,"who":{"uid":"andrebargull","name":"André Bargull"},"bug_when":"2015-05-26 09:54:46 -0700","thetext":"Was the implicit try-finally scope also changed to the rev29 bounds? Errors in rev38, 13.7.5.13 ForIn/OfBodyEvaluation steps 5.a-b don't call IteratorClose; in rev29 an error in those steps did call IteratorClose. \n\nSimple example for the rev38 behaviour:\n\njs> function* g(){try { yield } finally { print(\"finally!\") }}\njs> for (null[0] of g());\nuncaught exception: TypeError: cannot convert \"null\" or \"undefined\" to object\n        at  (typein:2)\njs> for ({set prop(_){throw null}}.prop of g());\nfinally!\nuncaught exception: null\n        at set prop (typein:3)\n        at  (typein:3)\n\n\nIn rev29, the first for-of loop also calls IteratorClose before re-throwing the TypeError."},{"commentid":14455,"comment_count":4,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2015-05-26 11:12:44 -0700","thetext":"(In reply to André Bargull from comment #3)\n> Was the implicit try-finally scope also changed to the rev29 bounds? Errors\n> in rev38, 13.7.5.13 ForIn/OfBodyEvaluation steps 5.a-b don't call\n> IteratorClose; in rev29 an error in those steps did call IteratorClose. \n> \nYes"}]}}
---
