---
{"_attributes":{"version":"4.4.4+","urlbase":"https://bugs.ecmascript.org/","maintainer":"dherman@mozilla.com"},"bug":{"bug_id":230,"creation_ts":"2011-11-29 19:27:00 -0800","short_desc":"Bugs in Number.prototype.toPrecision algorithm","delta_ts":"2014-07-20 18:20:04 -0700","product":"Draft for 6th Edition","component":"technical issue","version":"Rev 18: September 5, 2013 Draft","rep_platform":"All","op_sys":"All","bug_status":"VERIFIED","resolution":"FIXED","priority":"Normal","bug_severity":"normal","everconfirmed":true,"reporter":{"uid":"ecmascriptbugs","name":"Norbert"},"assigned_to":{"uid":"allen","name":"Allen Wirfs-Brock"},"long_desc":[{"commentid":516,"comment_count":0,"who":{"uid":"ecmascriptbugs","name":"Norbert"},"bug_when":"2011-11-29 19:27:09 -0800","thetext":"The algorithm for Number.prototype.toPrecision has a bug as well as a section that seems unnecessary.\n\nThe bug: When execution completes step 10.c.v, m is a string that's ready to be returned to the caller. However, the algorithm doesn't return it at this point, but instead stumbles through steps 11-14, adding unwanted characters to the string before finally returning it to the caller. For example, here are the steps taken for (-12340000).toPrecision(3):\n\n1. x = -12340000\n2. skip\n3. p = 3\n4. skip\n5. s = \"\"\n6. then\n    a. s = \"=\"\n    b. x = 12340000\n7. skip\n8. skip\n9. skip\n10. else\n    a. e = 7, n = 123\n    b. m = \"123\"\n    c. then\n        i. a = \"1\", b = \"23\"\n        ii. m = \"1.23\"\n        iii. skip\n        iv. else\n            1. then\n                a. c = \"+\"\n            2. skip\n            3. d = \"7\"\n        v. m = \"-1.23e+7\"\n11. skip\n12. then\n    a. m = \"-1.23e+7.\"\n13. skip\n14. return \"--1.23e+7.\"\n\nThe unnecessary section: The test e = 0 in 10.c.iii as well as the dependent step 10.c.iii.1 seem unnecessary because from 10.c we know that either e < -6 or e >= p, and from 8 that p >= 1."},{"commentid":5416,"comment_count":1,"who":{"uid":"ecmascriptbugs","name":"Norbert"},"bug_when":"2013-09-23 19:16:05 -0700","thetext":"Step numbers in draft ES6 are two higher."},{"commentid":5911,"comment_count":2,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2013-10-20 17:48:11 -0700","thetext":"fixed in rev 20 editor's draft"},{"commentid":6070,"comment_count":3,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2013-10-29 09:45:26 -0700","thetext":"fixed in rev20 draft, Oct. 28, 2013"},{"commentid":9414,"comment_count":4,"who":{"uid":"ecmascriptbugs","name":"Norbert"},"bug_when":"2014-07-20 18:20:04 -0700","thetext":"Verified in rev 26 draft."}]}}
---
