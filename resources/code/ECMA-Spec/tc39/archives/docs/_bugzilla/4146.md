---
{"_attributes":{"version":"4.4.4+","urlbase":"https://bugs.ecmascript.org/","maintainer":"dherman@mozilla.com"},"bug":{"bug_id":4146,"creation_ts":"2015-03-08 20:41:00 -0700","short_desc":"10.2 + 10.2.1: suggested rewrite","delta_ts":"2015-03-10 15:05:20 -0700","product":"Draft for 7th Edition","component":"Deferred from 6th edition","version":"unspecified","rep_platform":"All","op_sys":"All","bug_status":"CONFIRMED","priority":"Normal","bug_severity":"enhancement","everconfirmed":true,"reporter":{"uid":"jmdyck","name":"Michael Dyck"},"assigned_to":{"uid":"allen","name":"Allen Wirfs-Brock"},"long_desc":[{"commentid":13652,"comment_count":0,"who":{"uid":"jmdyck","name":"Michael Dyck"},"bug_when":"2015-03-08 20:41:30 -0700","thetext":"In 10.2 \"Types of Source Code\" and 10.2.1 \"Strict Mode Code\", ...\n\n{1}\nThe \"four types of ECMAScript code\" don't cover all source text. There are little exceptions like the BindingIdentifier and top-level terminals of a FunctionDeclaration, but there are also big exceptions like classes.\n\n{2}\n10.2 has three long lists of nonterminals, all the same list. 10.2.1 has another list that is almost the same. And there are other repeated bits.\n\nTo address the above (and also the points in Bug 4142 and Bug 4145), here's a suggested rewrite of those two sections.\n\n-----------\n\nSource text is divided into regions according to the 'region-defining nonterminals':\n    Script\n    Module\n    ClassDeclaration\n    ClassExpression\n    FunctionDeclaration\n    ...\n    ArrowFunction\nEach instance of a region-defining nonterminal in a parse tree defines a region that includes all of the matching source text except for the source text of any nested region.\n\nSource text is classified according to the region it belongs to:\n * 'Global code' is source text in a region defined by /Script/.\n\n * 'Module code' is source text in a region defined by /Module/.\n\n * 'Class code' is source text in a region defined by /ClassDeclaration/\n   or /ClassExpression/.\n\n * 'Function code' is source text in a region defined by any other\n   region-defining nonterminal.\n\n * ['Eval code' is defined as it is now, just a special case of global code.]\n\nA region is 'strict' if either it is nested within a region that is strict, or it is:\n    * module code;\n    * class code;\n    * global code that is explicitly strict;\n    * function code whose FunctionBody is explicitly strict; or\n    * eval code that is explicitly strict or is invoked via a direct eval\n        that is in a region that is strict.\n\nwhere \"is explicitly strict\" means\n\"begins with a Directive Prologue that contains a Use Strict Directive\".\n\nFor the purposes of the above definitions *only*, if an invocation of the built-in Function constructor causes source text to be parsed as FunctionBody and FormalParameters, these are deemed to be the FunctionBody and FormalParameters of a FunctionExpression.\n\n[And similarly for GeneratorFunction.]"},{"commentid":13656,"comment_count":1,"who":{"uid":"jmdyck","name":"Michael Dyck"},"bug_when":"2015-03-09 06:43:30 -0700","thetext":"Re {1}, I now recall that most of a class is function code. However, there's still a non-trivial leftover (ClassHeritage) that isn't any of the 4 \"types\" of code."},{"commentid":13677,"comment_count":2,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2015-03-10 11:13:23 -0700","thetext":"I don't want to do this big a change at this state in the process.\n\nDeferring to Es7 so we can think about a rewrite in that context"},{"commentid":13688,"comment_count":3,"who":{"uid":"jmdyck","name":"Michael Dyck"},"bug_when":"2015-03-10 15:05:20 -0700","thetext":"okay."}]}}
---
