---
{"_attributes":{"version":"4.4.4+","urlbase":"https://bugs.ecmascript.org/","maintainer":"dherman@mozilla.com"},"bug":{"bug_id":3692,"creation_ts":"2015-01-30 15:51:00 -0800","short_desc":"9.2.3 [[Construct]]: Use %ObjectPrototype% from caller or callee realm?","delta_ts":"2015-01-30 16:40:32 -0800","product":"Draft for 6th Edition","component":"technical issue","version":"Rev 31: January 15, 2015 Draft","rep_platform":"All","op_sys":"All","bug_status":"RESOLVED","resolution":"INVALID","priority":"Normal","bug_severity":"normal","everconfirmed":true,"reporter":{"uid":"andrebargull","name":"André Bargull"},"assigned_to":{"uid":"allen","name":"Allen Wirfs-Brock"},"long_desc":[{"commentid":11760,"comment_count":0,"who":{"uid":"andrebargull","name":"André Bargull"},"bug_when":"2015-01-30 15:51:43 -0800","thetext":"9.2.3 [[Construct]] ( argumentsList, newTarget)\n\nExecution of step 5: The caller execution context is still the current execution context when OrdinaryCreateFromConstructor is called, that means the intrinsic %ObjectPrototype% from the caller realm will be used if .prototype is not an object. \nIs this the correct choice? Not all browser implementations show that behaviour.\n\n\nIE11, Firefox 36: Report \"false, true\"\nChrome 39: Reports \"true, false\"\n\n\nTest case:\n---\n<!doctype html>\n<html>\n    <head>\n      <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" />\n    </head>\n    <body>\n        <iframe id=\"iframe\"></iframe>\n        <script type=\"text/javascript\">\n(function(){\n\"use strict\";\n\nvar global = window;\nvar otherGlobal = document.getElementById(\"iframe\").contentWindow;\n\nvar f = otherGlobal.eval(\"(function f(){})\");\nf.prototype = null;\n\nvar o = new f();\nvar proto = Object.getPrototypeOf(o);\n\nalert([\n  proto === global.Object.prototype,\n  proto === otherGlobal.Object.prototype,\n]);\n\n})();\n        </script>\n    </body>\n</html>\n---"},{"commentid":11765,"comment_count":1,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2015-01-30 16:27:38 -0800","thetext":"No, that's not what 9.2.3 says.  Note that it passes the string name of the intrinsic it wants.  OrdinaryCreateFromConstructor passes that string to GetPrototypeFromConstructor that, if necessary, fetches the named intrinsic from the real of the constructor. \n\nPrior editions of ES were not specific about what Realm should be used in this case.  However, the currently spec'ed behavior (the IE11/FF behavior) clearly seems right. The constructor should be in control of what it instantiates.\n\nIt looks to me like a V8/Chrome bug should be reported on this."},{"commentid":11767,"comment_count":2,"who":{"uid":"andrebargull","name":"André Bargull"},"bug_when":"2015-01-30 16:40:32 -0800","thetext":"(In reply to Allen Wirfs-Brock from comment #1)\n> No, that's not what 9.2.3 says. \n\nAh yes, I forgot about the special casing in GetPrototypeFromConstructor."}]}}
---
