---
{"_attributes":{"version":"4.4.4+","urlbase":"https://bugs.ecmascript.org/","maintainer":"dherman@mozilla.com"},"bug":{"bug_id":645,"creation_ts":"2012-09-03 17:49:00 -0700","short_desc":"BestAvailableLocale() off-by-one error","delta_ts":"2012-10-16 15:13:39 -0700","product":"Internationalization - ECMA-402","component":"Specification","version":"Edition 1.0 drafts","rep_platform":"All","op_sys":"All","bug_status":"RESOLVED","resolution":"FIXED","priority":"Normal","bug_severity":"enhancement","everconfirmed":true,"reporter":{"uid":"gphemsley","name":"Gordon P. Hemsley"},"assigned_to":{"uid":"ecmascriptbugs","name":"Norbert"},"long_desc":[{"commentid":1584,"comment_count":0,"who":{"uid":"gphemsley","name":"Gordon P. Hemsley"},"bug_when":"2012-09-03 17:49:05 -0700","thetext":"If I'm reading (and implementing) BestAvailableLocale() correctly, there seems to be an off-by-one error with regard to step 2(d): \"pos-1\" should be \"pos\".\n\nThis is the code I'm using, and it's chopping too much off the end of the candidate:\n\nBestAvailableLocale: function(availableLocales, locale) {\n\tif (!this.IsStructurallyValidLanguageTag(locale)) {\n\t\treturn undefined;\n\t}\n\n\tlet candidate = this.CanonicalizeLanguageTag(locale);\n\n\twhile (candidate.length > 0) {\n\t\tif (availableLocales.indexOf(candidate) !== -1) {\n\t\t\treturn candidate;\n\t\t}\n\n\t\tlet pos = candidate.lastIndexOf('-');\n\n\t\tif (pos === -1) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif (pos >= 2 && candidate[pos - 2] === '-' ) {\n\t\t\tpos -= 2;\n\t\t}\n\n\t\tcandidate = candidate.substring(0, pos - 1);\n\t}\n},\n\nAm I missing something? Or is the spec wrong?"},{"commentid":1586,"comment_count":1,"who":{"uid":"ecmascriptbugs","name":"Norbert"},"bug_when":"2012-09-03 22:20:56 -0700","thetext":"In a call to substring, it has to be just pos. Where the spec said \"substring of candidate from position 0 to position pos-1\", it meant to include the characters in both positions.\n\nTo make things clearer, I changed the spec to say \"position 0, inclusive, to position pos, exclusive\"."}]}}
---
