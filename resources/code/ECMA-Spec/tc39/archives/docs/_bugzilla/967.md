---
{"_attributes":{"version":"4.4.4+","urlbase":"https://bugs.ecmascript.org/","maintainer":"dherman@mozilla.com"},"bug":{"bug_id":967,"creation_ts":"2012-11-14 01:31:00 -0800","short_desc":"15.5.4.25 codePointAt usability issue","delta_ts":"2014-04-18 12:54:29 -0700","product":"Draft for 6th Edition","component":"technical issue","version":"Rev 11: October 26, 2012 Draft","rep_platform":"All","op_sys":"All","bug_status":"RESOLVED","resolution":"WONTFIX","priority":"Normal","bug_severity":"enhancement","everconfirmed":true,"reporter":{"uid":"roger.andrews","name":"Roger Andrews"},"assigned_to":{"uid":"allen","name":"Allen Wirfs-Brock"},"cc":["ecmascriptbugs","roger.andrews"],"long_desc":[{"commentid":2466,"comment_count":0,"who":{"uid":"roger.andrews","name":"Roger Andrews"},"bug_when":"2012-11-14 01:31:13 -0800","thetext":"The definition of codePointAt has results:\n   out-of-bounds                  -> Undefined\n   normal BMP char                -> the codepoint\n   lead surrogate of a good pair  -> the codepoint\n   trail surrogate of a good pair -> codeunit in [0xDC00:0xDFFF]  !!ambiguous\n   bad trail surrogate            -> codeunit in [0xDC00:0xDFFF]\n   bad lead surrogate             -> codeunit in [0xD800:0xDBFF]\n\nNote that a well-paired trail surrogate still results in a value even though the previous codeunit \"subsumed\" it.  So, if the caller is indexing down a string then it should take the well-paired trail surrogate value out of the sequence.\n\nUTF16 experts can write code to check these possibilities; but for general usability lets have:\n   Undefined for the trail surrogate of a good pair, and\n   NaN for bad surrogate.\n\nThen codePointAt would do the work for the casual user and experts can probe the string with charCodeAt (or codeUnitAt if it exists) if they really want to know the situation of bad surrogates.\n\n========================\nUnchanged, users are called upon to write code patterns like the messy....\n\n  // if the indexed position is part of a well-formed surrogate pair\n  // then result is either the entire code-point (for lead surrogates)\n  //                or undefined (for trail surrogates)\n  // result is NaN for bad surrogates\n  // (result is always undefined for out-of-bounds position)\n\n  cp = str.charPointAt( pos );\n  if (0xDC00 <= cp  &&  cp <= 0xDFFF) {\n      cu = str.charCodeAt( pos-1 );\n      if (0xD800 <= cu  &&  cu <= 0xDBFF) {\n          cp =  undefined;      // trail surrogate of good pair\n      }\n  }\n  if (0xD800 <= cp  &&  cp <= 0xDFFF) {\n      cp = NaN;                 // bad surrogate\n  }"},{"commentid":2467,"comment_count":1,"who":{"uid":"roger.andrews","name":"Roger Andrews"},"bug_when":"2012-11-14 01:43:13 -0800","thetext":"(Typo in my example code above: for 'charPointAt' read 'codePointAt')"},{"commentid":2909,"comment_count":2,"who":{"uid":"ecmascriptbugs","name":"Norbert"},"bug_when":"2012-11-29 13:46:56 -0800","thetext":"See discussion at\nhttps://mail.mozilla.org/pipermail/es-discuss/2012-November/thread.html#26340"},{"commentid":7822,"comment_count":3,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2014-04-18 12:54:29 -0700","thetext":"It's time to put ES6 to bed. Norbert made a good response to this proposal and nobody has further championed these changes within TC39, so at this point in time it doesn't look like we are going to make further ES6 changes in this area.\n\nProposals are being made for post ES6 features (see https://github.com/tc39/ecma262 ), so you may want to consider re-proposing some of the additional String functions."}]}}
---
