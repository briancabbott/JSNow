---
{"_attributes":{"version":"4.4.4+","urlbase":"https://bugs.ecmascript.org/","maintainer":"dherman@mozilla.com"},"bug":{"bug_id":2382,"creation_ts":"2013-12-11 03:36:00 -0800","short_desc":"6.2.4: Current PropertyDescriptor.[[Origin]] design hazards","delta_ts":"2014-08-01 06:28:48 -0700","product":"Draft for 6th Edition","component":"technical issue","version":"Rev 21: November 8, 2013 Draft","rep_platform":"All","op_sys":"All","bug_status":"RESOLVED","resolution":"FIXED","priority":"Normal","bug_severity":"normal","everconfirmed":true,"reporter":{"uid":"andrebargull","name":"André Bargull"},"assigned_to":{"uid":"allen","name":"Allen Wirfs-Brock"},"cc":["erights","tomvc.be"],"long_desc":[{"commentid":6924,"comment_count":0,"who":{"uid":"andrebargull","name":"André Bargull"},"bug_when":"2013-12-11 03:36:25 -0800","thetext":"The [[Origin]] field for PropertyDescriptor records seems to cause more harm than it brings benefits, at least in its current design. IIRC [[Origin]] was added to reduce object allocation costs and to provide a way to use custom property descriptors. But with its current design it is also possible to return invalid property descriptors from `Object.getOwnPropertyDescriptor()`, which does not seem to be intended. \n\nThis test case from [1] currently prints \"false\", which gives the impression that the property is non-configurable when in fact it is configurable.\n---\nlet propertyName = \"propertyName\";\nlet target = {[propertyName]: 0};\nlet p2 = new Proxy(target, {\n  getOwnPropertyDescriptor(t, pk) {\n    return {\n      value: 1, writable: true, enumerable: true,\n      get configurable() {\n        delete this.configurable;\n        this.configurable = false;\n        return true;\n      }\n    };\n  }\n});\nprint(Object.getOwnPropertyDescriptor(p2, propertyName).configurable);\n---\n\n[1] https://github.com/anba/es6draft/blob/master/src/test/scripts/suite/objects/Proxy/origin_pitfalls.js"},{"commentid":7331,"comment_count":1,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2014-02-16 17:49:52 -0800","thetext":"What harm is there in this?\n\nWhat was intended is that a Proxy handler can generate and accept (at the object level) any sort of property descriptor is wants. Including ones that  add new attributes or has attribute combinations (set+writable) that aren't produced by ordinary objects.  These are exactly the sorts of things that extensions to the ES ordinary object  model might do. So this allow such extensions to be experimented with and polyfilled.\n\nWe could restrict the property descriptors to returned from [[GetOwnProperty]] to only containing data properties.  But it isn't clear to me why why is necessary. It has always been the case that property descritpros using accessor properties could be passed to Object.defineProperty, etc.  And a property descriptor itself might be a Proxy so restricting accessor properties still don't result in side-effect free access to property descriptors.\n\nWe already have a good separation between Property Descriptor Records which are used internally within the spec. and Property Descriptor Objects which are at the Es meta level.  I don't see why the object form needs to be restricted.  When internal invariants need to be maintained Descriptor records are generated from descriptor objects."},{"commentid":7336,"comment_count":2,"who":{"uid":"andrebargull","name":"André Bargull"},"bug_when":"2014-02-17 04:13:17 -0800","thetext":"I've just noticed this topic was already discussed in [1]. Basically I share the same concerns as Tom Van Cutsem (cc-ed), so I don't think it's necessary for me to repeat them here once again. I've also cc-ed Mark Miller because he was explicitly mentioned in that thread. \n\n[1] http://esdiscuss.org/topic/property-descriptor-normalization-was-general-comments-response-was-re-es6-rev13-review-mop-refactoring-symbols-proxies-reflect-module"},{"commentid":8227,"comment_count":3,"who":{"uid":"tomvc.be","name":"Tom Van Cutsem"},"bug_when":"2014-05-08 14:20:43 -0700","thetext":"These issues were brought up independently by Jason Orendorff [1]\n\nAfter discussion between MarkM, Allen and myself, the consensus is to remove [[Origin]] and instead spec [[GetOwnProperty]] for Proxies such that the descriptor returned by the trap is coerced into a fresh, normalized, complete descriptor object (as originally specified in [2], but without copying custom attributes).\n\n[1] http://esdiscuss.org/topic/object-getownpropertydescriptor-can-return-just-about-anything\n[2] http://wiki.ecmascript.org/doku.php?id=harmony:proxies_spec"},{"commentid":9654,"comment_count":4,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2014-08-01 06:28:48 -0700","thetext":"in rev26"}]}}
---
