---
{"_attributes":{"version":"4.4.4+","urlbase":"https://bugs.ecmascript.org/","maintainer":"dherman@mozilla.com"},"bug":{"bug_id":4429,"creation_ts":"2015-07-21 09:12:00 -0700","short_desc":"14.5.14 invalid default constructor for class extends null","delta_ts":"2015-07-21 12:41:50 -0700","product":"ECMA-262 Edition 6","component":"technical issues","version":"unspecified","rep_platform":"All","op_sys":"All","bug_status":"CONFIRMED","priority":"Normal","bug_severity":"enhancement","everconfirmed":true,"reporter":{"uid":"allen","name":"Allen Wirfs-Brock"},"assigned_to":{"uid":"allen","name":"Allen Wirfs-Brock"},"cc":["andrebargull","brterlso","erik.arvidsson"],"long_desc":[{"commentid":14560,"comment_count":0,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2015-07-21 09:12:30 -0700","thetext":"The spec says that\n\n    class Foo extends null {}\n\nsets Foo.[[Prototype]] to %FunctionPrototype% and defines the default constructor body as: constructor(...args) {super(...args);}\n\nThis causes a runtime error for\n   new Foo\nbecause %FunctionPrototype% is not a constructor\n\nThe problem is in line 10.a where the test\n   if ClassHeritage-opt is present, then\n\nis such to determine the default constructor body. Instead the 10.a test should be\n   if ClassHeritage-opt is present and SameValue(constructorParent,%FunctionProtoype) is false, then\n\n\n(thanks to Brian Terlson for spotting the problem)"},{"commentid":14561,"comment_count":1,"who":{"uid":"andrebargull","name":"André Bargull"},"bug_when":"2015-07-21 09:45:37 -0700","thetext":"Does that mean the resolution from [1] is going to be revised?\n\n[1] https://github.com/rwaldron/tc39-notes/blob/master/es6/2015-01/jan-27.md#conclusionresolution-2"},{"commentid":14562,"comment_count":2,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2015-07-21 11:25:46 -0700","thetext":"(In reply to André Bargull from comment #1)\n> Does that mean the resolution from [1] is going to be revised?\n> \n> [1]\n> https://github.com/rwaldron/tc39-notes/blob/master/es6/2015-01/jan-27.\n> md#conclusionresolution-2\n\nIt seems that it must.\n\nUnfortunately, the resolution described there (which is what is in the ES2015 spec) just doesn't work for:\n\n    new class extends null {}\n\nBecause %FunctionPrototype% is not a constructor and hence the  `super(...args)` call in the default constructor body will fail when it does %FunctionPrototype%.[[Construct]]()"},{"commentid":14563,"comment_count":3,"who":{"uid":"andrebargull","name":"André Bargull"},"bug_when":"2015-07-21 11:50:26 -0700","thetext":"(In reply to Allen Wirfs-Brock from comment #2)\n> Unfortunately, the resolution described there (which is what is in the\n> ES2015 spec) just doesn't work for:\n> \n>     new class extends null {}\n> \n> Because %FunctionPrototype% is not a constructor and hence the \n> `super(...args)` call in the default constructor body will fail when it does\n> %FunctionPrototype%.[[Construct]]()\n\n\nErik Arvidsson (cc-ed) already described that issue during the meeting:\n\n> EA: If you have an extends clause, the default constructor calls super. If the \n> extends expression evaluates to null then the super() call will throw. So you \n> have to provide your own constructor"},{"commentid":14564,"comment_count":4,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2015-07-21 12:29:23 -0700","thetext":"(In reply to Allen Wirfs-Brock from comment #0)\n> The spec says that\n> \n>     class Foo extends null {}\n> \n> sets Foo.[[Prototype]] to %FunctionPrototype% and defines the default\n> constructor body as: constructor(...args) {super(...args);}\n> \n> This causes a runtime error for\n>    new Foo\n> because %FunctionPrototype% is not a constructor\n> \n> The problem is in line 10.a where the test\n>    if ClassHeritage-opt is present, then\n> \n> is such to determine the default constructor body. Instead the 10.a test\n> should be\n>    if ClassHeritage-opt is present and\n> SameValue(constructorParent,%FunctionProtoype) is false, then\n> \n> \n> (thanks to Brian Terlson for spotting the problem)\n\nIn addition, step 15 needs to also add a \n   and SameValue(constructorParent,%FunctionProtoype) is false\nclause to its predicate"},{"commentid":14565,"comment_count":5,"who":{"uid":"brterlso","name":"Brian Terlson"},"bug_when":"2015-07-21 12:41:50 -0700","thetext":"It was actually discovered here: https://github.com/Microsoft/TypeScript/issues/3696.\n\nI think it's clear that `extends null` shouldn't need to provide its own constructor to avoid errors. From the notes it seems like Erik raised the concern and it was not addressed at all. Maybe no one realized the severity of the issue? Or maybe I'm overlooking why Allen's proposed solution is a bad idea."}]}}
---
