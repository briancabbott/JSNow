---
{"_attributes":{"version":"4.4.4+","urlbase":"https://bugs.ecmascript.org/","maintainer":"dherman@mozilla.com"},"bug":{"bug_id":3237,"creation_ts":"2014-09-19 08:50:00 -0700","short_desc":"19.1.3.5 Object.prototype.toLocaleString: this-binding no longer boxed","delta_ts":"2014-12-07 14:35:01 -0800","product":"Draft for 6th Edition","component":"technical issue","version":"Rev 27: August 24, 2014 Draft","rep_platform":"All","op_sys":"All","bug_status":"RESOLVED","resolution":"FIXED","priority":"Normal","bug_severity":"normal","everconfirmed":true,"reporter":{"uid":"andrebargull","name":"André Bargull"},"assigned_to":{"uid":"allen","name":"Allen Wirfs-Brock"},"long_desc":[{"commentid":10204,"comment_count":0,"who":{"uid":"andrebargull","name":"André Bargull"},"bug_when":"2014-09-19 08:50:06 -0700","thetext":"19.1.3.5 Object.prototype.toLocaleString ( [ reserved1 [ , reserved2 ] ]  )\n\nThe this-binding was always a boxed value in ES5, this got changed in ES6 rev6. Was this a deliberate change?\n\n\nES5: Returns \"object\"\nES6: Returns \"number\"\n\n---\nNumber.prototype.toString = function() {\n  \"use strict\";\n  return typeof this;\n};\nObject.prototype.toLocaleString.call(0);\n---"},{"commentid":10230,"comment_count":1,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2014-09-21 11:58:37 -0700","thetext":"not, sure whether it was deliberate but I think it is a good change.\n\nArguably, the ES5 boxing was a bug that was a result of over zealous addition of this value boxing that was added when boxing was moved form the caller side to the callee side.\n\nBut, we also want to avoid unnecessary boxing, especially for values that a propagated to other functions.  I think we should leave it as currently spec'ed and document it as in Annex D as a correction that has possible (although likely) compatibility impact."},{"commentid":10236,"comment_count":2,"who":{"uid":"andrebargull","name":"André Bargull"},"bug_when":"2014-09-21 13:47:02 -0700","thetext":"(In reply to Allen Wirfs-Brock from comment #1)\n> But, we also want to avoid unnecessary boxing, especially for values that a\n> propagated to other functions.  \n\nDo you think it's possible to omit the current boxing in for-of loop iteration or collection classes?"},{"commentid":10238,"comment_count":3,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2014-09-21 14:49:54 -0700","thetext":"(In reply to André Bargull from comment #2) \n> \n> Do you think it's possible to omit the current boxing in for-of loop\n> iteration or collection classes?\n\nCould you be more specific about the cases you are think of."},{"commentid":10244,"comment_count":4,"who":{"uid":"andrebargull","name":"André Bargull"},"bug_when":"2014-09-23 09:10:36 -0700","thetext":"(In reply to Allen Wirfs-Brock from comment #3)\n> Could you be more specific about the cases you are think of.\n\nI realized this topic was already discussed in bug 3111. There is no follow up after the last comment (bug 3111 comment 10). Was there any outcome?\n\nBasically I'm asking whether it makes sense to perform these changes [1]. Sorry for the rather large diff, what started as a snug, little modification turned quickly into a monstrous beast. That makes me wonder if this change is really worth it... :-/\n\nThe effect of these changes can be observed in this test case. Without the modifications the script prints \"iterable-type: object\", with the modifications applied it will print \"iterable-type: number\".\n\n---\nNumber.prototype[Symbol.iterator] = function() {\n  \"use strict\";\n  print(`iterable-type: ${typeof this}`);\n  return {next: () => ({done: true})};\n};\nfor (var v of 123);\n---\n\n\n[1] Patch: https://gist.github.com/anba/2f96c137f8fb2f67ebc0\nBase (rev27): https://gist.github.com/anba/51eb15881522a107adf8\nModified: https://gist.github.com/anba/ba5923a3bb2e0aed93f7"},{"commentid":10686,"comment_count":5,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2014-11-26 14:34:42 -0800","thetext":"fixed in rev29 editor's draft\n\nThat is, the observable boxing in for-of loops and related places has been eliminated.  Also in destructuring"},{"commentid":10860,"comment_count":6,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2014-12-07 14:35:01 -0800","thetext":"fixed in rev29"}]}}
---
