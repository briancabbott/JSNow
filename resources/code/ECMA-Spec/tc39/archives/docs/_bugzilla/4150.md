---
{"_attributes":{"version":"4.4.4+","urlbase":"https://bugs.ecmascript.org/","maintainer":"dherman@mozilla.com"},"bug":{"bug_id":4150,"creation_ts":"2015-03-09 15:32:00 -0700","short_desc":"\"X is contained in strict code\"","delta_ts":"2015-03-17 16:57:07 -0700","product":"Draft for 6th Edition","component":"editorial issue","version":"Rev 35: March 4, 2015 Release Candidate 2","rep_platform":"All","op_sys":"All","bug_status":"RESOLVED","resolution":"FIXED","priority":"Normal","bug_severity":"enhancement","everconfirmed":true,"reporter":{"uid":"jmdyck","name":"Michael Dyck"},"assigned_to":{"uid":"allen","name":"Allen Wirfs-Brock"},"long_desc":[{"commentid":13674,"comment_count":0,"who":{"uid":"jmdyck","name":"Michael Dyck"},"bug_when":"2015-03-09 15:32:55 -0700","thetext":"The spec has several conditions of the form:\n    \"If X is contained in strict code or if its <child> is strict code, ...\"\n(I've appended a list.) I have a few comments about them.\n\n----------\n{1}\nPresumably, the distinction that these conditions make between\n    \"X is contained in strict code\"\nand\n    \"Y is strict code\"\nrelates to the fact that strictness can come \"down from above\" (inherited from\na strict parent) or \"up from below\" (via a Use Strict Directive in a Directive\nPrologue). However, the definition of strict code covers this distinction, so\nit shouldn't be necessary to repeat it elsewhere.\n\n----------\n{2}\nIn particular, if X is contained in strict code, then X *is* strict code\n(though the converse is not always true, of course). And recursively, every\nchild of X is also strict code.\n\nThus, in each of the conditions under discussion, the first term implies the\nsecond, so it suffices to check just the second.\n\n----------\n(3)\n14.4.12 / groups 1 + 2:\n   GeneratorDeclaration : function * ... ( FormalParameters ) { GeneratorBody }\n   GeneratorDeclaration : function * ( FormalParameters ) { GeneratorBody }\n      If the GeneratorDeclaration is contained in strict code\n          or if its GeneratorBody is strict code, ...\n\nThe condition's second term is presumably meant to mean \"its GeneratorBody\nbegins with a 'use strict' directive\", but it's debatable whether it achieves\nthat. Consider the derivation:\n\n    GeneratorDeclaration\n     -> GeneratorBody\n         -> FunctionBody\n             -> FunctionStatementList\n                 -> StatementList\n                    (-> Directive Prologue)\n                        (-> Use Strict Directive)\n\nIn such a case, 10.2.1 tells us that the code within the *FunctionBody* is\nstrict code, but the GeneratorBody is not *within* the FunctionBody, so that\nsuggests it isn't strict code (unless, of course, it inherits strictness from\nabove).\n\nYou could get around this objection by changing the condition to\n    ... or if _the_code_within_ its GeneratorBody is strict code, ...\nbecause all of the source text of the GeneratorBody is within the FunctionBody,\neven though the GeneratorBody itself isn't. However, I don't like this solution, because I don't like that strictness is supposedly defined as a property of source text, when it would make more sense as a property of parse tree nodes.  So I'd prefer a solution in which the presence of the Use Strict Directive makes the whole GeneratorDeclaration strict, not just the FunctionBody.  (E.g., see Bug 4146.) Then conditions like this don't have to reach down to the FunctionBody to determine if *it* is strict.\n\n----------\n{4}\n14.2.16 / group 1 says:\n    ArrowFunction : ArrowParameters => ConciseBody\n        If the code of this ArrowFunction is contained in strict mode code\n            or if any of the conditions in 10.2.1 apply, ...\nThis isn't quite of the form outlined at the top, but I'm puzzled as to why it isn't.  Of the various conditions in 10.2.1 that might apply, it seems there's only one (a FunctionBody that begins with \"use strict\") that's pertinent to this sentence, so why be vague?\n\n(There are other conditions in 10.2.1 that might apply, e.g. the ArrowFunction might be in a module, but in that case, it would be true that \"the code of this ArrowFunction is contained in strict mode code\", and so there'd be no need to check the second term of the condition.)\n\n--------------------------------------------------------------------------------\n\n14.1.13 / group 1 / step 1:\n    FunctionStatementList : StatementList_opt\n        If this FunctionStatementList is contained in strict code\n            or if StatementList is strict code, ...\n\n14.1.20 / group 1 / step 1:\n    FunctionDeclaration : function ... ( FormalParameters ) { FunctionBody }\n        If the FunctionDeclaration is contained in strict code\n            or if its FunctionBody is strict code, ...\n\n14.1.20 / group 2:\n    FunctionDeclaration : function ( FormalParameters ) { FunctionBody }\n        If the FunctionDeclaration is contained in strict code\n            or if its FunctionBody is strict code, ...\n\n14.1.21 / group 3:\n    FunctionExpression : function ( FormalParameters ) { FunctionBody }\n        If the FunctionExpression is contained in strict code\n            or if its FunctionBody is strict code, ...\n\n14.1.21 / group 4:\n    FunctionExpression : function ... ( FormalParameters ) { FunctionBody }\n        If the FunctionExpression is contained in strict code\n            or if its FunctionBody is strict code, ...\n\n14.2.16 / group 1:\n    ArrowFunction : ArrowParameters => ConciseBody\n        If the code of this ArrowFunction is contained in strict mode code\n            or if any of the conditions in 10.2.1 apply, ...\n\n14.4.12 / group 1:\n    GeneratorDeclaration : function * .. ( FormalParameters ) { GeneratorBody }\n        If the GeneratorDeclaration is contained in strict code\n            or if its GeneratorBody is strict code, ...\n\n14.4.12 / group 2:\n    GeneratorDeclaration : function * ( FormalParameters ) { GeneratorBody }\n        If the GeneratorDeclaration is contained in strict code\n            or if its GeneratorBody is strict code, ...\n\n15.1.2 / group 1:\n    ScriptBody : StatementList\n        If this ScriptBody is contained in strict code\n            or if StatementList is strict code, ..."},{"commentid":13681,"comment_count":1,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2015-03-10 12:41:41 -0700","thetext":"fixed in rev36 editor's draft\n\nsome of this was fragments of incomplete work to provide a more formal definition of strict mode.\n\nFor now, I've normalized all of these uses to follow the pattern of:\n\nIf the function code for this GeneratorExpression is strict mode code, let strict be true. Otherwise let strict be false. \n\nthat along with the cleanup in 10.2 should be sufficient for now.\n\nAlso eliminated at the IsStrict abstract operations except for the one for Script"},{"commentid":13829,"comment_count":2,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2015-03-17 16:57:07 -0700","thetext":"in rev36"}]}}
---
