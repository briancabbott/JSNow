---
{"_attributes":{"version":"4.4.4+","urlbase":"https://bugs.ecmascript.org/","maintainer":"dherman@mozilla.com"},"bug":{"bug_id":2490,"creation_ts":"2014-02-01 09:22:00 -0800","short_desc":"Clarify 'metadata' option property, esp. in Loader.prototype.define()","delta_ts":"2015-03-16 14:43:15 -0700","product":"Draft for 6th Edition","component":"deferred features","version":"Rev 22: January 20, 2014 Draft","rep_platform":"All","op_sys":"All","bug_status":"RESOLVED","resolution":"WONTFIX","priority":"Normal","bug_severity":"enhancement","everconfirmed":true,"reporter":{"uid":"johnjbarton","name":"johnjbarton"},"assigned_to":{"uid":"allen","name":"Allen Wirfs-Brock"},"cc":["dherman","jorendorff","samth"],"long_desc":[{"commentid":7168,"comment_count":0,"who":{"uid":"johnjbarton","name":"johnjbarton"},"bug_when":"2014-02-01 09:22:52 -0800","thetext":"The current spec has \n26.3.3.2 %Loader%.prototype.define ( name, source, options = undefined )\nwith this in the steps:\n\n10.If metadata is undefined then let metadata be the result of calling ObjectCreate(%ObjectPrototype%). \n11. Let p be PromiseOfStartLoadPartwayThrough(\"translate\", loaderRecord, name, metadata, source, \naddress). \n\nIn implementing define() I found two issues here:\n  1) Must metadata be passed by reference to translate()? \n  2) What is the purpose of passing metadata here at all?\n\nWe have been using metadata as an opaque side-table for the loader hooks. The Loader provides the metadata object to each of the hook calls but does nothing else to the object. This way the hooks can add and remove properties for a Load object, confident that the data will arrive again with another call for the same Load object. If the metadata can be passed in from user code then all of that has to stop and we'll have to ignore the metadata property throughout the hooks calls."},{"commentid":7174,"comment_count":1,"who":{"uid":"jorendorff","name":"Jason Orendorff"},"bug_when":"2014-02-03 08:14:16 -0800","thetext":"> If the metadata can be passed in from user code then all of\n> that has to stop and we'll have to ignore the metadata property throughout\n> the hooks calls.\n\nIt can't be passed in from user code.\n\nIn some cases, the \"load pipeline\" starts in the middle, e.g. when you're doing loader.define(), you've already got the source code so that there's no point doing a locate() or fetch(). So no hook can assume the previous hooks were called. I think we just have to live with that. The ability to jump in at intermediate stages of a load is just too important a feature to drop.\n\nFor those in-medias-res cases, what should the metadata value be? We decided to create an empty object. I agree this is confusing and obnoxious. We considered some alternatives but didn't find anything clearly better. My best alternative was:\n\n  - Drop metadata from the spec entirely;\n\n  - instead, pass the *same* options object to locate, fetch, translate, and\n    instantiate;\n\n  - and then Loader hooks can store data on that object (attaching\n    whatever metadata properties they want, ad hoc).\n\nI think that's more elegent, but is it really any better? Each hook that uses metadata would still have to detect the in-medias-res case and cope with it."},{"commentid":7175,"comment_count":2,"who":{"uid":"johnjbarton","name":"johnjbarton"},"bug_when":"2014-02-03 09:21:35 -0800","thetext":"In our implementation, 'metadata' is a property of Load. That is how it appears in other functions of the spec API.  There is no need to drop metadata from Load, or the rest if the spec.  It's fine there, because Load is a data structure shared between the Loader and its hooks. The issue it having it part of the API for the define() function, a user level function, not a loader hook.\n\nI'm confused by\n\n>It can't be passed in from user code.\n\nLoader.prototype.define() seems to be one of the primary user entry points. User code only really needs import() and define()."},{"commentid":13777,"comment_count":3,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2015-03-16 14:43:15 -0700","thetext":"concerns old module spec."}]}}
---
