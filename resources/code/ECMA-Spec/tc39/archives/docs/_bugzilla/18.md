---
{"_attributes":{"version":"4.4.4+","urlbase":"https://bugs.ecmascript.org/","maintainer":"dherman@mozilla.com"},"bug":{"bug_id":18,"creation_ts":"2011-02-12 16:40:00 -0800","short_desc":"several tests assume it's okay to have a FunctionDeclaration in a Statement context","delta_ts":"2011-09-24 23:39:37 -0700","product":"Test262","component":"ECMA-262 Tests","version":"unspecified","rep_platform":"All","op_sys":"All","bug_status":"RESOLVED","resolution":"FIXED","bug_file_loc":"http://hg.ecmascript.org/tests/test262/rev/a012a7e238f6","priority":"High","bug_severity":"normal","everconfirmed":true,"reporter":{"uid":"jmdyck","name":"Michael Dyck"},"assigned_to":{"uid":"erights","name":"Mark S. Miller"},"cc":["dfugate","erights"],"long_desc":[{"commentid":28,"comment_count":0,"who":{"uid":"jmdyck","name":"Michael Dyck"},"bug_when":"2011-02-12 16:40:30 -0800","thetext":"Several tests (mostly from sputnik) have a FunctionDeclaration in a Statement context. This isn't permitted by the ES5 grammar, but the tests apparently don't expect it to cause a parse error. Section 12 of ES5 recommends against supporting it.\n\nHere's a list:\n    12.14-5.js\n    S12.10_A3.3_T4.js\n    S12.10_A3.3_T5.js\n    S12.7_A3.js\n    S12.7_A4_T1.js\n    S12.7_A4_T2.js\n    S12.7_A4_T3.js\n    S12.8_A3.js\n    S12.8_A4_T1.js\n    S12.8_A4_T2.js\n    S12.8_A4_T3.js\n    S13.2.2_A17_T1.js\n    S13.2.2_D20_T2.js\n    S13.2.2_D20_T3.js\n    S13.2.2_D20_T4.js\n    S13.2.2_D20_T5.js\n    S13.2.2_D20_T6.js\n    S13.2.2_D20_T7.js\n    S13.2.2_D20_T8.js\n    S13_D1_T1.js\n    S14_D1_T1.js\n    S14_D4_T1.js\n    S14_D4_T2.js\n    S14_D4_T3.js\n    S14_D6_T1.js\n    S14_D6_T2.js\n    S14_D7.js"},{"commentid":35,"comment_count":1,"who":{"uid":"dfugate","name":"Dave Fugate"},"bug_when":"2011-02-14 14:26:45 -0800","thetext":"This one's a bit tricky.  The spec states verbatim:\nNOTE Several widely used implementations of ECMAScript are known to support the use of FunctionDeclaration as a Statement. However there are significant and irreconcilable variations among the implementations in the semantics applied to such FunctionDeclarations. Because of these irreconcilable difference, the use of a FunctionDeclaration as a Statement results in code that is not reliably portable among implementations. It is recommended that ECMAScript implementations either disallow this usage of FunctionDeclaration or issue a warning when such a usage is encountered. Future editions of ECMAScript may define alternative portable means for declaring functions in a Statement context.\n\nHowever, ES5 also states the following about (Syntax) errors:\nAn implementation may extend program syntax and regular expression pattern or flag syntax. To permit this, all operations (such as calling eval, using a regular expression literal, or using the Function or RegExp constructor) that are allowed to throw SyntaxError are permitted to exhibit implementation-defined behaviour instead of throwing SyntaxError when they encounter an implementation-defined extension to the program syntax or regular expression pattern or flag syntax.\n\n\nNeed to give this one some more thought..."},{"commentid":38,"comment_count":2,"who":{"uid":"jmdyck","name":"Michael Dyck"},"bug_when":"2011-02-14 18:49:32 -0800","thetext":"Okay, so a conforming implementation isn't required to raise a SyntaxError on these cases. But the point of these tests isn't to determine whether the implementation supports FunctionDecls-as-Statements or not; the tests just *assume* that the implementation does. I think it's unwise for a test to rely on support for any feature that isn't required by the spec (let alone one that's actively discouraged by the spec).\n\nIt would be nice if they could be rewritten to not rely on support for that feature. Or at least marked/grouped somehow so that the assumption was made explicit."},{"commentid":62,"comment_count":3,"who":{"uid":"dfugate","name":"Dave Fugate"},"bug_when":"2011-02-25 10:51:20 -0800","thetext":"For the short term, I'm disabling the set you've identified below."},{"commentid":169,"comment_count":4,"who":{"uid":"dfugate","name":"Dave Fugate"},"bug_when":"2011-03-23 14:43:00 -0700","thetext":"We also have a number of tests which explicitly check to ensure it's *not* OK to have a FunctionDeclaration in a Statement.  This is also disallowed by ES5.1 via chapter 16:\n    An implementation may extend program syntax and regular expression pattern or flag syntax. To permit this, all operations (such as calling eval, using a regular expression literal, or using the Function or RegExp constructor) that are allowed to throw SyntaxError are permitted to exhibit implementation-defined behaviour instead of throwing SyntaxError when they encounter an implementation-defined extension to the program syntax or regular expression pattern or flag syntax.\n\nAfter consulting with the TC-39 committee, we've decided 'negative parser tests' such as this should be disabled unless ES5 explicitly calls out that they should throw.  E.g., literal octals in strings under Strict Mode would be a valid negative test case we would not disable.  In the long term, the test harness and website will be adapted to allow opting-in WRT running these tests.  Thus far I've found the following which need to be disabled:\n\nS12.1_A1\nTrying to declare function at the Block statement\n\nS12.5_A9_T1\nDeclaring function within an \"if\" statement\n\nS12.5_A9_T2\nDeclaring function within and \"if\" that is declared within the function call\n\nS12.6.1_A13_T1\nDeclaring function within a \"do-while\" loop\n\nS12.6.1_A13_T2\nDeclaring a function within a \"do-while\" loop that is within a function call\n\nS12.6.2_A13_T1\nChecking if declaring a function within a \"while\" Statement leads to an exception\n\nS12.6.2_A13_T2\nChecking if declaring a function within a \"while\" Statement that is in a function call leads to an exception\n\nS12.6.4_A13_T1\nDeclaring function within a \"for-in\" Statement\n\nS12.6.4_A13_T2\nDeclaring function within a \"for-in\" Statement that is within a function call"},{"commentid":277,"comment_count":5,"who":{"uid":"dfugate","name":"Dave Fugate"},"bug_when":"2011-07-07 09:15:50 -0700","thetext":"Just removed 12.14-5.js outright after analyzing it.  Corrections for the Sputnik tests will need to be done by Mark before we can close this one down.\n\nMichael, just out of curiosity how did you generate this list of invalid tests?  Sounds like whatever tool/JS impl. you used would be useful for periodic 'validity' checks on the tests:)"},{"commentid":280,"comment_count":6,"who":{"uid":"jmdyck","name":"Michael Dyck"},"bug_when":"2011-07-07 11:03:17 -0700","thetext":">  how did you generate this list of invalid tests?\n\nI built a parser from the grammar in the ES5.1 spec, fed it the tests in the test suite, and looked at the ones that unexpectedly raised a syntax error.\n\n> Sounds like whatever tool/JS impl. you used would be useful for periodic\n> 'validity' checks on the tests:)\n\nAren't there generally-available implementations that only accept (or have a mode where they only accept) exactly what the spec says?"},{"commentid":462,"comment_count":7,"who":{"uid":"erights","name":"Mark S. Miller"},"bug_when":"2011-09-24 16:04:52 -0700","thetext":"Hi Michael, Of the files you list, I can't find the ones with an \"_D\" in them:\n\n(In reply to comment #0)\n>     S13.2.2_D20_T2.js\n>     S13.2.2_D20_T3.js\n>     S13.2.2_D20_T4.js\n>     S13.2.2_D20_T5.js\n>     S13.2.2_D20_T6.js\n>     S13.2.2_D20_T7.js\n>     S13.2.2_D20_T8.js\n>     S13_D1_T1.js\n>     S14_D1_T1.js\n>     S14_D4_T1.js\n>     S14_D4_T2.js\n>     S14_D4_T3.js\n>     S14_D6_T1.js\n>     S14_D6_T2.js\n>     S14_D7.js\n\nI also looked in external/contributions/Google/sputniktests/tests/Conformance and they're not there."},{"commentid":463,"comment_count":8,"who":{"uid":"erights","name":"Mark S. Miller"},"bug_when":"2011-09-24 16:30:13 -0700","thetext":"Fixed at http://hg.ecmascript.org/tests/test262/rev/a012a7e238f6"},{"commentid":472,"comment_count":9,"who":{"uid":"jmdyck","name":"Michael Dyck"},"bug_when":"2011-09-24 23:39:37 -0700","thetext":"(In reply to comment #7)\n> Hi Michael, Of the files you list, I can't find the ones with an \"_D\" in them:\n\nIn the copy I have, they're in\n    sputnik-v1/tests/Implementation_Diagnostics/\nand\n    test262-ca885b11b815/test/suite/sputnik/Implementation_Diagnostics/"}]}}
---
