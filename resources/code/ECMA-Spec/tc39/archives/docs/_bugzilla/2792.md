---
{"_attributes":{"version":"4.4.4+","urlbase":"https://bugs.ecmascript.org/","maintainer":"dherman@mozilla.com"},"bug":{"bug_id":2792,"creation_ts":"2014-05-01 11:38:00 -0700","short_desc":"B.1.1 should specify decimal integer literals starting with 0 and containing at least one of 8 or 9","delta_ts":"2014-10-14 15:18:01 -0700","product":"Draft for 6th Edition","component":"technical issue","version":"Rev 26: July 18, 2014 Draft","rep_platform":"All","op_sys":"All","bug_status":"RESOLVED","resolution":"FIXED","priority":"Normal","bug_severity":"enhancement","everconfirmed":true,"reporter":{"uid":"oliver","name":"Oliver Hunt"},"assigned_to":{"uid":"allen","name":"Allen Wirfs-Brock"},"cc":["brendan","brterlso","claude.pache","jmdyck","jorendorff","mathias","oliver","princexcess69","rossberg"],"long_desc":[{"commentid":8090,"comment_count":0,"who":{"uid":"oliver","name":"Oliver Hunt"},"bug_when":"2014-05-01 11:38:15 -0700","thetext":"The LegacyOctalIntegerLiteral syntax in B.1.1 specifies\nLegacyOctalIntegerLiteral ::\n    0 OctalDigit\n    LegacyOctalIntegerLiteral OctalDigit\n\nHowever all engines that recognise LegacyOctalIntegerLiteral actually recognise\n\nLegacyOctalIntegerLiteral ::\n    0 DecimalDigit\n    LegacyOctalIntegerLiteral DecimalDigit\n\nAnd interpret the value as decimal if any digit is greater than 7."},{"commentid":8128,"comment_count":1,"who":{"uid":"jmdyck","name":"Michael Dyck"},"bug_when":"2014-05-04 11:30:10 -0700","thetext":"(Changing this bug's 'Product' from 'ECMA-262' to 'Draft for 6th Edition', since LegacyOctalIntegerLiteral appears only in the 6th edition drafts.)"},{"commentid":9667,"comment_count":2,"who":{"uid":"mathias","name":"Mathias Bynens"},"bug_when":"2014-08-05 00:24:41 -0700","thetext":"https://github.com/whatwg/javascript/issues/17\nhttps://bugzilla.mozilla.org/show_bug.cgi?id=957513\nhttps://code.google.com/p/v8/issues/detail?id=3091\nhttps://bugs.webkit.org/show_bug.cgi?id=126618\nhttps://connect.microsoft.com/IE/feedback/details/813193\nhttp://esdiscuss.org/topic/early-error-on-0-followed-by-8-or-9-in-numeric-literals-does-not-seem-to-be-web-compatible"},{"commentid":9669,"comment_count":3,"who":{"uid":"mathias","name":"Mathias Bynens"},"bug_when":"2014-08-05 07:43:37 -0700","thetext":"(In reply to Oliver Hunt from comment #0)\n> The LegacyOctalIntegerLiteral syntax in B.1.1 specifies\n> LegacyOctalIntegerLiteral ::\n>     0 OctalDigit\n>     LegacyOctalIntegerLiteral OctalDigit\n> \n> However all engines that recognise LegacyOctalIntegerLiteral actually\n> recognise\n> \n> LegacyOctalIntegerLiteral ::\n>     0 DecimalDigit\n>     LegacyOctalIntegerLiteral DecimalDigit\n> \n> And interpret the value as decimal if any digit is greater than 7.\n\nThis is inaccurate. `08` for example is not a `LegacyOctalIntegerLiteral` nor is it treated as one by the majority of JavaScript engines:\n\n    > (function() { 'use strict'; return 01; }())\n    < SyntaxError: Octal escapes are forbidden in strict mode\n\nBut…\n\n    > (function() { 'use strict'; return 08; }())\n    < 8\n\nOnly SpiderMonkey seems to (incorrectly) recognize `08` as a `LegacyOctalIntegerLiteral`:\n\n    > (function() { 'use strict'; return 08; }())\n    < SyntaxError: octal literals and octal escape sequences are deprecated\n\nChanging the spec for `LegacyOctalIntegerLiteral` seems like the wrong way to solve this."},{"commentid":9670,"comment_count":4,"who":{"uid":"jorendorff","name":"Jason Orendorff"},"bug_when":"2014-08-05 11:44:36 -0700","thetext":"(In reply to Mathias Bynens from comment #3)\n> Only SpiderMonkey seems to (incorrectly) recognize `08` as a\n> `LegacyOctalIntegerLiteral`:\n> \n>     > (function() { 'use strict'; return 08; }())\n>     < SyntaxError: octal literals and octal escape sequences are deprecated\n> \n> Changing the spec for `LegacyOctalIntegerLiteral` seems like the wrong way\n> to solve this.\n\nI will defend SpiderMonkey's honor here: The error message above is incorrect in using the word \"octal\", but the SyntaxError is correct: `08` doesn't match any productions in ES1-5 as far as I know, or in any ES6 draft.\n\nBut there are scripts on the web that match it, so we can't drop support for it in sloppy mode.\n\nTherefore this syntax should be banned in strict mode and specified as a special (sloppy-mode-only) legacy decimal integer literal in B.1.1. That is what implementations must do regardless; TC39 does not have a practical choice, just an editorial one."},{"commentid":9701,"comment_count":5,"who":{"uid":"claude.pache","name":"Claude Pache"},"bug_when":"2014-08-07 00:29:19 -0700","thetext":"The issue of non-octal numbers starting with 0 is not limited to integers.\nFirst, the good news: all implementations I've tested agree on this:\n\n  07e3 // Syntax Error\n  07.9 // Syntax Error\n\nSo far, so good. But:\n\n  08e3 // 800\n  08.9 // 8.9\n\nYech. Let's try strict mode: \n\n  (function() { \"use strict\"; return 08e3 })() // 800, except FF: Syntax Error\n  (function() { \"use strict\"; return 08.9 })() // 8.9, except FF: Syntax Error\n\nUgh. Only FF does the Right Thing in strict mode (except maybe the wording of the error message, but error messages are not specced).\n\nThat said, it is not LegacyOctalIntegerLiteral, here. It is rather DecimalLiteralWithLeadingZeroAndNoctalDigitInIntegralPart."},{"commentid":9702,"comment_count":6,"who":{"uid":"mathias","name":"Mathias Bynens"},"bug_when":"2014-08-07 02:19:36 -0700","thetext":"(In reply to Jason Orendorff from comment #4)\n> (In reply to Mathias Bynens from comment #3)\n> > Only SpiderMonkey seems to (incorrectly) recognize `08` as a\n> > `LegacyOctalIntegerLiteral`:\n> > \n> >     > (function() { 'use strict'; return 08; }())\n> >     < SyntaxError: octal literals and octal escape sequences are deprecated\n> > \n> > Changing the spec for `LegacyOctalIntegerLiteral` seems like the wrong way\n> > to solve this.\n> \n> I will defend SpiderMonkey's honor here: The error message above is\n> incorrect in using the word \"octal\", but the SyntaxError is correct: `08`\n> doesn't match any productions in ES1-5 as far as I know, or in any ES6 draft.\n\nCorrect; see comment #2. No other implementation flags `08` as a syntax error, though.\n\n> But there are scripts on the web that match it, so we can't drop support for\n> it in sloppy mode.\n> \n> Therefore this syntax should be banned in strict mode and specified as a\n> special (sloppy-mode-only) legacy decimal integer literal in B.1.1. That is\n> what implementations must do regardless; TC39 does not have a practical\n> choice, just an editorial one.\n\nThat goes against Allen’s plans to make leading 0 constants legal decimal integer literals. See http://esdiscuss.org/topic/early-error-on-0-followed-by-8-or-9-in-numeric-literals-does-not-seem-to-be-web-compatible#content-19."},{"commentid":9703,"comment_count":7,"who":{"uid":"claude.pache","name":"Claude Pache"},"bug_when":"2014-08-07 02:57:39 -0700","thetext":"(In reply to Mathias Bynens from comment #6)\n> That goes against Allen’s plans to make leading 0 constants legal decimal\n> integer literals. See\n> http://esdiscuss.org/topic/early-error-on-0-followed-by-8-or-9-in-numeric-\n> literals-does-not-seem-to-be-web-compatible#content-19.\n\nHaving leading-zero decimal constants allowed is really useful only when it is allowed for *every* constant. Currently, what non-FF browsers do is at best useless and at worst harmful (e.g., some automatically generated JS might work during the test phase, then unexpected fail in production, because it wasn't tested against an account number containing only digits from 0 to 7)."},{"commentid":9704,"comment_count":8,"who":{"uid":"mathias","name":"Mathias Bynens"},"bug_when":"2014-08-07 05:05:07 -0700","thetext":"(In reply to Claude Pache from comment #7)\n> Having leading-zero decimal constants allowed is really useful only when it\n> is allowed for *every* constant.\n\nMy proposal describes what it takes to spec the existing behavior in the majority of engines (i.e. all but SpiderMonkey). I agree that’s not the most ideal behavior, but it is what it is – there’s only so much we can do without breaking the Web.\n\nLeading-zero decimal literals can probably only happen in strict mode (as currently octal literals throw there, so we’d go from throwing to evaluating to a value), and can never fully (i.e. for all digits) be implemented for sloppy mode (without breaking compatibility with existing Web content)."},{"commentid":9707,"comment_count":9,"who":{"uid":"oliver","name":"Oliver Hunt"},"bug_when":"2014-08-07 10:11:26 -0700","thetext":"We (JSC) are incorrectly allowing 08/09 in strict mode :-/\n\nhttps://bugs.webkit.org/show_bug.cgi?id=135704\n\nThis is an unintentional error and i will fix shortly."},{"commentid":9708,"comment_count":10,"who":{"uid":"mathias","name":"Mathias Bynens"},"bug_when":"2014-08-07 11:55:05 -0700","thetext":"(In reply to Oliver Hunt from comment #9)\n> We (JSC) are incorrectly allowing 08/09 in strict mode :-/\n\nDon’t feel bad – all engines except SpiderMonkey do this."},{"commentid":9728,"comment_count":11,"who":{"uid":"claude.pache","name":"Claude Pache"},"bug_when":"2014-08-08 06:13:39 -0700","thetext":"Proposed patch\n==============\n\nExplanations and notes\n----------------------\n\n* The patch adds (in sloppy mode) a NoctalDecimalIntegerLiteral production to the RHS of the DecimalIntegerLiteral production. Recall that DecimalIntegerLiteral is in turn used in DecimalLiteral, so that things like `08.5e2` will work, per Comment #5.\n\n* NoctalDecimalIntegerLiteral describes sequences of decimal digits beginning with 0 and containing at least one occurrence of 8 or 9.\n\n* LegacyOctalLikeDecimalIntegerLiteral describes the same sequences of digits as LegacyOctalIntegerLiteral, but the MV is different.\n\n\nStuff to be added in Section B.1.1 Numeric Literals\n---------------------------------------------------\n(reflecting web reality)\n\nSyntax:\n\n    DecimalIntegerLiteral ::\n        0\n        NonZeroDigit DecimalDigits[opt]\n        NoctalDecimalIntegerLiteral\n\n    NoctalDecimalIntegerLiteral ::\n        0 NoctalDigit\n        LegacyOctalLikeDecimalIntegerLiteral NoctalDigit\n        NoctalDecimalIntegerLiteral DecimalDigit\n\n    LegacyOctalLikeDecimalIntegerLiteral ::\n        0 OctalDigit\n        LegacyOctalLikeDecimalIntegerLiteral OctalDigit\n\n    NoctalDigit :: one of 8 9\n\nStatic semantics (lengthy but trivial):\n\n* The MV of DecimalIntegerLiteral :: NoctalDecimalIntegerLiteral is the MV of NoctalDecimalIntegerLiteral.\n\n* The MV of NoctalDecimalIntegerLiteral :: 0 NoctalDigit is the MV of NoctalDigit.\n\n* The MV of NoctalDecimalIntegerLiteral :: LegacyOctalLikeDecimalIntegerLiteral NoctalDigit is (the MV of LegacyOctalLikeDecimalIntegerLiteral × 10) plus the MV of NoctalDigit.\n\n* The MV of NoctalDecimalIntegerLiteral :: NoctalDecimalIntegerLiteral DecimalDigit is (the MV of NoctalDecimalIntegerLiteral × 10) plus the MV of DecimalDigit.\n\n* The MV of LegacyOctalLikeDecimalIntegerLiteral :: 0 OctalDigit is the MV of OctalDigit,\n\n* The MV of LegacyOctalLikeDecimalIntegerLiteral :: LegacyOctalLikeDecimalIntegerLiteral OctalDigit is (the MV of LegacyOctalLikeDecimalIntegerLiteral × 10) plus the MV of OctalDigit.\n\n* The MV of NoctalDigit :: 8 is 8.\n\n* The MV of NoctalDigit :: 9 is 9.\n\n\nStuff to be changed in Section 11.8.3 if we want to ban the thing in strict mode\n--------------------------------------------------------------------------------\n(a breaking change for several engines)\n\nJust after:\n    must not extend the syntax of NumericLiteral to include LegacyOctalIntegerLiteral\nadd:\n   , nor the syntax of DecimalIntegerLiteral to include NoctalDecimalIntegerLiteral"},{"commentid":9730,"comment_count":12,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2014-08-08 07:26:35 -0700","thetext":"added some V8 and IE names to the CC list"},{"commentid":10308,"comment_count":13,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2014-10-09 17:17:06 -0700","thetext":"fixed in rev28 editor's draft\n\nusing the patch from Comment 11"},{"commentid":10477,"comment_count":14,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2014-10-14 15:18:01 -0700","thetext":"fixed in rev28"}]}}
---
