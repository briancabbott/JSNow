---
{"_attributes":{"version":"4.4.4+","urlbase":"https://bugs.ecmascript.org/","maintainer":"dherman@mozilla.com"},"bug":{"bug_id":1444,"creation_ts":"2013-04-16 08:54:00 -0700","short_desc":"8.3.12 incomplete in the presence of prototype changes and property deletions.","delta_ts":"2014-07-18 14:32:51 -0700","product":"Draft for 6th Edition","component":"technical issue","version":"Rev 14: March 8, 2013 Draft","rep_platform":"All","op_sys":"All","bug_status":"RESOLVED","resolution":"FIXED","priority":"Normal","bug_severity":"enhancement","everconfirmed":true,"reporter":{"uid":"bugzilla","name":"Gareth Smith"},"assigned_to":{"uid":"allen","name":"Allen Wirfs-Brock"},"long_desc":[{"commentid":3645,"comment_count":0,"who":{"uid":"bugzilla","name":"Gareth Smith"},"bug_when":"2013-04-16 08:54:33 -0700","thetext":"Section 8.3.12 defines the behaviour of [[Enumerate]], and describes what should happen if properties are added or removed during enumeration:\n\n\"If a property that has not yet been visited during enumeration is deleted, then it will not be visited. If new properties are added to the object being enumerated during enumeration, the newly added properties are not guaranteed to be visited in the active enumeration.\"\n\nWe are not so clear on what happens if we enter the loop with an\nenumerable property shadowing a non-enumerable one, and then delete the\nenumerable one before it is visited.\n\nPerhaps the \"nicest\" reading of the existing would be to treat the revealed\nproperties the same way we would treat \"added\" properties. So, in this\ncase, the \"revealed\" property would be checked for enumerability and\nskipped. This doesn't seem to be the only possible reading of the spec however.  while spidermonkey seems to behave as I had expected, V8 disagrees, and visits the non-enumerable property.\n\nEssentially the same trick can be played by mutating __proto__ during enumeration.\n\nHere is a code snippit which demonstrates this behaviour, assuming that x happens to come before z in the enumeration order:\n\n  var a = {};\n  Object.defineProperty(a, 'z', {value: 'secret', enumerable: false});\n  var b = {x:0, z:\"tricky\", __proto__:a};\n  var ret = \"We have not visited a.z\";\n  var deleted_z_yet = false;\n  for (var i in b) {\n      if(i=='x') {\n          delete b.z ;\n          deleted_z_yet = true;\n      }\n      if (i=='z' && deleted_z_yet) {\n          ret = \"we have visited a.z\" ;\n      }\n  }"},{"commentid":9239,"comment_count":1,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2014-07-17 18:03:10 -0700","thetext":"fixed in rev26\n\nreplaced in informative algorithm with an ES generator function\n\nalso (hopefully) clarified the language WRT this point."},{"commentid":9277,"comment_count":2,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2014-07-18 14:32:51 -0700","thetext":"in rev26"}]}}
---
