---
{"_attributes":{"version":"4.4.4+","urlbase":"https://bugs.ecmascript.org/","maintainer":"dherman@mozilla.com"},"bug":{"bug_id":2733,"creation_ts":"2014-04-24 10:11:00 -0700","short_desc":"19.1.3.6 Object.prototype.toString handling for Proxy objects","delta_ts":"2014-06-16 16:33:49 -0700","product":"Draft for 6th Edition","component":"technical issue","version":"Rev 23: April 5, 2014 Draft","rep_platform":"All","op_sys":"All","bug_status":"RESOLVED","resolution":"FIXED","priority":"Normal","bug_severity":"normal","everconfirmed":true,"reporter":{"uid":"allen","name":"Allen Wirfs-Brock"},"assigned_to":{"uid":"allen","name":"Allen Wirfs-Brock"},"cc":["brterlso","erights","tomvc.be"],"long_desc":[{"commentid":7910,"comment_count":0,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2014-04-24 10:11:07 -0700","thetext":"Currently, the default behavior is to report a proxy as \"[object Proxy]\".\n\nSomebody might try to use this as a Proxy type test. But note that it isn't reliable because \"Proxy\" is intentionally not on the legacy toStringTag back. list. \n\nAlso: \n\nOn Apr 24, 2014, at 9:27 AM, Allen Wirfs-Brock wrote:\n\n\nOn Apr 24, 2014, at 9:03 AM, Tom Van Cutsem wrote:\n\n(reiterating what I already mentioned at the hangout, but to bring Brian up to date)\n\nBased on feedback I received from developers that are using my Proxy shim, they clearly want Object.prototype.toString to be transparent in the face of proxies (i.e. O.p.toString.call(proxy) should return whatever O.p.toString.call(target) returns).\n\nAllen raised the issue that this breaks the proxy's encapsulation, but a Proxy that wants to hide its target's type can still implement the @ToStringTag symbol to override the default behavior.\n\nMark and I continued discussing this quite a bit.  Consider this:\n\nlet exec = RegExp.prototype.exec;\nlet toString = Object.prototype.toString;\n...\nif (toString.call(obj) === 'RegExp') {\n    exec.call(obj, string)\n} else {\n    //something else\n}\n\nThe above with throw on the exec.call if obj is a Proxy because obj does not have the internal state required of a RegExp object.  In general proxies aren't transparent when passed as this values, so it isn't clear to me what your developers think they are asking for.\n\nAllen\n\n\n\nCheers,\nTom\n(adding Mark and Tom)\n\nYes, O.p.toString as an isProxy test has always been a bit of a concern since we eliminated Proxy.isProxy.\n\nMark and Tom, what do you think? Is this a concern?  Is there some other way you know of for detecting a Proxy that makes this a non-issue.\n\nIf you think it is a problem, it would be easy enough to spec. O.p.toString to report \"[object Object]\" for Proxies. \n\nAllen\n\nOn Apr 23, 2014, at 11:57 AM, Brian Terlson wrote:\n\nThat makes sense, thanks for explaining to me. I think the only other option would be ‘[object Object]’ but I don’t have a strong desire for this. I have a vague worry that people will write an isProxy function based on this, which would be a bad idea, but that’s about it.\n \nFrom: Allen Wirfs-Brock [mailto:allen@wirfs-brock.com] \nSent: Tuesday, April 22, 2014 5:24 PM\nTo: Brian Terlson\nSubject: Re: (new Proxy({},{})).toString() === '[object Proxy]'?\n \n \nOn Apr 22, 2014, at 4:26 PM, Brian Terlson wrote:\n\n\nAt least, according to the current spec. And, if I understand correctly, that’s unless the target has an @@toStringTag, in which case that will be used. Is this what we want for sure? I tried to search for rationale and failed…\n \nThanks for any insight!!\n \nWell, it's mostly a byproduct of the fact that method invocation on proxies, by default, looks up the method on the Proxy target, but invoke it with the Proxy as the this value. But it seems like as a good a default as any.  There are lots of ways the Proxy provider might define toString behavior (including by defined @@toStringTag on the target object.\n \nI'm not sure any other default for O.p.toString on a Proxy would be any better.  It seems like it would be a bit presumptuous for for O.p.toString to violate encapsulation by reach inside the Proxy and directly trying to invoke something on the target.\n \nallen"},{"commentid":8533,"comment_count":1,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2014-05-17 08:43:38 -0700","thetext":"fixed in rev25 editor's draft\n\nProxy objects default to either [object Object] or [object Function] depending upon whether or not they are callable."},{"commentid":8570,"comment_count":2,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2014-05-19 19:14:14 -0700","thetext":"fixed in rev25 editor's draft."},{"commentid":9032,"comment_count":3,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2014-06-16 16:33:49 -0700","thetext":"fixed in rev25 editor's draft"}]}}
---
