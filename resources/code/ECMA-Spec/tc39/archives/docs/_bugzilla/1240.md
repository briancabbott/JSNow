---
{"_attributes":{"version":"4.4.4+","urlbase":"https://bugs.ecmascript.org/","maintainer":"dherman@mozilla.com"},"bug":{"bug_id":1240,"creation_ts":"2013-02-01 07:38:00 -0800","short_desc":"[10.6] MakeArgGetter/MakeArgGetter does not work well with duplicate arguments","delta_ts":"2014-04-06 11:29:52 -0700","product":"Draft for 6th Edition","component":"technical issue","version":"Rev 13: December 21, 2012 Draft","rep_platform":"All","op_sys":"All","bug_status":"RESOLVED","resolution":"FIXED","priority":"Normal","bug_severity":"normal","everconfirmed":true,"reporter":{"uid":"andrebargull","name":"André Bargull"},"assigned_to":{"uid":"allen","name":"Allen Wirfs-Brock"},"long_desc":[{"commentid":3172,"comment_count":0,"who":{"uid":"andrebargull","name":"André Bargull"},"bug_when":"2013-02-01 07:38:25 -0800","thetext":"The following expression returns `undefined` per 10.6 MakeArgGetter algorithm, but should return `1`:\n---\n(function(a,a){return arguments[0]})(1)\n---\n\nReason:\nMakeArgGetter creates the following getter function:\n---\nfunction() { return a }\n---\n\nThe getter function resolves `a` to the second argument which is defaulted to `undefined`. \n\n\nThis bug also applies to the ECMAScript 5.1 specification."},{"commentid":3173,"comment_count":1,"who":{"uid":"andrebargull","name":"André Bargull"},"bug_when":"2013-02-01 08:16:11 -0800","thetext":"Hmm, I guess CompleteMappedArgumentsObject only needs be changed:\n---\n1-4: <<leave as is>>\n5: Let indx = numberOfNonRestFormals - 1.\n6: Repeat while indx ≥ 0,\n a: Let param be getParameter of formals with argument indx.\n b: If param is a BindingIdentifier, then\n  i : Let name be the sole element of BoundNames of param.\n  ii: If name is not an element of mappedNames, then\n    1: Add name as an element of the list mappedNames.\n    2: If indx is less than len, then\n      a: Let g be the result of calling the MakeArgGetter abstract operation with arguments name and env.\n      b: Let p be the result of calling the MakeArgSetter abstract operation with arguments name and env.\n      c: Call the [[DefineOwnProperty]] internal method of map passing ToString(indx) and the Property Descriptor {[[Set]]: p, [[Get]]: g, [[Configurable]]: true} as arguments.\n c: Let indx = indx - 1.\n7-9: <<leave as is>>\n---"},{"commentid":3174,"comment_count":2,"who":{"uid":"andrebargull","name":"André Bargull"},"bug_when":"2013-02-01 08:26:29 -0800","thetext":"Step 7 also needs to be changed and one additional boolean flag must be added. The complete algorithm:\n---\n1. Let len be the result of Get(obj, \"length\").\n2. Let mappedNames be an empty List.\n3. Let hasMapped be false.\n4. Let numberOfNonRestFormals be NumberOfParameters of formals.\n5. Let map be the result of the abstract operation ObjectCreate.\n6. Let indx = numberOfNonRestFormals - 1.\n7. Repeat while indx ≥ 0,\n a. Let param be getParameter of formals with argument indx.\n b. If param is a BindingIdentifier, then\n  i.  Let name be the sole element of BoundNames of param.\n  ii. If name is not an element of mappedNames, then\n    1. Add name as an element of the list mappedNames.\n    2. If indx is less than len, then\n      a  Let hasMapped be true.\n      b  Let g be the result of calling the MakeArgGetter abstract operation with arguments name and env.\n      c  Let p be the result of calling the MakeArgSetter abstract operation with arguments name and env.\n      d  Call the [[DefineOwnProperty]] internal method of map passing ToString(indx) and the Property Descriptor {[[Set]]: p, [[Get]]: g, [[Configurable]]: true} as arguments.\n c. Let indx = indx - 1.\n8. If hasMapped is true, then\n  a. Set the [[ParameterMap]] internal data property of obj to map.\n  b. Set the [[GetP]], [[GetOwnProperty]], [[DefineOwnProperty]], and [[Delete]] internal methods of obj to the definitions provided below.\n9. Call the [[DefineOwnProperty]] internal method on obj passing \"callee\" and the Property Descriptor \n{[[Value]]: func , [[Writable]]:  true, [[Enumerable]]: false, [[Configurable]]: true} as arguments.\n10. Return obj\n---"},{"commentid":7479,"comment_count":3,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2014-03-27 09:11:34 -0700","thetext":"fixed in rev23 editor's draft\n\ncomplex rewrite, should be reviewed again."},{"commentid":7535,"comment_count":4,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2014-04-06 11:29:52 -0700","thetext":"fixed in rev23 draft"}]}}
---
