---
{"_attributes":{"version":"4.4.4+","urlbase":"https://bugs.ecmascript.org/","maintainer":"dherman@mozilla.com"},"bug":{"bug_id":4377,"creation_ts":"2015-05-26 08:46:00 -0700","short_desc":"Remove environment parameters from GlobalDeclarationInstantiation/EvalDeclarationInstantiation","delta_ts":"2015-05-26 08:46:30 -0700","product":"Draft for 7th Edition","component":"Deferred from 6th edition","version":"unspecified","rep_platform":"All","op_sys":"All","bug_status":"CONFIRMED","priority":"Normal","bug_severity":"enhancement","everconfirmed":true,"reporter":{"uid":"andrebargull","name":"André Bargull"},"assigned_to":{"uid":"allen","name":"Allen Wirfs-Brock"},"long_desc":[{"commentid":14452,"comment_count":0,"who":{"uid":"andrebargull","name":"André Bargull"},"bug_when":"2015-05-26 08:46:30 -0700","thetext":"{Global, Eval}DeclarationInstantiation access the current variable/lexical environments through explicit parameters.\nBoth abstract operations should instead use the execution context to retrieve the environment state. Otherwise it's\npossible to pass or rather it gives the wrong impression it's valid to pass other environments to global/eval declaration\ninstantiation than the current environments. \nFunctionDeclarationInstantiation already retrieves the current lexical environment through the execution context.\n\n\nProposed changes:\n\n15.1.7 Runtime Semantics: ScriptEvaluation\n  10. Let result be GlobalDeclarationInstantiation(ScriptBody).\n\n15.1.8 Runtime Semantics: GlobalDeclarationInstantiation(script)\n  1. Let env be the running execution context’s LexicalEnvironment.\n  2. Let envRec be env’s EnvironmentRecord.\n  3. Assert: envRec is a global Environment Record.\n\n\n18.2.1.1 Runtime Semantics: PerformEval(x, evalRealm, strictCaller, direct)\n  18. Let result be EvalDeclarationInstantiation(body, strictEval).\n\n18.2.1.2 Runtime Semantics: EvalDeclarationInstantiation(body, strict)\n  1. Let varEnv be the running execution context’s VariableEnvironment.\n  2. Let varEnvRec be varEnv’s EnvironmentRecord.\n  3. Let lexEnv be the running execution context’s LexicalEnvironment.\n  4. Let lexEnvRec be lexEnv’s EnvironmentRecord.\n  5. Assert: lexEnvRec is a declarative Environment Record."}]}}
---
