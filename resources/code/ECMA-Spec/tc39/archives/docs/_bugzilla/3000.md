---
{"_attributes":{"version":"4.4.4+","urlbase":"https://bugs.ecmascript.org/","maintainer":"dherman@mozilla.com"},"bug":{"bug_id":3000,"creation_ts":"2014-06-27 14:46:00 -0700","short_desc":"23.1.1.1: order of side effects for Map constructor makes it unimplementable with for-of","delta_ts":"2014-07-18 14:14:18 -0700","product":"Draft for 6th Edition","component":"technical issue","version":"Rev 25: May 22, 2014 Draft","rep_platform":"All","op_sys":"All","bug_status":"RESOLVED","resolution":"FIXED","priority":"Normal","bug_severity":"enhancement","everconfirmed":true,"reporter":{"uid":"d","name":"Domenic Denicola"},"assigned_to":{"uid":"allen","name":"Allen Wirfs-Brock"},"long_desc":[{"commentid":9108,"comment_count":0,"who":{"uid":"d","name":"Domenic Denicola"},"bug_when":"2014-06-27 14:46:55 -0700","thetext":"Discussed toward the end of https://www.w3.org/Bugs/Public/show_bug.cgi?id=26217\n\nOne would like to be able to implement the `new Map(iterable)` algorithm via something like this:\n\n    var call = uncurryThis(Function.prototype.call);\n\n    var adder = map[adder];\n    if (typeof adder !== \"function\") {\n      throw new TypeError;\n    }\n\n    for (var x of iterable) {\n      var k = iterable[0];\n      var v = iterable[1];\n      call(adder, map, k, v);\n    }\n\nHowever, the specification requires that the iterator be gotten from the iterable before the `adder` is retrieved from `map`, which does not match this code.\n\nThis ordering means implementations cannot self-host using for-of, and must thus engage in some contortions to do the separate iterable-related steps.\n\nIt seems like it'd be simple enough to move step 7c,d,e before steps 7a,b and solve this.\n\nI imagine the other collection initializers might suffer from the same issue."},{"commentid":9109,"comment_count":1,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2014-06-27 15:17:21 -0700","thetext":"fixed in rev26 editor's draft\n\nAlso for Set, WeakMap, WeakSet\n\nLet me know if you see any other similar self-hosting issues like this.  Jason already turned up a couple others that have been fixed."},{"commentid":9263,"comment_count":2,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2014-07-18 14:14:18 -0700","thetext":"in rev26"}]}}
---
