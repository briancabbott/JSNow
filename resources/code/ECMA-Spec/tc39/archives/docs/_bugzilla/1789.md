---
{"_attributes":{"version":"4.4.4+","urlbase":"https://bugs.ecmascript.org/","maintainer":"dherman@mozilla.com"},"bug":{"bug_id":1789,"creation_ts":"2013-08-17 02:52:00 -0700","short_desc":"10.5.1: Insufficient redeclaration checks can trigger assertions in 10.2.1.1.2 and 10.2.1.1.3","delta_ts":"2014-07-18 20:46:47 -0700","product":"Draft for 6th Edition","component":"technical issue","version":"Rev 16: July 15, 2013 Draft","rep_platform":"All","op_sys":"All","bug_status":"RESOLVED","resolution":"FIXED","priority":"Normal","bug_severity":"normal","everconfirmed":true,"reporter":{"uid":"andrebargull","name":"André Bargull"},"assigned_to":{"uid":"allen","name":"Allen Wirfs-Brock"},"long_desc":[{"commentid":4962,"comment_count":0,"who":{"uid":"andrebargull","name":"André Bargull"},"bug_when":"2013-08-17 02:52:36 -0700","thetext":"\"10.5.1 Global Declaration Instantiation\" checks for invalid redeclarations in step 3-4, but steps 9.a.iii.1, 11.a.i.1.a and maybe 13.c, 14.a (cf. bug 1786) can execute side-effects. This can be used to trigger assertions in 10.2.1.1.2 and 10.2.1.1.3 when 10.5.1 processes step 16.\n\n\ntest case:\n---\nfunction triggerAssertion(global, callCounter, code1, code2) {\n  Object.setPrototypeOf(global, new Proxy(Object.create(null), {\n    has(t, pk) {\n      if (pk == \"foo\" && callCounter > 0 && --callCounter == 0) {\n        (1,eval)(`eval(\"${code2}\")`)\n      }\n      return false;\n    }\n  }));\n  (1,eval)(`eval(\"${code1}${code2}\")`)\n}\n\ntriggerAssertion(this, 1, \"var foo = 0;\", \"const bar = 0;\")\n\ntriggerAssertion(this, 1, \"var foo = 0;\", \"let bar = 0;\")\n---"},{"commentid":9232,"comment_count":1,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2014-07-17 13:23:11 -0700","thetext":"fixed in rev26 editor's draft.  \n\nAdded explicit tests for the cases where the assertion failures might occur and noted the possibility that the global script instantiation may abnormally terminate without instantiating some global declaratons.    \n\nIn the presence of proxies I don't think there is anyway to achieve true all or none instantiation behavior."},{"commentid":9297,"comment_count":2,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2014-07-18 20:46:47 -0700","thetext":"Fixed in Rev26"}]}}
---
