---
{"_attributes":{"version":"4.4.4+","urlbase":"https://bugs.ecmascript.org/","maintainer":"dherman@mozilla.com"},"bug":{"bug_id":3157,"creation_ts":"2014-08-26 10:53:00 -0700","short_desc":"Reserve `\\p{}` and `\\P{}` within `/u` RegExp patterns","delta_ts":"2014-10-17 05:47:33 -0700","product":"Draft for 6th Edition","component":"technical issue","version":"Rev 27: August 24, 2014 Draft","rep_platform":"All","op_sys":"All","bug_status":"RESOLVED","resolution":"FIXED","priority":"Normal","bug_severity":"enhancement","everconfirmed":true,"reporter":{"uid":"mathias","name":"Mathias Bynens"},"assigned_to":{"uid":"allen","name":"Allen Wirfs-Brock"},"cc":["andrebargull","claude.pache","ecmascriptbugs","mathias"],"long_desc":[{"commentid":9992,"comment_count":0,"who":{"uid":"mathias","name":"Mathias Bynens"},"bug_when":"2014-08-26 10:53:54 -0700","thetext":"Reserve the syntax `\\p{…}` and `\\P{…}` within `/u` RegExp patterns. https://mail.mozilla.org/pipermail/es-discuss/2014-August/039033.html"},{"commentid":9996,"comment_count":1,"who":{"uid":"claude.pache","name":"Claude Pache"},"bug_when":"2014-08-26 18:43:54 -0700","thetext":"We may also want to reserve \\X for \"grapheme cluster\", for example.\n\nMore generally, one should disallow to interpret \\<char> as <char>, where <char> is one of 0-9, A-Z, a-z, at the prospect to attach more useful meaning to these sequences."},{"commentid":9997,"comment_count":2,"who":{"uid":"mathias","name":"Mathias Bynens"},"bug_when":"2014-08-27 00:55:54 -0700","thetext":"+1 to Claude’s proposal.\n\nAnother example: in addition to the standard notation e.g. `\\p{L}`, Java, Perl, and PCRE allow you to use the shorthand `\\pL`. The shorthand only works with single-letter Unicode properties. `\\pLl` is not the equivalent of `\\p{Ll}`. It is the equivalent of `\\p{L}l` which matches `Al` or `àl` or any Unicode letter followed by a literal `l`.\n\nI’m not saying we should support this in ECMAScript but it’d be nice to keep our options open. For that, we’d have to do what Claude suggested and reserve `\\p…` and `\\P…` in addition to `\\p{…}` and `\\P{…}`."},{"commentid":9998,"comment_count":3,"who":{"uid":"mathias","name":"Mathias Bynens"},"bug_when":"2014-08-27 01:00:49 -0700","thetext":"(In reply to Claude Pache from comment #1)\n> We may also want to reserve \\X for \"grapheme cluster\", for example.\n> \n> More generally, one should disallow to interpret \\<char> as <char>, where\n> <char> is one of 0-9, A-Z, a-z, at the prospect to attach more useful\n> meaning to these sequences.\n\n`\\` followed by `0` already has special meaning (it’s equivalent to `\\x00`) and `\\` followed by a digit from `1` to `9` is already used for back-references. Just A-Z & a-z sounds good."},{"commentid":9999,"comment_count":4,"who":{"uid":"ecmascriptbugs","name":"Norbert"},"bug_when":"2014-08-27 11:17:49 -0700","thetext":"This was already decided by TC39 at the March 2012 meeting, and if I read the spec correctly, it’s already specified:\n\nIdentityEscape[U] ::\n   [+U] SyntaxCharacter\n   [~U] SourceCharacter but not IdentifierPart\n   [~U] <ZWJ>\n   [~U] <ZWNJ>\n\nhttps://mail.mozilla.org/pipermail/es-discuss/2012-March/021919.html\nhttp://people.mozilla.org/~jorendorff/es6-draft.html#sec-patterns"},{"commentid":10000,"comment_count":5,"who":{"uid":"claude.pache","name":"Claude Pache"},"bug_when":"2014-08-28 06:15:25 -0700","thetext":"(In reply to Norbert from comment #4)\n> \n> IdentityEscape[U] ::\n>    [+U] SyntaxCharacter\n>    [~U] SourceCharacter but not IdentifierPart\n>    [~U] <ZWJ>\n>    [~U] <ZWNJ>\n\nYes, that defines what implementations must accept, but that doesn't define what implementations don't accept.\n\nFor instance, the sequence \\p is not (and has never been) part of the specced syntax of regular expression: for `p` is included in IdentifierPart, which is excluded from IdentityEscape. However, most (all?) implementations extend the syntax and treat \\p as a synonym of a literal `p`.\n\nIn fact, it is absolutely fine to keep the old ES5.1 definition, namely:\n\nIdentityEscape ::\n    SourceCharacter but not IdentifierPart\n    <ZWJ>\n    <ZWNJ>\n\nbecause digits and letters are not part of IdentityEscape, and it is all we need. It is even better to revert to that definition, because otherwise it would create an *unnecessary* discrepancy between u- and non-u-regexps.\n\nWhat is needed, is to explicitly forbid implementations to extend the syntax by including other identity sequences than those specced. Because of BC constraints, we could require that only when the u-flag is set."},{"commentid":10001,"comment_count":6,"who":{"uid":"andrebargull","name":"André Bargull"},"bug_when":"2014-08-28 09:00:13 -0700","thetext":"(In reply to Claude Pache from comment #5)\n> For instance, the sequence \\p is not (and has never been) part of the\n> specced syntax of regular expression: for `p` is included in IdentifierPart,\n> which is excluded from IdentityEscape. However, most (all?) implementations\n> extend the syntax and treat \\p as a synonym of a literal `p`.\n\nEngines are generally required to implement \"B.1.4  Regular Expressions Patterns\" instead of \"21.2.1  Patterns\" because of interoperability reasons, and B.1.4 allows \\p. \n\n> \n> In fact, it is absolutely fine to keep the old ES5.1 definition, namely:\n> \n> IdentityEscape ::\n>     SourceCharacter but not IdentifierPart\n>     <ZWJ>\n>     <ZWNJ>\n> \n> because digits and letters are not part of IdentityEscape, and it is all we\n> need. It is even better to revert to that definition, because otherwise it\n> would create an *unnecessary* discrepancy between u- and non-u-regexps.\n\nNote that IdentifierPart includes $, so strictly speaking /\\$/ is not a valid regular expression according to 21.2.1. To properly escape $, you either need to use character classes or unicode-/hex-escape sequences. On my todo list is an item to request changing IdentityEscape to:\n\n  IdentityEscape ::\n    [+U] SyntaxCharacter\n    [~U] SourceCharacter but not UnicodeIDContinue or _\n\n> \n> What is needed, is to explicitly forbid implementations to extend the syntax\n> by including other identity sequences than those specced. Because of BC\n> constraints, we could require that only when the u-flag is set.\n\nSounds good, hopefully implementations adhere to this restriction. :)"},{"commentid":10005,"comment_count":7,"who":{"uid":"ecmascriptbugs","name":"Norbert"},"bug_when":"2014-08-28 18:12:17 -0700","thetext":"(In reply to André Bargull from comment #6)\n\n> Engines are generally required to implement \"B.1.4  Regular Expressions\n> Patterns\" instead of \"21.2.1  Patterns\" because of interoperability reasons,\n> and B.1.4 allows \\p.\n\nWhere does it do that? Our intent was certainly that, with the \"u\" flag set, it would not.\n\n> Sounds good, hopefully implementations adhere to this restriction. :)\n\nHope is good, conformance test cases are better."},{"commentid":10008,"comment_count":8,"who":{"uid":"andrebargull","name":"André Bargull"},"bug_when":"2014-08-29 04:22:15 -0700","thetext":"(In reply to Norbert from comment #7)\n> Where does it do that? Our intent was certainly that, with the \"u\" flag set,\n> it would not.\n\nAre any of the web compatibility extensions allowed for Unicode regular expressions at all? I thought Unicode mode means no web extensions, so my comment in #6 implied non-Unicode mode. I should have made that more clear, sorry!"},{"commentid":10016,"comment_count":9,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2014-08-29 13:13:01 -0700","thetext":"fixed in rev28 editor's draft\n\nAdded a 16.1 restriction forbidding extendings IdentifyEscape to include a-z and A-Z for /u patterns.\n\nAdded text to B.1.4 that clarifies that the Annix B extensions don't change the syntax or semantics of Unicode RegExps."},{"commentid":10462,"comment_count":10,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2014-10-14 15:17:58 -0700","thetext":"fixed in rev28"},{"commentid":10517,"comment_count":11,"who":{"uid":"mathias","name":"Mathias Bynens"},"bug_when":"2014-10-17 05:47:33 -0700","thetext":"(In reply to Allen Wirfs-Brock from comment #10)\n> fixed in rev28\n\nLooks like there’s a typo: `IdentifyEscape` (should be `IdentityEscape`)."}]}}
---
