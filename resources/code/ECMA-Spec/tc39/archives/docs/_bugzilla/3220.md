---
{"_attributes":{"version":"4.4.4+","urlbase":"https://bugs.ecmascript.org/","maintainer":"dherman@mozilla.com"},"bug":{"bug_id":3220,"creation_ts":"2014-09-11 09:37:00 -0700","short_desc":"Set/Map/WeakSet/WeakMap needs to call IteratorClose","delta_ts":"2015-07-10 08:34:24 -0700","product":"Draft for 6th Edition","component":"technical issue","version":"Rev 27: August 24, 2014 Draft","rep_platform":"All","op_sys":"All","bug_status":"RESOLVED","resolution":"FIXED","priority":"Normal","bug_severity":"normal","everconfirmed":true,"reporter":{"uid":"arv","name":"Erik Arvidsson"},"assigned_to":{"uid":"allen","name":"Allen Wirfs-Brock"},"cc":"erik.arvidsson","long_desc":[{"commentid":10184,"comment_count":0,"who":{"uid":"arv","name":"Erik Arvidsson"},"bug_when":"2014-09-11 09:37:27 -0700","thetext":"Set/Map/WeakSet/WeakMap needs to call IteratorClose in case of an abrupt completion:\n\nhttp://people.mozilla.org/~jorendorff/es6-draft.html#sec-set-iterable\n\n12. Repeat\n  a. Let next be the result of IteratorStep(iter).\n  b. ReturnIfAbrupt(next).\n  c. If next is false, then return set.\n  d. Let nextValue be IteratorValue(next).\n  e. ReturnIfAbrupt(nextValue).\n  f. Let status be the result of calling the [[Call]] internal method of adder with set as thisArgument and a List whose sole element is nextValue as argumentsList.\n  g. ReturnIfAbrupt(status).\n\nChange to something like:\n\n12. Repeat\n  a. Let next be the result of IteratorStep(iter).\n  b. If next is an abrupt completion, then return IteratorClose(iter, next).\n  c. If next is false, then return set.\n  d. Let nextValue be IteratorValue(next).\n  e. If nextValue is an abrupt completion, then return IteratorClose(iter, nextValue).\n  f. Let status be the result of calling the [[Call]] internal method of adder with set as thisArgument and a List whose sole element is nextValue as argumentsList.\n  g. If status is an abrupt completion, then return IteratorClose(iter, status).\n\nThe change is more or less to replace `ReturnIfAbrupt(x)` with `If x is an abrupt completion, then return IteratorClose(iter, x)`"},{"commentid":11548,"comment_count":1,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2015-01-18 14:38:47 -0800","thetext":"fixed in rev32 editor's draft"},{"commentid":11549,"comment_count":2,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2015-01-18 16:20:39 -0800","thetext":"Also fixed Array.from, %TypedArray%.from, Promise.all, and Promise.race"},{"commentid":12028,"comment_count":3,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2015-02-02 18:39:03 -0800","thetext":"fixed in rev32 draft"}]}}
---
