---
{"_attributes":{"version":"4.4.4+","urlbase":"https://bugs.ecmascript.org/","maintainer":"dherman@mozilla.com"},"bug":{"bug_id":4437,"creation_ts":"2015-08-18 08:25:00 -0700","short_desc":"26.3: Modules name space objects  should imnplement @@toPrimitive","delta_ts":"2015-08-18 11:16:23 -0700","product":"ECMA-262 Edition 6","component":"technical issues","version":"unspecified","rep_platform":"All","op_sys":"All","bug_status":"CONFIRMED","priority":"Normal","bug_severity":"enhancement","everconfirmed":true,"reporter":{"uid":"allen","name":"Allen Wirfs-Brock"},"assigned_to":{"uid":"allen","name":"Allen Wirfs-Brock"},"cc":["andrebargull","dehrenberg"],"long_desc":[{"commentid":14594,"comment_count":0,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2015-08-18 08:25:35 -0700","thetext":"Current Module name space objects implement only  @@toStringTag and @@iterator as own properties.  It should also implement @@toPrimitive as a method that unconditionally throws a TypeError exception.  Without it, the following can occur:\n\n//\"Mod1\"\nexport function toString() {\n   //arbitrary code with side effects\n   console.log(\"called export toString function\");\n   return \"Module\"\n}\n\n\n//-----------------\n// mail module\nimport * as m1 from \"Mod1\";\n\nconsole.log(m1 == \"Module);  //produces side efects before producing true\n\n\nNote that any operator that applies ToPrimitive to m1 will call the exported toString function (or an exported valueOf)"},{"commentid":14596,"comment_count":1,"who":{"uid":"dehrenberg","name":"Daniel Ehrenberg"},"bug_when":"2015-08-18 11:11:54 -0700","thetext":"I'm wondering about the motivation for this bug. Why is it more important that `m1 == \"Module\"` have no side effect, than that `m1 + \"\"` have no side effect? Does the @@toPrimitive definition need to be a primordial, or is it sufficient that a user could define it and it would work? Is it bad that the user could override @@toPrimitive and cause == to have ia side effect on modules?"},{"commentid":14597,"comment_count":2,"who":{"uid":"andrebargull","name":"AndrÃ© Bargull"},"bug_when":"2015-08-18 11:16:23 -0700","thetext":"(In reply to Daniel Ehrenberg from comment #1)\n> Does the @@toPrimitive definition need to be a primordial, or is it\n> sufficient that a user could define it and it would work? Is it bad that the\n> user could override @@toPrimitive and cause == to have ia side effect on\n> modules?\n\nUsers cannot add or redefine properties on module namespace objects (9.4.6.6, 9.4.6.9, 9.4.6.10)."}]}}
---
