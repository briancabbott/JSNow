---
{"_attributes":{"version":"4.4.4+","urlbase":"https://bugs.ecmascript.org/","maintainer":"dherman@mozilla.com"},"bug":{"bug_id":3104,"creation_ts":"2014-08-04 10:51:00 -0700","short_desc":"Updates to Generators/Iterators","delta_ts":"2015-07-10 08:35:03 -0700","product":"Draft for 6th Edition","component":"technical issue","version":"Rev 26: July 18, 2014 Draft","rep_platform":"All","op_sys":"All","bug_status":"RESOLVED","resolution":"FIXED","priority":"Normal","bug_severity":"enhancement","everconfirmed":true,"reporter":{"uid":"waldron.rick","name":"Rick Waldron"},"assigned_to":{"uid":"allen","name":"Allen Wirfs-Brock"},"cc":["claude.pache","dherman","erik.arvidsson","waldron.rick"],"long_desc":[{"commentid":9662,"comment_count":0,"who":{"uid":"waldron.rick","name":"Rick Waldron"},"bug_when":"2014-08-04 10:51:31 -0700","thetext":"- Add a prototype for iterators, but do not expose a global Iterator constructor for ES6 (leave that for ES7)\n  - Between Object prototype and Generator prototype\n  - Initially empty, but accessible\n- Comprehensions in general deferred to ES7"},{"commentid":9698,"comment_count":1,"who":{"uid":"claude.pache","name":"Claude Pache"},"bug_when":"2014-08-06 17:22:18 -0700","thetext":"The prototype for iterators should have an @@iterator method with the following semantics: `function @@iterator() { return this }`.\n\nThat will replace the corresponding method currently defined on\n%{String|Array|Map|Set|Generator|Loader}IteratorPrototype%\n(Sections { 21.1 | 22.1 | 23.1 | 23.2 | 26.3 }.5.2.2, and 25.3.1.5)"},{"commentid":9724,"comment_count":2,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2014-08-07 16:46:52 -0700","thetext":"(In reply to Claude Pache from comment #1)\n> The prototype for iterators should have an @@iterator method with the\n> following semantics: `function @@iterator() { return this }`.\n> \n> That will replace the corresponding method currently defined on\n> %{String|Array|Map|Set|Generator|Loader}IteratorPrototype%\n> (Sections { 21.1 | 22.1 | 23.1 | 23.2 | 26.3 }.5.2.2, and 25.3.1.5)\n\nI generally agree, although this was not discussed at the meeting."},{"commentid":9732,"comment_count":3,"who":{"uid":"arv","name":"Erik Arvidsson"},"bug_when":"2014-08-08 08:23:45 -0700","thetext":"That does seem like a simplification. I don't think we need to wait another 2 months for this."},{"commentid":9733,"comment_count":4,"who":{"uid":"waldron.rick","name":"Rick Waldron"},"bug_when":"2014-08-08 10:00:20 -0700","thetext":"(In reply to Erik Arvidsson from comment #3)\n> That does seem like a simplification. I don't think we need to wait another\n> 2 months for this.\n\nI agree. I actually read that suggestion as an implementation detail ie. implementing the update to the spec."},{"commentid":9734,"comment_count":5,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2014-08-08 10:43:25 -0700","thetext":"I agree that this is probably a good thing to do.  (I was actually thinking about it before Clauds's comment showed up).\n\nMy only reservation, is that @@iterator is not currently listed as part of the Iterator interface http://people.mozilla.org/~jorendorff/es6-draft.html#sec-iterator-interface and some people have argued that  Iterators, in general, should not be required to support @@iterator. By putting such a method into %IteratorPrototype% along with the expectation that user defined iterators will want to inherit from it pretty much enshrining @@iterator as part of the Iterator interface.\n\nIn practice this may not be such a bad thing as for-of essentially requires it.  As part of putting this change into the spec. I noted a bug where the iterators returned by some operations in the ES6 spec, for example [[Enumerate]] of string exotic objects, didn't include an @@iterator method.  Since those iterator will now inherit from %IteratorPrototype% the bug will just go away if %IteratorPrototype% implements @@iterator.\n\nBTW, this is what I've documented in the spec. for how you can gain access to %IteratorPrototype%:\n\nObject.getPrototypeOf(Object.getPrototypeOf([][Symbol.iterator()))\n\nI have a hard time believing that very many ES6 devs are going to bother to write that to set the [[Prototype]] of any ad hoc iterators they define.  Or even:\n\n    return {\n     __proto__:[][Symbol.iterator].__proto__.__proto__],\n     next() {...body of custom iterator next method ...}\n    }\n\nIf we think that inheriting from %IteratorPrototype% is important for future extensibility, then it might be better to just go ahead and define the global Iterator.  Then people could define ad hoc iterator like the above by saying:\n\n     return new class extends Iterator{\n       next() {...body of custom iterator next method ...}\n     }"},{"commentid":9749,"comment_count":6,"who":{"uid":"waldron.rick","name":"Rick Waldron"},"bug_when":"2014-08-09 17:22:50 -0700","thetext":"That would certainly be nicer for user code"},{"commentid":10311,"comment_count":7,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2014-10-11 16:34:47 -0700","thetext":"fixed in rev28 editor's draft"},{"commentid":10441,"comment_count":8,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2014-10-14 15:17:54 -0700","thetext":"fixed in rev28"}]}}
---
