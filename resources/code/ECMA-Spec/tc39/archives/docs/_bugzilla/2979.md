---
{"_attributes":{"version":"4.4.4+","urlbase":"https://bugs.ecmascript.org/","maintainer":"dherman@mozilla.com"},"bug":{"bug_id":2979,"creation_ts":"2014-06-06 09:08:00 -0700","short_desc":"B.2.5.1 RegExp.prototype.compile: Consider removing extensible check","delta_ts":"2014-08-25 08:29:23 -0700","product":"Draft for 6th Edition","component":"technical issue","version":"Rev 25: May 22, 2014 Draft","rep_platform":"All","op_sys":"All","bug_status":"RESOLVED","resolution":"FIXED","priority":"Normal","bug_severity":"normal","everconfirmed":true,"reporter":{"uid":"andrebargull","name":"André Bargull"},"assigned_to":{"uid":"allen","name":"Allen Wirfs-Brock"},"cc":["erights","erights"],"long_desc":[{"commentid":8868,"comment_count":0,"who":{"uid":"andrebargull","name":"André Bargull"},"bug_when":"2014-06-06 09:08:39 -0700","thetext":"B.2.5.1  RegExp.prototype.compile (pattern, flags ), steps 3-4:\n\nIIRC the [[IsExtensible]] check was only introduced to avoid property invariant violations (non-configurable, non-writable property changes its value). Now that RegExp.prototype reflects regular expression flags through accessor properties, the violation is no longer possible, so the extensible check could be removed."},{"commentid":8869,"comment_count":1,"who":{"uid":"erights","name":"Mark Miller"},"bug_when":"2014-06-06 09:18:49 -0700","thetext":"Is RegExp.prototype a RegExp in ES6?\n\nIIRC, the only \"Foo.prototype\"s which are still \"Foo\"s in ES6 are Array and Function. But I don't remember if that's the complete list.\n\nThe reason I ask is that if it is RegExp, then freezing the RegExp.prototype still needs to prevent it from being a global communications channel. OTOH, if RegExp.prototype is a regular object, then this change is worth considering."},{"commentid":8870,"comment_count":2,"who":{"uid":"andrebargull","name":"André Bargull"},"bug_when":"2014-06-06 09:33:36 -0700","thetext":"(In reply to comment #1)\n> Is RegExp.prototype a RegExp in ES6?\n\nNo.\n\n> \n> IIRC, the only \"Foo.prototype\"s which are still \"Foo\"s in ES6 are Array and\n> Function. But I don't remember if that's the complete list.\n> \n\nEven better, only Function.prototype is still an instance of its type. From 22.1.3:\n\n> The Array prototype object is itself an ordinary object. It is not an Array \n> instance and does not have a length property ."},{"commentid":9148,"comment_count":3,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2014-07-10 13:47:46 -0700","thetext":"I don't see any harm in keeping this restriction.  If somebody freezes a RegExp the presumably are thinking they are making the RegExp value immutable. Why shouldn't the compile method (which is the only way to actually mutate a RegExp) respect that request?"},{"commentid":9154,"comment_count":4,"who":{"uid":"andrebargull","name":"André Bargull"},"bug_when":"2014-07-11 02:49:54 -0700","thetext":"My counter arguments in favour of removing the test:\n\n(1) The same argument can be applied to Date/(Weak)Map/(Weak)Set/ArrayBuffer/... objects. That is, explicitly freezing a Date object should mean its date value will remain unchangeable. \n\n(2) Also, the current check does not actually test for frozen objects, but non-extensible objects. And replacing \"frozen\" with \"non-extensible\" makes the argument somewhat unsound:\n---\nIf somebody makes a RegExp \"non-extensible\" they presumably are thinking they are making the RegExp value immutable.\n---\n\n(3) If the [[IsExtensble]] check won't be removed, it should at least happen after side-effects. For example:\n---\nre = /abc/;\nre.compile({toString() {\n  // RegExp is now observably non-extensible, value will change nonetheless\n  Object.preventExtensions(re);\n  return \"ghi\";\n}});\n---\n\n(4) And RegExp.prototype.compile should no longer be able to initialize an uninitialized RegExp object:\n---\n(new class extends RegExp {\n  constructor() { super(\"ab\") }\n}).test(\"ab\"); // Returns true\n\n(new class extends RegExp {\n  constructor() { Object.preventExtensions(this); super(\"ab\") }\n}).test(\"ab\"); // Returns true\n\n(new class extends RegExp {\n  constructor() { this.compile(\"ab\") }\n}).test(\"ab\"); // Returns true\n\n(new class extends RegExp {\n  constructor() { Object.preventExtensions(this); this.compile(\"ab\") }\n}).test(\"ab\"); // Throws TypeError\n---"},{"commentid":9856,"comment_count":5,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2014-08-24 10:31:10 -0700","thetext":"ok, I'm sold.\n\nFixed in rev27 editor's draft"},{"commentid":9859,"comment_count":6,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2014-08-24 11:27:06 -0700","thetext":"fixed in rev27 editor's draft\n\nexcept as noted above or no longer applicable."},{"commentid":9900,"comment_count":7,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2014-08-25 08:29:23 -0700","thetext":"fixed in rev27 draft"}]}}
---
