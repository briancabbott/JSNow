---
{"_attributes":{"version":"4.4.4+","urlbase":"https://bugs.ecmascript.org/","maintainer":"dherman@mozilla.com"},"bug":{"bug_id":4418,"creation_ts":"2015-07-08 13:45:00 -0700","short_desc":"15.1.1 Early error WRT super in eval code too restrictive","delta_ts":"2015-07-08 13:45:44 -0700","product":"ECMA-262 Edition 6","component":"technical issues","version":"unspecified","rep_platform":"All","op_sys":"All","bug_status":"CONFIRMED","priority":"Normal","bug_severity":"major","everconfirmed":true,"reporter":{"uid":"allen","name":"Allen Wirfs-Brock"},"assigned_to":{"uid":"allen","name":"Allen Wirfs-Brock"},"long_desc":[{"commentid":14533,"comment_count":0,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2015-07-08 13:45:44 -0700","thetext":"On Jul 8, 2015, at 11:04 AM, Brian Terlson wrote:\n\nHi Allen,\n \nCurious what the rationale behind the early error for super inside eval inside arrow functions was. See here: http://www.ecma-international.org/ecma-262/6.0/index.html#sec-scripts-static-semantics-early-errors. Currently supported in V8 and Chakra, so presumably weâ€™d both have to do work to implement this error. But, why would we?\n\n---\n\n\"It is a Syntax Error if StatementList Contains super unless the source code containing super is eval code that is being processed by a direct eval that is contained in function code that is not the function code of an ArrowFunction.\"\n\nI think the actual wording is a bit bogus, but let's see if we can reverse engineer the intent...\n\nThe first part, \"It is a Syntax Error if StatementList Contains super\" is saying that `super` is illegal in the top-level code of actual scripts and  is also illegal in arrow functions (because Contains drills into them) that are contained in such top-level code.  Basically, we want all of the following to be illegal in Scripts:\n\nlet x=super.foo();  \nlet y = ()=>super.foo();\nlet z=()=>()=>super.foo();\n\nThat part seems fine.  But it needs to be restricted because Script is used to parse eval code and we want to be able to say things like:\n\nlet obj = {\n  foo() {\n    eval(`\n        let x=super.foo();  \n        let y = ()=>super.foo();\n        let z=()=>()=>super.foo();\n    `);\n };\n\nwithout generating a early error.  So, I have the clause \"...unless the source code containing super is eval code that is being processed by a direct eval that is contained in function code...\"\n\nBut that, by it self, would allow\n\nlet y1= ()=>eval(\"super.foo()\");\n\nwhich should be illegal.  So, I finished the \"unless\" clause with the restriction \"...that is not the function code of an ArrowFunction.\"\n\nThat correctly handles top-level arrow functions, but it unintentionally also makes things like this illegal:\n\nlet obj = {\n  foo() {\n    eval(`\n        let y = ()=>eval(\"super.foo()\");\n    `);\n };\n\nThere is the additional problem, that  (because of the instantiation reform changes) this should be illegal:\n\nfunction f() {\n   eval(\"super.foo()\");\n}\n\nBut, the above rule for StatementList will not produce an early error for it.  (I think this is something I missed updating when I did the Instantiation reform work in January).\n\nI think, what we really need to say for direct eval is something along the lines of: it is an early error if the StatementList contains  `super`   and replacing the direct eval with a super reference would have produced an early error. (but I think it is more complicated to state than this).  However we state it, it should be part of the eval semantics and not included in 15.1.1.   Then the 15.1.1 rule could be:\n\nIt is a Syntax Error if StatementList Contains super unless the source code containing super is eval code that is being processed by a direct eval."}]}}
---
