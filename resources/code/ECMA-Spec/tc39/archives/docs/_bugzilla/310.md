---
{"_attributes":{"version":"4.4.4+","urlbase":"https://bugs.ecmascript.org/","maintainer":"dherman@mozilla.com"},"bug":{"bug_id":310,"creation_ts":"2012-03-16 08:20:00 -0700","short_desc":"problems with restrictions on non-strict Function caller property","delta_ts":"2015-10-04 10:16:58 -0700","product":"ECMA-262, Editions 5 and 5.1","component":"technical content","version":"Edition 5.1","rep_platform":"All","op_sys":"All","bug_status":"RESOLVED","resolution":"INVALID","bug_file_loc":"https://mail.mozilla.org/pipermail/es5-discuss/2012-March/004107.html","priority":"Normal","bug_severity":"normal","blocked":982,"everconfirmed":true,"reporter":{"uid":"allen","name":"Allen Wirfs-Brock"},"assigned_to":{"uid":"allen","name":"Allen Wirfs-Brock"},"cc":["brendan","brterlso","erights","rossberg"],"long_desc":[{"commentid":768,"comment_count":0,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2012-03-16 08:20:23 -0700","thetext":"15.3.5.4 should have redefined [[GetOwnProperty]] instead of [[Get]] to restrict access to strict-mode functions from non-strict code. \n\nAllenWB:\n\nOK, it looks like the addition of line 6 of 15.3.4.5 was an error.  Line 20 and the informative note in 15.3.5.4 had been around for quite a while when lines 5 and 6 were added in the August 31, 2009 ES5 draft. Technically line 5 is needed and I probably also added line 6 to also incorporate 15.3.5.4 but didn't notice that line 20 made it unnecessary.\n\nI'm disinclined to do anything at all for non-strict caller other than correcting the spec. to use [[GetOwnProperty]] instead of [[Get]].  I'm haven't yet heard any real interoperability issues involving this non-standard feature and unless there are I don't thing we should do anything beyond the minimum necessary to ensure \"caller\" doesn't leak strict callers form the call stack.  As I mentioned earlier, we might consider just specify that as a requirement and moving a away for an algorithmic spec. for this mis-feature."},{"commentid":2471,"comment_count":1,"who":{"uid":"rossberg","name":"Andreas Rossberg"},"bug_when":"2012-11-16 04:16:21 -0800","thetext":"Special casing [[GetOwnProperty]] in 15.3.5.4 is what V8 (and FF) implements, but it actually causes a serious issue with Object.{seal,freeze,IsSealed,isFrozen}. These functions apply [[GetOwnProperty]] to all properties, and will hence throw with the proposed change when applied to the wrong function at the wrong time. In fact, they do in V8, e.g. try:\n\nd8> function g() { Object.seal(g) }\nd8> function f() { \"use strict\"; g() }\nd8> f()\n(d8):1: TypeError: Illegal access to a strict mode caller function.\n\nInterestingly, Firefox does not throw on that example, so I'm not sure what semantics it actually implements.\n\nAs for the rest of your comment, I agree that 15.3.4.5 line 6 (along with the second half of line 5) is unnecessary."},{"commentid":2472,"comment_count":2,"who":{"uid":"brendan","name":"Brendan Eich"},"bug_when":"2012-11-16 07:09:44 -0800","thetext":"(In reply to comment #1)\n> Special casing [[GetOwnProperty]] in 15.3.5.4 is what V8 (and FF) implements,\n> but it actually causes a serious issue with\n> Object.{seal,freeze,IsSealed,isFrozen}. These functions apply\n> [[GetOwnProperty]] to all properties, and will hence throw with the proposed\n> change when applied to the wrong function at the wrong time. In fact, they do\n> in V8, e.g. try:\n> \n> d8> function g() { Object.seal(g) }\n> d8> function f() { \"use strict\"; g() }\n> d8> f()\n> (d8):1: TypeError: Illegal access to a strict mode caller function.\n> \n> Interestingly, Firefox does not throw on that example, so I'm not sure what\n> semantics it actually implements.\n\nSee https://mail.mozilla.org/pipermail/es-discuss/2012-November/026410.html for what FF does, and an alternative fix: do not throw from [[GetOwnProperty]] on a strict function's 'caller', rather return a pd with a censored or poisoned .value property.\n\n/be"},{"commentid":11034,"comment_count":3,"who":{"uid":"erights","name":"Mark Miller"},"bug_when":"2014-12-13 22:24:29 -0800","thetext":"See https://bugs.ecmascript.org/show_bug.cgi?id=3113"},{"commentid":14780,"comment_count":4,"who":{"uid":"brterlso","name":"Brian Terlson"},"bug_when":"2015-10-04 10:16:58 -0700","thetext":"Seems invalid for ES2015."}]}}
---
