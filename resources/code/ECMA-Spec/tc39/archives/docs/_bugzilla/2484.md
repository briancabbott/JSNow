---
{"_attributes":{"version":"4.4.4+","urlbase":"https://bugs.ecmascript.org/","maintainer":"dherman@mozilla.com"},"bug":{"bug_id":2484,"creation_ts":"2014-01-29 11:10:00 -0800","short_desc":"9.2.4  [[Call]]: Use callee's realm for ToObject() operation","delta_ts":"2014-04-06 11:29:43 -0700","product":"Draft for 6th Edition","component":"technical issue","version":"Rev 22: January 20, 2014 Draft","rep_platform":"All","op_sys":"All","bug_status":"RESOLVED","resolution":"FIXED","priority":"Normal","bug_severity":"normal","everconfirmed":true,"reporter":{"uid":"andrebargull","name":"André Bargull"},"assigned_to":{"uid":"allen","name":"Allen Wirfs-Brock"},"long_desc":[{"commentid":7154,"comment_count":0,"who":{"uid":"andrebargull","name":"André Bargull"},"bug_when":"2014-01-29 11:10:06 -0800","thetext":"9.2.4  [[Call]] (thisArgument, argumentsList), step 9.b.iii:\n\n> Else if Type(thisArgument) is not Object, set the thisValue to ToObject(thisArg ument).\n\nAt this point in the algorithm the `calleeContext` execution context is not yet activated, so it's not the top element of the execution context stack. That also means the ToObject() operation does not create a primitive wrapper from the callee's realm, but instead from the caller's realm. That seems to be wrong, the primitive wrapper should be an object of the callee's realm.\n\n\ntest case:\n---\nlet foreign = new Realm();\nforeign.eval(\"function returnThis() { return this }\");\nforeign.global.returnThis.call(1).constructor === foreign.global.Number;\n---"},{"commentid":7164,"comment_count":1,"who":{"uid":"andrebargull","name":"André Bargull"},"bug_when":"2014-01-30 02:19:21 -0800","thetext":"And related: The realm for the ReferenceError thrown from NewFunctionEnvironment, step 5b, when [[Call]] calls NewFunctionEnvironment in step 9c."},{"commentid":7300,"comment_count":2,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2014-02-13 18:18:40 -0800","thetext":"fixed in rev23 editor's draft\n\nwrapper objects now come from callee Realm.\n\nI think its appropriate for the ReferenceError object to come from the caller Realm. The exception was triggered by a caller action  (making the call) and is being immediately thrown back to the caller."},{"commentid":7528,"comment_count":3,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2014-04-06 11:29:43 -0700","thetext":"fixed in rev23 draft"}]}}
---
