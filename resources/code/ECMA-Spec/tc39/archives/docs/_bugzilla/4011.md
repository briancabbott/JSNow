---
{"_attributes":{"version":"4.4.4+","urlbase":"https://bugs.ecmascript.org/","maintainer":"dherman@mozilla.com"},"bug":{"bug_id":4011,"creation_ts":"2015-02-19 07:44:00 -0800","short_desc":"9.2.8 SupportedLocales: Use GetOption in step 1 ?","delta_ts":"2016-02-11 09:49:16 -0800","product":"Internationalization - ECMA-402","component":"Specification","version":"Edition 2.0 drafts","rep_platform":"All","op_sys":"All","bug_status":"RESOLVED","resolution":"FIXED","priority":"Normal","bug_severity":"enhancement","everconfirmed":true,"reporter":{"uid":"andrebargull","name":"André Bargull"},"assigned_to":{"uid":"waldron.rick","name":"Rick Waldron"},"cc":"waldron.rick","long_desc":[{"commentid":12962,"comment_count":0,"who":{"uid":"andrebargull","name":"André Bargull"},"bug_when":"2015-02-19 07:44:08 -0800","thetext":"9.2.8 SupportedLocales (availableLocales, requestedLocales, options)\n\nThe initial steps of SupportedLocales can be simplified to:\n---\n1. If options is not undefined, then\n  a. Let matcher be GetOption(options, \"localeMatcher\", \"string\", « \"lookup\", \"best fit\" », \"best fit\").\n  b. ReturnIfAbrupt(matcher).\n2. Else, let matcher be \"best fit\".\n3. If matcher is \"best fit\", then\n[...]\n---"},{"commentid":12963,"comment_count":1,"who":{"uid":"waldron.rick","name":"Rick Waldron"},"bug_when":"2015-02-19 08:32:23 -0800","thetext":"(In reply to André Bargull from comment #0)\n> 9.2.8 SupportedLocales (availableLocales, requestedLocales, options)\n> \n> The initial steps of SupportedLocales can be simplified to:\n> ---\n> 1. If options is not undefined, then\n>   a. Let matcher be GetOption(options, \"localeMatcher\", \"string\", «\n> \"lookup\", \"best fit\" », \"best fit\").\n>   b. ReturnIfAbrupt(matcher).\n> 2. Else, let matcher be \"best fit\".\n> 3. If matcher is \"best fit\", then\n> [...]\n> ---\n\n\n\nPlease confirm: \n\n\n\n1.  If options is not undefined, then\n  a.  Let matcher be GetOption(options, \"localeMatcher\", \"string\", « \"lookup\", \"best fit\" », \"best fit\"). \n  b.  ReturnIfAbrupt(matcher).\n2.  Else, let matcher be \"best fit\".\n3.  If matcher is \"best fit\",\n  a.  Let MatcherOperation be the abstract operation BestFitSupportedLocales.\n4.  Else\n  a.  Let MatcherOperation be the abstract operation LookupSupportedLocales.\n5.  Let subset be MatcherOperation(availableLocales, requestedLocales).\n6.  For each named own property name P of subset,\n  a.  Let desc be the result of the [[GetOwnProperty]] internal method of subset with the argument P. \n  b.  Set desc.[[Writable]] to false.\n  c.  Set desc.[[Configurable]] to false.\n  d.  Let status be DefinePropertyOrThrow(subset, P, desc).\n  e.  ReturnIfAbrupt(status).\n7.  Return subset."},{"commentid":12965,"comment_count":2,"who":{"uid":"andrebargull","name":"André Bargull"},"bug_when":"2015-02-19 09:09:41 -0800","thetext":"(In reply to Rick Waldron from comment #1)\n> Please confirm: \n\nHow about:\n---\n1.  If options is not undefined, then\n  a.  Let matcher be GetOption(options, \"localeMatcher\", \"string\", « \"lookup\", \"best fit\" », \"best fit\"). \n  b.  ReturnIfAbrupt(matcher).\n2.  Else, let matcher be \"best fit\".\n3.  If matcher is \"best fit\",\n  a.  Let MatcherOperation be the abstract operation BestFitSupportedLocales.\n4.  Else\n  a.  Let MatcherOperation be the abstract operation LookupSupportedLocales.\n5.  Let subset be MatcherOperation(availableLocales, requestedLocales).\n6.  Assert: Type(subset) is Object.\n7.  Let keys be subset.[[OwnPropertyKeys]] ().\n8.  ReturnIfAbrupt(keys).\n9.  Repeat for each element P of keys in List order,\n  a.  Let currentDesc be subset.[[GetOwnProperty]](P).\n  b.  ReturnIfAbrupt(currentDesc).\n  c.  If currentDesc is not undefined, then\n      i.  Let desc be PropertyDescriptor { [[Configurable]]: false, [[Writable]]: false }.\n     ii.  Let status be DefinePropertyOrThrow(subset, P, desc).\n    iii.  ReturnIfAbrupt(status).\n10.  Return subset.\n---\n\n\nMotivation for the additional changes:\n- step 6: BestFitSupportedLocales is implementation defined, but we want to restrict the return value to objects.\n- step 8: BestFitSupportedLocales is implementation defined, so calling subset.[[OwnPropertyKeys]]() could result in an abrupt completion.\n- step 9.b: Same reason as for step 8.\n- step 9.c: To mirror the structure of ES6 SetIntegrityLevel.\n- step 9.c.i: This avoids mucking around with the returned descriptor which is normally not done in ES6. \n\n\nOr alternatively for step 9:\n---\n9.  Repeat for each element P of keys in List order,\n  a.  Let desc be PropertyDescriptor { [[Configurable]]: false, [[Writable]]: false }.\n  b.  Let status be DefinePropertyOrThrow(subset, P, desc).\n  c.  ReturnIfAbrupt(status).\n---\n\nIf you also want to handle accessor properties in step 9:\n---\n9.  Repeat for each element P of keys in List order,\n  a.  Let currentDesc be subset.[[GetOwnProperty]](P).\n  b.  ReturnIfAbrupt(currentDesc).\n  c.  If currentDesc is not undefined, then\n    i.  If IsAccessorDescriptor(currentDesc) is true, then\n      1.  Let desc be the PropertyDescriptor{ [[Configurable]]: false }.\n    ii.  Else,\n      1.  Let desc be the PropertyDescriptor { [[Configurable]]: false, [[Writable]]: false }.\n    iii.  Let status be DefinePropertyOrThrow(subset, P, desc).\n    iv.  ReturnIfAbrupt(status).\n---"},{"commentid":12967,"comment_count":3,"who":{"uid":"andrebargull","name":"André Bargull"},"bug_when":"2015-02-19 09:15:21 -0800","thetext":"(In reply to Rick Waldron from comment #1)\n> Please confirm: \n\nIf you don't want to apply the additional changes, your proposed updates also work for me."},{"commentid":12970,"comment_count":4,"who":{"uid":"waldron.rick","name":"Rick Waldron"},"bug_when":"2015-02-19 09:57:24 -0800","thetext":"Since LookupSupportedLocales and BestFitSupportedLocales, return an Array and List respectively, \"subset\" needs to become an object. I made some minor changes to your suggestion and rolled in Step 9, Alt 1:\n\n\n1.  If options is not undefined, then\n  a.  Let matcher be GetOption(options, \"localeMatcher\", \"string\", « \"lookup\", \"best fit\" », \"best fit\"). \n  b.  ReturnIfAbrupt(matcher).\n2.  Else, let matcher be \"best fit\".\n3.  If matcher is \"best fit\",\n  a.  Let MatcherOperation be the abstract operation BestFitSupportedLocales.\n4.  Else\n  a.  Let MatcherOperation be the abstract operation LookupSupportedLocales.\n5.  Let supportedLocales be MatcherOperation(availableLocales, requestedLocales).\n6.  Let subset be ToObject(supportedLocales).\n7.  ReturnIfAbrupt(subset).\n8.  Let keys be subset.[[OwnPropertyKeys]]().\n9.  ReturnIfAbrupt(keys).\n10. Repeat for each element P of keys in List order,\n  a.  Let desc be PropertyDescriptor { [[Configurable]]: false, [[Writable]]: false }. \n  b.  Let status be DefinePropertyOrThrow(subset, P, desc).\n  c.  ReturnIfAbrupt(status).\n11. Return subset."},{"commentid":14917,"comment_count":5,"who":{"uid":"andrebargull","name":"André Bargull"},"bug_when":"2016-02-11 09:49:16 -0800","thetext":"Fixed in ECMA-402, 2nd ed."}]}}
---
