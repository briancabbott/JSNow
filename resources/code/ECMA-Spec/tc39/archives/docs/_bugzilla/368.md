---
{"_attributes":{"version":"4.4.4+","urlbase":"https://bugs.ecmascript.org/","maintainer":"dherman@mozilla.com"},"bug":{"bug_id":368,"creation_ts":"2012-05-28 00:44:00 -0700","short_desc":"Duplicate parameter names in non-strict function cause assertion failure in InitializeBinding","delta_ts":"2012-09-28 12:53:20 -0700","product":"Draft for 6th Edition","component":"technical issue","version":"Rev 7: May 4, 2012 Draft","rep_platform":"All","op_sys":"All","bug_status":"RESOLVED","resolution":"FIXED","priority":"Normal","bug_severity":"enhancement","everconfirmed":true,"reporter":{"uid":"utatane.tea","name":"Yusuke Suzuki"},"assigned_to":{"uid":"allen","name":"Allen Wirfs-Brock"},"long_desc":[{"commentid":957,"comment_count":0,"who":{"uid":"utatane.tea","name":"Yusuke Suzuki"},"bug_when":"2012-05-28 00:44:00 -0700","thetext":"See https://mail.mozilla.org/pipermail/es-discuss/2012-May/022917.html\n\nIn the latest ES.next draft(May 4), section 10.5.3 Function Declaration Instantiation step 5 is following\n\n  5. For each String argName in parameterNames, in list order do\n    a. Let alreadyDeclared be the result of calling env’s HasBinding concrete method passing argName as the argument.\n    b. NOTE Duplicate parameter names can only occur in non-strict code.\n    c. If alreadyDeclared is false, then\n      i. Call env’s CreateMutableBinding concrete method passing argName as the argument.\n    d. If strict is false, then\n      i. Call env’s InitializeBinding concrete method passing argName, and undefined as the arguments.\n\nIn the step d-i, if strict is false, engine always call env.InitializeBinding(argName, undefined).\nBut if code is non-strict mode, duplicate parameter names may be provided.\n\nAnd section 10.2.1.1.8, InitializeBinding, step 2 is following\n\n  2. Assert: envRec must have an uninitialised binding for N.\n\nSo for example,\n\n  // this is non-strict function\n  function test(a, a) {\n  }\n  test(1, 1);\n\nengine execute above script and raise assertion failure because of calling InitializeBinding to the same name twice."},{"commentid":982,"comment_count":1,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2012-06-14 18:24:45 -0700","thetext":"The fix for this specific issue is to move 5.d under 5.c:\n\n5. For each String argName in parameterNames, in list order do\n    a. Let alreadyDeclared be the result of calling env’s HasBinding concrete\nmethod passing argName as the argument.\n    b. NOTE Duplicate parameter names can only occur in non-strict code.\n    c. If alreadyDeclared is false, then\n      i. Call env’s CreateMutableBinding concrete method passing argName as the\nargument.\n     ii. If strict is false, then\n         1. Call env’s InitializeBinding concrete method passing argName, and\nundefined as the arguments.\n\nIn other words, on the first occurrence of a name in a non-strict parameter, the binding of the name is initialized to undefined.  This allows them to be multiply initialized by step 8.d.\n\nBasically, non-string parameters are treated similarly to var declarations while strict parameters are treated similarly to let declarations."},{"commentid":1188,"comment_count":2,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2012-07-08 16:24:44 -0700","thetext":"fixed in editor's draft"},{"commentid":1772,"comment_count":3,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2012-09-28 12:53:20 -0700","thetext":"fixed in rev10, Sept. 27 2012 draft.  But this whole section is going to be rewritten in the near future"}]}}
---
