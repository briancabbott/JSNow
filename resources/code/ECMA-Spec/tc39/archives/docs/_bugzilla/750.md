---
{"_attributes":{"version":"4.4.4+","urlbase":"https://bugs.ecmascript.org/","maintainer":"dherman@mozilla.com"},"bug":{"bug_id":750,"creation_ts":"2012-10-06 13:10:00 -0700","short_desc":"[10.5, 10.6] Confusion between LexicalEnvironment and EnvironmentRecord","delta_ts":"2015-10-14 17:46:20 -0700","product":"ECMA-262, Editions 5 and 5.1","component":"technical content","version":"Edition 5.1","rep_platform":"All","op_sys":"All","bug_status":"RESOLVED","resolution":"FIXED","priority":"Normal","bug_severity":"normal","everconfirmed":true,"reporter":{"uid":"andrebargull","name":"André Bargull"},"assigned_to":{"uid":"allen","name":"Allen Wirfs-Brock"},"cc":"brterlso","long_desc":[{"commentid":1881,"comment_count":0,"who":{"uid":"andrebargull","name":"André Bargull"},"bug_when":"2012-10-06 13:10:48 -0700","thetext":"(Bug no. 1):\n[10.5 Declaration Binding Instantiation] uses the EnvironmentRecord of the context's VariableEnvironment and assigns it to `env` in step 1. Later in step 7a, this EnvironmentRecord `env` is passed to the abstract operation CreateArgumentsObject. CreateArgumentsObject [10.6] actually expects its `env` parameter to be of type LexicalEnvironment.\n\n(Bug no. 2):\nCreateArgumentsObject calls in step 11c[ii-2/3] MakeArgGetter/MakeArgSetter passing the parameter `env` (which is expected to be a LexicalEnvironment, but actually is a EnvironmentRecord). The introductory text for MakeArgGetter/MakeArgSetter even describes MakeArgGetter/MakeArgSetter's `env` parameter to be of type EnvironmentRecord. Then in step 2 (resp. 3) this `env` parameter is passed to the [13.2 Creating Function Objects] operation as the `Scope` parameter, but `Scope` must be of type LexicalEnvironment!\n\n\nSuggestions to fix (Bug no. 1):\n\nChange [10.5 Declaration Binding Instantiation] as follows:\n---\n1.  Let env be the running execution context‘s VariableEnvironment.\n2.  Let envRec be env‘s environment record.\n(Change every occurrence of `env` to `envRec` in the following algorithm steps expect for 7a which calls CreateArgumentsObject)\n---\n\n\nSuggestions to fix (Bug no. 2):\n\nChange the introductory text for MakeArgGetter/MakeArgSetter to describe the `env` parameter to be a lexical/variable environment."},{"commentid":1882,"comment_count":1,"who":{"uid":"andrebargull","name":"André Bargull"},"bug_when":"2012-10-06 13:16:10 -0700","thetext":"This also needs to be changed in the ES6-draft."},{"commentid":14803,"comment_count":2,"who":{"uid":"brterlso","name":"Brian Terlson"},"bug_when":"2015-10-14 17:46:20 -0700","thetext":"This seems fixed in ES2015 (probably due to extensive refactorings in this area)."}]}}
---
