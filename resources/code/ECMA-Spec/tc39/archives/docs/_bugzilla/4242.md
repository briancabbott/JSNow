---
{"_attributes":{"version":"4.4.4+","urlbase":"https://bugs.ecmascript.org/","maintainer":"dherman@mozilla.com"},"bug":{"bug_id":4242,"creation_ts":"2015-03-30 13:39:00 -0700","short_desc":"Possible bug in IterationStatement grammar","delta_ts":"2015-07-10 08:35:00 -0700","product":"Draft for 6th Edition","component":"technical issue","version":"Rev 31: January 15, 2015 Draft","rep_platform":"All","op_sys":"All","bug_status":"RESOLVED","resolution":"FIXED","priority":"Normal","bug_severity":"enhancement","everconfirmed":true,"reporter":{"uid":"jorendorff","name":"Jason Orendorff"},"assigned_to":{"uid":"allen","name":"Allen Wirfs-Brock"},"cc":"erik.arvidsson","long_desc":[{"commentid":13960,"comment_count":0,"who":{"uid":"jorendorff","name":"Jason Orendorff"},"bug_when":"2015-03-30 13:39:05 -0700","thetext":"I'm usually missing something when I encounter something like this, so bear with me.\n\nHere is a quote from the grammar, but with each production truncated to fit in the textarea I'm working in:\n\n    IterationStatement[Yield, Return] :\n        do   [...]\n        while   [...]\n        for ( [lookahead ∉ {let [}] Expression[?Yield]_opt ;   [...]\n        for ( var VariableDeclarationList[?Yield] ;   [...]\n        for ( LexicalDeclaration   [...]\n        for ( [lookahead ∉ {let [}] LeftHandSideExpression[?Yield] in   [...]\n        for ( var ForBinding[?Yield] in   [...]\n        for ( ForDeclaration[?Yield] in   [...]\n        for ( [lookahead ≠ let] LeftHandSideExpression[?Yield] of   [...]\n        for ( var ForBinding[?Yield] of   [...]\n        for ( ForDeclaration[?Yield] of   [...]\n\nWhat is the purpose of banning `[` after `(` in productions 3 and 6 but not 9?\n\nThe purpose of banning `let` there is clear: it is so that `for(let` unambiguously starts one of the ForBinding/LexicalDeclaration productions, and we don't need a cover grammar to make the syntax parseable with finite lookahead.\n\nBut it seems `[` unambiguously selects one of the non-declaration productions anyway."},{"commentid":13961,"comment_count":1,"who":{"uid":"arv","name":"Erik Arvidsson"},"bug_when":"2015-03-30 14:16:03 -0700","thetext":"This looks correct to me. Let me try to explain.\n\n3 & 6: We want `let [` to be the start of a pattern declaration and not a `let[key]` member lookup. However, we want to support the identifier expression `let` for backwards compat:\n\nvar let;\nfor (let in {}) {}\nfor (let = 0; let < 10; let++) {}\n\n9: for of is new syntax so we can restrict even furtehr"},{"commentid":13962,"comment_count":2,"who":{"uid":"jorendorff","name":"Jason Orendorff"},"bug_when":"2015-03-31 09:48:10 -0700","thetext":"Oh, OK, that makes sense, but there's still a bug. The part in 5.1.5 that explains what [lookahead ∉ set] means needs to be updated. Right now it says:\n\n> If the phrase “[lookahead ∉ set]” appears in the right-hand side of a\n> production, it indicates that the production may not be used if the\n> immediately following input token is a member of the given set.\n\nNote the singular \"immediately following input token\".\n\nThis is why I was confused; I was reading the restriction as:\n\n    [lookahead ∉ {`let`, `[`}]\n\nbecause I didn't realize that the intended meaning\n\n    [lookahead ∉ {`let [`}]\n\nwas a possibility.\n\n----\n\n(more philosophically) The use of ∉ is misleading now that \"lookahead\" no longer refers to exactly one token in particular. It would be clearer to say \"[lookahead does not match x]\" and \"[lookahead does not match any of {x, y, z}]\" but I don't know of symbols that mean quite those things."},{"commentid":13988,"comment_count":3,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2015-04-01 10:29:01 -0700","thetext":"fixed in rev37 editor's draft\n\nI tweaked 5.1.5 to make it explicit that the elements of the set are are one or two element sequences of terminal symbols"},{"commentid":14064,"comment_count":4,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2015-04-03 12:35:33 -0700","thetext":"In Rev37"}]}}
---
