---
{"_attributes":{"version":"4.4.4+","urlbase":"https://bugs.ecmascript.org/","maintainer":"dherman@mozilla.com"},"bug":{"bug_id":3544,"creation_ts":"2015-01-16 01:06:00 -0800","short_desc":"new Object(value), for value != null, is no longer equivalent to ToObject(value)","delta_ts":"2015-01-16 04:41:45 -0800","product":"Draft for 6th Edition","component":"technical issue","version":"Rev 31: January 15, 2015 Draft","rep_platform":"All","op_sys":"All","bug_status":"RESOLVED","resolution":"DUPLICATE","dup_id":3550,"priority":"Normal","bug_severity":"normal","everconfirmed":true,"reporter":{"uid":"claude.pache","name":"Claude Pache"},"assigned_to":{"uid":"allen","name":"Allen Wirfs-Brock"},"long_desc":[{"commentid":11463,"comment_count":0,"who":{"uid":"claude.pache","name":"Claude Pache"},"bug_when":"2015-01-16 01:06:40 -0800","thetext":"19.1.1.1 Object([ value ])\n\nAs specced in Rev 31, `new Object(foo)`, for foo != null, is now just equivalent to `new Object()` instead of ToObject(foo).\n\nThe simplest fix is to revert to the definition of Rev 30, that is removing the newly added step 1. \n\nOtherwise, one might want to produce an object with NewTarget.prototype as its [[Prototype]] internal slot: That may be done when `value` is a primitive; but when `value` is an object, it clashes with the ES1-5 semantics of `new Object(foo) === foo`."},{"commentid":11464,"comment_count":1,"who":{"uid":"claude.pache","name":"Claude Pache"},"bug_when":"2015-01-16 01:45:30 -0800","thetext":"In case one is interested to produce an object with NewTarget.prototype as its [[Prototype]] when possible (that is, except when `value` is already an object), here is a proposed patch.\n\n\n19.1.1.1 Object(value)\n\n1. If value is provided and is neither undefined nor null, return ToObject(value, NewTarget).\n2. If NewTarget is not null, return OrdinaryCreateFromConstructor(NewTarget, \"%ObjectPrototype\").\n3. Return ObjectCreate(%ObjectPrototype%).\n\n\n7.1.13. ToObject(argument [, constructor])\n\n1. If argument is undefined or null, throw a TypeError.\n2. If Type(argument) is Object, return argument.\n3. If Type(argument) is Boolean, then\n    a. Let dataSlot be [[BooleanData]].\n    b. Let intrinsicDefaultProto be \"%BooleanPrototype%\".\n4. Else, if Type(argument) is Number, then\n    a. Let dataSlot be [[NumberData]].\n    b. Let intrinsicDefaultProto be \"%NumberPrototype%\".\n5. Else, if Type(argument) is String, then\n    a. Let dataSlot be [[StringData]].\n    b. Let intrinsicDefaultProto be \"%StringPrototype%\".\n6. Else, Type(argument) is Symbol.\n    a. Let dataSlot be [[SymbolData]].\n    b. Let intrinsicDefaultProto be \"%SymbolPrototype%\".\n7. If constructor is provided as is not null, then\n    a. Let O be OrdinaryCreateFromConstructor(constructor, intrinsicDefaultProto, «dataSlot»).\n    b. ReturnIfAbrupt(O).\n8. Else\n    a. Let currentRealm be the running execution context’s Realm.\n    b. Let proto be currentRealm’s intrinsic object named intrinsicDefaultProto.\n    c. Let O be ObjectCreate(proto, «dataSlot»).\n9. Set the value of the dataSlot internal slot of O to argument.\n10. Return O."},{"commentid":11465,"comment_count":2,"who":{"uid":"claude.pache","name":"Claude Pache"},"bug_when":"2015-01-16 01:49:33 -0800","thetext":"Typo in Comment 1:\n\n7. If constructor is provided *and* is not null, then"},{"commentid":11472,"comment_count":3,"who":{"uid":"claude.pache","name":"Claude Pache"},"bug_when":"2015-01-16 04:36:31 -0800","thetext":"Sorry, the idea of Comment 1 is bad, because new Object(3) must produce an object with [[Prototype]] equal to %NumberPrototype%, not %ObjectPrototype%.\n\nOne should just revert to algorithm of Rev 30 (deleting step 1)."},{"commentid":11474,"comment_count":4,"who":{"uid":"claude.pache","name":"Claude Pache"},"bug_when":"2015-01-16 04:41:45 -0800","thetext":"[creating a new bug, removing the noise]\n\n*** This bug has been marked as a duplicate of bug 3550 ***"}]}}
---
