---
{"_attributes":{"version":"4.4.4+","urlbase":"https://bugs.ecmascript.org/","maintainer":"dherman@mozilla.com"},"bug":{"bug_id":3011,"creation_ts":"2014-07-19 01:54:00 -0700","short_desc":"13.6.3, 13.6.4, 13.14, 12.2.4.2: Different visibility for captured bindings in lexical declarations","delta_ts":"2014-09-20 12:24:21 -0700","product":"Draft for 6th Edition","component":"technical issue","version":"Rev 26: July 18, 2014 Draft","rep_platform":"All","op_sys":"All","bug_status":"RESOLVED","resolution":"FIXED","priority":"Normal","bug_severity":"normal","everconfirmed":true,"reporter":{"uid":"andrebargull","name":"André Bargull"},"assigned_to":{"uid":"allen","name":"Allen Wirfs-Brock"},"cc":"princexcess69","long_desc":[{"commentid":9324,"comment_count":0,"who":{"uid":"andrebargull","name":"André Bargull"},"bug_when":"2014-07-19 01:54:07 -0700","thetext":"13.6.3  The for Statement\n13.6.4  The for-in and for-of Statements\n13.14  The try Statement\n12.2.4.2  Array Comprehension\n\nCaptured bindings in lexical declarations with destructuring and defaults have different visibility depending on where they appear. \n\n(A) C-style for-loops use this approach:\n1. Create new declarative lexical environment\n2. Create bindings in the new environment\n3. Set the new environment to the currently active lexical environment\n4. Perform binding initialization\n\n(B) for-in/of loops, comprehension and catch blocks use this approach:\n1. Create new declarative lexical environment\n2. Create bindings in the new environment\n3. Perform binding initialization\n4. Set the new environment to the currently active lexical environment\n\nUse same semantics for both types of statements?\n\n\nTest case:\n---\nfunction f() { let v = 0; for (let {v = () => v} = {};;) return v }\nf()(); // () => v\n\nfunction g() { let v = 0; for (let {v = () => v} of [{}]) return v }\ng()(); // 0\n\nfunction h() { let v = 0; try { throw {} } catch ({v = () => v}) { return v } }\nh()(); // 0\n\nfunction k() { let v = 0; return [for ({v = () => v} of [{}]) v][0] }\nk()(); // 0\n---"},{"commentid":9441,"comment_count":1,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2014-07-21 09:07:27 -0700","thetext":"agreed, they should all work, like A.\n\nI'll fix it."},{"commentid":9443,"comment_count":2,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2014-07-21 12:05:50 -0700","thetext":"fixed in rev27 editor's draft"},{"commentid":9934,"comment_count":3,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2014-08-25 08:29:27 -0700","thetext":"fixed in rev27 draft"}]}}
---
