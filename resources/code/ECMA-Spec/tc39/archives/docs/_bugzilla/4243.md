---
{"_attributes":{"version":"4.4.4+","urlbase":"https://bugs.ecmascript.org/","maintainer":"dherman@mozilla.com"},"bug":{"bug_id":4243,"creation_ts":"2015-04-02 07:30:00 -0700","short_desc":"Function name in strict functions","delta_ts":"2015-07-17 00:32:04 -0700","product":"Draft for 7th Edition","component":"New feature suggestons","version":"unspecified","rep_platform":"All","op_sys":"All","bug_status":"CONFIRMED","priority":"Normal","bug_severity":"major","everconfirmed":true,"reporter":{"uid":"arv","name":"Erik Arvidsson"},"assigned_to":{"uid":"allen","name":"Allen Wirfs-Brock"},"cc":["adamk","brterlso","erik.arvidsson","mathias","mike","rossberg","waldron.rick"],"long_desc":[{"commentid":14014,"comment_count":0,"who":{"uid":"arv","name":"Erik Arvidsson"},"bug_when":"2015-04-02 07:30:42 -0700","thetext":"All existing engines treat the function name of a strict function as strict. However, the spec seems to imply that only the formal parameters and the function body is strict.\n\nAll existing engines treat this as error:\n\n// sloppy code\nfunction static() {\n  'use strict';\n}\n\nBut the spec seems to imply that that is valid?"},{"commentid":14024,"comment_count":1,"who":"mike","bug_when":"2015-04-02 09:46:01 -0700","thetext":"Here's the reading of the spec that prompted my reports against SpiderMonkey\n[1] and V8 [2].\n\nFrom the ES5 spec:\n\n> The following tokens are also considered to be FutureReservedWords when they\n> occur within strict mode code (see 10.1.1). [3]\n\n...which defines \"strict mode code\":\n\n> Function code that is part of a FunctionDeclaration, FunctionExpression, or\n> accessor PropertyAssignment is strict function code if its\n> FunctionDeclaration, FunctionExpression, or PropertyAssignment is contained\n> in strict mode code or if the function code begins with a Directive Prologue\n> that contains a Use Strict Directive. [4]\n\n...and \"function code\":\n\n> Function code is source text that is parsed as part of a FunctionBody. The\n> function code of a particular FunctionBody does not include any source text\n> that is parsed as part of a nested FunctionBody. Function code also denotes\n> the source text supplied when using the built-in Function object as a\n> constructor. More precisely, the last parameter provided to the Function\n> constructor is converted to a String and treated as the FunctionBody. If more\n> than one parameter is provided to the Function constructor, all parameters\n> except the last one are converted to Strings and concatenated together,\n> separated by commas. The resulting String is interpreted as the\n> FormalParameterList for the FunctionBody defined by the last parameter. The\n> function code for a particular instantiation of a Function does not include\n> any source text that is parsed as part of a nested FunctionBody. [5]\n\nSo since the BindingIdentifier is not considered part of the function code, it\nshould not be interpreted according to the strictness of the function itself.\nThis interpretation also holds in ECMAScript 6 [6].\n\n[1] https://bugzilla.mozilla.org/show_bug.cgi?id=1145191\n[2] https://code.google.com/p/v8/issues/detail?id=3975\n[3] http://es5.github.io/#x11\n[4] http://es5.github.io/#x10.1.1\n[5] http://es5.github.io/#function-code\n[6] Relevant definitions in the ES6 spec draft:\n    - https://people.mozilla.org/~jorendorff/es6-draft.html#sec-identifiers-static-semantics-early-errors\n    - https://people.mozilla.org/~jorendorff/es6-draft.html#sec-strict-mode-code\n    - https://people.mozilla.org/~jorendorff/es6-draft.html#sec-types-of-source-code\n    - https://people.mozilla.org/~jorendorff/es6-draft.html#sec-function-definitions"},{"commentid":14025,"comment_count":2,"who":"mike","bug_when":"2015-04-02 09:47:44 -0700","thetext":"As to whether this is a bug in the spec itself: the spec seems intuitive (and\nthe current implementation seems unintuitive) because of the effect function\ndeclarations have on the environment record.\n\n    function static() {\n      'use strict';\n    }\n\nFrom the perspective of the identifiers themselves (i.e. disregarding\nhoisting), this is similar to:\n\n    var static;\n    static = function() {\n      'use strict';\n    };\n\nIn both cases, the identifier `static` is used to create an entry in the outer\n(sloppy) environment record. The strictness of the function has no effect here.\nContrast this with function expressions, where the spec and current\nimplementations are in alignment. This example generates a SyntaxError:\n\n    (function static() {\n      'use strict';\n    });\n\n...and this behavior maps to the version that does not use an identifier in the\nfunction expression:\n\n    var __tmp = function() {\n      'use strict';\n      var static = __tmp;\n    };"},{"commentid":14030,"comment_count":3,"who":{"uid":"arv","name":"Erik Arvidsson"},"bug_when":"2015-04-02 11:40:48 -0700","thetext":"mike: I think your explanation makes total sense.\n\nMaybe it is safe to change the existing engines?"},{"commentid":14112,"comment_count":4,"who":{"uid":"brterlso","name":"Brian Terlson"},"bug_when":"2015-04-03 13:13:44 -0700","thetext":"This seems unlikely to be problematic. Let's see if we can make the change in our engines before we push for a spec change."},{"commentid":14156,"comment_count":5,"who":{"uid":"brterlso","name":"Brian Terlson"},"bug_when":"2015-04-07 16:24:49 -0700","thetext":"That said, according to #174 (https://bugs.ecmascript.org/show_bug.cgi?id=174) seems to have decided that browsers' current behavior is what the spec should reflect. I wonder why this bug was not resolved? Is that no longer the intention?"},{"commentid":14157,"comment_count":6,"who":{"uid":"waldron.rick","name":"Rick Waldron"},"bug_when":"2015-04-08 07:49:07 -0700","thetext":"(In reply to Brian Terlson from comment #5)\n> That said, according to #174\n> (https://bugs.ecmascript.org/show_bug.cgi?id=174) seems to have decided that\n> browsers' current behavior is what the spec should reflect. I wonder why\n> this bug was not resolved? Is that no longer the intention?\n\nA slippery slope ;)\n\nIf this argument is used for all cases in which browsers/runtimes/etc have implemented the spec incorrectly, then even"},{"commentid":14159,"comment_count":7,"who":{"uid":"waldron.rick","name":"Rick Waldron"},"bug_when":"2015-04-08 07:54:01 -0700","thetext":"(In reply to Rick Waldron from comment #6)\n> (In reply to Brian Terlson from comment #5)\n> > That said, according to #174\n> > (https://bugs.ecmascript.org/show_bug.cgi?id=174) seems to have decided that\n> > browsers' current behavior is what the spec should reflect. I wonder why\n> > this bug was not resolved? Is that no longer the intention?\n> \n> A slippery slope ;)\n> \n> If this argument is used for all cases in which browsers/runtimes/etc have\n> implemented the spec incorrectly, then even\n\nPlease ignore this idiotic non-sense. \n\nI had typed this before fully considering the argument being made and how it applies to anything we're discussing here. At some point, I scrolled to the top of the bug and then I left the page entirely. After reading the linked bug and cc'ing myself there, I returned to this bug's tab and clicked \"save changes\" at the top of the page to cc myself on this as well. Of course, I completely forgot the Bugzilla (being the crappiest pile of garbage ever cobbled together) treats the entire page as the same form and as a result of hitting \"save changes\" (in a completely different region of the page), I also accidentally posted comments that no longer reflected my current thoughts on the subject. \n\nSorry about that."},{"commentid":14537,"comment_count":8,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2015-07-09 14:33:46 -0700","thetext":"While I stand by the argument in made in Bug #174 for that point in time, I also think that Mike has a strong argument that for FunctionDeclaration the binding identifier is part of the code of the surrounding scope and hence the strictness of that scope should apply to it.\n\nHere is another case, that I think adds some insight:\n\n\"don't use strict\";\nvar foo = {bar: \"baz\"};\nvar obj = {\n   [()=>{with (foo) return bar}()] () {\n       \"use strict\";\n       //method body...\n   },\n   strict() {\n      \"use strict\"\n      //method body\n   }\n}\n\nThe computed property name is part of the MethodDefinition but it is computing a property name for a sloppy mode object literal.  It doesn't seem right that strict mode be applied to the property name computation in the first method.  But if that is the case, then for consistency sake it also should not apply to the second method definition.\n\nI don't think we can arrive a single consistently apply rule.  Instead, here is an enumeration of what I think the rules should be for the various cases (in all cases we are talking about a strict mode function in sloppy mode code):\n\n1) BindingIdentifier of a FunctionDeclaration/GeneratorDeclaraton: sloppy mode because the identifier is only bound in the sloppy mode scope\n2) BindingIdentifier of a FunctionExpression/GeneratorExpression: strict because the identifier is only bound in an inner scope of the function\n3) BindingIdentifier of a ClassDeclaration: strict because the identifier in addition to being bound in the sloppy mode scope is also bound in an inner scope of the class body and the a class body is always strict.\n4) BindingIdentifer of a ClassExpression: strict because the identifier is  bound in an inner scope of the class body\n5) PropertyName of a MethodDefinition in a sloppy mode ObjectLiteral: sloppy mode\n6) PropertyName of a MethodDefinition in a ClassBody: strict because all parts of a class body are strict"},{"commentid":14538,"comment_count":9,"who":{"uid":"arv","name":"Erik Arvidsson"},"bug_when":"2015-07-09 14:37:58 -0700","thetext":"Those rules looks good to me."},{"commentid":14548,"comment_count":10,"who":{"uid":"rossberg","name":"Andreas Rossberg"},"bug_when":"2015-07-17 00:32:04 -0700","thetext":"Closely related, but more serious: bug 4426."}]}}
---
