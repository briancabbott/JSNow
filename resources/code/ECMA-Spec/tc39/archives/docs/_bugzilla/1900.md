---
{"_attributes":{"version":"4.4.4+","urlbase":"https://bugs.ecmascript.org/","maintainer":"dherman@mozilla.com"},"bug":{"bug_id":1900,"creation_ts":"2013-09-17 15:51:00 -0700","short_desc":"Make it easy to iterate over iterables in spec language","delta_ts":"2013-10-29 09:44:45 -0700","product":"Draft for 6th Edition","component":"restructure","version":"Rev 18: September 5, 2013 Draft","rep_platform":"All","op_sys":"All","bug_status":"RESOLVED","resolution":"FIXED","priority":"Normal","bug_severity":"enhancement","everconfirmed":true,"reporter":{"uid":"d","name":"Domenic Denicola"},"assigned_to":{"uid":"allen","name":"Allen Wirfs-Brock"},"cc":["annevk","d"],"long_desc":[{"commentid":5397,"comment_count":0,"who":{"uid":"d","name":"Domenic Denicola"},"bug_when":"2013-09-17 15:51:30 -0700","thetext":"In all functions that allow iterables as input arguments, a great number of steps are present to perform the iteration process. For example, in the Map constructor:\n\nLet next be the result of IteratorNext(iter).\nReturnIfAbrupt(next).\nLet done be IteratorComplete(next).\nReturnIfAbrupt(done).\nIf done is true, then return NormalCompletion(map).\nLet nextItem be IteratorValue(next).\nReturnIfAbrupt(nextItem).\n\nare all just setup for getting nextItem. Set has almost-the-same steps:\n\nLet next be the result of IteratorNext(iter).\nReturnIfAbrupt(next).\nLet done be IteratorComplete(next).\nReturnIfAbrupt(done).\nIf done is true, then return set.\nLet nextValue be IteratorValue(next).\nReturnIfAbrupt(nextValue).\n\nDOM promises [1] want this, but I chickened out of actually copying all those steps in to the spec and just said \"For each value `nextValue` of `iterable.\"\n\nIt would be great if you abstracted the above steps into some reusable construct that could be used throughout the spec. I think the only modification would be that you'd say \"If done is true, stop repeat.\" or similar instead of \"If done is true, then return x.\" You'd then move the \"return set\" and \"return NormalCompletion(map)\" (why are they different?) after the repeat.\n\n[1]: https://github.com/domenic/promises-unwrapping#promiseraceiterable"},{"commentid":5413,"comment_count":1,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2013-09-20 13:26:13 -0700","thetext":"I've looked into this and I could replace most uses of IteratorNext+IteratorComplete in the spec. with a new abstract operations IteratorStep(iterator [, value]) which returns either true indicating \"done\" or an iteration result obj for the not done cases. The 7 line sequence could then be expressed in 5 lines like: \n\nlet next be the result of IteratorStep(iter).\nReturnIfAbrupt(next).\nIf next is true, then return NormalCompletion(map).\nLet nextItem be IteratorValue(next).\nReturnIfAbrupt(nextItem).\n\nBut I think there is a tension between conciseness and clarity.  This is a specification,  not an actual implementation, and it primary goal is to clearly and precisely communicate the required semantics. Adding an additional layer of procedural abstraction that over-loads its  result type won't necessarily make the spec. easier to understand. IteratorStep would make some algorithms slightly easier to write but will it make them harder to read/understand?\n\nWhat do you think?"},{"commentid":6004,"comment_count":2,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2013-10-28 11:18:45 -0700","thetext":"fixed in rev20 editor's draft\n\nadded IteratorStep"},{"commentid":6034,"comment_count":3,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2013-10-29 09:44:45 -0700","thetext":"fixed in rev20 draft, Oct. 28, 2013"}]}}
---
