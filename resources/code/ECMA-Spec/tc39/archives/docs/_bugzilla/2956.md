---
{"_attributes":{"version":"4.4.4+","urlbase":"https://bugs.ecmascript.org/","maintainer":"dherman@mozilla.com"},"bug":{"bug_id":2956,"creation_ts":"2014-06-02 07:47:00 -0700","short_desc":"21.1.3.14 String.prototype.replace: Apply ToString on replaceValue even if no match was found","delta_ts":"2014-07-18 14:26:31 -0700","product":"Draft for 6th Edition","component":"technical issue","version":"Rev 25: May 22, 2014 Draft","rep_platform":"All","op_sys":"All","bug_status":"RESOLVED","resolution":"FIXED","priority":"Normal","bug_severity":"normal","everconfirmed":true,"reporter":{"uid":"andrebargull","name":"André Bargull"},"assigned_to":{"uid":"allen","name":"Allen Wirfs-Brock"},"long_desc":[{"commentid":8790,"comment_count":0,"who":{"uid":"andrebargull","name":"André Bargull"},"bug_when":"2014-06-02 07:47:17 -0700","thetext":"21.1.3.14 String.prototype.replace (searchValue, replaceValue )\n\n21.2.5.7 RegExp.prototype.replace calls ToString on a non-callable replaceValue even if no match was found. Compared to that String.prototype.replace performs an early return in step 7 and does not call ToString if no match was found. \nChange String.prototype.replace to call ToString on the replaceValue parameter before step 7. \n\nTest case:\n---\n\"a\".replace(\"b\", {toString: function(){throw 0}})\n\n\"a\".replace(/b/, {toString: function(){throw 0}})\n---"},{"commentid":9161,"comment_count":1,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2014-07-12 08:20:59 -0700","thetext":"fixed in rev26 editor's draft\n\nES3&5 are not precise on this point but seem to suggest that the ToString happens after a successful match.  While Chrome currently does the after match conversion, FF, IE, and Safari all do a before match conversion.  So the legacy de facto standard seems to be before match conversion."},{"commentid":9272,"comment_count":2,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2014-07-18 14:26:31 -0700","thetext":"in rev26"}]}}
---
