---
{"_attributes":{"version":"4.4.4+","urlbase":"https://bugs.ecmascript.org/","maintainer":"dherman@mozilla.com"},"bug":{"bug_id":653,"creation_ts":"2012-09-23 15:38:00 -0700","short_desc":"[11.13.1 Destructuring Assignment] AssignmentProperty should not allow \"Identifier Initialiser{opt}\"","delta_ts":"2015-07-10 08:35:04 -0700","product":"Draft for 6th Edition","component":"technical issue","version":"Rev 9: July 8, 2012 Draft","rep_platform":"All","op_sys":"All","bug_status":"RESOLVED","resolution":"FIXED","priority":"Normal","bug_severity":"normal","everconfirmed":true,"reporter":{"uid":"andrebargull","name":"André Bargull"},"assigned_to":{"uid":"allen","name":"Allen Wirfs-Brock"},"cc":["erik.arvidsson","zenparsing"],"long_desc":[{"commentid":1600,"comment_count":0,"who":{"uid":"andrebargull","name":"André Bargull"},"bug_when":"2012-09-23 15:38:29 -0700","thetext":"From [11.13.1 Destructuring Assignment]:\n---\nAssignmentProperty :\n  Identifier Initialiser{opt}\n  PropertyName : AssignmentElement\n---\n\nThe optional `Initialiser` is most likely provided for consistency purposes, cf. `SingleNameBinding` [12.2.4 Destructuring Binding Patterns]. But since [11.1.5 Object Initialiser] does not contain any `PropertyDefinition -> Identifier Initialiser{opt}` production rule, an `Initialiser` can never occur in an `ObjectAssignmentPattern` and therefore the optional `Initialiser` should be removed from `AssignmentProperty`. That means the rule should look like:\n\n---\nAssignmentProperty :\n  Identifier\n  PropertyName : AssignmentElement\n---\n\n\nNote: This restriction does not apply to `AssignmentElement`."},{"commentid":1604,"comment_count":1,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2012-09-25 12:28:46 -0700","thetext":"We want consistency between Assignment destructuring and binding destructuring so we need to allow for an initialiser in both bases.\n\nRather than removing it from AssignmentProperty the fix is to add it to ObjectLiteral as a covering production.  A static semantic restriction in PostfixExpression prevents this form from being used from regular object literals.  It is in PostfixExpressiion because that is the lowers point in the expression grammar where we know we aren't on the lefthand-side of an assignment operator.\n\nFixed in Rev 10 editor's draft"},{"commentid":1605,"comment_count":2,"who":{"uid":"andrebargull","name":"André Bargull"},"bug_when":"2012-09-25 13:55:24 -0700","thetext":"I'm not sure whether adding a semantic restriction only to PostfixExpression helps, though. On the LHS of an AssignmentExpression could be a MemberExpression with a leading ObjectLiteral:\n---\nfunction f(){\n  ({}.x = 0);\n}\n---"},{"commentid":1607,"comment_count":3,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2012-09-25 14:59:44 -0700","thetext":"(In reply to comment #2)\n> I'm not sure whether adding a semantic restriction only to PostfixExpression\n> helps, though. On the LHS of an AssignmentExpression could be a\n> MemberExpression with a leading ObjectLiteral:\n> ---\n> function f(){\n>   ({}.x = 0);\n> }\n> ---\nYou're right.  I also need a few such restrictions on MemberExpression, CallExpression, and NewExpression.\n\nAn example of a case that would be of concern is ({x=1}.x = 0)\nThis is filtered out with restrictions on some of the \n   MemberExpression : MemberExpression . IdentifierName\nproduction.  The MemberExpression to the left of the . isn't allowed to derive an ObjectLiteral that contains an \n  PropertyDefinition : CoveredInitialisedIdentifier\nproduction."},{"commentid":1608,"comment_count":4,"who":{"uid":"andrebargull","name":"André Bargull"},"bug_when":"2012-09-25 15:26:35 -0700","thetext":"A semantic restriction on PostfixExpression (and MemberExpression, CallExpression, and NewExpression) won't help to resolve the additional issue reported at https://mail.mozilla.org/pipermail/es-discuss/2012-September/025124.html ."},{"commentid":1613,"comment_count":5,"who":{"uid":"zenparsing","name":"Kevin Smith"},"bug_when":"2012-09-26 06:13:03 -0700","thetext":"This could get really complicated.  What about just removing the optional initializer from BindingProperty and AssignmentProperty  when there is no \":\"?"},{"commentid":1724,"comment_count":6,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2012-09-28 12:24:25 -0700","thetext":"fixed in rev10, Sept. 27 2012 draft"}]}}
---
