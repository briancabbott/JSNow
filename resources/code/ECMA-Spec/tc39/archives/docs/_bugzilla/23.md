---
{"_attributes":{"version":"4.4.4+","urlbase":"https://bugs.ecmascript.org/","maintainer":"dherman@mozilla.com"},"bug":{"bug_id":23,"creation_ts":"2011-02-18 14:06:00 -0800","short_desc":"S15.5.4.10_A1_T3 asserting incorrect behavior","delta_ts":"2012-01-13 11:33:18 -0800","product":"Test262","component":"ECMA-262 Tests","version":"unspecified","rep_platform":"All","op_sys":"All","bug_status":"RESOLVED","resolution":"FIXED","priority":"Normal","bug_severity":"normal","everconfirmed":true,"reporter":{"uid":"jorendorff","name":"Jason Orendorff"},"assigned_to":{"uid":"erights","name":"Mark S. Miller"},"cc":["dfugate","erights"],"long_desc":[{"commentid":41,"comment_count":0,"who":{"uid":"jorendorff","name":"Jason Orendorff"},"bug_when":"2011-02-18 14:06:17 -0800","thetext":"S15.5.4.10_A1_T3 Checking by using eval\nfunction testcase() {\n   var match = String.prototype.match;\n   if (typeof toString === \"undefined\") {\n       toString = Object.prototype.toString;\n   }\n   var __class__ = toString();\n   if (match(eval(\"\\\"bj\\\"\"))[0] !== \"bj\") {\n       $ERROR(\"#1: match = String.prototype.match;\nmatch(eval(\\\"\\\\\\\"bj\\\\\\\"\\\"))[0] === \\\"bj\\\". Actual: \" +\nmatch(eval(\"\\\"bj\\\"\"))[0]);\n   }\n}\n\nIt seems like the four lines to do with __class__ are irrelevant and can just be deleted.\n\nMore importantly, when match is called, step 1 in 15.5.4.10 requires that it throw a TypeError, because the this-value is undefined. But the test expects the call to succeed and return an array."},{"commentid":52,"comment_count":1,"who":{"uid":"dfugate","name":"Dave Fugate"},"bug_when":"2011-02-22 10:25:31 -0800","thetext":"Agree that line 17 \"var __class__ = ...\" can and should be removed.\n\nI'm not so convinced about the argument about 15.5.4.10 step 1 making this invalid though.  Line 11 equates to:\n   this.match = String.prototype.match;\nand lines 13-14:\n   this.toString = this.toString || Object.prototype.toString;\n\nwhen match is called, won't 'this' be set to the global object (by 10.4.3 step 2)?  If so, the CheckObjectCoercible call won't throw.\n\nAll this said, the test still seems invalid as the check on line 13 is making a pretty strong assumption about the the host object's toString method if it exists.  That is, the result will contain the substring \"Object\".  While I'd buy this is the case for (all?) built-in objects defined in ES5, it doesn't seem to be a sure thing for host objects...\n\nIf you agree with this assessment, please let me know and I'll disable the test as invalid.\n\nThanks,\n\nDave"},{"commentid":159,"comment_count":2,"who":{"uid":"jorendorff","name":"Jason Orendorff"},"bug_when":"2011-03-16 07:58:38 -0700","thetext":"(In reply to comment #1)\n> when match is called, won't 'this' be set to the global object (by 10.4.3 step\n> 2)?  If so, the CheckObjectCoercible call won't throw.\n\nThis is a change from ES3.\n\n10.4.3 only applies to functions that create an execution context. Functions written in ES5 all have the same [[Call]] method (13.2 step 6) and it creates an execution context (13.2.1 step 1; note that step 2 is not suitable for built-in functions, so this [[Call]] method clearly is not the one built-in functions use). Built-in functions don't. Their [[Call]] and [[Construct]] methods do exactly what their spec says. If they want \"this\" to be an object, they have to coerce it themselves.\n\nThat's why the call to CheckObjectCoercible is there in the first place. Otherwise it would be useless.\n\nIt's also why so many built-in functions were changed in ES5 to have a step 1 that reads, \"Let O be the result of calling ToObject passing the this value as the argument.\" That wasn't necessary in ES3, because the this value was always an object.\n\nAnnex E mentions this change too: \"In particular, in Edition 5 built-in functions that are specified to actually use the passed this value as an object typically throw a TypeError exception if passed null or undefined as the this value.\""},{"commentid":276,"comment_count":3,"who":{"uid":"dfugate","name":"Dave Fugate"},"bug_when":"2011-07-07 09:00:25 -0700","thetext":"Never mentioned it in this bug report, but the test case was disabled;)"},{"commentid":600,"comment_count":4,"who":{"uid":"dfugate","name":"Dave Fugate"},"bug_when":"2012-01-13 11:33:18 -0800","thetext":"I've fixed the test by binding match's this to fnGlobalObject() and only asserting when we can use Object.prototype.toString for the global object's toString method:\n    var match = String.prototype.match.bind(fnGlobalObject());\n    try {\n        fnGlobalObject().toString = Object.prototype.toString;\n    } catch (e) { ; }\n\n    if (  (fnGlobalObject().toString === Object.prototype.toString)  &&\n          (match(eval(\"\\\"bj\\\"\"))[0] !== \"bj\")) {\n        $ERROR('...');\n    }"}]}}
---
