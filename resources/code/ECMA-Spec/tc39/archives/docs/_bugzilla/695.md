---
{"_attributes":{"version":"4.4.4+","urlbase":"https://bugs.ecmascript.org/","maintainer":"dherman@mozilla.com"},"bug":{"bug_id":695,"creation_ts":"2012-10-02 15:20:00 -0700","short_desc":"Please require \"new\" with TypedArray constructor functions","delta_ts":"2013-10-18 13:54:27 -0700","product":"Draft for 6th Edition","component":"technical issue","version":"Rev 10: September 27, 2012 Draft","rep_platform":"All","op_sys":"All","bug_status":"RESOLVED","resolution":"FIXED","priority":"Normal","bug_severity":"normal","everconfirmed":true,"reporter":{"uid":"kbr","name":"Kenneth Russell"},"assigned_to":{"uid":"allen","name":"Allen Wirfs-Brock"},"cc":"dslomov","long_desc":[{"commentid":1815,"comment_count":0,"who":{"uid":"kbr","name":"Kenneth Russell"},"bug_when":"2012-10-02 15:20:50 -0700","thetext":"In the new sections on Typed Arrays in the ES6 draft:\n\n15.13.5.1 The ArrayBuffer Object Called as a Function\n15.13.6.1 TypeArray Constructors Called as a Function\n15.13.7.1 The DataView Constructor Called as a Function\n\nI would like to require that the \"new\" operator be used with the ArrayBuffer, Typed Array and DataView constructors.\n\nPure JavaScript constructor functions do not work correctly without using the \"new\" operator. There should not be an expectation that these built-ins do.\n\nSome web platform constructor functions necessarily support calling them without the \"new\" operator because of necessary backward compatibility requirements. The typed array constructors have no such legacy. It is difficult to support calling them without the \"new\" operator in some browser implementations -- at least as long as they are implemented at the DOM binding level and not in the JS engine directly. Further, the typed array spec editors have to this point declined requests to require support for calling them without the \"new\" operator. Please don't add this requirement in the ES6 spec."},{"commentid":4286,"comment_count":1,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2013-06-23 13:15:37 -0700","thetext":"I've love to spec. it in the way you suggest.  However, when I checked I found that Firefox doesn't require the use of new.  \n\n\nIf you can confirm that other browsers don't already work like Firefox in this regard then I'll make the change you are requesting."},{"commentid":4305,"comment_count":2,"who":{"uid":"kbr","name":"Kenneth Russell"},"bug_when":"2013-06-24 01:44:32 -0700","thetext":"It definitely doesn't work in any WebKit based browser.\n\nChrome:\n\n> var t = Float32Array(5);\n< TypeError: DOM object constructor cannot be called as a function.\n\nWebKit nightly:\n\n> var t = Float32Array(5);\n< TypeError: '[object Float32ArrayConstructor]' is not a function (evaluating 'Float32Array(5)')\n\n> t = new Float32Array(5);\n< [0, 0, 0, 0, 0]"},{"commentid":4306,"comment_count":3,"who":{"uid":"kbr","name":"Kenneth Russell"},"bug_when":"2013-06-24 02:24:39 -0700","thetext":"Dmitry Lomov (CC'd) has been working on implementing Typed Arrays directly in the V8 VM. He points out that in the VM, it is trivial to make\n\n  Float32Array(5)\n\nwork the same as\n\n  new Float32Array(5)\n\nSince a goal of typed arrays' incorporation into the ES spec is to make them work similarly to Arrays, perhaps their constructors should be allowed to be called as functions after all, because \"var t = Array(5)\" works in every browser.\n\nIf it seems this should be possible then please close this bug."},{"commentid":4308,"comment_count":4,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2013-06-24 08:43:41 -0700","thetext":"(In reply to comment #3)\n> Dmitry Lomov (CC'd) has been working on implementing Typed Arrays directly in\n> the V8 VM. He points out that in the VM, it is trivial to make\n> \n>   Float32Array(5)\n> \n> work the same as\n> \n>   new Float32Array(5)\n> \n> Since a goal of typed arrays' incorporation into the ES spec is to make them\n> work similarly to Arrays, perhaps their constructors should be allowed to be\n> called as functions after all, because \"var t = Array(5)\" works in every\n> browser.\n> \n> If it seems this should be possible then please close this bug.\n\nActually, in ES6 we have moving away from using constructor functions in this manner.  While it is easy enough for engines (particularly V8) to make this distinction, it is harder for JS code to do so.  In particular in ES6 we have this problem:\n   class Foo {\n      constructor() {\n         if /*called directly */ {/* act like a factory */}\n         else if /* super called from subclass constructor */ \n            {/* initialize subclass provided this value */}\n         else /* must be a new Foo call */\n            { /* initialize new Foo instance */ }\n      }\n   }\n   class Bar extends Foo () {\n      constructor() {\n         super();\n      }\n   }\n\nThe issue is what do those predicated look like coded in JS? They have to be written by the JS programmer and it is actually pretty difficult of reliably discriminate the cases. Because of this, I expect having class constructors that  also act as factory functions is going to become an ES6 anti-pattern.\n\nAlso for  Binary Data, we want calls like Int8Array(10) to produce a type object describing a 10 element Int8Array rather than an actual array. The present state where using new is required for portable code, in theory, lets us apply that interpretation to calls without new.\n\nHopefully, V8 won't change its current behavior until ES6 if finalized in this regard.  Making the new optional on Typed Array constructors at this time would probably turn that into a de facto standard and block that aspect of the Binary Data extension.\n\nGiven all of this, I think your original bug is correct.  We do want to require new for actual data object creation by these constructors."},{"commentid":4309,"comment_count":5,"who":{"uid":"dslomov","name":"Dmitry Lomov"},"bug_when":"2013-06-24 08:54:31 -0700","thetext":"Great, I am fine either way (and happy to see \"constructor as function\" pattern gone); and I'll be happy to kill this behavior in V8 implementation.\nIt will be great to reflect this decision in the spec draft (in rev 15 e.g. it is still \"If its this value is undefined, it creates and initialises a new ArrayBuffer object. Thus the function call ArrayBuffer(…) is equivalent to the object creation expression new ArrayBuffer (…) with the same arguments.\""}]}}
---
