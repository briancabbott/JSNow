---
{"_attributes":{"version":"4.4.4+","urlbase":"https://bugs.ecmascript.org/","maintainer":"dherman@mozilla.com"},"bug":{"bug_id":4008,"creation_ts":"2015-02-18 16:33:00 -0800","short_desc":"ToDateTimeOptions must not apply defaults if at least one required option is present","delta_ts":"2016-02-11 09:49:14 -0800","product":"Internationalization - ECMA-402","component":"Specification","version":"Edition 2.0 drafts","rep_platform":"All","op_sys":"All","bug_status":"RESOLVED","resolution":"FIXED","priority":"Normal","bug_severity":"normal","everconfirmed":true,"reporter":{"uid":"andrebargull","name":"André Bargull"},"assigned_to":{"uid":"waldron.rick","name":"Rick Waldron"},"cc":["edf","waldron.rick"],"long_desc":[{"commentid":12951,"comment_count":0,"who":{"uid":"andrebargull","name":"André Bargull"},"bug_when":"2015-02-18 16:33:55 -0800","thetext":"ToDateTimeOptions must not apply defaults if at least one required option is present.\n\nFor example:\nToDateTimeOptions({weekday: \"long\"}, \"date\", \"date\") currently returns `{weekday: \"long\", year: \"numeric\", month: \"numeric\", day: \"numeric\"}`, but expected is `{weekday: \"long\"}`."},{"commentid":12972,"comment_count":1,"who":{"uid":"waldron.rick","name":"Rick Waldron"},"bug_when":"2015-02-19 10:52:39 -0800","thetext":"I see where the mistake that was made and the fix is simple, but I have question: why is \"weekday\" not present in 7.a?\n\nhttp://www.ecma-international.org/ecma-402/1.0/index.html#ToDateTimeOptions"},{"commentid":12976,"comment_count":2,"who":{"uid":"andrebargull","name":"André Bargull"},"bug_when":"2015-02-19 11:43:54 -0800","thetext":"Because we don't want to include the weekday in the default date format string. `new Intl.DateTimeFormat(\"en-US\").format(new Date)` and `new Date().toLocaleDateString(\"en-US\")` should both return \"2/19/2015\" instead of \"Thu, 2/19/2015\"."},{"commentid":12983,"comment_count":3,"who":{"uid":"waldron.rick","name":"Rick Waldron"},"bug_when":"2015-02-19 13:15:26 -0800","thetext":"Ah, that makes sense. I think a non-normative note is in order."},{"commentid":13185,"comment_count":4,"who":{"uid":"waldron.rick","name":"Rick Waldron"},"bug_when":"2015-02-20 06:53:15 -0800","thetext":"(In reply to André Bargull from comment #2)\n> Because we don't want to include the weekday in the default date format\n> string. `new Intl.DateTimeFormat(\"en-US\").format(new Date)` and `new\n> Date().toLocaleDateString(\"en-US\")` should both return \"2/19/2015\" instead\n> of \"Thu, 2/19/2015\".\n\n\nPlease confirm:\n\n\n1.  If options is undefined, then let options be null, else let options be ToObject(options).\n2.  ReturnIfAbrupt(options).\n3.  Let opts  be ObjectCreate(options).\n4.  Let needDefaults be true.\n5.  If required is \"date\" or \"any\", then\n  a.  For each of the property names \"weekday\", \"year\", \"month\", \"day\":\n    i.  Let prop  be the property name.\n    ii. If the result of Get(options, prop) is undefined, then let needDefaults be false.\n6.  If required is \"time\" or \"any\", then\n  a.  For each of the property names \"hour\", \"minute\", \"second\":\n    i.  Let prop  be the property name.\n    ii. If the result of Get(options, prop) is not undefined, then let needDefaults be false.\n7.  If needDefaults is true and defaults is either \"date\" or \"all\", then\n  a.  For each of the property names \"year\", \"month\", \"day\":\n    i.  Let prop be the property name.\n    ii. Let desc be PropertyDescriptor { [[Value]]: \"numeric\", [[Configurable]]: true, [[Enumerable]]: true, [[Writable]]: true }. \n    iii.  Let status be DefinePropertyOrThrow(options, prop, desc).\n8.  If needDefaults is true and defaults is either \"time\" or \"all\", then\n  a.  For each of the property names \"hour\", \"minute\", \"second\":\n    i.  Let prop be the property name.\n    ii. Let desc be PropertyDescriptor { [[Value]]: \"numeric\", [[Configurable]]: true, [[Enumerable]]: true, [[Writable]]: true }. \n    iii.  Let status be DefinePropertyOrThrow(options, prop, desc).\n9.  Return options.\n\n\nThis is essentially reverting to the 1st edition, but with updates to ES6 language and mechanisms."},{"commentid":13187,"comment_count":5,"who":{"uid":"andrebargull","name":"André Bargull"},"bug_when":"2015-02-20 07:23:00 -0800","thetext":"(In reply to Rick Waldron from comment #4)\n> Please confirm:\n> \n\nLGTM except for a typo in step 5.a.ii: \"is undefined\" -> \"is not undefined\".\n\n\nFurthermore these steps:\n---\nii.  Let desc be PropertyDescriptor { [[Value]]: \"numeric\", [[Configurable]]: true, [[Enumerable]]: true, [[Writable]]: true }. \niii. Let status be DefinePropertyOrThrow(options, prop, desc).\n---\n\ncan be reduced to:\n---\nii.  Let status be CreateDataPropertyOrThrow(options, prop, \"numeric\").\niii. ReturnIfAbrupt(status).\n---\n\n\nAnd calling Get() actually needs an ReturnIfAbrupt check:\n---\nii. If the result of Get(options, prop) is undefined, then let needDefaults be false.\n---\n\nLike:\n---\nii.  Let value be Get(options, prop).\niii. ReturnIfAbrupt(value).\niv.  If value is not undefined, then let needDefaults be false.\n---\n\nDo you plan to fix all places in the intl spec where ReturnIfAbrupt calls are necessary? Or do you want to leave this as-is for the time being?"},{"commentid":13192,"comment_count":6,"who":{"uid":"waldron.rick","name":"Rick Waldron"},"bug_when":"2015-02-20 07:57:18 -0800","thetext":"(In reply to André Bargull from comment #5)\n> (In reply to Rick Waldron from comment #4)\n> > Please confirm:\n> > \n> \n> LGTM except for a typo in step 5.a.ii: \"is undefined\" -> \"is not undefined\".\n\nFixed\n\n> \n> \n> Furthermore these steps:\n> ---\n> ii.  Let desc be PropertyDescriptor { [[Value]]: \"numeric\",\n> [[Configurable]]: true, [[Enumerable]]: true, [[Writable]]: true }. \n> iii. Let status be DefinePropertyOrThrow(options, prop, desc).\n> ---\n> \n> can be reduced to:\n> ---\n> ii.  Let status be CreateDataPropertyOrThrow(options, prop, \"numeric\").\n> iii. ReturnIfAbrupt(status).\n> ---\n\nFixed.\n\n\n> \n> \n> And calling Get() actually needs an ReturnIfAbrupt check:\n> ---\n> ii. If the result of Get(options, prop) is undefined, then let needDefaults\n> be false.\n> ---\n> \n> Like:\n> ---\n> ii.  Let value be Get(options, prop).\n> iii. ReturnIfAbrupt(value).\n> iv.  If value is not undefined, then let needDefaults be false.\n> ---\n\nFixed.\n\n> \n> Do you plan to fix all places in the intl spec where ReturnIfAbrupt calls\n> are necessary? Or do you want to leave this as-is for the time being?\n\nI would like to make sure that these are all fixed. Any that might appear as \"missed\" were probably considered and determined unnecessary, however I realize now that I overlooked the possibility that user code may pass in objects with accessors that may throw, so another pass is necessary and if you have the time and resources to help me with that, I would greatly appreciate it."},{"commentid":14916,"comment_count":7,"who":{"uid":"andrebargull","name":"André Bargull"},"bug_when":"2016-02-11 09:49:14 -0800","thetext":"Fixed in ECMA-402, 2nd ed."}]}}
---
