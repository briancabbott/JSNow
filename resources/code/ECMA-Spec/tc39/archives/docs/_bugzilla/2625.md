---
{"_attributes":{"version":"4.4.4+","urlbase":"https://bugs.ecmascript.org/","maintainer":"dherman@mozilla.com"},"bug":{"bug_id":2625,"creation_ts":"2014-04-10 07:47:00 -0700","short_desc":"21.2.5.7 RegExp.prototype.replace, 21.2.5.2.1 RegExpExec: Dynamic flags retrieval is unsafe","delta_ts":"2014-04-29 22:20:25 -0700","product":"Draft for 6th Edition","component":"technical issue","version":"Rev 23: April 5, 2014 Draft","rep_platform":"All","op_sys":"All","bug_status":"RESOLVED","resolution":"FIXED","priority":"Normal","bug_severity":"normal","everconfirmed":true,"reporter":{"uid":"andrebargull","name":"André Bargull"},"assigned_to":{"uid":"allen","name":"Allen Wirfs-Brock"},"long_desc":[{"commentid":7654,"comment_count":0,"who":{"uid":"andrebargull","name":"André Bargull"},"bug_when":"2014-04-10 07:47:49 -0700","thetext":"21.2.5.7 RegExp.prototype.replace ( string, replaceValue )\n21.2.5.2.1 Runtime Semantics: RegExpExec Abstract Operation\n\nThe dynamic regular expression flags retrieval with Get() is unsafe when it is performed multiple times, like in RegExp.prototype.replace().\n\nMultiple solutions are possible:\n- retrieve flags only once with Get()\n- retrieve flags with internal [[OriginalFlags]] field\n- change 21.2.5.7, step 16.d.xv to handle the case when nextSrcPosition > position\n\n\nExpected: No error\nActual: Attempt to retrieve substring [start=8, end=0]\n\nTest case:\n---\nvar re = /test/;\nvar glob = true;\nvar c = 0;\nObject.defineProperty(re, \"global\", {\n  get() {\n    c += 1;\n    if (c == 3) {\n      re.compile(/pre/);\n    }\n    if (c == 4) {\n      re.compile(/kaboom/);\n    }\n    var g = glob;\n    glob = false;\n    return g;\n  }\n});\n\"pre-test\".replace(re, function(){});\n---"},{"commentid":7737,"comment_count":1,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2014-04-15 17:11:15 -0700","thetext":"fixed in rev24 editor's draft.\n\nTook the third alternative as subclasses could (either intentionally or unintentionally) also cause the position to move backs words changing the RegExp match algorithm it uses."},{"commentid":8006,"comment_count":2,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2014-04-29 22:20:25 -0700","thetext":"fixed in rev24"}]}}
---
