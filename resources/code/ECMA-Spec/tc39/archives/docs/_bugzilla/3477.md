---
{"_attributes":{"version":"4.4.4+","urlbase":"https://bugs.ecmascript.org/","maintainer":"dherman@mozilla.com"},"bug":{"bug_id":3477,"creation_ts":"2014-12-18 06:49:00 -0800","short_desc":"Fully specify the behaviour of backslash followed by digits in string literals and template literals","delta_ts":"2015-07-10 08:34:59 -0700","product":"Draft for 7th Edition","component":"Deferred from 6th edition","version":"unspecified","rep_platform":"All","op_sys":"All","bug_status":"CONFIRMED","priority":"Normal","bug_severity":"enhancement","everconfirmed":true,"reporter":{"uid":"claude.pache","name":"Claude Pache"},"assigned_to":{"uid":"allen","name":"Allen Wirfs-Brock"},"cc":["bugs.ecmascript","caitpotter88","erights","erik.arvidsson","gabelevi","jorendorff","mathias","oliver"],"long_desc":[{"commentid":11094,"comment_count":0,"who":{"uid":"claude.pache","name":"Claude Pache"},"bug_when":"2014-12-18 06:49:07 -0800","thetext":"This is a follow-up of Bug 1553 and Bug 3212.\n\nLet's consider the general case of a backslash followed by one or more digits, in string literal. We can distinguish four cases:\n\nA. \"\\0\"\n-------\nThis is interpreted as the NUL character.\n\nB. \"\\[89][0-9]*\"\n----------------\nThis is interpreted as literal characters (i.e., as if the backslash wasn't there).\n\nC. \"\\0[89][0-9]*\"\n-----------------\nThis is interpreted as NUL followed by literal characters.\n\nD. All other cases: \"\\[1-7][0-9]*\" and \"\\0[1-7][0-9]*\"\n------------------------------------------------------\nThis is interpreted as a legacy octal escape sequence producing a character of code 0-255, eventually followed by literal characters.\n\n--\n\nIn sloppy mode, engines seem to accept all the forms above and interpret them as described (although I have not fully tested them).\n\nIn strict mode (and in template literals, which follow the rules of strict mode), form A is explicitely allowed, and form D is explicitely forbidden. For forms B and C, according to Bug 1553 Comment 2, the behaviour of engines varies between accepting both (V8/Presto), accepting only B (IE/SpiderMonkey), and throwing a SyntaxError on both (JSC).\n\nAs for regexps, engines seem to be very sloppy even in strict mode :-(\nIf something is to be said about them, I think it is better to open a separate bug.\n\n--\n\nI believe that forms A and D are fully specified. I plan to check the current spec and implementations, and to propose an update of the spec text of annex B that includes also cases B and C (for string literals in sloppy mode) before the end of the year. The only formal decision to be taken here is whether forms B and C should be explicitely forbidden in strict mode and/or in template literals."},{"commentid":11096,"comment_count":1,"who":{"uid":"claude.pache","name":"Claude Pache"},"bug_when":"2014-12-18 06:54:05 -0800","thetext":"*** Bug 1553 has been marked as a duplicate of this bug. ***"},{"commentid":11098,"comment_count":2,"who":{"uid":"claude.pache","name":"Claude Pache"},"bug_when":"2014-12-18 06:54:35 -0800","thetext":"*** Bug 3212 has been marked as a duplicate of this bug. ***"},{"commentid":11099,"comment_count":3,"who":{"uid":"claude.pache","name":"Claude Pache"},"bug_when":"2014-12-18 06:56:10 -0800","thetext":"IMHO, the best behaviour in strict mode is the one of JSC, that is disallowing forms B and C. The reason is that, in these cases, if you replace the first 8 or 9 with any digit between 1 and 7, you fall in case D, and it is better to have something that behaves consistently accross all digits."},{"commentid":11100,"comment_count":4,"who":{"uid":"caitpotter88","name":"Caitlin Potter [:caitp]"},"bug_when":"2014-12-18 07:15:33 -0800","thetext":"Erik's position (in https://crrev.com/811113002/) is that \\0 followed by any digit should be legal (in template literals), such that\n\nEscapeSequence :: 0 [lookahead ∉ DecimalDigit]\n\nbecomes\n\nEscapeSequence :: 0\n\nAnd \\[1-9] would then need to match CharacterEscapeSequence\n\nIt's different from the current strict mode behaviour in all engines, but it doesn't seem unreasonable --- just not what is specified"},{"commentid":11101,"comment_count":5,"who":{"uid":"arv","name":"Erik Arvidsson"},"bug_when":"2014-12-18 07:49:13 -0800","thetext":"I wish B, C and D were all syntax errors in strict mode but I'm afraid that changing this might lead to breaking web sites. However, if JSC gets away with it I'm fine specing that and hope that we can make changes to the other engines."},{"commentid":11105,"comment_count":6,"who":{"uid":"claude.pache","name":"Claude Pache"},"bug_when":"2014-12-18 08:50:26 -0800","thetext":"(In reply to Caitlin Potter [:caitp] from comment #4)\n> Erik's position (in https://crrev.com/811113002/) is that \\0 followed by any\n> digit should be legal (in template literals), such that\n> \n> EscapeSequence :: 0 [lookahead ∉ DecimalDigit]\n> \n> becomes\n> \n> EscapeSequence :: 0\n> \n> And \\[1-9] would then need to match CharacterEscapeSequence\n> \n> It's different from the current strict mode behaviour in all engines, but it\n> doesn't seem unreasonable --- just not what is specified\n\nRight, and if we want to be precise, we should make a distinction between:\n1. forbidding a given extension (e.g., legacy octal escape sequence);\n2. requiring to throw a SyntaxError on some escape sequences.\nThis will make a difference of what engines are allowed to do with \\07, for example."},{"commentid":11107,"comment_count":7,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2014-12-18 09:14:54 -0800","thetext":"added Jason and Oliver to the CC list"},{"commentid":11134,"comment_count":8,"attachid":"77","who":{"uid":"claude.pache","name":"Claude Pache"},"bug_when":"2014-12-23 05:06:45 -0800","thetext":"Created attachment 77\nTests for string literals in sloppy and strict modes\n\nHere are tests for testing the behaviour of implementations in string literals.\n\nThe last two tests check if forms C and B respectively throw a SyntaxError; it is where current implementations differ. (The results are those announced in Comment 0 and Bug 1553 Comment 2.)"},{"commentid":11135,"comment_count":9,"who":{"uid":"claude.pache","name":"Claude Pache"},"bug_when":"2014-12-23 06:43:37 -0800","thetext":"Completing the spec in sloppy mode is remarkably simple: It suffices to replace the following definition of EscapeCharacter (11.8.4) \n\n    EscapeCharacter ::\n        SingleEscapeCharacter\n        DecimalDigit\n        x\n        u\n\nby the following alternative one (to be introduced in B.1.2 probably, although it will depend of what we want for strict mode and templates):\n\n    EscapeCharacter ::\n        SingleEscapeCharacter\n        OctalDigit\n        x\n        u\n\nThat would effectively add 8 and 9 to the NonEscapeCharacter production. Other cases are just special cases of LegacyOctalEscapeSequence."},{"commentid":11136,"comment_count":10,"who":{"uid":"claude.pache","name":"Claude Pache"},"bug_when":"2014-12-23 07:18:37 -0800","thetext":"In case there is an interest in fully specifying the behaviour in strict mode, we need a decision of what to do with the following:\n\n(a) \\07\n(b) \\7\n(c) \\08\n(d) \\8\n\nOptions are:\n\n(1) leave undefined (but do not implement the legacy octal escapes);\n(2) throw a SyntaxError;\n(3) interpret as \\0 = NUL, \\1 = 1, etc.\n\nCurrent spec uses (1);  implementations uses (2) or (3), depending (or not) on the case.\n\nThe same question arises for template literals. According to Comment 4, the answer might be different."},{"commentid":11137,"comment_count":11,"who":{"uid":"caitpotter88","name":"Caitlin Potter [:caitp]"},"bug_when":"2014-12-23 07:50:35 -0800","thetext":"(1) and (2) are essentially equivalent, as there is no valid production to be made from each of those (in the current spec).\n\nIt comes down to two things: A) should octals be parsed and result in a syntax error in strict mode, or B) should they not be parsed at all, with related productions changed to accommodate.\n\nThe rationale for B) is that it doesn't make sense to throw a syntax error, it's strange that the legacy octal escapes are being considered at all (that the grammar is defined in this way explicitly to make it a syntax error to use something that looks like a numeric literal).\n\nSo here's a proposal:\n\n```\n11.8.4\n\nEscapeSequence ::\n    CharacterEscapeSequence\n    0 (previously `0 [lookahead ∉ DecimalDigit]`)\n    HexEscapeSequence\n    UnicodeEscapeSequence\n\nEscapeCharacter ::\n    SingleEscapeCharacter\n    0 (previously `DecimalDigit`)\n    x\n    u\n\nB.1.2\n\nEscapeSequence ::\n    CharacterEscapeSequence\n    LegacyOctalEscapeSequence\n    HexEscapeSequence\n    UnicodeEscapeSequence\n\nEscapeCharacter ::\n    SingleEscapeCharacter\n    OctalDigit (previously replacing `0` in strict mode)\n    x\n    u\n```\n\nFollowing this,\n\n- \"\\0\"  :: U+0000 (strict and sloppy)\n- \"\\1\"  :: U+0031 (strict), U+0001 (sloppy)\n- \"\\2\"  :: U+0032 (strict), U+0002 (sloppy)\n- \"\\3\"  :: U+0033 (strict), U+0003 (sloppy)\n- \"\\4\"  :: U+0034 (strict), U+0004 (sloppy)\n- \"\\5\"  :: U+0035 (strict), U+0005 (sloppy)\n- \"\\6\"  :: U+0036 (strict), U+0006 (sloppy)\n- \"\\7\"  :: U+0037 (strict), U+0007 (sloppy)\n- \"\\8\"  :: U+0038 (strict and sloppy)\n- \"\\9\"  :: U+0039 (strict and sloppy)\n- \"\\00\" :: U+0000 U+0030 (strict), U+0000 (sloppy)\n- \"\\01\" :: U+0000 U+0031 (strict), U+0001 (sloppy)\n- \"\\02\" :: U+0000 U+0032 (strict), U+0002 (sloppy)\n- \"\\03\" :: U+0000 U+0033 (strict), U+0003 (sloppy)\n- \"\\04\" :: U+0000 U+0034 (strict), U+0004 (sloppy)\n- \"\\05\" :: U+0000 U+0035 (strict), U+0005 (sloppy)\n- \"\\06\" :: U+0000 U+0036 (strict), U+0006 (sloppy)\n- \"\\07\" :: U+0000 U+0037 (strict), U+0007 (sloppy)\n- \"\\08\" :: U+0000 U+0038 (strict and sloppy)\n- \"\\09\" :: U+0000 U+0039 (strict and sloppy)\n\nIn my mind, it's low-risk because non-interoperable legacy octal behaviour in strict mode is probably not something many applications depend on, and it seems to make sense, but does prevent introducing octal escape sequences to strict mode later."},{"commentid":11138,"comment_count":12,"who":{"uid":"claude.pache","name":"Claude Pache"},"bug_when":"2014-12-23 08:21:01 -0800","thetext":"(In reply to Caitlin Potter [:caitp] from comment #11)\n> (1) and (2) are essentially equivalent, as there is no valid production to\n> be made from each of those (in the current spec).\n\nThey are not equivalent if implementations are allowed to extend the specced syntax. (And they often do extend.)\n\n> (...) it's strange that the legacy octal escapes are being considered at all (that\n> the grammar is defined in this way explicitly to make it a syntax error to\n> use something that looks like a numeric literal).\n\nIt's useful for avoiding refactoring hazards. For example, if you put \"use strict\" at the top of the file, you are loudly notified that something need to be amended in your string literal 80 lines below, instead of having its semantics silently modified."},{"commentid":12919,"comment_count":13,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2015-02-18 12:01:47 -0800","thetext":"I like Catlin's proposal in comment 11, but I think it needs to be formally considered by TC39.\n\nToo late to do that for ES6 but we can do it for ES7.\n\nChanging this ticket to ES7 deferred"}],"attachment":[{"_attributes":{"isobsolete":"0","ispatch":"0"},"attachid":"77","date":"2014-12-23 05:06:00 -0800","delta_ts":"2014-12-23 05:06:45 -0800","desc":"Tests for string literals in sloppy and strict modes","filename":"test_escape_digits.html","type":"text/html","size":"2257","attacher":{"_attributes":{"name":"Claude Pache"},"_text":"claude.pache"},"data":{"_attributes":{"encoding":"base64"},"_text":"PCFET0NUWVBFIGh0bWw+CjxtZXRhIGNoYXJzZXQ9dXRmLTg+Cjx0aXRsZT5UZXN0cyBmb3IgYmFj\na3NsYXNoIGZvbGxvd2VkIGJ5IGRpZ2l0cyBpbiBzdHJpbmcgbGl0ZXJhbHM8L3RpdGxlPgo8bWV0\nYSBuYW1lPXZpZXdwb3J0IGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCI+CjxkaXYgaWQ9bG9n\nPjwvZGl2Pgo8c2NyaXB0IHNyYz0iaHR0cHM6Ly9tYXRoaWFzLmh0bWw1Lm9yZy9yZXNvdXJjZXMv\ndGVzdGhhcm5lc3MuanMiPjwvc2NyaXB0Pgo8c2NyaXB0IHNyYz0iaHR0cHM6Ly9tYXRoaWFzLmh0\nbWw1Lm9yZy9yZXNvdXJjZXMvdGVzdGhhcm5lc3NyZXBvcnQuanMiPjwvc2NyaXB0Pgo8c2NyaXB0\nPgoJKGZ1bmN0aW9uKGdsb2JhbCkgewoKCgkJdGVzdChmdW5jdGlvbigpIHsKCQkgICAgYXNzZXJ0\nX2VxdWFscygiXDAxMSIsICJceDA5IikKCQkgICAgYXNzZXJ0X2VxdWFscygiXDExOCIsICJceDA5\nOCIpCgkJICAgIGFzc2VydF9lcXVhbHMoIlwxMTM3IiwgIlx4NEI3IikKCQkgICAgYXNzZXJ0X2Vx\ndWFscygiXDc3MiIsICJceDNGMiIpCgkJfSwgJyJcXFswLTddKyIsIHdpdGggY29kZSBiZXR3ZWVu\nIDBvMCBhbmQgMG8zNzcsIGlzIGFuIG9jdGFsIGVzY2FwZSBzZXF1ZW5jZScpOwoKCQl0ZXN0KGZ1\nbmN0aW9uKCkgewoJCSAgICBhc3NlcnRfZXF1YWxzKCJcMDgiLCAiXHgwMDgiKQoJCSAgICBhc3Nl\ncnRfZXF1YWxzKCJcMDkiLCAiXHgwMDkiKQoJCX0sICciXFwwWzg5XSIgaXMgTlVMIGZvbGxvd2Vk\nIGJ5IGxpdGVyYWwgOCBvciA5Jyk7CgoJCXRlc3QoZnVuY3Rpb24oKSB7CgkJICAgIGFzc2VydF9l\ncXVhbHMoIlwwIiwgIlx4MDAiKQoJCSAgICBhc3NlcnRfZXF1YWxzKCI1XDBBIiwgIjVceDAwQSIp\nCgkJfSwgJyJcXDAiIG5vdCBmb2xsb3dlZCBieSBkaWdpdDogTlVMJyk7CgoJCXRlc3QoZnVuY3Rp\nb24oKSB7CgkJICAgIGFzc2VydF9lcXVhbHMoIlw4MzQiLCAiODM0IikKCQkgICAgYXNzZXJ0X2Vx\ndWFscygiXDk5IiwgIjk5IikKCQl9LCAnIlxcOCIgYW5kICJcXDkiOiBsaXRlcmFsIGNoYXJhY3Rl\ncicpCgoJCXRlc3QoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGFzc2VydF9lcXVhbHMoZXZhbCgn\nInVzZSBzdHJpY3QiOyJcXDBBIicpLCAiXHgwMEEiKQoJCX0sICdzdHJpY3QgbW9kZTogIlxcMCIg\nbm90IGZvbGxvd2VkIGJ5IGRpZ2l0OiBOVUwnKQoKCQl0ZXN0KGZ1bmN0aW9uKCkgewoJCSAgICBh\nc3NlcnRfdGhyb3dzKG5ldyBTeW50YXhFcnJvciwgZnVuY3Rpb24oKSB7CgkJICAgICAgICBldmFs\nKCcidXNlIHN0cmljdCI7IlxcMDAiJykKCQkgICAgfSkKCQkgICAgYXNzZXJ0X3Rocm93cyhuZXcg\nU3ludGF4RXJyb3IsIGZ1bmN0aW9uKCkgewoJCSAgICAgICAgZXZhbCgnInVzZSBzdHJpY3QiOyJc\nXDAzIicpCgkJICAgIH0pCgkJfSwgJ3N0cmljdCBtb2RlOiAiXFwwWzAtN10iIHRocm93cyBhIFN5\nbnRheEVycm9yJykKCgkJdGVzdChmdW5jdGlvbigpIHsKCQkgICAgYXNzZXJ0X3Rocm93cyhuZXcg\nU3ludGF4RXJyb3IsIGZ1bmN0aW9uKCkgewoJCSAgICAgICAgZXZhbCgnInVzZSBzdHJpY3QiOyJc\nXDcxIicpCgkJICAgIH0pCgkJICAgIGFzc2VydF90aHJvd3MobmV3IFN5bnRheEVycm9yLCBmdW5j\ndGlvbigpIHsKCQkgICAgICAgIGV2YWwoJyJ1c2Ugc3RyaWN0IjsiXFwxOCInKQoJCSAgICB9KQoJ\nCX0sICdzdHJpY3QgbW9kZTogIlxcWzEtN10iIHRocm93cyBhIFN5bnRheEVycm9yJykKCgkJdGVz\ndChmdW5jdGlvbigpIHsKCQkgICAgYXNzZXJ0X3Rocm93cyhuZXcgU3ludGF4RXJyb3IsIGZ1bmN0\naW9uKCkgewoJCSAgICAgICAgZXZhbCgnInVzZSBzdHJpY3QiOyJcXDA4IicpCgkJICAgIH0pCgkJ\nICAgIGFzc2VydF90aHJvd3MobmV3IFN5bnRheEVycm9yLCBmdW5jdGlvbigpIHsKCQkgICAgICAg\nIGV2YWwoJyJ1c2Ugc3RyaWN0IjsiXFwwOSInKQoJCSAgICB9KQoJCX0sICdzdHJpY3QgbW9kZTog\nIlxcMFs4OV0iIHRocm93cyBhIFN5bnRheEVycm9yJykKCgkJdGVzdChmdW5jdGlvbigpIHsKCQkg\nICAgYXNzZXJ0X3Rocm93cyhuZXcgU3ludGF4RXJyb3IsIGZ1bmN0aW9uKCkgewoJCSAgICAgICAg\nZXZhbCgnInVzZSBzdHJpY3QiOyJcXDgiJykKCQkgICAgfSkKCQkgICAgYXNzZXJ0X3Rocm93cyhu\nZXcgU3ludGF4RXJyb3IsIGZ1bmN0aW9uKCkgewoJCSAgICAgICAgZXZhbCgnInVzZSBzdHJpY3Qi\nOyJcXDkiJykKCQkgICAgfSkKCQl9LCAnc3RyaWN0IG1vZGU6ICJcXFs4OV0iIHRocm93cyBhIFN5\nbnRheEVycm9yJykKCgl9KHRoaXMpKTsKPC9zY3JpcHQ+Cg==\n"}}]}}
---
