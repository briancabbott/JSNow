---
{"_attributes":{"version":"4.4.4+","urlbase":"https://bugs.ecmascript.org/","maintainer":"dherman@mozilla.com"},"bug":{"bug_id":1467,"creation_ts":"2013-05-03 06:35:00 -0700","short_desc":"15.10.6.11/15.10.6.12: RegExp.prototype.{match, replace} algorithm is wrong for empty matches","delta_ts":"2014-12-23 20:23:28 -0800","product":"Draft for 6th Edition","component":"technical issue","version":"Rev 14: March 8, 2013 Draft","rep_platform":"All","op_sys":"All","bug_status":"RESOLVED","resolution":"FIXED","priority":"Normal","bug_severity":"major","everconfirmed":true,"reporter":{"uid":"andrebargull","name":"André Bargull"},"assigned_to":{"uid":"allen","name":"Allen Wirfs-Brock"},"long_desc":[{"commentid":3704,"comment_count":0,"who":{"uid":"andrebargull","name":"André Bargull"},"bug_when":"2013-05-03 06:35:08 -0700","thetext":"From ES3, 15.5.4.10 String.prototype.match:\n> Set the regexp.lastIndex property to 0 and invoke RegExp.prototype.exec\n> repeatedly until there is no match. If there is a match with an empty\n> string (in other words, if the value of regexp.lastIndex is left unchanged),\n> increment regexp.lastIndex by 1.\n\nThe part `(in other words, if the value of regexp.lastIndex is left unchanged)` is actually wrong. Nevertheless, this part was carried over to ES5/5.1 and eventually also into the current ES6 draft. See 15.10.6.11, step 10.g.iv.3.\n\nThese are the expected results from RegExp.prototype.match:\njs> matchWithLength(/^|$/g, \"aa\")\n[\"\", \"\"]\njs> matchWithLength(/\\b/g, \"aa aa\")\n[\"\", \"\", \"\", \"\"]\n\nThese are results with the currently specified algorithm:\njs> matchWithLastIndex(/^|$/g, \"aa\")\n[\"\", \"\", \"\"]\njs> matchWithLastIndex(/\\b/g, \"aa aa\")\n[\"\", \"\", \"\", \"\", \"\", \"\"]\n\nRegExp.prototype.match as expected:\n----\nfunction matchWithLength(re,s) {\n  re.lastIndex = 0;\n  var a = [];\n  for (;;) {\n    var r = re.exec(s);\n    if (!r) break;\n    a.push(r[0]);\n    if (r[0].length === 0)\n      re.lastIndex = re.lastIndex + 1;\n  }\n  return a;\n}\n----\n\nRegExp.prototype.match as currently specified:\n----\nfunction matchWithLastIndex(re, s) {\n  re.lastIndex = 0;\n  var a = [];\n  var prev = 0;\n  for(;;) {\n    var r = re.exec(s);\n    if (!r) break;\n    a.push(r[0]);\n    if (re.lastIndex === prev)\n      re.lastIndex = re.lastIndex + 1;\n    prev = re.lastIndex\n  }\n  return a;\n}\n----"},{"commentid":3846,"comment_count":1,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2013-05-14 08:46:23 -0700","thetext":"need to confirm that \"expected\" results matches current browsers reality"},{"commentid":7646,"comment_count":2,"who":{"uid":"andrebargull","name":"André Bargull"},"bug_when":"2014-04-10 06:09:26 -0700","thetext":"Still present in new RegExp.prototype.replace implementation. \n\nTest case:\n---\n\"aa\".replace(/^|$/g, \"bb\")\n---\n\nExpected: \"bbaabb\"\nActual: \"bbaabbbb\"\n\nTested in: V8, IE11, JSC, SpiderMonkey, Nashorn"},{"commentid":10994,"comment_count":3,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2014-12-10 18:33:12 -0800","thetext":"fixed in rev30 editor's draft\n\nalso added an item to Annex D."},{"commentid":11169,"comment_count":4,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2014-12-23 20:23:28 -0800","thetext":"fixed in rev30"}]}}
---
