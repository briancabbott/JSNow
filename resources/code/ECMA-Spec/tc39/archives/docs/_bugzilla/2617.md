---
{"_attributes":{"version":"4.4.4+","urlbase":"https://bugs.ecmascript.org/","maintainer":"dherman@mozilla.com"},"bug":{"bug_id":2617,"creation_ts":"2014-04-10 05:47:00 -0700","short_desc":"21.2.5.7 RegExp.prototype.replace: Call replacer function after all matches were found","delta_ts":"2014-04-29 22:09:42 -0700","product":"Draft for 6th Edition","component":"technical issue","version":"Rev 23: April 5, 2014 Draft","rep_platform":"All","op_sys":"All","bug_status":"RESOLVED","resolution":"FIXED","priority":"Normal","bug_severity":"normal","everconfirmed":true,"reporter":{"uid":"andrebargull","name":"André Bargull"},"assigned_to":{"uid":"allen","name":"Allen Wirfs-Brock"},"long_desc":[{"commentid":7644,"comment_count":0,"who":{"uid":"andrebargull","name":"André Bargull"},"bug_when":"2014-04-10 05:47:02 -0700","thetext":"21.2.5.7 RegExp.prototype.replace ( string, replaceValue ):\n\nFor ECMAScript 5 and browser compatibility, RegExp.prototype.replace needs to call the replacer function after all matches were found.\n\nTest case: https://github.com/mozilla/gecko-dev/blob/master/js/src/tests/ecma_5/String/replace-updates-global-lastIndex.js\n\nSimplified test case:\n---\nr = /x/g;\n'0x2x4x6x8'.replace(r, function(){ print(r.lastIndex) })\n---\n\nExpected: Prints four times 0\nActual: Prints 2, 4, 6, 8\n\nTested in: SpiderMonkey, JSC, V8, IE11, Nashorn"},{"commentid":7647,"comment_count":1,"who":{"uid":"andrebargull","name":"André Bargull"},"bug_when":"2014-04-10 06:15:05 -0700","thetext":"Different test case which is currently broken when following spec algorithm:\n---\nvar g_rx = /test/g;\n\"test-string\".replace(g_rx, function() { g_rx.lastIndex = 0; return \"a\" });\n---\n\nExpected: \"a-string\"\nActual: attempt to retrieve invalid substring from [start=4, end=0]"},{"commentid":7725,"comment_count":2,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2014-04-14 12:57:40 -0700","thetext":"fixed in rev24 editor's draft"},{"commentid":7998,"comment_count":3,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2014-04-29 22:09:42 -0700","thetext":"fixed in rev24"}]}}
---
