---
{"_attributes":{"version":"4.4.4+","urlbase":"https://bugs.ecmascript.org/","maintainer":"dherman@mozilla.com"},"bug":{"bug_id":2994,"creation_ts":"2014-06-22 19:02:00 -0700","short_desc":"15.2.4.7.1 AsyncStartLoadPartwayThrough shouldn't throw for existing load records","delta_ts":"2015-03-16 14:33:18 -0700","product":"Draft for 6th Edition","component":"deferred features","version":"Rev 25: May 22, 2014 Draft","rep_platform":"All","op_sys":"All","bug_status":"RESOLVED","resolution":"WONTFIX","priority":"Normal","bug_severity":"normal","everconfirmed":true,"reporter":{"uid":"guybedford","name":"Guy Bedford"},"assigned_to":{"uid":"allen","name":"Allen Wirfs-Brock"},"cc":["dherman","jorendorff","samth"],"long_desc":[{"commentid":9063,"comment_count":0,"who":{"uid":"guybedford","name":"Guy Bedford"},"bug_when":"2014-06-22 19:02:31 -0700","thetext":"I assume step 6 is supposed to read loader.[[Loads]] not loader.[[Modules]] otherwise this is a duplicate check.\n\nBut if we import a dependency while it is already an existing load record for the loader (say as a dependency of another load), we should be picking up from that load record and not throwing in this situation."},{"commentid":9064,"comment_count":1,"who":{"uid":"guybedford","name":"Guy Bedford"},"bug_when":"2014-06-22 19:07:38 -0700","thetext":"Note I have implemented a fix that allows GetOrCreateLoad to be used more widely to solve this, as well as https://bugs.ecmascript.org/show_bug.cgi?id=2601.\n\nIt does involve adding two new load record states, \"init\" and \"completed\", and some other adjustments to the algorithm, but I think having a complete GetOrCreateLoad implementation could be useful to handle these kinds of scenarios generally.\n\nI'd be happy to write out these changes in spec language if it would help."},{"commentid":9065,"comment_count":2,"who":{"uid":"guybedford","name":"Guy Bedford"},"bug_when":"2014-06-22 19:09:58 -0700","thetext":"To summarize the issue in case it isn't clear:\n\nSystem.import('A')\nsetTimeout(function() {\n  System.import('B')\n});\n\nA depends on B.\n\nIf we manage to get the timing right to import B while it has a load record for A that is not yet loaded, the load for B will throw."},{"commentid":9750,"comment_count":3,"who":{"uid":"guybedford","name":"Guy Bedford"},"bug_when":"2014-08-09 20:37:41 -0700","thetext":"Another side effect of this, in combination with https://bugs.ecmascript.org/show_bug.cgi?id=3097.\n\nWhen a load fails, and we try to load a module that depends on non-failing dependencies of that failed load, we get an error.\n\nSystem.import('foo') // fails on loading dependency \"bar\"\n\nWhere foo depends on \"bar\" and \"baz\", and \"bar\" is a failing load record.\n\nIf I later import baz:\n\nSystem.import('baz')\n// throws since baz already loading"},{"commentid":10143,"comment_count":4,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2014-09-03 14:47:52 -0700","thetext":"(In reply to Guy Bedford from comment #1)\n> Note I have implemented a fix that allows GetOrCreateLoad to be used more\n> widely to solve this, as well as\n> https://bugs.ecmascript.org/show_bug.cgi?id=2601.\n> \n> It does involve adding two new load record states, \"init\" and \"completed\",\n> and some other adjustments to the algorithm, but I think having a complete\n> GetOrCreateLoad implementation could be useful to handle these kinds of\n> scenarios generally.\n> \n> I'd be happy to write out these changes in spec language if it would help.\n\nSorry it's been a while, I'm just getting to update the module load algorithms in the spec. \n\nIt would be great if you could write up you fix for this.  It doesn't have to be anything fancy, just a the basic algorithm out line. I'll do the necessary reformatting."},{"commentid":10212,"comment_count":5,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2014-09-19 11:04:57 -0700","thetext":"(In reply to Allen Wirfs-Brock from comment #4)\n> \n> It would be great if you could write up you fix for this.  It doesn't have\n> to be anything fancy, just a the basic algorithm out line. I'll do the\n> necessary reformatting.\n\nDon't bother, I've already taken care of this."},{"commentid":13759,"comment_count":6,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2015-03-16 14:33:18 -0700","thetext":"concerns old module spec."}]}}
---
