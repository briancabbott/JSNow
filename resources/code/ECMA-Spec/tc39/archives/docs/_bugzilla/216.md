---
{"_attributes":{"version":"4.4.4+","urlbase":"https://bugs.ecmascript.org/","maintainer":"dherman@mozilla.com"},"bug":{"bug_id":216,"creation_ts":"2011-10-20 09:53:00 -0700","short_desc":"15.11.4.4-8-2 errObj.toString() returns \"Error\"","delta_ts":"2012-01-13 09:05:43 -0800","product":"Test262","component":"ECMA-262 Tests","version":"unspecified","rep_platform":"All","op_sys":"All","bug_status":"RESOLVED","resolution":"INVALID","priority":"Normal","bug_severity":"normal","everconfirmed":true,"reporter":{"uid":"utatane.tea","name":"Yusuke Suzuki"},"assigned_to":{"uid":"dfugate","name":"Dave Fugate"},"cc":"allen","long_desc":[{"commentid":500,"comment_count":0,"attachid":"6","who":{"uid":"utatane.tea","name":"Yusuke Suzuki"},"bug_when":"2011-10-20 09:53:23 -0700","thetext":"Created attachment 6\npatch for 15.11.4.4-8-2\n\nin chapter15/15.11/15.11.4/15.11.4.4/15.11.4.4^8-2.js, errObj.toString() should return \"Error\".\n\nFirst, errObj.name is \"\"\n\nQuoted from section 15.11.2.1\n  If the argument message is not undefined, the message own property of the newly constructed object is set to ToString(message).\n\nAnd errObj instance is created by Error constructor with argument is undefined, so errObj.message is not own property and if [[Get]] is called, returns \"\" because Error.prototype.message is \"\".\n\nSo in section 15.11.4.4, step 7\nhttp://es5.github.com/#x15.11.4.4\n  7. If name and msg are both the empty String, return \"Error\".\n\nBecause errObj.name is \"\" and errObj.message is \"\", errObj.toString() returns \"Error\"."},{"commentid":565,"comment_count":1,"who":{"uid":"dfugate","name":"Dave Fugate"},"bug_when":"2012-01-12 10:39:59 -0800","thetext":"I believe the test case is actually correct here according to my version of the spec.  After the line:\n    var errObj = new Error();\n\nerrObj.name===\"Error\" (15.11.4.2) and errObj.message===\"\" (15.11.4.3).\n\n\nThe next line causes us to use \"\" for the value of the 'name' property rather than Error.prototype.name's value:\n    errObj.name = \"\";\n\n\n\nThe next part might be contentious.  My version of ES5.1 - Rev. 5 â€“ 10 January 2011 (15.11.4.4 Step 7) reads:\n    \"If msg is undefined, then let msg be the empty String; else let msg be ToString(msg).\"\n\nand Annex F (corrections between ES5 and ES5.1) states:\n    15.11.4.4: Steps 6-10 modified/added to correctly deal with missing or empty message property value.\n\nTo complicate things a bit more, steps 6 and 7 in 15.11.4.4 (of ES5.1) are identical which is an issue in and of itself.\n\nI'll do a bit of digging and see if this is a known spec issue or if there's a newer revision available yet."},{"commentid":566,"comment_count":2,"who":{"uid":"dfugate","name":"Dave Fugate"},"bug_when":"2012-01-12 10:48:17 -0800","thetext":"There is indeed a newer version of ES5.1 (June 2011 edition) found at http://www.ecma-international.org/publications/files/ECMA-ST/Ecma-262.pdf.  Unfortunately, it has the same issue I mentioned before and the full 15.11.4.4 algorithm given is:\n\n15.11.4.4 Error.prototype.toString ( )\nThe following steps are taken:\n1. Let O be the this value.\n2. If Type(O) is not Object, throw a TypeError exception.\n3. Let name be the result of calling the [[Get]] internal method of O with argument \"name\".\n4. If name is undefined, then let name be \"Error\"; else let name be ToString(name).\n5. Let msg be the result of calling the [[Get]] internal method of O with argument \"message\".\n6. If msg is undefined, then let msg be the empty String; else let msg be ToString(msg).\n7. If msg is undefined, then let msg be the empty String; else let msg be ToString(msg).\n8. If name is the empty String, return msg.\n9. If msg is the empty String, return name.\n10. Return the result of concatenating name, \":\", a single space character, and msg.\n\nThis issue has been filed as https://bugs.ecmascript.org/show_bug.cgi?id=239, and we can modify the tests as needed once we get clarification on the expected behavior."},{"commentid":567,"comment_count":3,"who":{"uid":"utatane.tea","name":"Yusuke Suzuki"},"bug_when":"2012-01-12 11:11:54 -0800","thetext":"Thanks!\n\nI saw ES5 Errata (Updated July 31, 2010) http://wiki.ecmascript.org/doku.php?id=\nhttp://wiki.ecmascript.org/lib/exe/fetch.php?id=start&cache=cache&media=resources:es5_errata_7-31-10.pdf\n\nin Errata P.5 and P.6\n\nstatement of 15.11.1.1 and 15.11.2.1, \"Otherwise, the message own property is set to the empty String.\" is removed.\n\nAnd 15.11.4.4 is modified to\n\n15.11.4.4 Error.prototype.toString ( )\n(Algorithm incorrect when message is the empty string or undefined)\n6. If msg is undefined, then let msg be the empty String; else let msg be ToString(msg).\n7. If name and msg are both the empty String, return \"Error\".\n8. If name is the empty String, return msg.\n9. If msg is the empty String, return name.\n10. Return the result of concatenating name, \":\", a single space character, and msg.\n\nSo I thought when errObj.name===\"\" and errObj.message===\"\", toString result is \"Error\".\nIf I overlooked something, please point out."},{"commentid":572,"comment_count":4,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2012-01-12 12:09:51 -0800","thetext":"(In reply to comment #3)\n> Thanks!\n> \n> I saw ES5 Errata (Updated July 31, 2010)\n> http://wiki.ecmascript.org/doku.php?id=\n> http://wiki.ecmascript.org/lib/exe/fetch.php?id=start&cache=cache&media=resources:es5_errata_7-31-10.pdf\n\nThe only normative source is the http://www.ecma-international.org/publications/files/ECMA-ST/Ecma-262.pdf please use source except where it is clearly by a confirmed ES5.1 at bugs.ecmascript.org \n\nThe ES5 errata are obsolete and do not apply to the ES5.1 spec.\n\n> \n> in Errata P.5 and P.6\n> \n> statement of 15.11.1.1 and 15.11.2.1, \"Otherwise, the message own property is\n> set to the empty String.\" is removed.\n\nYes, this correction was made in ES5.1.  new Error objects that do not explicitly provide a (non-undefined) name or message value do not have corresponding own properties created for them.  They inherit those properties from Error.prototype where their default values are \"Error\" and \"\".\n\n> \n> And 15.11.4.4 is modified to\n\nThe actual algorithm used in the ES5.1 spec is different from the algorithm given in the Errata but the results should be the same.\n\n   (new Error(undefined)).toString() \n\nshould produce \"Error\" because that is normally the value of the name property that is inherited from Error.prototype.\n\nHowever, this logic is only correct if the values of the name and message properties of have Error.prototype have not been modified (or deleted).  That probably need to be a precondition of this test.  If such tests don't already exist, there should also be tests that ensure that such modification actually produce correct output according to 15.11.4.4."},{"commentid":591,"comment_count":5,"who":{"uid":"utatane.tea","name":"Yusuke Suzuki"},"bug_when":"2012-01-12 12:35:56 -0800","thetext":">> The ES5 errata are obsolete and do not apply to the ES5.1 spec.\nOh, I didn't know this.\n\nNow I see. I understood that this test case is actually correct.\nThank you for your clarification."}],"attachment":[{"_attributes":{"isobsolete":"0","ispatch":"0"},"attachid":"6","date":"2011-10-20 09:53:00 -0700","delta_ts":"2011-10-20 09:53:23 -0700","desc":"patch for 15.11.4.4-8-2","filename":"res2.patch","type":"application/octet-stream","size":"683","attacher":{"_attributes":{"name":"Yusuke Suzuki"},"_text":"utatane.tea"},"data":{"_attributes":{"encoding":"base64"},"_text":"ZGlmZiAtLWdpdCBhL3Rlc3Qvc3VpdGUvY2hhcHRlcjE1LzE1LjExLzE1LjExLjQvMTUuMTEuNC40\nLzE1LjExLjQuNC04LTIuanMgYi90ZXN0L3N1aXRlL2NoYXB0ZXIxNS8xNS4xMS8xNS4xMS40LzE1\nLjExLjQuNC8xNS4xMS40LjQtOC0yLmpzCi0tLSBhL3Rlc3Qvc3VpdGUvY2hhcHRlcjE1LzE1LjEx\nLzE1LjExLjQvMTUuMTEuNC40LzE1LjExLjQuNC04LTIuanMKKysrIGIvdGVzdC9zdWl0ZS9jaGFw\ndGVyMTUvMTUuMTEvMTUuMTEuNC8xNS4xMS40LjQvMTUuMTEuNC40LTgtMi5qcwpAQCAtMjIsMTEg\nKzIyLDExIEBACiAgKiBAcGF0aCBjaGFwdGVyMTUvMTUuMTEvMTUuMTEuNC8xNS4xMS40LjQvMTUu\nMTEuNC40LTgtMi5qcwogICogQGRlc2NyaXB0aW9uIEVycm9yLnByb3RvdHlwZS50b1N0cmluZyBy\nZXR1cm4gZW1wdHkgc3RyaW5nIHdoZW4gJ25hbWUnIGlzIGVtcHR5IHN0cmluZyBhbmQgJ21zZycg\naXMgdW5kZWZpbmVkCiAgKi8KIAogCiBmdW5jdGlvbiB0ZXN0Y2FzZSgpIHsKICAgICAgICAgdmFy\nIGVyck9iaiA9IG5ldyBFcnJvcigpOwogICAgICAgICBlcnJPYmoubmFtZSA9ICIiOwotICAgICAg\nICByZXR1cm4gZXJyT2JqLnRvU3RyaW5nKCkgPT09ICIiOworICAgICAgICByZXR1cm4gZXJyT2Jq\nLnRvU3RyaW5nKCkgPT09ICJFcnJvciI7CiAgICAgfQogcnVuVGVzdENhc2UodGVzdGNhc2UpOwo=\n"}}]}}
---
