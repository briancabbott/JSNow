---
{"_attributes":{"version":"4.4.4+","urlbase":"https://bugs.ecmascript.org/","maintainer":"dherman@mozilla.com"},"bug":{"bug_id":2166,"creation_ts":"2013-11-02 03:23:00 -0700","short_desc":"23.3.3.1, 23.4.3.2: Use the same approach to clear WeakMap/WeakSet","delta_ts":"2013-11-08 13:08:46 -0800","product":"Draft for 6th Edition","component":"technical issue","version":"Rev 20: October 28, 2013 Draft","rep_platform":"All","op_sys":"All","bug_status":"RESOLVED","resolution":"FIXED","priority":"Normal","bug_severity":"enhancement","everconfirmed":true,"reporter":{"uid":"andrebargull","name":"André Bargull"},"assigned_to":{"uid":"allen","name":"Allen Wirfs-Brock"},"long_desc":[{"commentid":6367,"comment_count":0,"who":{"uid":"andrebargull","name":"André Bargull"},"bug_when":"2013-11-02 03:23:01 -0700","thetext":"23.3.3.1 WeakMap.prototype.clear (), step 5:\n23.4.3.2 WeakSet.prototype.clear (), steps 5-6:\n\nWeakMap simply reassigns [[WeakMapData]] to a new empty List, whereas WeakSet iterates over all entries of [[WeakSetData]] to manually set the value to `empty`. This should be changed to use a single approach."},{"commentid":6401,"comment_count":1,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2013-11-02 17:28:26 -0700","thetext":"they are different because Maps are Iterable and WeakMaps are not.  When a map is cleared, there may be existing MapIterators that have not completed.  This form of clearing and the explicit indexing in the Map.iterator next ensures that what happens in this case is well defined.\n\nI think I'll put a not in Map.prototype.clear explaining some of this"},{"commentid":6404,"comment_count":2,"who":{"uid":"andrebargull","name":"André Bargull"},"bug_when":"2013-11-03 01:34:08 -0800","thetext":"Re-opening:\nNeither WeakMap [1] nor WeakSet [2] is iterable, so the justification for bug 1157 does not apply here. \n\n[1] https://people.mozilla.org/~jorendorff/es6-draft.html#sec-weakmap.prototype.clear\n[2] https://people.mozilla.org/~jorendorff/es6-draft.html#sec-weakset.prototype.clear"},{"commentid":6405,"comment_count":3,"who":{"uid":"andrebargull","name":"André Bargull"},"bug_when":"2013-11-03 01:38:09 -0800","thetext":"This bug is only about the difference for clear() in WeakMap compared to WeakSet. The clear() method for normal Map and Set must not be changed for exactly the reason you've given."},{"commentid":6406,"comment_count":4,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2013-11-03 08:46:05 -0800","thetext":"go it\n\nfixed in rev21 editor's draft"},{"commentid":6509,"comment_count":5,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2013-11-08 13:08:46 -0800","thetext":"fixed in rev21 draft"}]}}
---
