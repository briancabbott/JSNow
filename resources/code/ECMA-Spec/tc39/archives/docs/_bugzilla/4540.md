---
{"_attributes":{"version":"4.4.4+","urlbase":"https://bugs.ecmascript.org/","maintainer":"dherman@mozilla.com"},"bug":{"bug_id":4540,"creation_ts":"2015-09-24 05:34:00 -0700","short_desc":"Completion reform is incomplete","delta_ts":"2015-10-23 14:29:55 -0700","product":"ECMA-262 Edition 6","component":"technical issues","version":"unspecified","rep_platform":"All","op_sys":"All","bug_status":"RESOLVED","resolution":"FIXED","priority":"Normal","bug_severity":"enhancement","everconfirmed":true,"reporter":{"uid":"rossberg","name":"Andreas Rossberg"},"assigned_to":{"uid":"allen","name":"Allen Wirfs-Brock"},"cc":["brterlso","rossberg"],"long_desc":[{"commentid":14705,"comment_count":0,"who":{"uid":"rossberg","name":"Andreas Rossberg"},"bug_when":"2015-09-24 05:34:06 -0700","thetext":"Completion values have not been reformed properly for `if` and `with` statements:\n\n- 13.6.7 step 6: The ReturnIfAbrupt will not replace the empty value of a `break` completion with undefined.\n\n- 13.11.7 step 10: This only replaces the empty value of a `normal` completion, but not of a `break`.\n\nConsequently, examples like the following still have dynamic behaviour:\n\n  666;\n  l: if (condition) {\n    42; break l;\n  } else {\n    break l;\n  }\n  // completion value here is 666 if condition is false; should be undefined\n\n  666;\n  l: with ({}) {\n    break l;\n  }\n  // completion value is 666, not undefined\n\nThe spec seems correct for all other statements, e.g.\n\n  666;\n  while (true) {\n    break;\n  }\n  // completion value is undefined"},{"commentid":14707,"comment_count":1,"who":{"uid":"rossberg","name":"Andreas Rossberg"},"bug_when":"2015-09-24 05:42:37 -0700","thetext":"Closely related bug: https://bugs.ecmascript.org/show_bug.cgi?id=4541"},{"commentid":14860,"comment_count":2,"who":{"uid":"brterlso","name":"Brian Terlson"},"bug_when":"2015-10-23 14:29:55 -0700","thetext":"Fixed in ES2016 Draft."}]}}
---
