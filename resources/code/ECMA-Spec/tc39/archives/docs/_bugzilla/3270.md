---
{"_attributes":{"version":"4.4.4+","urlbase":"https://bugs.ecmascript.org/","maintainer":"dherman@mozilla.com"},"bug":{"bug_id":3270,"creation_ts":"2014-10-08 12:17:00 -0700","short_desc":"24.1.1.5 CloneArrayBuffer: Steps 5-10 should be reordered for clarity","delta_ts":"2014-10-14 15:18:03 -0700","product":"Draft for 6th Edition","component":"technical issue","version":"Rev 27: August 24, 2014 Draft","rep_platform":"All","op_sys":"All","bug_status":"RESOLVED","resolution":"FIXED","priority":"Normal","bug_severity":"enhancement","everconfirmed":true,"reporter":{"uid":"andrebargull","name":"André Bargull"},"assigned_to":{"uid":"allen","name":"Allen Wirfs-Brock"},"long_desc":[{"commentid":10295,"comment_count":0,"who":{"uid":"andrebargull","name":"André Bargull"},"bug_when":"2014-10-08 12:17:38 -0700","thetext":"24.1.1.5 CloneArrayBuffer( srcBuffer, srcByteOffset )\n\n\nSteps 5, 8-9 and steps 6-7, 10 should be moved closer together, so it's easier to understand which step needs to be executed first (step 5 needs to appear before step 6 in case step 6 detaches the array buffer, otherwise the assertion in step 8 does not hold; Alternatively step 5 needs to appear after step 6 and step 13).\n\nSuggested reorder:\n---\n5.  Let bufferConstructor be Get(srcBuffer, \"constructor\").\n6.  ReturnIfAbrupt(bufferConstructor).\n7.  If bufferConstructor is undefined, then let bufferConstructor be %ArrayBuffer%.\n8.  Let targetBuffer be AllocateArrayBuffer(bufferConstructor).\n9.  NOTE: Side-effects of the above steps may have detached srcBuffer.\n10.  If IsDetachedBuffer(srcBuffer) is true, then throw a TypeError exception.\n11.  Let srcBlock be the value of srcBuffer’s [[ArrayBufferData]] internal slot.\n12.  Let srcLength be the value of srcBuffer’s [[ArrayBufferByteLength]] internal slot.\n13.  Assert: srcByteOffset ≤ srcLength.\n14.  Let cloneLength be srcLength – srcByteOffset.\n15.  Let status be SetArrayBufferData(targetBuffer, cloneLength).\n16.  ReturnIfAbrupt(status).\n---"},{"commentid":10303,"comment_count":1,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2014-10-08 17:16:47 -0700","thetext":"fixed in rev28 editor's draft"},{"commentid":10488,"comment_count":2,"who":{"uid":"allen","name":"Allen Wirfs-Brock"},"bug_when":"2014-10-14 15:18:03 -0700","thetext":"fixed in rev28"}]}}
---
