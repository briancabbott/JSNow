<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [antlr-interest] [SPAM] ANTLR PHP target / runtime status
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:antlr-interest%40antlr.org?Subject=Re:%20%5Bantlr-interest%5D%20%5BSPAM%5D%20ANTLR%20PHP%20target%20/%20runtime%20status&In-Reply-To=%3C4EF2ED41C97D44228B8039ACC0B2A048%40KenPC%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="042631.html">
   <LINK REL="Next"  HREF="042628.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[antlr-interest] [SPAM] ANTLR PHP target / runtime status</H1>
    <B>Kenneth Domino</B> 
    <A HREF="mailto:antlr-interest%40antlr.org?Subject=Re:%20%5Bantlr-interest%5D%20%5BSPAM%5D%20ANTLR%20PHP%20target%20/%20runtime%20status&In-Reply-To=%3C4EF2ED41C97D44228B8039ACC0B2A048%40KenPC%3E"
       TITLE="[antlr-interest] [SPAM] ANTLR PHP target / runtime status">kenneth.domino at domemtech.com
       </A><BR>
    <I>Thu Sep  8 14:16:19 PDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="042631.html">[antlr-interest] Allowing and maintaining space characters in	string literals
</A></li>
        <LI>Next message: <A HREF="042628.html">[antlr-interest] Sample automatic visitor
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#42627">[ date ]</a>
              <a href="thread.html#42627">[ thread ]</a>
              <a href="subject.html#42627">[ subject ]</a>
              <a href="author.html#42627">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi All,

I updated the PHP target to work with Antlr 3.4/PHP 5.3.  This code is 
available at <A HREF="http://domemtech.com/code/antlrphpruntime.zip">http://domemtech.com/code/antlrphpruntime.zip</A> for the next 
month or so, until it&#8212;hopefully&#8212;finds a permanent location. I plan on making 
more changes when I start rewriting the runtime tests for the target and 
figuring out what in the world is going on with this target.

NOTE: Someone needs to take control of this mess, delete the many forked 
copies of this target, and put this in one official location.  The 
development of this target is absolutely atrocious.  This code is not in one 
repository, but at least four.  I really do not understand why people cannot 
make private repositories on their machines instead of proliferating 
multiple public repositories.  It is not easy figuring out who made what 
change when, why, and are those changes useful.  There may be more forked 
copies of the PHP runtime out in the wild, but who knows.

For better or worse, I chose code base #3 listed below for development, and 
made a copy of that onto my machine.  The reason I chose that code base was 
because the author sent a cogent email explaining his changes, and because 
it was changed more recently than any of the other code bases.


WHERE IS ANTLR PHP LOCATED?

Here are the four different repositories:

(1) <A HREF="http://antlrphpruntime.googlecode.com">http://antlrphpruntime.googlecode.com</A> 
(<A HREF="http://code.google.com/p/antlrphpruntime/">http://code.google.com/p/antlrphpruntime/</A> ) &#8211; SVN.

This code is officially anointed in the Antlr targets web page 
<A HREF="http://www.antlr.org/wiki/display/ANTLR3/Code+Generation+Targets">http://www.antlr.org/wiki/display/ANTLR3/Code+Generation+Targets</A> as &#8220;the one 
and only PHP target&#8221;.  It isn&#8217;t clear what Antlr version or PHP version this 
code targets.

This code was last changed on June 19, 2010 (code) by Eugeny Yakimovitch. 
Several other unimportant changes were made more recently (e.g., June 26, 
2011).


(2) <A HREF="https://github.com/rollxx/antlr-php-runtime">https://github.com/rollxx/antlr-php-runtime</A> &#8211; GIT

This code was probably forked from (1), but since there are no embedded 
version ids in the source code, I can&#8217;t tell you what was done.

The code was last changed March 21, 2010 by rollex.  At the top of the page, 
the author says:
&#8220;This version in not maintained. Please visit the main project page listed 
below for the current version &#8220;, and gives a link to (1).

Unfortunately, it&#8217;s hard to say whether the changes were successfully merged 
back into (1), but there are check ins in late March by rollex to (1).


(3) <A HREF="https://github.com/beberlei/antlr-php-runtime">https://github.com/beberlei/antlr-php-runtime</A> &#8211; GIT.

Benjamin Eberlei noted in an email to the &#8220;Antlr Interest&#8221; and &#8220;Antlr dev&#8221; 
lists 
(<A HREF="http://markmail.org/message/zbdc2ni3mfjioens#query:+page:1+mid:zbdc2ni3mfjioens+state:results">http://markmail.org/message/zbdc2ni3mfjioens#query:+page:1+mid:zbdc2ni3mfjioens+state:results</A> 
<A HREF="http://www.antlr.org/pipermail/antlr-interest/2010-September/039653.html">http://www.antlr.org/pipermail/antlr-interest/2010-September/039653.html</A> 
<A HREF="http://markmail.org/message/v7wq2a6wvsjlwl4n">http://markmail.org/message/v7wq2a6wvsjlwl4n</A>  ) that development of the 
source code in (1) was halted since Feb 2010. Eberlei modified this code to 
fix several bugs and improve on the quality of the code and checked it in.

This repository was forked from (2) (unclear when), and last modified in 
September 2010 by beberbei.


(4) <A HREF="http://code.google.com/p/phpandallthat/">http://code.google.com/p/phpandallthat/</A> &#8211; SVN.

Eugeny.Yakimovitch, who is on the list of developers for (1), has an unknown 
fork of (1) that is yet another implementation of the PHP runtime.

The latest changes to that source code was in September 10, 2010. Great!


NOTE: As far as I know, there is no PHP target listed in the Fisheye view of 
the Antlr repository (linked via <A HREF="http://antlr.org">http://antlr.org</A>).


DISCUSSIONS ON THE PHP TARGET:

* Aug 30, 2011 <A HREF="http://markmail.org/message/73fo5jg5a36qhv5p">http://markmail.org/message/73fo5jg5a36qhv5p</A>
* May 30, 2011 
<A HREF="http://www.antlr.org/pipermail/antlr-interest/2011-May/041725.html">http://www.antlr.org/pipermail/antlr-interest/2011-May/041725.html</A>
* Sep 6/8, 2010 <A HREF="http://markmail.org/message/zbdc2ni3mfjioens">http://markmail.org/message/zbdc2ni3mfjioens</A> 
<A HREF="http://markmail.org/message/v7wq2a6wvsjlwl4n">http://markmail.org/message/v7wq2a6wvsjlwl4n</A>
* May 6, 2010 <A HREF="http://www.antlr.org/pipermail/antlr-dev/2009-May/002292.html">http://www.antlr.org/pipermail/antlr-dev/2009-May/002292.html</A>
* Oct 9, 2009 <A HREF="http://markmail.org/message/ewmppl7u4b3jnwgh">http://markmail.org/message/ewmppl7u4b3jnwgh</A>


WHAT CHANGES DID I MAKE TO ANTLR PHP?

Most of my changes are in Php.stg, to move it forward to Antlr 3.4, and to 
handle lexers with semantic rules, like this grammar:


lexer grammar BigParLexer;


options {
   backtrack = true;
   filter = true;
}


@members{
   int open = 0;
}


P
@init{open = 1;}
   :
   '/*'
   (
      {open &gt; 0}?=&gt; // keep reapeating `( ... )*` as long as open &gt; 0
         ( ( { !((input.LA(1) == '/' &amp;&amp; input.LA(2) == '*') || (input.LA(1) 
== '*' &amp;&amp; input.LA(2) == '/')) }?=&gt; . ) // match anything other than 
delimiters.
         | '/*' {open++;}
         | '*/' {open--;}
      )
   )*
   ;

The lexer for this grammar accepts input like &#8216;/* hi /* there */ */&#8217; as one 
token.  NB: this grammar doesn&#8217;t work exactly as written for the PHP target, 
as I explain below.

* Rolled changes from Java.stg, Revision ID: 8204, into Php.stg. The link to 
the code for Java.stg used in the modification of Php.stg is: 
<A HREF="https://fisheye2.atlassian.com/browse/antlr/tool/src/main/resources/org/antlr/codegen/templates/Java/Java.stg">https://fisheye2.atlassian.com/browse/antlr/tool/src/main/resources/org/antlr/codegen/templates/Java/Java.stg</A>
* Fixed problems with backtracking.
* Fixed missing $input declaration for semantic predicates.
* Fixed missing &#8216;$&#8217; for &#8216;alt...&#8217; state variables in DFA generated code.
* Added a makefile to constuct antlr.jar.  I could not find any &#8220;build.xml&#8221; 
file anywhere.  And, I cannot stand Ant.


WHAT DOES NOT WORK?

Not all the tests in .../runtime/Php/test/Antlr/Tests work.  Many of these 
are terrible test cases, some of which cause the Antlr tool to output 
warnings, and others that crash the tool altogether.

I don't know the status of AST construction, tree parsing, etc.  There is 
code for tree construction, but I haven't tested it.


WHAT DON'T I LIKE ABOUT THE PHP TARGET?

* PHP does not automatically convert an integer into a string and vice versa 
for tests; variables must be preceded with &#8220;$&#8221;; and &#8220;?&gt;&#8221; ends PHP code even 
in a comment.
Input streams in Antlr are composed of integers, not characters. 
&#8220;input-&gt;LA()&#8221; returns a number.  When you want to test the lookahead in a 
semantic predicate, you must convert the character you are testing into a 
number, or convert LA() into a string.  So, in the above grammar 
BigParLexer, &#8220;input.LA(1) == &#8216;/&#8217;&#8221; won&#8217;t work&#8212;and PHP won&#8217;t complain!  It 
must be converted to a target-specific syntax, e.g., &#8220;\$input-&gt;LA(1) == 47&#8221;.

* In the wisdom of the developers of PHP, &#8220;?&gt;&#8221; ends the PHP code section 
even if it is on a comment line.

e.g., &#8220;// you are screwed ?&gt; boo hoo.&#8221;

Consequently, some of the templates in Php.stg are missing code to generate 
descriptions in comments.  If the grammar contains &#8220;?&gt;&#8221;, as in some of the 
test cases, PHP will barf on the generated code.  There must be a way to 
convert the description into a PHP safe format, but I don&#8217;t know what that 
would be.

* THERE IS NO DOCUMENTATION!


WHAT DO I LIKE ABOUT THE PHP TARGET?

PHP does not have a &#8220;64K byte code per method limit&#8221; as in Java.  When 
writing a lexer grammar with semantic predicates, it seems extremely easy to 
generate Java code that will not compile (e.g., BitParLexer.g but with 
delimiters with more characters, e.g., &#8220;&lt;script&gt; .... &lt;/script&gt;&#8221;.  But, PHP 
works!


Ken Domino

</PRE>



















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="042631.html">[antlr-interest] Allowing and maintaining space characters in	string literals
</A></li>
	<LI>Next message: <A HREF="042628.html">[antlr-interest] Sample automatic visitor
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#42627">[ date ]</a>
              <a href="thread.html#42627">[ thread ]</a>
              <a href="subject.html#42627">[ subject ]</a>
              <a href="author.html#42627">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://www.antlr.org/mailman/listinfo/antlr-interest">More information about the antlr-interest
mailing list</a><br>
</body></html>
