<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [antlr-interest] greedy subrule option idiom
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:antlr-interest%40antlr.org?Subject=Re:%20%5Bantlr-interest%5D%20greedy%20subrule%20option%20idiom&In-Reply-To=%3C4C0009A9.2010409%40junkwallah.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="038830.html">
   <LINK REL="Next"  HREF="038813.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[antlr-interest] greedy subrule option idiom</H1>
    <B>Junkman</B> 
    <A HREF="mailto:antlr-interest%40antlr.org?Subject=Re:%20%5Bantlr-interest%5D%20greedy%20subrule%20option%20idiom&In-Reply-To=%3C4C0009A9.2010409%40junkwallah.org%3E"
       TITLE="[antlr-interest] greedy subrule option idiom">j at junkwallah.org
       </A><BR>
    <I>Fri May 28 11:21:29 PDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="038830.html">[antlr-interest] greedy subrule option idiom
</A></li>
        <LI>Next message: <A HREF="038813.html">[antlr-interest] Ambiguous grammar
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#38838">[ date ]</a>
              <a href="thread.html#38838">[ thread ]</a>
              <a href="subject.html#38838">[ subject ]</a>
              <a href="author.html#38838">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Here is another variation of the grammar:

------------------

grammar Test;

fragment
CHAR	:	'\u0000'..'#' | '$'..'\uffff' ;

STRING	:	'##' ( options {greedy=false;} : CHAR )* '##' ;

stmt	:	
	( . )+
	;


--------------------

This generates grammar check error just like the one in my previous post
(attached at the bottom).

The error goes away if I pull the character '#' out of CHAR and inline
it into STRING with '|' operator next to CHAR like this:

--------------------

grammar Test;

fragment
CHAR	:	'\u0000'..'&quot;' | '$'..'\uffff' ;

STRING	:	'##' ( options {greedy=false;} : CHAR | '#' )* '##' ;

stmt	:	
	( . )+
	;

---------------------

Looks like the DFA needs '#' at the top level of the greedy subrule
because the character also match the beginning of the exit branch (and
hence require more lookahead to decide).

I'd like to know if this is known (and consistent) behavior.  Or perhaps
I'm way off because I missed something very basic in the grammars above.

I did a quick search of the list archive using the MarkMail link Jim
provided, and did find a recent thread on non-greedy loop, but it
concerns suggestion for v4 and not sure it's directly applicable to this
question.

Sorry if it seems like I'm beating a dead horse.  Being a noob makes me
want to dot every i and j twice.

Junkman wrote:
&gt;<i> Hello,
</I>&gt;<i> 
</I>&gt;<i> The following grammar generates error:
</I>&gt;<i> 
</I>&gt;<i> ---------------------
</I>&gt;<i> grammar Test;
</I>&gt;<i> 
</I>&gt;<i> fragment
</I>&gt;<i> CHAR	:	. ;
</I>&gt;<i> 
</I>&gt;<i> STRING	:	'&quot;' ( options {greedy=false;} : CHAR )* '&quot;' ;
</I>&gt;<i> 
</I>&gt;<i> stmt	:	
</I>&gt;<i> 	( . )+
</I>&gt;<i> 	;
</I>&gt;<i> 
</I>&gt;<i> ---------------------
</I>&gt;<i> 
</I>&gt;<i> The error message generated by &quot;Check Grammar&quot; option of Antlrwork (1.4) is:
</I>&gt;<i> 
</I>&gt;<i> [15:34:52] error(201): Test.g:6:47: The following alternatives can never
</I>&gt;<i> be matched: 2
</I>&gt;<i> 
</I>&gt;<i> I think it means it cannot exit the non-greedy subrule (of the lexer
</I>&gt;<i> rule STRING).
</I>&gt;<i> 
</I>&gt;<i> If I substitute &quot;.&quot; directly for &quot;CHAR&quot;, no error.
</I>&gt;<i> 
</I>&gt;<i> Is this the expected behavior?  Is there a problem with the grammar
</I>&gt;<i> given above?
</I>&gt;<i> 
</I>&gt;<i> Thanks for any insight/assistance.
</I>&gt;<i> 
</I>&gt;<i> J
</I>&gt;<i> 
</I>&gt;<i> Junkman wrote:
</I>&gt;&gt;<i> Hello,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Following is a lexer rule to match quoted string that allows backslash
</I>&gt;&gt;<i> escape sequence.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> STRING
</I>&gt;&gt;<i> 	: 	 '&quot;' ( options {greedy=false;} : ( ~ '\\' | '\\' . ) )* '&quot;'
</I>&gt;&gt;<i> 	;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> It seems to work.  But if you put the '*' operator inside the subrule
</I>&gt;&gt;<i> like this:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> STRING
</I>&gt;&gt;<i> 	: 	 '&quot;' ( options {greedy=false;} : ( ~ '\\' | '\\' . )* ) '&quot;'
</I>&gt;&gt;<i> 	;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> It eats up everything to EOF.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> It's as if the greedy option applies to the ((subrule)*) instead of the
</I>&gt;&gt;<i> subrule itself, and only if the subrule is suffixed with '*' operator
</I>&gt;&gt;<i> (or with '+') externally (as in (subrule)*).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> To my eyes, the second version seems the &quot;correct&quot; one.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thoughts?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> J
</I>&gt;&gt;<i>
</I>&gt;<i> 
</I>&gt;<i> 
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="038830.html">[antlr-interest] greedy subrule option idiom
</A></li>
	<LI>Next message: <A HREF="038813.html">[antlr-interest] Ambiguous grammar
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#38838">[ date ]</a>
              <a href="thread.html#38838">[ thread ]</a>
              <a href="subject.html#38838">[ subject ]</a>
              <a href="author.html#38838">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://www.antlr.org/mailman/listinfo/antlr-interest">More information about the antlr-interest
mailing list</a><br>
</body></html>
