<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [antlr-interest] Relaxed number format lexer problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:antlr-interest%40antlr.org?Subject=Re:%20%5Bantlr-interest%5D%20Relaxed%20number%20format%20lexer%20problem&In-Reply-To=%3Cebc876d70904221124i5e15de75y38d7b0928399d6c0%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="034146.html">
   <LINK REL="Next"  HREF="034145.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[antlr-interest] Relaxed number format lexer problem</H1>
    <B>Thomas Brandon</B> 
    <A HREF="mailto:antlr-interest%40antlr.org?Subject=Re:%20%5Bantlr-interest%5D%20Relaxed%20number%20format%20lexer%20problem&In-Reply-To=%3Cebc876d70904221124i5e15de75y38d7b0928399d6c0%40mail.gmail.com%3E"
       TITLE="[antlr-interest] Relaxed number format lexer problem">tbrandonau at gmail.com
       </A><BR>
    <I>Wed Apr 22 11:24:01 PDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="034146.html">[antlr-interest] Relaxed number format lexer problem
</A></li>
        <LI>Next message: <A HREF="034145.html">[antlr-interest] Building antlr3
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34147">[ date ]</a>
              <a href="thread.html#34147">[ thread ]</a>
              <a href="subject.html#34147">[ subject ]</a>
              <a href="author.html#34147">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, Apr 23, 2009 at 2:40 AM, Sam Harwell
&lt;<A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">sharwell at pixelminegames.com</A>&gt; wrote:
&gt;<i> I&#8217;m using a heavily relaxed NUMBER token in my lexer so I can provide better
</I>&gt;<i> error messages. The problem I&#8217;m having occurs when input such as 1..2 is
</I>&gt;<i> reached. The '..' should be an OP_RANGE token, not part of the number.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> NUMBER
</I>&gt;<i>
</I>&gt;<i> @after
</I>&gt;<i>
</I>&gt;<i> {
</I>&gt;<i>
</I>&gt;<i> ClassifyNumber($text);
</I>&gt;<i>
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160; :&#160;&#160;&#160;&#160;&#160;&#160; '.'? '0'..'9'
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (&#160;&#160;&#160;&#160;&#160;&#160; // &lt;-- It throws a NoViableAltException at this
</I>&gt;<i> decision when next the input is '..'
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160;&#160;&#160;&#160; (&#160;&#160;&#160;&#160;&#160;&#160; '0'..'9'
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; |&#160;&#160;&#160;&#160;&#160;&#160; 'a'..'d'
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; |&#160;&#160;&#160;&#160;&#160;&#160; 'f'..'z'
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; |&#160;&#160;&#160;&#160;&#160;&#160; 'A'..'D'
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; |&#160;&#160;&#160;&#160;&#160;&#160; 'F'..'Z'
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; |&#160;&#160;&#160;&#160;&#160;&#160; ('.' ~'.') =&gt; '.'
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; )
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; |&#160;&#160;&#160;&#160;&#160;&#160; ('e' | 'E')
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (&#160;&#160;&#160;&#160;&#160;&#160; ('+'|'-') =&gt; ('+' | '-')?
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160;&#160;&#160;&#160; '0'..'9'
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; )?
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; )*
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160; ;
</I>&gt;<i>
</I>I think the problem is that as there is no syntactic ambiguity ANTLR
won't hoist your &quot;('.' ~'.') =&gt;&quot; into the choice between the  &quot;(
'0'..'9' | 'a'..'d' | 'f'..'z' | 'A'..'D' | 'F'..'Z' | ('.' ~'.') =&gt;
'.'  )&quot; block and the exponent block. Hence on seeing a '.' ANTLR
enters the first alternate and then as something must match in the
required sub-block here ANTLR throws a NoViableAlt when it doesn't.

Changing the predicate to a gated semantic predicate (&quot;{ input.LA(2)
!= '.'}=&gt;&quot;) forces it to be hoisted and resolves the problem.

Alternately, removing the sub-block so you have:
NUMBER
@after
{
ClassifyNumber($text);
}
        :       '.'? '0'..'9'
                (       '0'..'9'
                |       'a'..'d'
                |       'f'..'z'
                |       'A'..'D'
                |       'F'..'Z'
                |       ( '.' ~'.' )=&gt; '.'
                |       ('e' | 'E')
                        (       ('+'|'-') =&gt; ('+' | '-')?
                                '0'..'9'
                        )?
                )*
        ;
also fixes it without introducing a semantic predicate which you
didn't want. Though now you couldn't have actions on the non-exponent
block if that was your intent for the sub-block.

I don't think this is an error, it's just that syntactic predicates
aren't hoisted. Gated syntactic predicates would solve this. In this
case the semantic predicate is simple enough and it is only your
desire to not use one that goes against it but in other cases
converting to a semantic predicate could be trickier. Though I can't
see there being that many cases where you'd want to syntactically
disambiguate a (according to ANTLR) non-syntactically ambiguous
decision.

Tom.
&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thank you,
</I>&gt;<i>
</I>&gt;<i> Sam Harwell
</I>&gt;<i>
</I>&gt;<i> List: <A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">http://www.antlr.org/mailman/listinfo/antlr-interest</A>
</I>&gt;<i> Unsubscribe:
</I>&gt;<i> <A HREF="http://www.antlr.org/mailman/options/antlr-interest/your-email-address">http://www.antlr.org/mailman/options/antlr-interest/your-email-address</A>
</I>&gt;<i>
</I>&gt;<i>
</I></PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="034146.html">[antlr-interest] Relaxed number format lexer problem
</A></li>
	<LI>Next message: <A HREF="034145.html">[antlr-interest] Building antlr3
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34147">[ date ]</a>
              <a href="thread.html#34147">[ thread ]</a>
              <a href="subject.html#34147">[ subject ]</a>
              <a href="author.html#34147">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://www.antlr.org/mailman/listinfo/antlr-interest">More information about the antlr-interest
mailing list</a><br>
</body></html>
