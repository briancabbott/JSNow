<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [antlr-interest] Triggering a lexical &quot;include&quot; from the parser
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:antlr-interest%40antlr.org?Subject=Re:%20%5Bantlr-interest%5D%20Triggering%20a%20lexical%20%22include%22%20from%20the%20parser&In-Reply-To=%3CCAJ3AhhW4jn3NTmSxi7cZ8EXrb%3DevWD4CW%2B-%2BqBen-WqDEjTnXw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="045117.html">
   <LINK REL="Next"  HREF="045119.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[antlr-interest] Triggering a lexical &quot;include&quot; from the parser</H1>
    <B>Jesse McGrew</B> 
    <A HREF="mailto:antlr-interest%40antlr.org?Subject=Re:%20%5Bantlr-interest%5D%20Triggering%20a%20lexical%20%22include%22%20from%20the%20parser&In-Reply-To=%3CCAJ3AhhW4jn3NTmSxi7cZ8EXrb%3DevWD4CW%2B-%2BqBen-WqDEjTnXw%40mail.gmail.com%3E"
       TITLE="[antlr-interest] Triggering a lexical &quot;include&quot; from the parser">jmcgrew at hansprestige.com
       </A><BR>
    <I>Fri Aug 24 12:53:39 PDT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="045117.html">[antlr-interest] Problem to build AST (kind of reverse AST)
</A></li>
        <LI>Next message: <A HREF="045119.html">[antlr-interest] Keeping AST state between parsing and walker
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#45118">[ date ]</a>
              <a href="thread.html#45118">[ thread ]</a>
              <a href="subject.html#45118">[ subject ]</a>
              <a href="author.html#45118">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi all, I posted this question to StackOverflow
(<A HREF="http://stackoverflow.com/questions/12104324/how-can-my-antlr-parser-not-lexer-trigger-a-lexical-include-not-ast-splice">http://stackoverflow.com/questions/12104324/how-can-my-antlr-parser-not-lexer-trigger-a-lexical-include-not-ast-splice</A>)
but I'd appreciate your input on it too, either here or over there...

The ANTLR website describes two approaches
(<A HREF="http://www.antlr.org/wiki/pages/viewpage.action?pageId=557057">http://www.antlr.org/wiki/pages/viewpage.action?pageId=557057</A>) to
implementing &quot;include&quot; directives. The first approach is to recognize
the directive in the lexer and include the file lexically (by pushing
the CharStream onto a stack and replacing it with one that reads the
new file); the second is to recognize the directive in the parser,
launch a sub-parser to parse the new file, and splice in the AST
generated by the sub-parser. Neither of these are quite what I need.

In the language I'm parsing, recognizing the directive in the lexer is
impractical for a few reasons:

* There is no self-contained character pattern that always means &quot;this
is an include directive&quot;. For example, 'Include &quot;foo&quot;;' at top level
is an include directive, but in 'Array bar --&gt; Include &quot;foo&quot;;' or
'Constant Include &quot;foo&quot;;' the word 'Include' is an identifier.
* The name of the file to include may be given as a string or as a
constant identifier, and such constants can be defined with
arbitrarily complex expressions. (That is, the Constant directive in
general supports arbitrary expressions, as long as they can be
calculated at compile time, although there are no compile-time string
operators so in this specific case the expressions are either a quoted
string or another constant identifier.)

So I want to trigger the inclusion from the parser. But to perform the
inclusion, I can't launch a sub-parser and splice the AST together; I
have to splice the tokens. It's legal for a block to begin with '{' in
the main file and be terminated by '}' in the included file. A file
included inside a function can even close the function definition and
start a new one.

It seems like I'll need something like the first approach but at the
level of TokenStreams instead of CharStreams. Is that a viable
approach? How much state would I need to keep on the stack, and how
would I make the parser switch back to the original token stream
instead of terminating when it hits EOF? Or is there a better way to
handle this?

Here's an example of the language, demonstrating that blocks opened in
the main file can be closed in the included file (and vice versa).
Note that the '#' before 'Include' is required when the directive is
inside a function, but optional outside.

main.inf:

    [ Main;
      print &quot;This is Main!&quot;;
      if (0) {
      #include &quot;other.h&quot;;
      print &quot;This is OtherFunction!&quot;;
    ];

other.h:

      } ! end if
    ];  ! end Main

    [ OtherFunction;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="045117.html">[antlr-interest] Problem to build AST (kind of reverse AST)
</A></li>
	<LI>Next message: <A HREF="045119.html">[antlr-interest] Keeping AST state between parsing and walker
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#45118">[ date ]</a>
              <a href="thread.html#45118">[ thread ]</a>
              <a href="subject.html#45118">[ subject ]</a>
              <a href="author.html#45118">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://www.antlr.org/mailman/listinfo/antlr-interest">More information about the antlr-interest
mailing list</a><br>
</body></html>
