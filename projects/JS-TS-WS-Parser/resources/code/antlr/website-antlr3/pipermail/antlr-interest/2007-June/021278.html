<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [antlr-interest] Looping Lexer
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:antlr-interest%40antlr.org?Subject=Re:%20%5Bantlr-interest%5D%20Looping%20Lexer&In-Reply-To=%3Ca9cbce950706111657i3eb4d141sd4079c1071c54a79%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021280.html">
   <LINK REL="Next"  HREF="021279.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[antlr-interest] Looping Lexer</H1>
    <B>Stephen Gargan</B> 
    <A HREF="mailto:antlr-interest%40antlr.org?Subject=Re:%20%5Bantlr-interest%5D%20Looping%20Lexer&In-Reply-To=%3Ca9cbce950706111657i3eb4d141sd4079c1071c54a79%40mail.gmail.com%3E"
       TITLE="[antlr-interest] Looping Lexer">evilsteevil at gmail.com
       </A><BR>
    <I>Mon Jun 11 16:57:55 PDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="021280.html">[antlr-interest] Problem, with minimal problem-causing grammar
</A></li>
        <LI>Next message: <A HREF="021279.html">[antlr-interest] Looping Lexer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21278">[ date ]</a>
              <a href="thread.html#21278">[ thread ]</a>
              <a href="subject.html#21278">[ subject ]</a>
              <a href="author.html#21278">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I've been seeing a situation with Antlr and Antlrworks (1.0.2) and was
hoping someone could shed some light on it for me. I'm playing around with a
very simple grammar to familiarize myself with the concepts. When I try to
debug this grammar the Debugger fails to connect, the spawned debug process
doesn't terminate and takes over the system.

Having looked at the Antlr code generated by Antlrworks I have seen the
following. The __Test__.java file creates an instance of the lexer, uses the
lexer instance to create a CommonTokenStream and passes the this to the
parser to fill its buffer. At this stage the application goes into an
infinite loop requesting tokens from the lexer. The generated lexer is
broken and will either get stuck lexing a particular token (emitting
nothing) or (with slight modifications to the grammar) repeatedly emit the
same token.

The debug parser will not open its debug socket until after the buffer has
been filled leading to two outcomes. When the lexer repeatedly emits the
same token, the buffer in the Token stream will eventually fill up and an
OutOfMemory exception is generated. The spawned process ends, Antlrwoks will
try to connect to the finished process and eventually will fail.

The other case is worse though as the spawned process is left running,
spinning in its lexing loop, chewing up resources. Antlrworks cannot connect
and the spawned process is left hanging. Antlrworks could possibly mitigate
this by monitoring the spawned process and attempt to kill it if the
connection was unsuccessful.

The question remains though, what is wrong with my grammar that would cause
it to loop like this? It compiles fine, though that is not to say it is
valid ;), I'm new to all of this and would not be surprised if it were my
fault (indeed I'm hoping this is the case). Is there anything obviously
wrong in my grammar that would cause it to loop like this? If so is there
anything I should look for as tell-tale to avoid this problem? Might there
be a way for the lexer to know it is stuck in a loop and complain?

grammar simple;

paths    :     (path)*;
path    :    VOLUME | NAME NEWLINE;
VOLUME    :    'volume' NUMBER;
NAME    :    (WORD? WS?)*;
NUMBER    :     ('0'..'9')+ ;
WORD     :    ('a'..'z'|'A'..'Z'|'_')*;
WS     :     ( '\t' | ' ')+     { $channel = HIDDEN; } ;
NEWLINE :    '\r'? '\n' ;

The following snippet of code runs using the files generated by antlrworks
and gets stuck in the lexer. The test input is

volume1
this is a test volume2

public class LexerTest {

    public static void main(String[] args) throws Exception{
        simpleLexer lex = new simpleLexer(new
ANTLRFileStream(&quot;/tmp/antlrworks/__Test___input.txt&quot;));
        System.out.println(&quot;Created Lexer&quot;);

        Token t = null;
        do{
            t = lex.nextToken();
            System.out.println(t.toString());
        }
        while(t != null);

        System.out.println(&quot;done&quot;); // never gets here

    }
}


I am working on reproducing the grammar that caused the repeated emission of
the same token. I'll post again when I have failing this way again. Anyone
know what might be wrong?

Thanks in advance,

Stephen.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://www.antlr.org/pipermail/antlr-interest/attachments/20070611/49ab70fa/attachment.html">http://www.antlr.org/pipermail/antlr-interest/attachments/20070611/49ab70fa/attachment.html</A> 
</PRE>



































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021280.html">[antlr-interest] Problem, with minimal problem-causing grammar
</A></li>
	<LI>Next message: <A HREF="021279.html">[antlr-interest] Looping Lexer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21278">[ date ]</a>
              <a href="thread.html#21278">[ thread ]</a>
              <a href="subject.html#21278">[ subject ]</a>
              <a href="author.html#21278">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://www.antlr.org/mailman/listinfo/antlr-interest">More information about the antlr-interest
mailing list</a><br>
</body></html>
