<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [antlr-interest] Problem with $type in final ANTLR 3.0
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:antlr-interest%40antlr.org?Subject=Re:%20%5Bantlr-interest%5D%20Problem%20with%20%24type%20in%20final%20ANTLR%203.0&In-Reply-To=%3C051466DAA0D608439E196797955018D76DF9%40wavemachine.temporal-wave.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021579.html">
   <LINK REL="Next"  HREF="021605.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[antlr-interest] Problem with $type in final ANTLR 3.0</H1>
    <B>Jim Idle</B> 
    <A HREF="mailto:antlr-interest%40antlr.org?Subject=Re:%20%5Bantlr-interest%5D%20Problem%20with%20%24type%20in%20final%20ANTLR%203.0&In-Reply-To=%3C051466DAA0D608439E196797955018D76DF9%40wavemachine.temporal-wave.com%3E"
       TITLE="[antlr-interest] Problem with $type in final ANTLR 3.0">jimi at temporal-wave.com
       </A><BR>
    <I>Thu Jun 21 08:04:13 PDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="021579.html">[antlr-interest] Problem with $type in final ANTLR 3.0
</A></li>
        <LI>Next message: <A HREF="021605.html">[antlr-interest] Problem with $type in final ANTLR 3.0
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21583">[ date ]</a>
              <a href="thread.html#21583">[ thread ]</a>
              <a href="subject.html#21583">[ subject ]</a>
              <a href="author.html#21583">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I see what You are trying to construct I think, but this is not the way
to go about it as best I can tell without your full grammar.

It seesm that you want a placeholding token that recognizes the keywords
that begin with @ and sets them to their particular type. I presume that
you have some reason for not just listing them as:

STATIC  : '@static' ;
ISA	  : '@isa' ;
ISATYPE : '@isatype' ;
AT  : '@' ;

When you have a lot of things like this you can end up with more code
than you expect I have found. So, I tend to do this:

tokens
{
	STATIC;
	ISA;
	ISATYPE;
}

AT : '@'
	(
		  'static' 	{ $type = STATIC; }
		| 'isa'	{ $type = ISA;	}
		| 'isatype'	{ $type = ISATYPE;}
		|		{ $type = AT; // Not needed but
documents the rule }
	)
	;

This tends to generate simpler code and gives you the token types you
want back at the parser :-). 

The reason that your first attempt does nto work is because there is no
token for a fragment rule per se, hence the code generated by the $type
has not token being constructed that it can affect the type of so you
get this error. In the second instance, you are trying to use predicates
from a rule that is not a fragment to enter into a non fragment rule.

You can pick up things like the text associated with a fragment rule
like this:

FRED : '&quot;' bodytext=STRING_GUTS '&quot;'
		{ System.out.println(&quot;text is &quot; + $bodytext.text); }
	;

fragment
STRING_GUTS :	( EscapeSequence | ~('\\'|'&quot;') )* ;


fragment
EscapeSequence
    :   '\\' ('b'|'t'|'n'|'f'|'r'|'\&quot;'|'\''|'\\')
	;

Which can tends to fool you into thinking there is an actual token
emitted by the fragment. You can of course use it to construct your own
token, which you can emit() in the lexer action.

Hope that helps,

Jim

&gt;<i> -----Original Message-----
</I>&gt;<i> From: <A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">antlr-interest-bounces at antlr.org</A> [mailto:antlr-interest-
</I>&gt;<i> <A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">bounces at antlr.org</A>] On Behalf Of Jose San Leandro
</I>&gt;<i> Sent: Thursday, June 21, 2007 3:18 AM
</I>&gt;<i> To: <A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">antlr-interest at antlr.org</A>
</I>&gt;<i> Subject: [antlr-interest] Problem with $type in final ANTLR 3.0
</I>&gt;<i> 
</I>&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> I've been using a grammar which used $type keyword (the replacement of
</I>&gt;<i> ANTLR2
</I>&gt;<i> setType()[1]) to guide the lexer and define explicitly the type of the
</I>&gt;<i> matched token:
</I>&gt;<i> 
</I>&gt;<i> fragment AT
</I>&gt;<i>     :  (  ('@static')    =&gt; STATIC {$type = STATIC;}
</I>&gt;<i>         | ('@isa')       =&gt; ISA {$type = ISA;}
</I>&gt;<i>         | ('@isatype')   =&gt; ISATYPE  {$type = ISATYPE;}
</I>&gt;<i>         | '@')
</I>&gt;<i>     ;
</I>&gt;<i> 
</I>&gt;<i> With ANTLR 3.0 (Relased May 17), I get compilation errors in the
</I>&gt;<i> generated
</I>&gt;<i> lexer:
</I>&gt;<i> 
</I>&gt;<i> [..]
</I>&gt;<i>             switch (alt1) {
</I>&gt;<i>                 case 1 :
</I>&gt;<i>                     // PerComment.g:575:11: ( '@static' )=&gt; STATIC
</I>&gt;<i>                     {
</I>&gt;<i>                     mSTATIC(); if (failed) return ;
</I>&gt;<i>                     if ( backtracking==0 ) {
</I>&gt;<i>                       _type = STATIC;
</I>&gt;<i>                     }
</I>&gt;<i> [..]
</I>&gt;<i> 
</I>&gt;<i> The _type variable is not defined.
</I>&gt;<i> 
</I>&gt;<i> This issue has a different flavour on non-&quot;fragment&quot; rules:
</I>&gt;<i> 
</I>&gt;<i> [..]
</I>&gt;<i>             this.type = _type;
</I>&gt;<i>         }
</I>&gt;<i>         finally {
</I>&gt;<i>         }
</I>&gt;<i>     }
</I>&gt;<i>     // $ANTLR end AT
</I>&gt;<i> 
</I>&gt;<i> The compilation stops since type is not a declared attribute.
</I>&gt;<i> 
</I>&gt;<i> Do you have any suggestions?
</I>&gt;<i> 
</I>&gt;<i> Kind regards,
</I>&gt;<i> Jose.
</I></PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021579.html">[antlr-interest] Problem with $type in final ANTLR 3.0
</A></li>
	<LI>Next message: <A HREF="021605.html">[antlr-interest] Problem with $type in final ANTLR 3.0
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21583">[ date ]</a>
              <a href="thread.html#21583">[ thread ]</a>
              <a href="subject.html#21583">[ subject ]</a>
              <a href="author.html#21583">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://www.antlr.org/mailman/listinfo/antlr-interest">More information about the antlr-interest
mailing list</a><br>
</body></html>
