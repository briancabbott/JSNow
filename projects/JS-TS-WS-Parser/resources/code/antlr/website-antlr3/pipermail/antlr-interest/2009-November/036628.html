<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [antlr-interest] Bug report: Unexplainable &quot;no viable	alternative&quot;
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:antlr-interest%40antlr.org?Subject=Re:%20%5Bantlr-interest%5D%20Bug%20report%3A%20Unexplainable%20%22no%20viable%0A%09alternative%22&In-Reply-To=%3C7978306a2ec850449b0215b6f2b49ed7%40temporal-wave.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="036627.html">
   <LINK REL="Next"  HREF="036640.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[antlr-interest] Bug report: Unexplainable &quot;no viable	alternative&quot;</H1>
    <B>Jim Idle</B> 
    <A HREF="mailto:antlr-interest%40antlr.org?Subject=Re:%20%5Bantlr-interest%5D%20Bug%20report%3A%20Unexplainable%20%22no%20viable%0A%09alternative%22&In-Reply-To=%3C7978306a2ec850449b0215b6f2b49ed7%40temporal-wave.com%3E"
       TITLE="[antlr-interest] Bug report: Unexplainable &quot;no viable	alternative&quot;">jimi at temporal-wave.com
       </A><BR>
    <I>Wed Nov  4 07:53:14 PST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="036627.html">[antlr-interest] Bug report: Unexplainable &quot;no viable alternative&quot;
</A></li>
        <LI>Next message: <A HREF="036640.html">[antlr-interest] Bug report: Unexplainable &quot;no viable	alternative&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36628">[ date ]</a>
              <a href="thread.html#36628">[ thread ]</a>
              <a href="subject.html#36628">[ subject ]</a>
              <a href="author.html#36628">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>In general, when porting a grammar it is much better to start again I am afraid. Have you got global backtracking turned on as well? Remember that when you add predicates you will quite often make warnings/errors go away (half the point is this of course), but it does not mean that you solved the issue. I think that you are starting with a v2 grammar that just about hung together and are finding that v3 is showing you a lot more of the holes. Start again is my advice,though you probably don't want to hear that ;-)

Jim

&gt;<i> -----Original Message-----
</I>&gt;<i> From: Alex Marin [mailto:<A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">alex.marin at amiq.ro</A>]
</I>&gt;<i> Sent: Wednesday, November 04, 2009 5:07 AM
</I>&gt;<i> To: Jim Idle; Gerald Rosenberg
</I>&gt;<i> Cc: Antlr interest; Etools; Adrian Simionescu
</I>&gt;<i> Subject: RE: [antlr-interest] Bug report: Unexplainable &quot;no viable
</I>&gt;<i> alternative&quot;
</I>&gt;<i> Importance: Low
</I>&gt;<i> 
</I>&gt;<i> Hello Jim, Gerald
</I>&gt;<i> 
</I>&gt;<i> @ Jim: I suppose you are referring to the much larger grammar I've
</I>&gt;<i> mentioned in the initial post by &quot;myriad syntactic predicates&quot;.
</I>&gt;<i> However,
</I>&gt;<i> this is why I extracted this (quite simple) example, which has a single
</I>&gt;<i> syntactic predicate and yet fails to perform the recognition. On the
</I>&gt;<i> other
</I>&gt;<i> hand, the  rule associative_dimension_1 *is* left-factored, and re-
</I>&gt;<i> writing
</I>&gt;<i> it using a syntactic predicate (as associative_dimension_2) made the
</I>&gt;<i> grammar work in the first place.
</I>&gt;<i> Indeed, choosing k=1 fixes the problem, but I still don't understand if
</I>&gt;<i> this change is reliable as a global change in the &quot;much larger
</I>&gt;<i> grammar&quot;.
</I>&gt;<i> 
</I>&gt;<i> @ Gerald: At the moment I'm trying to install AntlrDT in order to
</I>&gt;<i> reproduce
</I>&gt;<i> the diagrams and better understand what exactly is the difference
</I>&gt;<i> between
</I>&gt;<i> rules associative_dimension_1 and _2. It seems that eclipse has loaded
</I>&gt;<i> the
</I>&gt;<i> plugin, but I don't find any new perspective/view/editor.
</I>&gt;<i> However, I don't see why the recognition would treat differently the
</I>&gt;<i> two
</I>&gt;<i> subrules which I find equivalent (i.e. why doesn't the parser follow
</I>&gt;<i> sized_or_unsized_dimension when using _1).
</I>&gt;<i> 
</I>&gt;<i> A note for clarification: I reported this issue as a &quot;bug&quot; mainly
</I>&gt;<i> because
</I>&gt;<i> of the very strange behavior obtained by commenting/uncommenting an
</I>&gt;<i> alternative in the data_type rule. There is no warning issued by the
</I>&gt;<i> generator, and the behavior is unpredictable. This makes me feel quite
</I>&gt;<i> insecure, since such a &quot;harmless&quot; change can cause a recognition
</I>&gt;<i> failure. I
</I>&gt;<i> understand that there might be better practices for writing a grammar
</I>&gt;<i> (and
</I>&gt;<i> I acknowledge the &quot;lack of experience on my part&quot;), but I would still
</I>&gt;<i> classify such behavior as a bug.
</I>&gt;<i> In a bigger picture, I want to port a v2 *working* grammar to v3, and I
</I>&gt;<i> would like all the code relying on the v2 parser to be affected as
</I>&gt;<i> little
</I>&gt;<i> as possible. In other words, I'd like to modify the rules as little as
</I>&gt;<i> possible in order to avoid introducing bugs in a working and verified
</I>&gt;<i> grammar.
</I>&gt;<i> 
</I>&gt;<i> Thank you,
</I>&gt;<i> Alex Marin
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On Tue, 03 Nov 2009 12:26:12 -0800, &quot;Jim Idle&quot; &lt;<A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">jimi at temporal-wave.com</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i> &gt; It isn&#8217;t a bug; this happens because your grammar is ambiguous
</I>&gt;<i> without
</I>&gt;<i> all
</I>&gt;<i> &gt; those myriad syntactic predicates. Take those all out and left factor
</I>&gt;<i> your
</I>&gt;<i> &gt; rules so that there are no ambiguities. Also, remove that k=1 option
</I>&gt;<i> and
</I>&gt;<i> &gt; let ANTLR work it out, then use ANTLRWorks syntax diagrams to work
</I>&gt;<i> out
</I>&gt;<i> why
</I>&gt;<i> &gt; your grammar is ambiguous.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Left factor the rules so that everything that starts with a '['
</I>&gt;<i> starts in
</I>&gt;<i> &gt; the same rule, then branches at places (such as '*') where you want
</I>&gt;<i> to
</I>&gt;<i> &gt; distinguish. Then build the appropriate AST.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I think perhaps this is lack of experience on your part so until you
</I>&gt;<i> have
</I>&gt;<i> a
</I>&gt;<i> &gt; better idea of what is going on I also recommend that you do the
</I>&gt;<i> following:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 1) Take all the 'xxxxx' out of your parser rules and create clear
</I>&gt;<i> LEXER
</I>&gt;<i> &gt; rules for them;
</I>&gt;<i> &gt; 2) Then check your lexer rules for overlaps in their specification;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; As well as taking out those predicates and fixing the rules properly
</I>&gt;<i> of
</I>&gt;<i> &gt; course.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Finally, eliminate just generation ordering errors by cleaning out
</I>&gt;<i> the
</I>&gt;<i> &gt; generated .java and .tokens classes and completely regenerating
</I>&gt;<i> everything
</I>&gt;<i> &gt; to make sure that the parser's idea of what tokens numbers go with
</I>&gt;<i> what
</I>&gt;<i> is
</I>&gt;<i> &gt; the same as the lexer's thoughts on the matter.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Jim
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;&gt; -----Original Message-----
</I>&gt;<i> &gt;&gt; From: <A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">antlr-interest-bounces at antlr.org</A> [mailto:antlr-interest-
</I>&gt;<i> &gt;&gt; <A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">bounces at antlr.org</A>] On Behalf Of <A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">alex.marin at amiq.ro</A>
</I>&gt;<i> &gt;&gt; Sent: Tuesday, November 03, 2009 10:22 AM
</I>&gt;<i> &gt;&gt; To: Antlr interest
</I>&gt;<i> &gt;&gt; Cc: Etools; Adrian Simionescu; <A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">parrt at cs.usfca.edu</A>
</I>&gt;<i> &gt;&gt; Subject: [antlr-interest] Bug report: Unexplainable &quot;no viable
</I>&gt;<i> &gt;&gt; alternative&quot;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Hello,
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; We have trouble understanding why we get a &quot;no viable alternative&quot;
</I>&gt;<i> when
</I>&gt;<i> &gt;&gt; running the attached parser grammar on the following input:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; bit bitstream [];
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; The output is:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; line 1:15 no viable alternative at input ']'
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; However, we have found two (very strange) workarounds for the issue:
</I>&gt;<i> &gt;&gt; 1. Commenting out the 'real' option in the data_type rule 2. Using
</I>&gt;<i> &gt;&gt; associative_dimension_2 rule instead of associative_dimension_1
</I>&gt;<i> &gt;&gt; (although the two are equivalent)
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; What is the explanation for this behavior?
</I>&gt;<i> &gt;&gt; Is there a rigurous solution to avoid such behavior?
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Thanks,
</I>&gt;<i> &gt;&gt; Alex Marin
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Notes:
</I>&gt;<i> &gt;&gt; - the example is not intended to be useful by itself (it is an
</I>&gt;<i> excerpt
</I>&gt;<i> &gt;&gt; from a much larger grammar)
</I>&gt;<i> &gt;&gt; - the latest antlr version has been used for code generation
</I>&gt;<i> &gt;&gt; (antlr-3.2.jar)
</I>&gt;<i> &gt;&gt; - you can find the referred grammar inline at the end of this e-mail
</I>&gt;<i> &gt;&gt; and also in the attached file
</I>&gt;<i> &gt;&gt; - by comparing the generated parsers, we noticed that the
</I>&gt;<i> workarounds
</I>&gt;<i> &gt;&gt; cause the prediction to be done by some complicated if-conditions
</I>&gt;<i> &gt;&gt; rather than the dfa which throws the NoViableAlt
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; ////////////////// Example.g ////////////////////////
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; grammar Example;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; options {
</I>&gt;<i> &gt;&gt; 	k=1;
</I>&gt;<i> &gt;&gt; 	output=AST;
</I>&gt;<i> &gt;&gt; 	}
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; entry
</I>&gt;<i> &gt;&gt; :
</I>&gt;<i> &gt;&gt; (my_rule)+
</I>&gt;<i> &gt;&gt; ;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; my_rule
</I>&gt;<i> &gt;&gt; 	:
</I>&gt;<i> &gt;&gt; 	  tf_port_item SEMI
</I>&gt;<i> &gt;&gt; 	;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; tf_port_item
</I>&gt;<i> &gt;&gt; :
</I>&gt;<i> &gt;&gt; data_type ID variable_dimension
</I>&gt;<i> &gt;&gt; ;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; data_type
</I>&gt;<i> &gt;&gt; :
</I>&gt;<i> &gt;&gt; 'bit'
</I>&gt;<i> &gt;&gt; | 'byte'
</I>&gt;<i> &gt;&gt; | 'real' // Comment this to suppress NoViableAlt 'struct'
</I>&gt;<i> &gt;&gt; | 'union' ( 'tagged' )?
</I>&gt;<i> &gt;&gt; | 'enum'
</I>&gt;<i> &gt;&gt; | 'virtual'
</I>&gt;<i> &gt;&gt; | ps_identifier
</I>&gt;<i> &gt;&gt; ;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; ps_identifier
</I>&gt;<i> &gt;&gt; :
</I>&gt;<i> &gt;&gt; ( ID COLON_COLON ) =&gt; ID COLON_COLON ID
</I>&gt;<i> &gt;&gt; | ID
</I>&gt;<i> &gt;&gt; ;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; variable_dimension
</I>&gt;<i> &gt;&gt; :
</I>&gt;<i> &gt;&gt; ( associative_dimension_1 ) =&gt; associative_dimension_1
</I>&gt;<i> &gt;&gt; variable_dimension // comment this line
</I>&gt;<i> &gt;&gt; //        ( associative_dimension_2 ) =&gt; associative_dimension_2
</I>&gt;<i> &gt;&gt; variable_dimension  // and uncomment this one to suppress
</I>&gt;<i> NoViableAlt (
</I>&gt;<i> &gt;&gt; with 'real' alt in data_type)
</I>&gt;<i> &gt;&gt; | ( sized_or_unsized_dimension )*
</I>&gt;<i> &gt;&gt; ;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; associative_dimension_1
</I>&gt;<i> &gt;&gt; :
</I>&gt;<i> &gt;&gt; LBRACK ( STAR | data_type ) RBRACK
</I>&gt;<i> &gt;&gt; ;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; associative_dimension_2
</I>&gt;<i> &gt;&gt; 	    :
</I>&gt;<i> &gt;&gt; ( LBRACK STAR ) =&gt; LBRACK STAR RBRACK
</I>&gt;<i> &gt;&gt; | LBRACK data_type RBRACK
</I>&gt;<i> &gt;&gt; 	    ;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; sized_or_unsized_dimension
</I>&gt;<i> &gt;&gt; :
</I>&gt;<i> &gt;&gt; LBRACK ( NUMBER )? RBRACK
</I>&gt;<i> &gt;&gt; ;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; /********** Lexer *************/
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; SEMI: ';';
</I>&gt;<i> &gt;&gt; STAR: '*';
</I>&gt;<i> &gt;&gt; LBRACK: '[';
</I>&gt;<i> &gt;&gt; RBRACK: ']';
</I>&gt;<i> &gt;&gt; COLON_COLON: '::';
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; WS
</I>&gt;<i> &gt;&gt; :
</I>&gt;<i> &gt;&gt; (' '|'\r'|'\t'|'\u000C'|'\n') {$channel=HIDDEN;}
</I>&gt;<i> &gt;&gt; ;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; ID
</I>&gt;<i> &gt;&gt; :
</I>&gt;<i> &gt;&gt; ('a'..'z'|'A'..'Z'|'_') ('0'..'9'|'a'..'z'|'A'..'Z'|'_')*
</I>&gt;<i> &gt;&gt; ;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; NUMBER
</I>&gt;<i> &gt;&gt; :
</I>&gt;<i> &gt;&gt; ('0'..'9')+
</I>&gt;<i> &gt;&gt; ;
</I>


</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="036627.html">[antlr-interest] Bug report: Unexplainable &quot;no viable alternative&quot;
</A></li>
	<LI>Next message: <A HREF="036640.html">[antlr-interest] Bug report: Unexplainable &quot;no viable	alternative&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36628">[ date ]</a>
              <a href="thread.html#36628">[ thread ]</a>
              <a href="subject.html#36628">[ subject ]</a>
              <a href="author.html#36628">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://www.antlr.org/mailman/listinfo/antlr-interest">More information about the antlr-interest
mailing list</a><br>
</body></html>
