<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [antlr-interest] NoViableAltException in optional alternative
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:antlr-interest%40antlr.org?Subject=Re:%20%5Bantlr-interest%5D%20NoViableAltException%20in%20optional%20alternative&In-Reply-To=%3C6edc6c380805241104i551652aau6774ef4250533154%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028398.html">
   <LINK REL="Next"  HREF="028406.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[antlr-interest] NoViableAltException in optional alternative</H1>
    <B>Brent Yates</B> 
    <A HREF="mailto:antlr-interest%40antlr.org?Subject=Re:%20%5Bantlr-interest%5D%20NoViableAltException%20in%20optional%20alternative&In-Reply-To=%3C6edc6c380805241104i551652aau6774ef4250533154%40mail.gmail.com%3E"
       TITLE="[antlr-interest] NoViableAltException in optional alternative">brent.yates at gmail.com
       </A><BR>
    <I>Sat May 24 11:04:54 PDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="028398.html">[antlr-interest] problem with unicode characters in comments within ANTLR .g files ...
</A></li>
        <LI>Next message: <A HREF="028406.html">[antlr-interest] NoViableAltException in optional alternative
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28403">[ date ]</a>
              <a href="thread.html#28403">[ thread ]</a>
              <a href="subject.html#28403">[ subject ]</a>
              <a href="author.html#28403">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>If the prediction DFA for an alternative fails but the alternative is
optional, should the rule throw a NoViableAltException?  It seems to me that
it should not, but the code generated by Antlr 3.1b1 does throw the
exception.  Here is a short silly grammar that shows the problem.  If you
runs this in AntlrWorks and test just the numbers rule with an input of '5',
you will get NoViableAltExceptions.

grammar Bug;

options
    {
    language= Java;
    }

start
    :    declarations EOF
    ;

declarations
    :    numbers ';'
    ;

numbers
    :    '5'
        (
            '.'
        |    '&amp;' '%' '%'
        |    '&amp;' '%' '^'
        |    '%' '$'
        |    '%' '^'
        )?
    ;

If one calls the '*numbers*' rule in isolation (for example during unit
testing or if you are building an interpreter) and feeds a single '*5*' to
it followed by EOF (or anything other than semicolon), the alternative
prediction DFA inside the numbers function fails and a NoViableAltException
is thrown.  I belive this is incorrect as the numbers rule should have
succeeded since the final alternative is optional.  The extra input should
be passed up the chain for other rules to verify.

Antlr is also not consistent in this behavior.  Making minor changes to the
grammar will sometimes cause the generated code to NOT use a DFA for the
alternative check and in this case no exception is thrown when the
alternative does not match - reguardless of the reason for not matching
(i.e., extra input that is not in the follow set).

The inconsistency makes it hard to craft gUnit tests as the rule tests work
sometimes and then later fail (due to NoViableAltExceptions) after unrelated
changes to the grammar.  I also think this could cause problems for
applications where the rules need to be called independently.

Thanks,

Brent Yates
<A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">brent.yates at gmail.com</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://www.antlr.org/pipermail/antlr-interest/attachments/20080524/2f5d2f6a/attachment.html">http://www.antlr.org/pipermail/antlr-interest/attachments/20080524/2f5d2f6a/attachment.html</A> 
</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028398.html">[antlr-interest] problem with unicode characters in comments within ANTLR .g files ...
</A></li>
	<LI>Next message: <A HREF="028406.html">[antlr-interest] NoViableAltException in optional alternative
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28403">[ date ]</a>
              <a href="thread.html#28403">[ thread ]</a>
              <a href="subject.html#28403">[ subject ]</a>
              <a href="author.html#28403">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://www.antlr.org/mailman/listinfo/antlr-interest">More information about the antlr-interest
mailing list</a><br>
</body></html>
