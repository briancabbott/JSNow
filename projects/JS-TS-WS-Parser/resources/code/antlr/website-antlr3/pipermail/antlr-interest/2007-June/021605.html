<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [antlr-interest] Problem with $type in final ANTLR 3.0
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:antlr-interest%40antlr.org?Subject=Re:%20%5Bantlr-interest%5D%20Problem%20with%20%24type%20in%20final%20ANTLR%203.0&In-Reply-To=%3C200706220724.40290.jose.sanleandro%40ventura24.es%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021583.html">
   <LINK REL="Next"  HREF="021580.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[antlr-interest] Problem with $type in final ANTLR 3.0</H1>
    <B>Jose San Leandro</B> 
    <A HREF="mailto:antlr-interest%40antlr.org?Subject=Re:%20%5Bantlr-interest%5D%20Problem%20with%20%24type%20in%20final%20ANTLR%203.0&In-Reply-To=%3C200706220724.40290.jose.sanleandro%40ventura24.es%3E"
       TITLE="[antlr-interest] Problem with $type in final ANTLR 3.0">jose.sanleandro at ventura24.es
       </A><BR>
    <I>Thu Jun 21 22:24:40 PDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="021583.html">[antlr-interest] Problem with $type in final ANTLR 3.0
</A></li>
        <LI>Next message: <A HREF="021580.html">[antlr-interest] The right way to invoke templates with null	arguments?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21605">[ date ]</a>
              <a href="thread.html#21605">[ thread ]</a>
              <a href="subject.html#21605">[ subject ]</a>
              <a href="author.html#21605">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thank you for your advice.
It used such construct to keep the lookahead at 1, and hand-code the 
dissambiguations.
Anyway, I actually tended to think the purpose of &quot;fragment&quot; rules in lexers 
where just to define which can be directly seen by the parser and which 
don't.
I'll follow your recommendation from now on. Besides that, I encounter this 
issue only on released ANTLR 3.0, not in ANTLR 3.0b6. Maybe ANTLR 3.0b6 just 
forgot to throw warnings for some &quot;habits&quot; that now in ANTLR 3.0 are 
discarded?

Again, thank you very much.
Jose.

On Thursday 21 June 2007 17:04, Jim Idle wrote:
&gt;<i> I see what You are trying to construct I think, but this is not the way
</I>&gt;<i> to go about it as best I can tell without your full grammar.
</I>&gt;<i>
</I>&gt;<i> It seesm that you want a placeholding token that recognizes the keywords
</I>&gt;<i> that begin with @ and sets them to their particular type. I presume that
</I>&gt;<i> you have some reason for not just listing them as:
</I>&gt;<i>
</I>&gt;<i> STATIC  : '@static' ;
</I>&gt;<i> ISA	  : '@isa' ;
</I>&gt;<i> ISATYPE : '@isatype' ;
</I>&gt;<i> AT  : '@' ;
</I>&gt;<i>
</I>&gt;<i> When you have a lot of things like this you can end up with more code
</I>&gt;<i> than you expect I have found. So, I tend to do this:
</I>&gt;<i>
</I>&gt;<i> tokens
</I>&gt;<i> {
</I>&gt;<i> 	STATIC;
</I>&gt;<i> 	ISA;
</I>&gt;<i> 	ISATYPE;
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> AT : '@'
</I>&gt;<i> 	(
</I>&gt;<i> 		  'static' 	{ $type = STATIC; }
</I>&gt;<i>
</I>&gt;<i> 		| 'isa'	{ $type = ISA;	}
</I>&gt;<i> 		| 'isatype'	{ $type = ISATYPE;}
</I>&gt;<i> 		|		{ $type = AT; // Not needed but
</I>&gt;<i>
</I>&gt;<i> documents the rule }
</I>&gt;<i> 	)
</I>&gt;<i> 	;
</I>&gt;<i>
</I>&gt;<i> This tends to generate simpler code and gives you the token types you
</I>&gt;<i> want back at the parser :-).
</I>&gt;<i>
</I>&gt;<i> The reason that your first attempt does nto work is because there is no
</I>&gt;<i> token for a fragment rule per se, hence the code generated by the $type
</I>&gt;<i> has not token being constructed that it can affect the type of so you
</I>&gt;<i> get this error. In the second instance, you are trying to use predicates
</I>&gt;<i> from a rule that is not a fragment to enter into a non fragment rule.
</I>&gt;<i>
</I>&gt;<i> You can pick up things like the text associated with a fragment rule
</I>&gt;<i> like this:
</I>&gt;<i>
</I>&gt;<i> FRED : '&quot;' bodytext=STRING_GUTS '&quot;'
</I>&gt;<i> 		{ System.out.println(&quot;text is &quot; + $bodytext.text); }
</I>&gt;<i> 	;
</I>&gt;<i>
</I>&gt;<i> fragment
</I>&gt;<i> STRING_GUTS :	( EscapeSequence | ~('\\'|'&quot;') )* ;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> fragment
</I>&gt;<i> EscapeSequence
</I>&gt;<i>
</I>&gt;<i>     :   '\\' ('b'|'t'|'n'|'f'|'r'|'\&quot;'|'\''|'\\')
</I>&gt;<i>
</I>&gt;<i> 	;
</I>&gt;<i>
</I>&gt;<i> Which can tends to fool you into thinking there is an actual token
</I>&gt;<i> emitted by the fragment. You can of course use it to construct your own
</I>&gt;<i> token, which you can emit() in the lexer action.
</I>&gt;<i>
</I>&gt;<i> Hope that helps,
</I>&gt;<i>
</I>&gt;<i> Jim
</I>&gt;<i>
</I>&gt;<i> &gt; -----Original Message-----
</I>&gt;<i> &gt; From: <A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">antlr-interest-bounces at antlr.org</A> [mailto:antlr-interest-
</I>&gt;<i> &gt; <A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">bounces at antlr.org</A>] On Behalf Of Jose San Leandro
</I>&gt;<i> &gt; Sent: Thursday, June 21, 2007 3:18 AM
</I>&gt;<i> &gt; To: <A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">antlr-interest at antlr.org</A>
</I>&gt;<i> &gt; Subject: [antlr-interest] Problem with $type in final ANTLR 3.0
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Hi,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I've been using a grammar which used $type keyword (the replacement of
</I>&gt;<i> &gt; ANTLR2
</I>&gt;<i> &gt; setType()[1]) to guide the lexer and define explicitly the type of the
</I>&gt;<i> &gt; matched token:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; fragment AT
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     :  (  ('@static')    =&gt; STATIC {$type = STATIC;}
</I>&gt;<i> &gt;     :
</I>&gt;<i> &gt;         | ('@isa')       =&gt; ISA {$type = ISA;}
</I>&gt;<i> &gt;         | ('@isatype')   =&gt; ISATYPE  {$type = ISATYPE;}
</I>&gt;<i> &gt;         | '@')
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     ;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; With ANTLR 3.0 (Relased May 17), I get compilation errors in the
</I>&gt;<i> &gt; generated
</I>&gt;<i> &gt; lexer:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; [..]
</I>&gt;<i> &gt;             switch (alt1) {
</I>&gt;<i> &gt;                 case 1 :
</I>&gt;<i> &gt;                     // PerComment.g:575:11: ( '@static' )=&gt; STATIC
</I>&gt;<i> &gt;                     {
</I>&gt;<i> &gt;                     mSTATIC(); if (failed) return ;
</I>&gt;<i> &gt;                     if ( backtracking==0 ) {
</I>&gt;<i> &gt;                       _type = STATIC;
</I>&gt;<i> &gt;                     }
</I>&gt;<i> &gt; [..]
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The _type variable is not defined.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; This issue has a different flavour on non-&quot;fragment&quot; rules:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; [..]
</I>&gt;<i> &gt;             this.type = _type;
</I>&gt;<i> &gt;         }
</I>&gt;<i> &gt;         finally {
</I>&gt;<i> &gt;         }
</I>&gt;<i> &gt;     }
</I>&gt;<i> &gt;     // $ANTLR end AT
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The compilation stops since type is not a declared attribute.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Do you have any suggestions?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Kind regards,
</I>&gt;<i> &gt; Jose.
</I></PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021583.html">[antlr-interest] Problem with $type in final ANTLR 3.0
</A></li>
	<LI>Next message: <A HREF="021580.html">[antlr-interest] The right way to invoke templates with null	arguments?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21605">[ date ]</a>
              <a href="thread.html#21605">[ thread ]</a>
              <a href="subject.html#21605">[ subject ]</a>
              <a href="author.html#21605">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://www.antlr.org/mailman/listinfo/antlr-interest">More information about the antlr-interest
mailing list</a><br>
</body></html>
