<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [antlr-interest] 3.1b1 trouble with a CSharp2/AST example
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:antlr-interest%40antlr.org?Subject=Re:%20%5Bantlr-interest%5D%203.1b1%20trouble%20with%20a%20CSharp2/AST%20example&In-Reply-To=%3C20080523122056.188240%40gmx.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028372.html">
   <LINK REL="Next"  HREF="028370.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[antlr-interest] 3.1b1 trouble with a CSharp2/AST example</H1>
    <B>Johannes Luber</B> 
    <A HREF="mailto:antlr-interest%40antlr.org?Subject=Re:%20%5Bantlr-interest%5D%203.1b1%20trouble%20with%20a%20CSharp2/AST%20example&In-Reply-To=%3C20080523122056.188240%40gmx.net%3E"
       TITLE="[antlr-interest] 3.1b1 trouble with a CSharp2/AST example">JALuber at gmx.de
       </A><BR>
    <I>Fri May 23 05:20:56 PDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="028372.html">[antlr-interest] building antlr 3.1b1
</A></li>
        <LI>Next message: <A HREF="028370.html">[antlr-interest] DFA problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28373">[ date ]</a>
              <a href="thread.html#28373">[ thread ]</a>
              <a href="subject.html#28373">[ subject ]</a>
              <a href="author.html#28373">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> If you have any suggestions of where to look for the problem (and any 
</I>&gt;<i> suggestions on what the problem might be) I am happy to follow up on 
</I>&gt;<i> them, I need to get this working.
</I>
The first thing I'd check, if the Java code generated by the same grammar has the same defect. You may have to change actions, too, but if the cause isn't your own code, the content of them is ignorable. Indeed, it would be a good idea to remove all actions in C# variant first and see if a clean version still fails.

After that, if you determine that Java doesn't work, send Ter the full grammar, so he can fix the templates (maybe even the C# variants, otherwise you have to do it yourself). If the Java code works, then compare the generated code for differences. It may be possible, that I lost a line somewhere when syncing with Java. If you find a difference beyond syntactic Java/C# changes, then change the C# template file at the appropriate place(s) and recreate ANTLR, regenerate the files and test them. Usually that does work.

If you don't find a difference in the output files, then the mistake is in the runtime somewhere. Look for the crash, determine why at that place the code blew up and track the wrong state back to its origin. Then compare all Java runtime files touched by the wrong state from the beginning with the C# equivalents. Somewhere there has to be the difference.

I hope that should be enough advice to deal with the problem. :)
&gt;<i> 
</I>&gt;<i> Oh, um... I do have ANT 1.7 and JDK 1.6 installed but when I tried to 
</I>&gt;<i> &quot;ant build&quot; the 3.1b1 distribution I got a mess of errors.  I didn't 
</I>&gt;<i> look very closely at them, I just re-unpacked the distro since mostly I 
</I>&gt;<i> care about using antlr rather than building it.  If I start to track 
</I>&gt;<i> down this one bug I may have to start messing with other build problems 
</I>&gt;<i> and Java isn't my strong point (thus my use of the C# targets to begin 
</I>&gt;<i> with), but c'est la vie.  If you're interested in _those_ error logs I 
</I>&gt;<i> can post them.
</I>&gt;<i> 
</I>&gt;<i> I will also try this with the CSharp target (vs. CSharp2)... yep, same 
</I>&gt;<i> error and raised in the same place.
</I>
CSharp and CSharp2 differ currently at only four tested places, so the templates don't have to be checked both, unless you want to test the .NET 1.1.-only parts of the runtime.

Johannes
&gt;<i> 
</I>&gt;<i> thanks,
</I>&gt;<i> hamilton
</I>&gt;<i> 
</I>&gt;<i> Johannes Luber wrote:
</I>&gt;<i> &gt; Hi!
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; My apologies: Right now, I do not have access to a machine with the
</I>&gt;<i> required development tools, so I can't go bug hunting. Also I don't know how
</I>&gt;<i> long that state will continue. :( I will add the report to JIRA, so I don't
</I>&gt;<i> forget it. Maybe you or someone else hunt the bug down?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Johannes
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;   
</I>&gt;<i> &gt;&gt; I'm having trouble producing an abstract syntax tree with ANTLR. 
</I>&gt;<i> Lexing
</I>&gt;<i> &gt;&gt; is working fine, parsing without any translation is working as far as I
</I>&gt;<i> can
</I>&gt;<i> &gt;&gt; tell as well.  Parsing using a grammer with rewrite rules in it dies.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Here's what I'm doing.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; I scarfed the polynomial example from the web site and stuck it in a
</I>&gt;<i> &gt;&gt; SimpleExpressions.g test file:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; ------
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; grammar SimpleExpressions;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; options { language = CSharp2; output = AST; }
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; tokens { MULT; } // imaginary token
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; start: term ('+'^ term)*
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; ;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; term: INT ID -&gt; ^(MULT[&quot;*&quot;] INT ID)
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; | INT exp -&gt; ^(MULT[&quot;*&quot;] INT exp)
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; | exp
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; | INT
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; | ID
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; ;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; exp : ID '^'^ INT
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; ;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; ID : 'a'..'z'+ ;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; INT : '0'..'9'+ ;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; WS : (' '|'\t'|'\r'|'\n')+ {$channel = HIDDEN;} ;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; ------
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; I ran the 3.1b1 version of antlr on it, from the command line, and it
</I>&gt;<i> &gt;&gt; produced my .cs files for the lexer and parser without any errors:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; $ java -cp
</I>&gt;<i> &gt;&gt; &quot;./antlr-3.1b1.jar;./stringtemplate-3.1.jar;./antlr-runtime-3.1b1.ja
</I>&gt;<i> &gt;&gt; r;./antlr-2.7.7.jar;./gunit-1.0.2.jar&quot; org.antlr.Tool &quot;C:\Documents and
</I>&gt;<i> &gt;&gt; Setting
</I>&gt;<i> &gt;&gt; s\helink\My Documents\Visual Studio
</I>&gt;<i> &gt;&gt; 2008\Projects\Examples\ANTLRTest\TestParser
</I>&gt;<i> &gt;&gt; \SimpleExpressions.g&quot;
</I>&gt;<i> &gt;&gt; ANTLR Parser Generator  Version 3.1b1 (May 20, 2008)  1989-2008
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; $
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; I built a sample C# application and it compiles just fine (using
</I>&gt;<i> &gt;&gt; antlr.runtime, Antlr3.Runtime, Antlr3.Utility, and StringTemplate as
</I>&gt;<i> references).
</I>&gt;<i> &gt;&gt; My main program.cs file is as follows, and it is built with the
</I>&gt;<i> &gt;&gt; SimpleExpressionsLexer.cs and SimpleExpressionsParser.cs.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; ------
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; using System;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; using System.Collections.Generic;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; using System.Linq;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; using System.Text;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; using Antlr.Runtime;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; using Antlr.Runtime.Tree;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; using Antlr.Runtime.Debug;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; using Antlr.Utility.Tree;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; namespace TestParser
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; {
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; class Program
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; {
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; static void Main(string[] args)
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; {
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; string testString = &quot;2x+3x^5&quot;;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; SimpleExpressionsLexer lexer = new SimpleExpressionsLexer(new
</I>&gt;<i> &gt;&gt; ANTLRStringStream(testString));
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; CommonTokenStream tokens = new CommonTokenStream(lexer);
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; SimpleExpressionsParser parser = new SimpleExpressionsParser(tokens);
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; SimpleExpressionsParser.start_return bar = parser.start();
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; CommonTree t = (CommonTree)bar.Tree;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; String result = (t != null) ? t.ToStringTree() : null;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; }
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; }
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; }
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; ------
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; When I run it, I get a &quot;RewriteEmptyStreamException was unhandled&quot;
</I>&gt;<i> error
</I>&gt;<i> &gt;&gt; with the message &quot;token INT&quot;.  Here is the exception detail:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Antlr.Runtime.Tree.RewriteEmptyStreamException was unhandled
</I>&gt;<i> &gt;&gt;   Message=&quot;token INT&quot;
</I>&gt;<i> &gt;&gt;   Source=&quot;Antlr3.Runtime&quot;
</I>&gt;<i> &gt;&gt;   StackTrace:
</I>&gt;<i> &gt;&gt;        at Antlr.Runtime.Tree.RewriteRuleElementStream`1._Next()
</I>&gt;<i> &gt;&gt;        at Antlr.Runtime.Tree.RewriteRuleTokenStream.NextNode()
</I>&gt;<i> &gt;&gt;        at SimpleExpressionsParser.term() in C:\Documents and
</I>&gt;<i> &gt;&gt; Settings\helink\My Documents\Visual Studio
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> 2008\Projects\Examples\ANTLRTest\TestParser\SimpleExpressionsParser.cs:line 305
</I>&gt;<i> &gt;&gt;        at SimpleExpressionsParser.start() in C:\Documents and
</I>&gt;<i> &gt;&gt; Settings\helink\My Documents\Visual Studio
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> 2008\Projects\Examples\ANTLRTest\TestParser\SimpleExpressionsParser.cs:line 104
</I>&gt;<i> &gt;&gt;        at TestParser.Program.Main(String[] args) in C:\Documents and
</I>&gt;<i> &gt;&gt; Settings\helink\My Documents\Visual Studio
</I>&gt;<i> &gt;&gt; 2008\Projects\Examples\ANTLRTest\TestParser\Program.cs:line 20
</I>&gt;<i> &gt;&gt;        at System.AppDomain._nExecuteAssembly(Assembly assembly,
</I>&gt;<i> String[]
</I>&gt;<i> &gt;&gt; args)
</I>&gt;<i> &gt;&gt;        at System.AppDomain.ExecuteAssembly(String assemblyFile,
</I>&gt;<i> Evidence
</I>&gt;<i> &gt;&gt; assemblySecurity, String[] args)
</I>&gt;<i> &gt;&gt;        at
</I>&gt;<i> &gt;&gt; Microsoft.VisualStudio.HostingProcess.HostProc.RunUsersAssembly()
</I>&gt;<i> &gt;&gt;        at System.Threading.ThreadHelper.ThreadStart_Context(Object
</I>&gt;<i> state)
</I>&gt;<i> &gt;&gt;        at System.Threading.ExecutionContext.Run(ExecutionContext
</I>&gt;<i> &gt;&gt; executionContext, ContextCallback callback, Object state)
</I>&gt;<i> &gt;&gt;        at System.Threading.ThreadHelper.ThreadStart()
</I>&gt;<i> &gt;&gt;   InnerException:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; in other words it's dying in term() as called by start() as called by
</I>&gt;<i> my
</I>&gt;<i> &gt;&gt; main program, i.e. it's dying trying to parse.  The code around the
</I>&gt;<i> error
</I>&gt;<i> &gt;&gt; (at the break point) in Visual Studio is....
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; // 10:15: -&gt; ^( MULT[\&quot;*\&quot;] INT ID )
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; {
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; // C:\\Documents and Settings\\helink\\My Documents\\Visual Studio
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> 2008\\Projects\\Examples\\ANTLRTest\\TestParser\\SimpleExpressions.g:10:18: ^(
</I>&gt;<i> &gt;&gt; MULT[\&quot;*\&quot;] INT ID )
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; {
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; object root_1 = (object)adaptor.GetNilNode();
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; root_1 = (object)adaptor.BecomeRoot((object)adaptor.Create(MULT, &quot;*&quot;),
</I>&gt;<i> &gt;&gt; root_1);
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; adaptor.AddChild(root_1, stream_INT.NextNode());         // &lt;--- It's
</I>&gt;<i> &gt;&gt; dying here, in SimpleExpressionsParser.cs
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; adaptor.AddChild(root_1, stream_ID.NextNode());
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; adaptor.AddChild(root_0, root_1);
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; }
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; If I get rid of the rewrite rules or whatever you call them, the -&gt; and
</I>&gt;<i> ^
</I>&gt;<i> &gt;&gt; etc. stuff, and regenerate and recompile, it runs fine but of course it
</I>&gt;<i> &gt;&gt; doesn't produce a useful AST, it just produces t==null.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Any help getting this simple example to run would be greatly
</I>&gt;<i> appreciated.
</I>&gt;<i> &gt;&gt; At the moment however I'm suspecting either a bug in the example or in
</I>&gt;<i> the
</I>&gt;<i> &gt;&gt; CSharp2 target, as there's nothing of my own making in the picture
</I>&gt;<i> (even
</I>&gt;<i> &gt;&gt; the main program is cribbed from the web site example code).
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; My immediate goal is to get parse trees and ASTs generated from fairly
</I>&gt;<i> &gt;&gt; simple expression grammars.  My ultimate goal is to build heterogenous
</I>&gt;<i> node
</I>&gt;<i> &gt;&gt; trees and write code to evaluate them, i.e. my ultimate goal is to make
</I>&gt;<i> a
</I>&gt;<i> &gt;&gt; fairly simple expression interpreter.  I think if I can get the
</I>&gt;<i> polynomial
</I>&gt;<i> &gt;&gt; example working I'll be a great deal closer to that goal.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; thanks,
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; hamilton
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;     
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; --
</I>&gt;<i> &gt; GMX startet ShortView.de. Hier findest Du Leute mit Deinen Interessen!
</I>&gt;<i> &gt; Jetzt dabei sein: <A HREF="http://www.shortview.de/?mc=sv_ext_mf@gmx">http://www.shortview.de/?mc=sv_ext_mf@gmx</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;   
</I>&gt;<i> 
</I>
-- 
Psssst! Schon vom neuen GMX MultiMessenger geh&#246;rt?
Der kann`s mit allen: <A HREF="http://www.gmx.net/de/go/multimessenger">http://www.gmx.net/de/go/multimessenger</A>
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028372.html">[antlr-interest] building antlr 3.1b1
</A></li>
	<LI>Next message: <A HREF="028370.html">[antlr-interest] DFA problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28373">[ date ]</a>
              <a href="thread.html#28373">[ thread ]</a>
              <a href="subject.html#28373">[ subject ]</a>
              <a href="author.html#28373">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://www.antlr.org/mailman/listinfo/antlr-interest">More information about the antlr-interest
mailing list</a><br>
</body></html>
