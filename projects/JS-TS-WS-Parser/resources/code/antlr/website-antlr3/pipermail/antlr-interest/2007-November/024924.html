<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [antlr-interest] Push/Pop for CommonTreeNodeStream in C runtime	target
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:antlr-interest%40antlr.org?Subject=Re:%20%5Bantlr-interest%5D%20Push/Pop%20for%20CommonTreeNodeStream%20in%20C%20runtime%0A%09target&In-Reply-To=%3C40609FCF-70FF-47F6-AD8F-9C8738A9F65D%40visibleassets.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024925.html">
   <LINK REL="Next"  HREF="024926.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[antlr-interest] Push/Pop for CommonTreeNodeStream in C runtime	target</H1>
    <B>Ronesh Puri</B> 
    <A HREF="mailto:antlr-interest%40antlr.org?Subject=Re:%20%5Bantlr-interest%5D%20Push/Pop%20for%20CommonTreeNodeStream%20in%20C%20runtime%0A%09target&In-Reply-To=%3C40609FCF-70FF-47F6-AD8F-9C8738A9F65D%40visibleassets.com%3E"
       TITLE="[antlr-interest] Push/Pop for CommonTreeNodeStream in C runtime	target">ronesh at visibleassets.com
       </A><BR>
    <I>Mon Nov 26 13:29:37 PST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="024925.html">[antlr-interest] question about &quot;.st&quot; in Mantra grammar
</A></li>
        <LI>Next message: <A HREF="024926.html">[antlr-interest] conditional processing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24924">[ date ]</a>
              <a href="thread.html#24924">[ thread ]</a>
              <a href="subject.html#24924">[ subject ]</a>
              <a href="author.html#24924">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Jim,

Thanks for your response and particularly the explanation on how to  
get the CommonTree from the BaseTree. I tried following your  
suggestion to use visitChild() in absence of the push() and pop() in  
the C versions of CommonTreeNodeStream; however before I could test  
it out I ran into another problem:

The code generated by the C runtime doesn't seem to be able to match  
the '.' wildcard. Refering to the same snipped from my previous post:


block
     :   (NEWLINE)* BEGIN 	(stat1)*	END
         	-&gt; ^( BLOCK[&quot;BLOCK&quot;] stat1* )
     ;

ifStat
     : 'if' '(' expr ')' ifBlock=block
     	-&gt; ^('if' ^(EXPR expr) $ifBlock)
     ;

AST
------
ifStat
     : ^('if' ^(EXPR v=expr) .)				// &lt;-- ERROR due to '.'
    {

	if ($v.value != 0){
   		printf(&quot; 'IF' condition is true  
-----------------------------------&quot;);
		// execute block() here... since the condition is true
	}
	else
		printf(&quot; 'IF' condition is false  
-----------------------------------&quot;);

   }

gives the following error message:
-Imaginary-(0)  : error 7 : Unexpected node, at offset 0, near DO :  
syntax not recognized...

The error goes away if I replace the '.' with a 'block' in the AST file.

 From the example on &quot;<A HREF="http://www.antlr.org/wiki/display/ANTLR3/Simple">http://www.antlr.org/wiki/display/ANTLR3/Simple</A> 
+tree-based+interpeter&quot;, Terence mentions that &quot;The wildcard says  
skip the entire subtree (new in 3.0b6).&quot;

Sounds like this might also be a part of the recent additions that  
haven't been implemented in the C runtime?

In order to implement any conditional statements including loops one  
would need to control when the blocks of code are parsed and hence  
interpreted/executed. The wildcard and the push/pop methods provided  
a non-complex means to achieve this. I'd appreciate any suggestions.

Thanks again
	Ron




&gt;<i>
</I>&gt;<i> From: &quot;Jim Idle&quot; &lt;<A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">jimi at temporal-wave.com</A>&gt;
</I>&gt;<i> Date: November 22, 2007 2:22:02 PM EST (CA)
</I>&gt;<i> To: antlr-interest &lt;<A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">antlr-interest at antlr.org</A>&gt;
</I>&gt;<i> Subject: Re: [antlr-interest] Push/Pop for CommonTreeNodeStream in  
</I>&gt;<i> C runtime target
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> The organization of this is a little different with the C runtime  
</I>&gt;<i> because we don&#8217;t have objects and inheritance available. However,  
</I>&gt;<i> the functionality is all there.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> pANTRL3_BASE_TREE is always passed to everything, even if you have  
</I>&gt;<i> your own tree node structures etc. However, within this, there is a  
</I>&gt;<i> pointer to common tree and within there, there is a pointer that  
</I>&gt;<i> you can use to point to your own structure (which must contain  
</I>&gt;<i> common tree, which must contain base tree). So, to get the common  
</I>&gt;<i> tree associated with a base tree, take the void * called &#8216;super&#8217;  
</I>&gt;<i> and cast it to the common tree node typedef. You will see that all  
</I>&gt;<i> the structures have this &#8216;super&#8217; pointer, which is used to point to  
</I>&gt;<i> any structure that is higher up the organization chain (parent in  
</I>&gt;<i> object terms).
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I can only think that the particular methods on the java common  
</I>&gt;<i> tree node stream were implemented after I implemented this in C and  
</I>&gt;<i> somehow I missed these additions. However, if you look at the C  
</I>&gt;<i> runtime code for visitChild(), you will see that there is code to  
</I>&gt;<i> stack a current node and restore a prior node. Hence, you can  
</I>&gt;<i> probably work out how to use the inbuilt stack system to do what  
</I>&gt;<i> you need. I will make a note to see when the push and pop were  
</I>&gt;<i> added and why I have not implemented them yet.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Jim
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> From: Ronesh Puri [mailto:<A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">ronesh at visibleassets.com</A>]
</I>&gt;<i> Sent: Wednesday, November 21, 2007 8:39 PM
</I>&gt;<i> To: <A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">antlr-interest at antlr.org</A>
</I>&gt;<i> Subject: [antlr-interest] Push/Pop for CommonTreeNodeStream in C  
</I>&gt;<i> runtime target
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Hi
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>           I've written a simple parser/ast walker in Java which  
</I>&gt;<i> includes loops (for/while) and conditional (if) statements. With  
</I>&gt;<i> help from the mailing list; this was accomplished in the Java  
</I>&gt;<i> version by using the Java runtime's CommonTreeNodeStream's push()  
</I>&gt;<i> and pop() methods...
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> for e.g. see:
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://www.antlr.org/pipermail/antlr-interest/2007-March/">http://www.antlr.org/pipermail/antlr-interest/2007-March/</A> 
</I>&gt;<i> 020029.html
</I>&gt;<i>
</I>&gt;<i> and
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://www.antlr.org/wiki/display/ANTLR3/Simple+tree-based+interpeter">http://www.antlr.org/wiki/display/ANTLR3/Simple+tree-based+interpeter</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I've been rewriting the grammar in C for performance reasons. So  
</I>&gt;<i> far its been fairly straightfoward - kudos to Jim Idle (and all  
</I>&gt;<i> involved). However, the C runtime target's  
</I>&gt;<i> antlr3commontreenodestream.c doesn't seem to implement the push()  
</I>&gt;<i> and pop() methods -or- perhaps I haven't been looking in the right  
</I>&gt;<i> place. Could someone please direct me on how to  &quot;Make stream jump  
</I>&gt;<i> to a new location, saving old location.&quot; as would be needed for a  
</I>&gt;<i> simple IF statement such as this (Java version):
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> grammar file
</I>&gt;<i>
</I>&gt;<i> ---------------------
</I>&gt;<i>
</I>&gt;<i> ifStat
</I>&gt;<i>
</I>&gt;<i>     : 'if' '(' expr ')' ifBlock=block
</I>&gt;<i>
</I>&gt;<i>                   -&gt; ^('if' ^(EXPR expr) $ifBlock)
</I>&gt;<i>
</I>&gt;<i>     ;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> AST file
</I>&gt;<i>
</I>&gt;<i> --------------------
</I>&gt;<i>
</I>&gt;<i> ifStat
</I>&gt;<i>
</I>&gt;<i>    : ^('if' ^(EXPR v=expr) .)
</I>&gt;<i>
</I>&gt;<i>    {
</I>&gt;<i>
</I>&gt;<i>           CommonTree stmtNode = null;
</I>&gt;<i>
</I>&gt;<i>        CommonTreeNodeStream stream = (CommonTreeNodeStream)input;
</I>&gt;<i>
</I>&gt;<i>        if ($v.value != 0)
</I>&gt;<i>
</I>&gt;<i>        {
</I>&gt;<i>
</I>&gt;<i>                    System.out.println(&quot; 'IF' condition is true&quot;);
</I>&gt;<i>
</I>&gt;<i>                          stmtNode = (CommonTree) 
</I>&gt;<i> $ifStat.start.getChild(1);
</I>&gt;<i>
</I>&gt;<i>        } else {
</I>&gt;<i>
</I>&gt;<i>                       System.out.println(&quot; 'IF' condition is false&quot;);
</I>&gt;<i>
</I>&gt;<i>           }
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>        if ( stmtNode != null )
</I>&gt;<i>
</I>&gt;<i>        {
</I>&gt;<i>
</I>&gt;<i>                          stream.push(stream.getNodeIndex(stmtNode));
</I>&gt;<i>
</I>&gt;<i>                          block();
</I>&gt;<i>
</I>&gt;<i>                          stream.pop();
</I>&gt;<i>
</I>&gt;<i>        }
</I>&gt;<i>
</I>&gt;<i>     }
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Also, since the node type is always pANTRL3_BASE_TREE in the C  
</I>&gt;<i> runtime, does this change how such a conditional would be  
</I>&gt;<i> implemented? An example of how to do this with the C runtime would  
</I>&gt;<i> really be appreciated.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thank you,
</I>&gt;<i>
</I>&gt;<i>     Ron
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> antlr-interest mailing list
</I>&gt;<i> <A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">antlr-interest at antlr.org</A>
</I>&gt;<i> <A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">http://www.antlr.org/mailman/listinfo/antlr-interest</A>
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://www.antlr.org/pipermail/antlr-interest/attachments/20071126/439a2c85/attachment-0001.html">http://www.antlr.org/pipermail/antlr-interest/attachments/20071126/439a2c85/attachment-0001.html</A> 
</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024925.html">[antlr-interest] question about &quot;.st&quot; in Mantra grammar
</A></li>
	<LI>Next message: <A HREF="024926.html">[antlr-interest] conditional processing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24924">[ date ]</a>
              <a href="thread.html#24924">[ thread ]</a>
              <a href="subject.html#24924">[ subject ]</a>
              <a href="author.html#24924">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://www.antlr.org/mailman/listinfo/antlr-interest">More information about the antlr-interest
mailing list</a><br>
</body></html>
