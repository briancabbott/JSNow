<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [antlr-interest] C target difficulties
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:antlr-interest%40antlr.org?Subject=Re:%20%5Bantlr-interest%5D%20C%20target%20difficulties&In-Reply-To=%3C1229621634.27289.9.camel%40jimi%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032055.html">
   <LINK REL="Next"  HREF="032065.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[antlr-interest] C target difficulties</H1>
    <B>Jim Idle</B> 
    <A HREF="mailto:antlr-interest%40antlr.org?Subject=Re:%20%5Bantlr-interest%5D%20C%20target%20difficulties&In-Reply-To=%3C1229621634.27289.9.camel%40jimi%3E"
       TITLE="[antlr-interest] C target difficulties">jimi at temporal-wave.com
       </A><BR>
    <I>Thu Dec 18 09:33:54 PST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="032055.html">[antlr-interest] C target difficulties
</A></li>
        <LI>Next message: <A HREF="032065.html">[antlr-interest] C target difficulties
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32060">[ date ]</a>
              <a href="thread.html#32060">[ thread ]</a>
              <a href="subject.html#32060">[ subject ]</a>
              <a href="author.html#32060">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, 2008-12-18 at 13:48 +0100, M. C. wrote:

&gt;<i> Hi all,
</I>&gt;<i>  
</I>&gt;<i>  
</I>&gt;<i> I have been working with ANTLR for some weeks now, but I'm having some
</I>&gt;<i> difficulties getting the generated code to work.
</I>&gt;<i>  
</I>&gt;<i> I'm using ANTLRworks 1.2.2 under Fedora linux 8. and installed the
</I>&gt;<i> runtime library &quot;libantlr3c-3.1.1&quot;, which works perfectly. 
</I>&gt;<i>  
</I>&gt;<i> I generate code for the C target, and made my own main.c using the
</I>&gt;<i> example on the ANTLR website, this code compiles well without errors
</I>&gt;<i> (and some warnings about not used variables, but that isn't harmfull I
</I>&gt;<i> guess)
</I>&gt;<i>  
</I>&gt;<i> Whats the problem then? Well I've got a question about the section
</I>&gt;<i> just above the main, &quot;int ANTLR3_CDECL&quot; what is it good for? when I
</I>&gt;<i> comment this part out, the source compiles well, but if I don't it
</I>&gt;<i> generates the following error:
</I>&gt;<i>  
</I>&gt;<i> &quot;main.c:8: Warning: two or more data types in declaration specifiers&quot;
</I>

You are not using it correctly. The runtime will define this is empty on
UNIX and as the proper cdecl spec for exporting functions from DLLs on
windows. So, apart from the fact that you can't export main() from a DLL
like that, look at your code - it is incorrect you have int in there
twice. Use this macro if you want to export your own functions from DLLs
- it is a convenience for you but a necessity for the runtime functions.



&gt;<i>  
</I>&gt;<i> Then I've got a somewhat more serious problem, my code hangs when
</I>&gt;<i> feeding an input file. I checked with some printf statements where it
</I>&gt;<i> hangs, but it doesn't do anything after the  &quot; psr =
</I>&gt;<i> testParserNew(tstream); &quot; line. The program doesn't shutdown, but also
</I>&gt;<i> doesn't do anything else. 
</I>
I suggest that this means there is something wrong with the grammar or
the way your are compiling it etc. 

&gt;<i>  
</I>&gt;<i> And is  psr-&gt;program(psr);  the right way to invoke the parser? 
</I>

In your code below you are saying that it hangs on the parser
constructor, but here you are suggesting that it is hanging on
invocation of the parser? I assume the latter is correct?


&gt;<i> So that the outputs I made in the .g file (like detecting a number and
</I>&gt;<i> then printf(&quot;number found&quot;); actually get printed in the terminal?
</I>&gt;<i>  
</I>&gt;<i> I've been trying things for some time now, but really can't find the
</I>&gt;<i> problem. Does someone else maybe know what i'm doing wrong?
</I>

Do you absolutely need to use the C target? I would suggest that you
learn using Java just because it will keep you out of trouble, then come
back to the C target.

&gt;<i>  
</I>&gt;<i> Thanx in advance!!
</I>&gt;<i>  
</I>



&gt;<i> int  ANTLR3_CDECL
</I>&gt;<i> int main(int argc, char *argv[])
</I>

See that you have 

int ANTLR3_CDECL int main...

?


&gt;<i>    tstream = antlr3CommonTokenStreamSourceNew(ANTLR3_SIZE_HINT,
</I>&gt;<i> TOKENSOURCE(lxr));
</I>&gt;<i>     if (tstream == NULL)
</I>&gt;<i>     {
</I>&gt;<i>         fprintf(stderr, &quot;Out of memory trying to allocate token stream
</I>&gt;<i> \n&quot;);
</I>&gt;<i>         exit(1);
</I>&gt;<i>     }
</I>&gt;<i>     psr     = testParserNew(tstream);  // CParserNew is generated by
</I>&gt;<i> ANTLR3
</I>&gt;<i>  
</I>&gt;<i> // SOFTWARE HANGS HERE........
</I>

I don't think you mean here?

&gt;<i>  
</I>&gt;<i>  
</I>&gt;<i>     if (psr == NULL)
</I>&gt;<i>     {
</I>&gt;<i>         fprintf(stderr, &quot;Out of memory trying to allocate parser\n&quot;);
</I>&gt;<i>         exit(ANTLR3_ERR_NOMEM);
</I>&gt;<i>     }
</I>

I think that you mean here?

&gt;<i>     psr-&gt;program(psr);
</I>

You probably need to post your grammar so that we can look for errors
within it.

Jim

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://www.antlr.org/pipermail/antlr-interest/attachments/20081218/f61acd64/attachment.html">http://www.antlr.org/pipermail/antlr-interest/attachments/20081218/f61acd64/attachment.html</A> 
</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032055.html">[antlr-interest] C target difficulties
</A></li>
	<LI>Next message: <A HREF="032065.html">[antlr-interest] C target difficulties
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32060">[ date ]</a>
              <a href="thread.html#32060">[ thread ]</a>
              <a href="subject.html#32060">[ subject ]</a>
              <a href="author.html#32060">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://www.antlr.org/mailman/listinfo/antlr-interest">More information about the antlr-interest
mailing list</a><br>
</body></html>
