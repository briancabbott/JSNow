<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [antlr-interest] NullPointerException in parser bug
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:antlr-interest%40antlr.org?Subject=%5Bantlr-interest%5D%20NullPointerException%20in%20parser%20bug&In-Reply-To=20050317200004.1B41EDCD46%40www.antlr.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011572.html">
   <LINK REL="Next"  HREF="011571.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[antlr-interest] NullPointerException in parser bug</H1>
    <B>Mike Gadsdon</B> 
    <A HREF="mailto:antlr-interest%40antlr.org?Subject=%5Bantlr-interest%5D%20NullPointerException%20in%20parser%20bug&In-Reply-To=20050317200004.1B41EDCD46%40www.antlr.org"
       TITLE="[antlr-interest] NullPointerException in parser bug">m.gadsdon at rheagroup.com
       </A><BR>
    <I>Wed Mar 23 03:34:37 PST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="011572.html">[antlr-interest] v3.0 debug interface
</A></li>
        <LI>Next message: <A HREF="011571.html">[antlr-interest] NullPointerException in parser bug
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11567">[ date ]</a>
              <a href="thread.html#11567">[ thread ]</a>
              <a href="subject.html#11567">[ subject ]</a>
              <a href="author.html#11567">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi All

I've come across what appears to be a bug in ANTLR (i'm using version
2.7.4).

One of my parser rules generates Java code like this :-

else if ((LA(1)==MINUS||LA(1)==PLUS||LA(1)==NUMBER) &amp;&amp;
         (_tokenSet_8.member(LA(2))) &amp;&amp;
         (_tokenSet_9.member(LA(3))) &amp;&amp;
         (_tokenSet_10.member(LA(4))) &amp;&amp;
         (_tokenSet_11.member(LA(5))) &amp;&amp;
         (_tokenSet_7.member(LA(6))) &amp;&amp;
         (_tokenSet_7.member(LA(7)))) {
   decimalConstant();

I've split the if condition onto separate lines, but otherwise this is
automatically generated by ANTLR, and presumably goes out to LA(7) due to my
lookahead being set to 7.

The problem arises when this code is executed as a result of tokens near the
end of the input file. In the case I've debugged, LA(5) is the end of file,
so LA(6) does not exist. The previous conditions (LA(1) -&gt; LA(5)) all pass,
so the condition on LA(6) is executed.

The LA code in TokenBuffer ends up running :-

    public final int LA(int i) throws TokenStreamException {
        fill(i);
        return queue.elementAt(markerOffset + i - 1).type;
    }

but the queue contains null at the accessed index position, so the type
method call fails with a NullPointerException.

I'm not entirely sure what should be done about this. Maybe LA should
return -1 if we are past the end of the input and the 'member' method always
return true if the token type is -1. Whatever the solution, it would appear
to need changes in ANTLR itself.

Any suggestions for a workaround would be gratefully received.

Mike

==============================================================
Mike Gadsdon                   mailto:<A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">m.gadsdon at rheagroup.com</A>
Rhea System S.A                Tel +44 (0)20 8891 0702
                               Fax +44 (0)20 8891 6702
==============================================================

</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011572.html">[antlr-interest] v3.0 debug interface
</A></li>
	<LI>Next message: <A HREF="011571.html">[antlr-interest] NullPointerException in parser bug
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11567">[ date ]</a>
              <a href="thread.html#11567">[ thread ]</a>
              <a href="subject.html#11567">[ subject ]</a>
              <a href="author.html#11567">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://www.antlr.org/mailman/listinfo/antlr-interest">More information about the antlr-interest
mailing list</a><br>
</body></html>
