<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [antlr-interest] [C Target] Problem with ANTLR 3.1b1 - C	codegeneration
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:antlr-interest%40antlr.org?Subject=Re:%20%5Bantlr-interest%5D%20%5BC%20Target%5D%20Problem%20with%20ANTLR%203.1b1%20-%20C%0A%09codegeneration&In-Reply-To=%3CD167331D-6A57-416B-995E-192A9FD8C340%40computer.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028712.html">
   <LINK REL="Next"  HREF="028713.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[antlr-interest] [C Target] Problem with ANTLR 3.1b1 - C	codegeneration</H1>
    <B>David Benn</B> 
    <A HREF="mailto:antlr-interest%40antlr.org?Subject=Re:%20%5Bantlr-interest%5D%20%5BC%20Target%5D%20Problem%20with%20ANTLR%203.1b1%20-%20C%0A%09codegeneration&In-Reply-To=%3CD167331D-6A57-416B-995E-192A9FD8C340%40computer.org%3E"
       TITLE="[antlr-interest] [C Target] Problem with ANTLR 3.1b1 - C	codegeneration">dbenn at computer.org
       </A><BR>
    <I>Tue Jun 17 06:21:20 PDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="028712.html">[antlr-interest] [C Target] Problem with ANTLR 3.1b1 - C	codegeneration
</A></li>
        <LI>Next message: <A HREF="028713.html">[antlr-interest] [C Target] Problem with ANTLR 3.1b1 - C	code	generation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28726">[ date ]</a>
              <a href="thread.html#28726">[ thread ]</a>
              <a href="subject.html#28726">[ subject ]</a>
              <a href="author.html#28726">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>As a counterpoint, I just want to say that I am currently using the C  
Runtime for a fairly non-trivial translation task and am satisfied  
enough to continue using it. I am using it for a commercial  
application with a tight timeline.

Apart from lexing and parsing, I am generating and walking an AST  
multiple times, and have wrapped the C lexer, parser, walker calls in  
a C++ class, and embedded some C++ code within tree walker actions.

Pre-ANTLR3, I used the Java and C++ runtimes, but I can't say that the  
ANTLR3 C Runtime took took all that much getting used to, apart from  
the differences in invocation of the generated code, for which there  
are good, commented examples. Some of the changes in ANTLR3 itself  
probably took more getting used to, but that was only because I'd used  
ANTLR2.x for quite awhile. The book helped with that.

Yes, I've found bugs, and reported them, and found Jim to be very  
responsive. No it's not perfect, but as Jim has said, it's beta.

I'd like to thank Jim for all his hard work on the C Runtime so far.  
I've released free software in the past (e.g. a compiler) and I know  
how much work is involved.

Also, a vote of Thanks to Terrence. ANTLR3 has several welcome  
improvements, and the book is good too.

Regards,

David

On 17/06/2008, at 2:13 AM, George J. Shannon wrote:

&gt;<i> I&#8217;m just sending out a note in support of Mr. Iglesias&#8217; request.
</I>&gt;<i>
</I>&gt;<i> Please note that my intent is not to be critical of the C runtime or  
</I>&gt;<i> imply that the C runtime ought to mimic OO architecture.  I just  
</I>&gt;<i> want to mention some of the needs we uncovered that relate  
</I>&gt;<i> specifically to C++.  The bottom line is that it would be very  
</I>&gt;<i> helpful to have a C++ runtime that makes it possible to mimic  
</I>&gt;<i> instantiating objects and invoking object methods inside the grammar  
</I>&gt;<i> in the same way it is currently done using the Java version.
</I>&gt;<i>
</I>&gt;<i> Specifically I wanted to request support for a C++ runtime library  
</I>&gt;<i> that is architected for consistency with the object-oriented design  
</I>&gt;<i> of the existing Java version.  It has been difficult to transition  
</I>&gt;<i> from Java to use the C runtime.  Due to time constraints it has been  
</I>&gt;<i> necessary for us to back away from using the C version for the  
</I>&gt;<i> grammar runtime.
</I>&gt;<i>
</I>&gt;<i> I&#8217;m not an architect but for example it would be helpful to have a C+ 
</I>&gt;<i> + runtime library with classes that mimic the existing Java  
</I>&gt;<i> classes.  This would appear to make it more reasonable to reuse  
</I>&gt;<i> existing Java documentation/books, in particular when using the  
</I>&gt;<i> ANTLRworks tool to develop and debug a grammar, and also when  
</I>&gt;<i> embedding C++ runtime actions into the grammar.  Then user needs for  
</I>&gt;<i> separate and unique documentation for a C++ version I hope would be  
</I>&gt;<i> minimized at least in comparison to a non OO runtime such as C.
</I>&gt;<i>
</I>&gt;<i> This is just my opinion if of interest.
</I>&gt;<i>
</I>&gt;<i> Regards,
</I>&gt;<i>
</I>&gt;<i> George Shannon
</I>&gt;<i> President, Raphael Analytics, Inc.
</I>&gt;<i> 16 Spur Drive
</I>&gt;<i> Fenton, MO 63026
</I>&gt;<i> (314) 550-5589 (cell)
</I>&gt;<i> <A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">George.Shannon at raphaelanalytics.com</A>
</I>&gt;<i> www.raphaelanalytics.com
</I>&gt;<i>
</I>&gt;<i> The information transmitted is intended only for the person or  
</I>&gt;<i> entity to which it is addressed and may contain confidential and/or  
</I>&gt;<i> privileged material.  Any review, retransmission, dissemination or  
</I>&gt;<i> other use of, or taking of any action in reliance upon, this  
</I>&gt;<i> information by persons or entities other than the intended recipient  
</I>&gt;<i> is prohibited.   If you received this in error, please contact the  
</I>&gt;<i> sender and delete the material from any computer.
</I>&gt;<i> From: <A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">antlr-interest-bounces at antlr.org</A> [mailto:<A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">antlr-interest-bounces at antlr.org</A> 
</I>&gt;<i> ] On Behalf Of Garry Iglesias
</I>&gt;<i> Sent: Monday, June 16, 2008 10:25 AM
</I>&gt;<i> To: <A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">antlr-interest at antlr.org</A>
</I>&gt;<i> Subject: [antlr-interest] [C Target] Problem with ANTLR 3.1b1 - C  
</I>&gt;<i> codegeneration
</I>&gt;<i>
</I>&gt;<i>   Hi everybody,
</I>&gt;<i>   Sorry to disturb you, I've been successfully using ANTLR v3 with  
</I>&gt;<i> JAVA for 3 months now, for one client, and I'm pretty happy with it.
</I>&gt;<i>
</I>&gt;<i>   Now I tried to generate a C++ parser for another project, and I  
</I>&gt;<i> was quite disapointed by the absence of support for C++ and the very  
</I>&gt;<i> poor support for C... First I tried the 3.0.1, which was generated  
</I>&gt;<i> 'good' c sources, but I was stuck with de C/C++ interface, I needed  
</I>&gt;<i> to have more 'C++' inside my rules, and the 'extern &quot;C&quot; {}' was too  
</I>&gt;<i> restrictive. (Needed a lot of 'glue code' to interface the C++  
</I>&gt;<i> classes).
</I>&gt;<i> Then I tried to #include my generated parser files in C into some  
</I>&gt;<i> CPP file. It worked well except a 'cast' problem (which I localized  
</I>&gt;<i> in the C.stg code generation template...) that was preventing to  
</I>&gt;<i> compile things like : TFoo tmp = ANTL3_MALLOC(sizeof(TFoo)).
</I>&gt;<i> I hesitated to patch the stg and recompile ANTLR (still 3.0.1 at  
</I>&gt;<i> that time).
</I>&gt;<i>
</I>&gt;<i>   When I remember about a recent beta, which I installed immediatly.  
</I>&gt;<i> Nice :)... But... ;)
</I>&gt;<i>   ...But it seems things are worse !!! I still haven't noticed any  
</I>&gt;<i> cast problem (yet... :) ). But I found some weird bug, which seems  
</I>&gt;<i> to show the generated code (I assume from the current C .stgs) is  
</I>&gt;<i> buggy. Sorry, I'm surprised, (maybe it's on my side but I can't  
</I>&gt;<i> understand how...).
</I>&gt;<i>
</I>&gt;<i>   First here is a extract of my grammar source :
</I>&gt;<i>
</I>&gt;<i> [...]
</I>&gt;<i> defIndexed
</I>&gt;<i>  : INDEXED sz=bitWidth id=identifier '[' cnt=immediateInteger ']'  
</I>&gt;<i> access=quotedString
</I>&gt;<i>  {
</I>&gt;<i>   SStringPtr l_pidStr=$id.s;
</I>&gt;<i> [...]
</I>&gt;<i>
</I>&gt;<i> [...]
</I>&gt;<i> identifier returns [SStringPtr s]
</I>&gt;<i>  : quoted=IDENTIFIER
</I>&gt;<i>   {
</I>&gt;<i>    const char* l_pString=(const char*)($quoted.text-&gt;chars);
</I>&gt;<i>    $s = newStringFromLimitedString(1+l_pString,strlen(l_pString)-2);
</I>&gt;<i>   }
</I>&gt;<i>  ;
</I>&gt;<i> [...]
</I>&gt;<i>
</I>&gt;<i>   This looks alright for me, I had almost the same rule in my JAVA  
</I>&gt;<i> project and it works well. (I remind you that this was not a problem  
</I>&gt;<i> on ANTLR v3.01)...
</I>&gt;<i>
</I>&gt;<i>   Now here is the generated code by ANTLR :
</I>&gt;<i>
</I>&gt;<i> // The 'buggy' rule code :
</I>&gt;<i> static MyparserParser_defIndexed_return
</I>&gt;<i> defIndexed(pMyparserParser ctx)
</I>&gt;<i> {
</I>&gt;<i>  [...]
</I>&gt;<i>     id=identifier(ctx);
</I>&gt;<i>     [...]
</I>&gt;<i>     //Here is the generated code for the rule action :
</I>&gt;<i>     {
</I>&gt;<i>   SStringPtr l_pidStr=( id != NULL ? id.s : NULL ); //!! THis is NOT  
</I>&gt;<i> a pointer !!
</I>&gt;<i>   [...]
</I>&gt;<i> [...]
</I>&gt;<i> // The indifier rule that seems to works well...
</I>&gt;<i> static MyparserParser_identifier_return
</I>&gt;<i> identifier(pMyparserParser ctx)
</I>&gt;<i> {
</I>&gt;<i>     MyparserParser_cpu_identifier_return retval;
</I>&gt;<i> [..]
</I>&gt;<i>     return retval;
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i>   As you can see, the 'identifier' rule implementation returns its  
</I>&gt;<i> result into a 'by value' struct, whereas the 'defIndexed' rule  
</I>&gt;<i> implementation try to see if a 'by reference' (some kind of pointer)  
</I>&gt;<i> result exists...
</I>&gt;<i>   I would be greatly surprise to be the first one to find this bug,  
</I>&gt;<i> it seems so straightforward... Did I do something wrong ? Did I miss  
</I>&gt;<i> something ? I'll have another note as I 'digged' into the C runtime  
</I>&gt;<i> project, the beta version has several 'vsrulesfiles' directory (all  
</I>&gt;<i> empty but one... :) ), and some other 'ghost/empties' directory. It  
</I>&gt;<i> seems far more 'work in progress' than the 3.0.1.
</I>&gt;<i>
</I>&gt;<i>   Also : I'm a 'warning killer maniac' and compile (using Visual C++  
</I>&gt;<i> 2005), in warning level 4, warning as error...
</I>&gt;<i>
</I>&gt;<i>   Finally, as a C++ programmer I don't mind you use classes in your  
</I>&gt;<i> parser... It can be a C target only. Just if it can compile  
</I>&gt;<i> 'embedded' in a C++ file, or C++ compliant, without warnings. The  
</I>&gt;<i> most important stuff for a 'C++ ANTLR user' (or for me :) ), is to  
</I>&gt;<i> be able to use 'C++' code inside my rules actions. I don't mind if  
</I>&gt;<i> ANTLR generated code or ANTLR runtime is C++ or not. I need 'my  
</I>&gt;<i> code' to be C++ that's it. :)
</I>&gt;<i>
</I>&gt;<i>   Despite my first contact with the community is to report a bug,  
</I>&gt;<i> great job to all of you.
</I>&gt;<i>   Thank you !
</I>&gt;<i>
</I>&gt;<i> (By the way : ANTLR is a GREAAAT tool, as a long time 'parser geek'  
</I>&gt;<i> I enjoy it, and it opens more new perspectives to me :) ).
</I>&gt;<i>
</I>&gt;<i> Garry.
</I>
Regards,

David Benn
<A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">dbenn at computer.org</A>
0407 261163

&quot;The real voyage of discovery consists not in seeking new landscapes  
but in having new eyes.&quot; (Marcel Proust)




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://www.antlr.org/pipermail/antlr-interest/attachments/20080617/13993db5/attachment-0001.html">http://www.antlr.org/pipermail/antlr-interest/attachments/20080617/13993db5/attachment-0001.html</A> 
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028712.html">[antlr-interest] [C Target] Problem with ANTLR 3.1b1 - C	codegeneration
</A></li>
	<LI>Next message: <A HREF="028713.html">[antlr-interest] [C Target] Problem with ANTLR 3.1b1 - C	code	generation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28726">[ date ]</a>
              <a href="thread.html#28726">[ thread ]</a>
              <a href="subject.html#28726">[ subject ]</a>
              <a href="author.html#28726">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://www.antlr.org/mailman/listinfo/antlr-interest">More information about the antlr-interest
mailing list</a><br>
</body></html>
