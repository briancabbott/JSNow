<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [antlr-interest] Fragment tokens are not generated by emit() --	breaks setting TokenLabelType
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:antlr-interest%40antlr.org?Subject=Re:%20%5Bantlr-interest%5D%20Fragment%20tokens%20are%20not%20generated%20by%20emit%28%29%0A%20--%09breaks%20setting%20TokenLabelType&In-Reply-To=%3C4A550F84.8020001%40temporal-wave.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="035129.html">
   <LINK REL="Next"  HREF="035143.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[antlr-interest] Fragment tokens are not generated by emit() --	breaks setting TokenLabelType</H1>
    <B>Jim Idle</B> 
    <A HREF="mailto:antlr-interest%40antlr.org?Subject=Re:%20%5Bantlr-interest%5D%20Fragment%20tokens%20are%20not%20generated%20by%20emit%28%29%0A%20--%09breaks%20setting%20TokenLabelType&In-Reply-To=%3C4A550F84.8020001%40temporal-wave.com%3E"
       TITLE="[antlr-interest] Fragment tokens are not generated by emit() --	breaks setting TokenLabelType">jimi at temporal-wave.com
       </A><BR>
    <I>Wed Jul  8 14:28:36 PDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="035129.html">[antlr-interest] Fragment tokens are not generated by emit() --	breaks setting TokenLabelType
</A></li>
        <LI>Next message: <A HREF="035143.html">[antlr-interest] Fragment and error tokens are not generated by emit() -- breaks setting TokenLabelType
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35134">[ date ]</a>
              <a href="thread.html#35134">[ thread ]</a>
              <a href="subject.html#35134">[ subject ]</a>
              <a href="author.html#35134">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>David-Sarah Hopwood wrote:
&gt;<i> In order to change the token type (so that I can associate another
</I>&gt;<i> field with each token), I have overridden emit() in my lexer as shown
</I>&gt;<i> below:
</I>&gt;<i>
</I>&gt;<i> grammar Jacaranda;
</I>&gt;<i>
</I>&gt;<i> options {
</I>&gt;<i>   TokenLabelType = JacarandaToken;
</I>&gt;<i>   language = Java;
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> @lexer::members {
</I>&gt;<i>   private String SV = null;
</I>&gt;<i>
</I>&gt;<i>   // See &lt;<A HREF="http://www.antlr.org/wiki/pages/viewpage.action?pageId=1844">http://www.antlr.org/wiki/pages/viewpage.action?pageId=1844</A>&gt;.
</I>&gt;<i>   public Token emit() {
</I>&gt;<i>     JacarandaToken token = new JacarandaToken(input, state.type,
</I>&gt;<i>       state.channel, state.tokenStartCharIndex, getCharIndex()-1);
</I>&gt;<i>     token.setLine(state.tokenStartLine);
</I>&gt;<i>     token.setText(state.text);
</I>&gt;<i>     token.setCharPositionInLine(state.tokenStartCharPositionInLine);
</I>&gt;<i>
</I>&gt;<i>     // Transfer the last SV computed by the lexer to the token object.
</I>&gt;<i>     token.SV = SV; SV = null;
</I>&gt;<i>
</I>&gt;<i>     emit(token);
</I>&gt;<i>     return token;
</I>&gt;<i>   }
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> The problem is that the generated code has compilation errors because
</I>&gt;<i> not all creation of token objects goes through emit(); there are some
</I>&gt;<i> direct uses of 'new CommonToken(...)':
</I>&gt;<i>
</I>&gt;<i> org\jacaranda\verifier\JacarandaLexer.java:4006: incompatible types
</I>&gt;<i> found   : org.antlr.runtime.CommonToken
</I>&gt;<i> required: org.jacaranda.verifier.JacarandaToken
</I>&gt;<i>   d = new CommonToken(input, Token.INVALID_TOKEN_TYPE,
</I>&gt;<i>           Token.DEFAULT_CHANNEL, dStart1982, getCharIndex()-1);
</I>&gt;<i>       ^
</I>&gt;<i>
</I>&gt;<i> The errors seem to occur in lexer rules where a child rule that is
</I>&gt;<i> a fragment is given a name (whether or not that name is used in an
</I>&gt;<i> action), for example:
</I>Yes, I think you are correct.

The solution is either that return types of fragments in lexerRuleRef() 
template, should be known to be CommonToken or that the hard coded new 
CommonToken should use the template's labelType. Probably the latter, 
but fragment labels are really for using the token to determine the 
start and end of fragments spans and so on, rather than emit()'ing them, 
so perhaps not.

However, if you separate the lexer and parser, and use TokenLabelType 
only in the parser grammar, then I think it would work as you require, 
even with labeled fragment rules.

Jim


</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="035129.html">[antlr-interest] Fragment tokens are not generated by emit() --	breaks setting TokenLabelType
</A></li>
	<LI>Next message: <A HREF="035143.html">[antlr-interest] Fragment and error tokens are not generated by emit() -- breaks setting TokenLabelType
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35134">[ date ]</a>
              <a href="thread.html#35134">[ thread ]</a>
              <a href="subject.html#35134">[ subject ]</a>
              <a href="author.html#35134">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://www.antlr.org/mailman/listinfo/antlr-interest">More information about the antlr-interest
mailing list</a><br>
</body></html>
