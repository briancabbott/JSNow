<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [antlr-interest] GUnit failing / Parser appending EOF to input	tokens?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:antlr-interest%40antlr.org?Subject=Re:%20%5Bantlr-interest%5D%20GUnit%20failing%20/%20Parser%20appending%20EOF%20to%20input%0A%09tokens%3F&In-Reply-To=%3CCAFm4XO2XBLa3n7g8EgQf-yogvSn7y0KHgswWFbHMcog915ZCww%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="044860.html">
   <LINK REL="Next"  HREF="044865.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[antlr-interest] GUnit failing / Parser appending EOF to input	tokens?</H1>
    <B>Sanne Grinovero</B> 
    <A HREF="mailto:antlr-interest%40antlr.org?Subject=Re:%20%5Bantlr-interest%5D%20GUnit%20failing%20/%20Parser%20appending%20EOF%20to%20input%0A%09tokens%3F&In-Reply-To=%3CCAFm4XO2XBLa3n7g8EgQf-yogvSn7y0KHgswWFbHMcog915ZCww%40mail.gmail.com%3E"
       TITLE="[antlr-interest] GUnit failing / Parser appending EOF to input	tokens?">sanne.grinovero at gmail.com
       </A><BR>
    <I>Tue Jul 10 07:15:08 PDT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="044860.html">[antlr-interest] ANTLRWorks generating cpp files.
</A></li>
        <LI>Next message: <A HREF="044865.html">[antlr-interest] Help Wanted - Adobe Flash Compiler Team - Boston	or SF
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44864">[ date ]</a>
              <a href="thread.html#44864">[ thread ]</a>
              <a href="subject.html#44864">[ subject ]</a>
              <a href="author.html#44864">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello All,
I'm having a not too complex Parser and Lexer nicely generated by
ANTLR v3.4, with more than 2,500 tests GUnit tests.

The Parser seems to work as expected, but it fails some GUnit test as
the number of tokens doesn't match an expectation in the GUnit code
itself.

Debugging, it fails at this point of
org.antlr.gunit.gUnitExecutor :

(prefixing lines numbers):
----------

378: /** Invalid input */
379: if ( tokens.index()!=tokens.size()-1 ) {
380:    //throw new InvalidInputException();
381:    ps2.print(&quot;Invalid input&quot;);
382: }

----------

And this output into ps2 marks the test as failed even while it would
otherwise succeed.

Debugging the tokens of the failing input test &quot;from Animal&quot;, I print
the Lexer output with this code snippet:

CommonTokenStream tokens = new CommonTokenStream( lexer );
System.out.println( tokens.getTokens() );

Which produces:
[[@0,0:3='from',&lt;74&gt;,1:0], [@1,5:10='Animal',&lt;74&gt;,1:5],
[@2,11:11='&lt;EOF&gt;',&lt;-1&gt;,1:11]]

*before* passing it through the generated Parser, but produces this
different output after the parser:

[[@0,0:3='from',&lt;74&gt;,1:0], [@1,5:10='Animal',&lt;74&gt;,1:5],
[@2,11:11='&lt;EOF&gt;',&lt;-1&gt;,1:11], [@3,11:11='&lt;EOF&gt;',&lt;-1&gt;,1:11]]

Note the duplication of the EOF token at the end.
This output with duplicate EOFs is generated even if I invoke
&quot;tokens.reset();&quot;, or if I parse the same token stream multiple times,
it's not going to append additional EOF tokens.
Today I'm skipping white space, but even using an hidden channel it
behaves the same.

I would strongly appreciate some advise of why this could happen, and
what I could look into:

1# is the check done by GUnit really suggesting a problem, or should
it be relaxed?

2# I tried to have my generated Lexer extend a custom class to
override the getTokens() to artificially cleanup duplicates.. but it
seems I can't define a superclass for the Lexer [1], or I couldn't
figure out the syntax.

3# Is the Parser somehow changing the input token stream? Would that
be expected? (and needed?)

4# Since GUnit directly creates the components and controls all the
wiring, I couldn't find a way to workaround these.. I can't &quot;cleanup&quot;
the duplicate EOF or have it ignore them at token count time.

While I'd love some enlightenment about what might be happening, I
would also appreciate some practical advice to &quot;workaround&quot; this, as
the Parser I have is otherwise working fine.
I would rather not delete otherwise valid tests..

TiA,
Sanne

1 - <A HREF="http://www.antlr.org/wiki/display/ANTLR3/add+superClass+to+lexer">http://www.antlr.org/wiki/display/ANTLR3/add+superClass+to+lexer</A>
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="044860.html">[antlr-interest] ANTLRWorks generating cpp files.
</A></li>
	<LI>Next message: <A HREF="044865.html">[antlr-interest] Help Wanted - Adobe Flash Compiler Team - Boston	or SF
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44864">[ date ]</a>
              <a href="thread.html#44864">[ thread ]</a>
              <a href="subject.html#44864">[ subject ]</a>
              <a href="author.html#44864">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://www.antlr.org/mailman/listinfo/antlr-interest">More information about the antlr-interest
mailing list</a><br>
</body></html>
