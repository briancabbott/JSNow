<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [antlr-interest] LIP pg. 285 11.4 Rewriter. How do you do it with	ANLTR 3?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:antlr-interest%40antlr.org?Subject=Re:%20%5Bantlr-interest%5D%20LIP%20pg.%20285%2011.4%20Rewriter.%20How%20do%20you%20do%20it%0A%20with%09ANLTR%203%3F&In-Reply-To=%3C4D8204F1.7030200%40googlemail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="041076.html">
   <LINK REL="Next"  HREF="041078.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[antlr-interest] LIP pg. 285 11.4 Rewriter. How do you do it with	ANLTR 3?</H1>
    <B>Stephen Tuttlebee</B> 
    <A HREF="mailto:antlr-interest%40antlr.org?Subject=Re:%20%5Bantlr-interest%5D%20LIP%20pg.%20285%2011.4%20Rewriter.%20How%20do%20you%20do%20it%0A%20with%09ANLTR%203%3F&In-Reply-To=%3C4D8204F1.7030200%40googlemail.com%3E"
       TITLE="[antlr-interest] LIP pg. 285 11.4 Rewriter. How do you do it with	ANLTR 3?">themightystephen at googlemail.com
       </A><BR>
    <I>Thu Mar 17 05:56:17 PDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="041076.html">[antlr-interest] LIP pg. 285 11.4 Rewriter. How do you do it with	ANLTR 3?
</A></li>
        <LI>Next message: <A HREF="041078.html">[antlr-interest] CSharp3 and SQLCLR
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41081">[ date ]</a>
              <a href="thread.html#41081">[ thread ]</a>
              <a href="subject.html#41081">[ subject ]</a>
              <a href="author.html#41081">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Eric

I don't know if I understand your question completely (I haven't read 
the previous questions you mentioned), but are you simply asking how you 
rewrite a tree using ANTLR? Or were you actually asking how ANTLR 
actually IMPLEMENTS this rewriting under the hood (i.e. what code does 
it generate to do the rewriting)? Or something else?

If you were asking the first question, then I can provide a fairly 
simple example from a couple of grammars I have been working on recently 
(I don't know if the example is too simple since it only alters the tree 
in a very minor way, and maybe you're thinking along the lines of larger 
and more substantial changes to the tree).

I have the 'phase 1 grammar' (JavaBPhase1Parser.g) that does the parsing 
and has tree rewrite rules to build an AST. This grammar has the 
following options:
options {
     language = Java;
     output = AST;
     tokenVocab = JavaBLexer;
}

This grammar just builds a tree in the normal way.

My 'phase 2 grammar' (JavaBPhase2WalkerSem1.g) is a tree grammar that 
reads that AST, performs some semantic analysis of the input and spits 
out an almost identical AST. It has similar options as before but the 
really important one here is the rewrite=true option:
options {
     language = Java;
     output = AST; // since we are performing a tree rewrite, as well as 
reading in an AST, I will also be outputting an AST
     rewrite = true; // &lt;---- this is the key option here
     tokenVocab = JavaBPhase1Parser;
     ASTLabelType = CommonTree; // this option here because we're 
reading in a tree and ANTLR would like to know the type of the nodes
}

The rewrite=true causes the tree to be spat out just the same as the 
input tree except where you specify otherwise. For example, in one rule 
I perform some semantic analysis that informs me on how to rewrite the tree:

compositionExpression
     @init {
     boolean compositionComponent = false; // this is only here rather 
than further below where I would want to use it because in the code 
generated by ANTLR the variable is out of scope if I declare it down there
     }
     : ... // other tree rule
     | ... // other tree rule
     | ^(PLAIN_OR_COMPOSITION_COMPONENT ^(IDENT IDENTIFIER))
       { .... some actions that perform semantic analysis (look up in 
the symbol table) to decide if compositionComponent is true or false }
       -&gt; {compositionComponent}? ^(COMPOSITION_COMPONENT ^(IDENT 
IDENTIFIER))
       -&gt;                                                
^(PLAIN_COMPONENT ^(IDENT IDENTIFIER))


In this example I am performing a very simple tree rewrite by simply 
changing the imaginary token of a subtree's root node, but you could 
change the entire subtree by changing the rewrite rule(s) to produce a 
completely different subtree.

For larger, more 'structural' changes to the tree, I would imagine you 
need to do a fair amount of passing subtrees around as parameters / 
return values between rules so that you have access to the subtrees in 
the rules that need them. p170 of the ANTLR reference book has an 
example of this kind of thing (example is used in doing tree 
construction in a *parser* grammar but you can do exactly the same in a 
tree grammar).

You can also have semantic predicates (I think that's the proper name) 
before multiple rewrite rules to rewrite the tree in different ways 
depending on what the boolean expression in the semantic predicates 
evaluates to. See page 181 of ANTLR reference for an example in the 
variableDefinition rule:
variableDefinition
     : modifiers type ID ('=' expression)? ';'
        -&gt; {inMethod}? ^(VARIABLE ID modifier* type expression?) // 
semantic predicate used here
        -&gt;                        ^(FIELD ID modifier* type expression?)
     ;
Again, that example is used in doing tree construction in a parser 
grammar but you can do exactly the same in a tree grammar.

Bear in mind though (at least I think this is the case...), that with 
these semantic predicates you have to ensure that there is a default 
case which specifies the tree to be built if all the other previous 
semantic predicates evaluate to false.

Hope this helps.

Stephen
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="041076.html">[antlr-interest] LIP pg. 285 11.4 Rewriter. How do you do it with	ANLTR 3?
</A></li>
	<LI>Next message: <A HREF="041078.html">[antlr-interest] CSharp3 and SQLCLR
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41081">[ date ]</a>
              <a href="thread.html#41081">[ thread ]</a>
              <a href="subject.html#41081">[ subject ]</a>
              <a href="author.html#41081">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://www.antlr.org/mailman/listinfo/antlr-interest">More information about the antlr-interest
mailing list</a><br>
</body></html>
