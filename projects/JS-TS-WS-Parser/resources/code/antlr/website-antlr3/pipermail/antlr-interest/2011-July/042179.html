<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [antlr-interest] C target: unhelpful error messages from the	default error handler in trivial cases
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:antlr-interest%40antlr.org?Subject=Re:%20%5Bantlr-interest%5D%20C%20target%3A%20unhelpful%20error%20messages%20from%20the%0A%09default%20error%20handler%20in%20trivial%20cases&In-Reply-To=%3C1F3B6C65-DD98-4BBC-8795-68E455745988%40demoninsight.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="042177.html">
   <LINK REL="Next"  HREF="042195.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[antlr-interest] C target: unhelpful error messages from the	default error handler in trivial cases</H1>
    <B>Vlad</B> 
    <A HREF="mailto:antlr-interest%40antlr.org?Subject=Re:%20%5Bantlr-interest%5D%20C%20target%3A%20unhelpful%20error%20messages%20from%20the%0A%09default%20error%20handler%20in%20trivial%20cases&In-Reply-To=%3C1F3B6C65-DD98-4BBC-8795-68E455745988%40demoninsight.com%3E"
       TITLE="[antlr-interest] C target: unhelpful error messages from the	default error handler in trivial cases">vlad at demoninsight.com
       </A><BR>
    <I>Wed Jul 20 20:41:29 PDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="042177.html">[antlr-interest] C target: unhelpful error messages from the default error handler in trivial cases
</A></li>
        <LI>Next message: <A HREF="042195.html">[antlr-interest] on &quot;crap&quot; grammars
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#42179">[ date ]</a>
              <a href="thread.html#42179">[ thread ]</a>
              <a href="subject.html#42179">[ subject ]</a>
              <a href="author.html#42179">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Jul 20, 2011, at 9:53 PM, Jim Idle wrote:

&gt;<i> The standard error handler can only do its best as a generic handler. When
</I>&gt;<i> your grammar is crap, and you feed it crap, then guess what?
</I>
Fair enough (I guess), assuming you can elaborate on why my simple grammar example is &quot;crap&quot;?

&gt;<i> 
</I>&gt;<i> Also, your questions are not &quot;with all due respect&quot; at all; you don't
</I>&gt;<i> understand what is going on, but would rather blame the generic error
</I>&gt;<i> handler than your lack of knowledge (which you will improve if you offer a
</I>&gt;<i> little more respect). The recovery mechanisms are the same for C as Java.
</I>
I do not deny that there are many things I do not yet understand about ANTLR, but I did spend a couple of days reading through the source code and stepping through scenarios in gdb. I've read most of the chapters from the ANTLR ref book and most of the LIP book. I have also searched the mailing list archives for tips on C targets. I am not a grammar beginner by a long shot. The point I am trying to make is I would like to *learn* what is going on with ANTLR specifically and it seems that the initial barrier is somewhat high. 

&gt;<i> However, if you spend some more time reading, then you will know to use
</I>&gt;<i> real tokens and not inline 'int' and 'float'.
</I>
Are you referring to using something along the lines of

tokens
{
	INT = 'int';
	FLOAT = 'float'
}
? I have tried that as well prior to posting (this is very similar to what you'd do with JavaCC) and it changes nothing. 

Ok, let's nevertheless assume that I am not seeing something obvious and take someone else's grammar. On page 79 of Terrence's book he gives an example nearly identical to mine. If I just add target='C' it becomes:

grammar bookexample;

options
{
    language='C';
}

parse:  type ID (',' ID)* ;
type: 'int' | 'float' ;
ID: 'a'..'z'+ ;

When I feed the parse() non-terminal a string &quot;badtype A&quot; I get an error message error with &lt;invalid&gt; in it, just like I posted earlier. What gives? 


&gt;<i> You would also have read the
</I>&gt;<i> long article on error recovery techniques in the Wiki and then know why
</I>&gt;<i> you are dropping out of the loop. Read the C code a bit and you will see
</I>&gt;<i> where the missing and invalid come from and would say &quot;ahhhhh&quot;.
</I>
Could you kindly point to the exact article? I see

<A HREF="http://www.antlr.org/wiki/display/ANTLR3/Error+reporting+and+recovery">http://www.antlr.org/wiki/display/ANTLR3/Error+reporting+and+recovery</A>

but that does not seem helpful enough.

&gt;<i> I love people spouting off about how bad things are, when they have made
</I>&gt;<i> no effort to look in to the details. The type of exception is generated by
</I>&gt;<i> the ANTLR analysis and not the C runtime. Or perhaps you have spent all
</I>&gt;<i> the effort you can?
</I>
I hope not, even after your sharp response. The things I've referred to above should convince you that I did make an effort to look into details.

&gt;<i> In short then, I cannot know how you want to report errors, so there are a
</I>&gt;<i> bunch of examples of finding out information. But the type of exception
</I>&gt;<i> depends on how you construct your grammar.
</I>
What would be helpful is to know why the default error handler acts so strangely for the simple example I gave and how to fix that. What am I doing wrong to cause it to (a) switch between reporting &quot;memory&quot; or &quot;unknown source&quot; for the source name with minor input changes and (b) report &quot;&lt;invalid&gt;&quot; -- ever?

&gt;<i> Jim
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> -----Original Message-----
</I>&gt;&gt;<i> From: <A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">antlr-interest-bounces at antlr.org</A> [mailto:antlr-interest-
</I>&gt;&gt;<i> <A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">bounces at antlr.org</A>] On Behalf Of Vlad
</I>&gt;&gt;<i> Sent: Wednesday, July 20, 2011 6:50 PM
</I>&gt;&gt;<i> To: <A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">antlr-interest at antlr.org</A>
</I>&gt;&gt;<i> Subject: [antlr-interest] C target: unhelpful error messages from the
</I>&gt;&gt;<i> default error handler in trivial cases
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Greetings,
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Like apparently many new ANTLR users, I've borrowed the implementation
</I>&gt;&gt;<i> from the default displayRecognitionError() to implement my own version.
</I>&gt;&gt;<i> Somewhat unfortunately, this version generates unhelpful/random errors
</I>&gt;&gt;<i> in rather trivial cases. Here is a full example:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> grammar testerrors;
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> options
</I>&gt;&gt;<i> {
</I>&gt;&gt;<i>    language='C';
</I>&gt;&gt;<i> }
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> NAME    :   ( 'a'..'z' | 'A'..'Z' | '0'..'9' )+ ;
</I>&gt;&gt;<i> WS      :   ( ' ' | '\t' | '\r' | '\n' )+ { $channel = HIDDEN; } ;
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> parse:
</I>&gt;&gt;<i>    decl ( options { greedy = true; }: ',' decl )* ','? EOF
</I>&gt;&gt;<i>    ;
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> decl:
</I>&gt;&gt;<i>    NAME ':' type
</I>&gt;&gt;<i>    ;
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> type:
</I>&gt;&gt;<i>    'int' | 'float'
</I>&gt;&gt;<i>    ;
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Feeding &quot;A : badtype&quot; into parse() results in:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> -memory-(1)  : error 10 : Unexpected token, at offset 3
</I>&gt;&gt;<i>    near [Index: 0 (Start: 0-Stop: 0) ='&lt;missing &lt;invalid&gt;&gt;', type&lt;0&gt;
</I>&gt;&gt;<i> Line:
</I>&gt;&gt;<i> 1 LinePos:3]
</I>&gt;&gt;<i>     : Missing &lt;invalid&gt;
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> What puzzles me is where the &lt;invalid&gt; comes from. It would seem easy
</I>&gt;&gt;<i> to compute that either 'int' or 'float' token was expected. In the
</I>&gt;&gt;<i> stock error handler this comes from tokenNames[ex-&gt;expecting] evaluated
</I>&gt;&gt;<i> for
</I>&gt;&gt;<i> ex-&gt;expecting being 0. What change to the default implementation is
</I>&gt;&gt;<i> necessary to make this work correctly?
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Similary, attempting to parse &quot;A :&quot; results in:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> -unknown source-(1)  : error 10 : Unexpected token, at offset -1
</I>&gt;&gt;<i>    near [Index: 0 (Start: 0-Stop: 0) ='&lt;missing &lt;invalid&gt;&gt;', type&lt;0&gt;
</I>&gt;&gt;<i> Line:
</I>&gt;&gt;<i> 1 LinePos:1]
</I>&gt;&gt;<i>     : Missing &lt;invalid&gt;
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Note how the source became &quot;unknown&quot; and the offset became -1. In the
</I>&gt;&gt;<i> default handler this is determined by &quot;streamName&quot; as follows:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> if (ex-&gt;streamName == NULL)
</I>&gt;&gt;<i> {
</I>&gt;&gt;<i> if (((pANTLR3_COMMON_TOKEN)(ex-&gt;token))-&gt;type == ANTLR3_TOKEN_EOF) {
</I>&gt;&gt;<i> ANTLR3_FPRINTF(stderr, &quot;-end of input-(&quot;); } else {
</I>&gt;&gt;<i> ANTLR3_FPRINTF(stderr, &quot;-unknown source-(&quot;); } } else { ftext = ex-
</I>&gt;&gt;&gt;<i> streamName-&gt;to8(ex-&gt;streamName);
</I>&gt;&gt;<i> ANTLR3_FPRINTF(stderr, &quot;%s(&quot;, ftext-&gt;chars); }
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> and it is frankly unexpected that a slightly different match error type
</I>&gt;&gt;<i> should have this impact since it does not impact the branches taken
</I>&gt;&gt;<i> here at all (that happens later in the function). Anyone trying to take
</I>&gt;&gt;<i> this function as a blueprint for their own handler would conclude that
</I>&gt;&gt;<i> ex-&gt;streamName is NULL in one case but not the other and that is set
</I>&gt;&gt;<i> somewhere *outside* of displayRecognitionError(): the problem of fixing
</I>&gt;&gt;<i> the default implementation begins to feel like it might snowball into
</I>&gt;&gt;<i> patching the runtime itself.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> As the last example, trying to parse &quot;A B&quot; results in:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> -memory-(1)  : error 1 : Unexpected token, at offset 1
</I>&gt;&gt;<i>    near [Index: 2 (Start: 15787098-Stop: 15787098) ='B', type&lt;4&gt; Line:
</I>&gt;&gt;<i> 1 LinePos:1]
</I>&gt;&gt;<i>     : syntax error...
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> The start/stop indices are bogus, i.e. some uninitialized variables --
</I>&gt;&gt;<i> on repeated parses they change randomly.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> My second question follows. Good error handling is a big selling point
</I>&gt;&gt;<i> of ANTLR, but with all due respect it hardly seems so for the C target.
</I>&gt;&gt;<i> Is there documentation available for all context relevant to handling
</I>&gt;&gt;<i> main mismatch error conditions? I have scanned everything in the
</I>&gt;&gt;<i> available examples download and there are no examples of customizing
</I>&gt;&gt;<i> the error handler that I can find. Alternatively, could someone share a
</I>&gt;&gt;<i> workable version of their own that might be a good learning example?
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Thank you,
</I>&gt;&gt;<i> Vlad
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> List: <A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">http://www.antlr.org/mailman/listinfo/antlr-interest</A>
</I>&gt;&gt;<i> Unsubscribe: <A HREF="http://www.antlr.org/mailman/options/antlr-interest/your-">http://www.antlr.org/mailman/options/antlr-interest/your-</A>
</I>&gt;&gt;<i> email-address
</I>&gt;<i> 
</I>&gt;<i> List: <A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">http://www.antlr.org/mailman/listinfo/antlr-interest</A>
</I>&gt;<i> Unsubscribe: <A HREF="http://www.antlr.org/mailman/options/antlr-interest/your-email-address">http://www.antlr.org/mailman/options/antlr-interest/your-email-address</A>
</I>
</PRE>

















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="042177.html">[antlr-interest] C target: unhelpful error messages from the default error handler in trivial cases
</A></li>
	<LI>Next message: <A HREF="042195.html">[antlr-interest] on &quot;crap&quot; grammars
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#42179">[ date ]</a>
              <a href="thread.html#42179">[ thread ]</a>
              <a href="subject.html#42179">[ subject ]</a>
              <a href="author.html#42179">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://www.antlr.org/mailman/listinfo/antlr-interest">More information about the antlr-interest
mailing list</a><br>
</body></html>
