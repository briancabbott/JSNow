<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [antlr-interest] Backtracking and labels
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:antlr-interest%40antlr.org?Subject=Re:%20%5Bantlr-interest%5D%20Backtracking%20and%20labels&In-Reply-To=%3C4F659B1D.1010805%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="044258.html">
   <LINK REL="Next"  HREF="044266.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[antlr-interest] Backtracking and labels</H1>
    <B>Kieran Simpson</B> 
    <A HREF="mailto:antlr-interest%40antlr.org?Subject=Re:%20%5Bantlr-interest%5D%20Backtracking%20and%20labels&In-Reply-To=%3C4F659B1D.1010805%40gmail.com%3E"
       TITLE="[antlr-interest] Backtracking and labels">kierans777 at gmail.com
       </A><BR>
    <I>Sun Mar 18 01:21:49 PDT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="044258.html">[antlr-interest] Backtracking and labels
</A></li>
        <LI>Next message: <A HREF="044266.html">[antlr-interest] Backtracking and labels
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44265">[ date ]</a>
              <a href="thread.html#44265">[ thread ]</a>
              <a href="subject.html#44265">[ subject ]</a>
              <a href="author.html#44265">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Eric (and list)

I had a shot at porting Sam's fixes to the C target.  While it does 
indeed fix the label generation issue (yay!), it unfortunately 
introduces a number of other changes which results in uncompilable code 
:<i>'( :'(
</I>
I've forked the antlr3 repo at <A HREF="https://github.com/kierans/antlr3">https://github.com/kierans/antlr3</A> and 
pushed up my current changes.  If anyone has any suggestions (or wishes 
to fork and add some patches) they're more than welcome.  With some more 
tweaking hopefully this bug will go away :D

Cheers,

On 17/03/12 3:48 PM, Eric wrote:
&gt;<i> Hi Kieran,
</I>&gt;<i> Did one of my crazy suggestions actually pan out?
</I>&gt;<i> I took a quick 30 second look at the code and it looks doable. When you
</I>&gt;<i> mentioned Sam I thought it would be C# code, but is actually a java,
</I>&gt;<i> grammar, and string template patch. I'm not sure if all three patches in
</I>&gt;<i> the update have to be applied. If I wasn't going to sleep right now I
</I>&gt;<i> would take a shot at it.
</I>&gt;<i> It might be as simple as applying the patch to the files and building.
</I>&gt;<i> Don't let the unknown file types scare you, just treat it like any patch
</I>&gt;<i> that you would do by hand, looking to make sure that the before and
</I>&gt;<i> after parts match up and there is a good change it will work.
</I>&gt;<i> I should be able to help you tomorrow with it. Drop a message if you
</I>&gt;<i> need help and I will jump in when I see it.
</I>&gt;<i> Good luck and great job on finding it, that fix is wanted by at least
</I>&gt;<i> several people. If you get it to work you might become someones hero.
</I>&gt;<i> Eric.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Sat, Mar 17, 2012 at 12:17 AM, Kieran Simpson &lt;<A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">kierans777 at gmail.com</A>
</I>&gt;<i> &lt;mailto:<A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">kierans777 at gmail.com</A>&gt;&gt; wrote:
</I>&gt;<i>
</I>&gt;<i>     Further to the related discussion of the Java grammar not compiling (see
</I>&gt;<i>     <A HREF="http://antlr.markmail.org/search/?q=java+parser+not+compiling#query:java%20parser%20not%20compiling+page:1+mid:vyevxqph4xniwl6q+state:results">http://antlr.markmail.org/search/?q=java+parser+not+compiling#query:java%20parser%20not%20compiling+page:1+mid:vyevxqph4xniwl6q+state:results</A>
</I>&gt;<i>     ) I've found Sam's fix for the labels not being generated properly.
</I>&gt;<i>
</I>&gt;<i>     It's
</I>&gt;<i>     <A HREF="https://github.com/antlr/antlr3/commit/db6adaefb12a1901606f81c9c8931aa07d12949f">https://github.com/antlr/antlr3/commit/db6adaefb12a1901606f81c9c8931aa07d12949f</A>
</I>&gt;<i>     and building against the current head of the antlr3 repo, the fix still
</I>&gt;<i>     holds for the Java target, however the C target still has the bug.
</I>&gt;<i>
</I>&gt;<i>     I'm not that familiar with Antlr's internal workings, nor String
</I>&gt;<i>     Template.  If anyone can help it would be appreciated (not just by my
</I>&gt;<i>     I'm sure).
</I>&gt;<i>
</I>&gt;<i>     Cheers,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>     On 23/07/64 5:59 AM, Kieran Simpson wrote:
</I>&gt;<i>      &gt; As a follow up, I checked out the antlr3 repo from Git Hub and
</I>&gt;<i>     built the
</I>&gt;<i>      &gt; current master branch. Still have the same problem
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; [java] '-classpath'
</I>&gt;<i>      &gt; [java]
</I>&gt;<i>      &gt;
</I>&gt;<i>     './lib/ST4-4.0.4.jar:./lib/antlr-2.7.7.jar:./lib/antlr-3.4.1-SNAPSHOT.jar:./lib/antlr-runtime-3.4.1-SNAPSHOT.jar:./lib/stringtemplate-3.2.1.jar'
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; Cheers,
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; On 11/03/12 5:43 PM, Kieran Simpson wrote:
</I>&gt;<i>      &gt;&gt; @Bart - yes you're right, I forgot to add the leading ^ for the
</I>&gt;<i>      &gt;&gt; resulting AST in my example. Typo :(
</I>&gt;<i>      &gt;&gt;
</I>&gt;<i>      &gt;&gt; @Ivan - I ran my build with Antlr 3.3 and the resulting code is OK
</I>&gt;<i>      &gt;&gt;
</I>&gt;<i>      &gt;&gt; static void
</I>&gt;<i>     synpred9_CoreConfiguration_fragment(pCoreConfigurationParser
</I>&gt;<i>      &gt;&gt; ctx )
</I>&gt;<i>      &gt;&gt; {
</I>&gt;<i>      &gt;&gt; pANTLR3_COMMON_TOKEN value;
</I>&gt;<i>      &gt;&gt;
</I>&gt;<i>      &gt;&gt; value = NULL;
</I>&gt;<i>      &gt;&gt;
</I>&gt;<i>      &gt;&gt; However I want to use 3.4 ;)
</I>&gt;<i>      &gt;&gt;
</I>&gt;<i>      &gt;&gt; I was thinking it might be a classpath issue, however I'm not
</I>&gt;<i>     certain.
</I>&gt;<i>      &gt;&gt; The classpaths are (from my Ant build):
</I>&gt;<i>      &gt;&gt;
</I>&gt;<i>      &gt;&gt; [java] '-classpath'
</I>&gt;<i>      &gt;&gt; [java]
</I>&gt;<i>      &gt;&gt;
</I>&gt;<i>     './lib/ST4-4.0.4.jar:./lib/antlr-2.7.7.jar:./lib/antlr-3.4.jar:./lib/antlr-runtime-3.4.jar:./lib/stringtemplate-3.2.1.jar'
</I>&gt;<i>      &gt;&gt;
</I>&gt;<i>      &gt;&gt;
</I>&gt;<i>      &gt;&gt;
</I>&gt;<i>      &gt;&gt; [java] '-classpath'
</I>&gt;<i>      &gt;&gt; [java]
</I>&gt;<i>      &gt;&gt;
</I>&gt;<i>     './lib/antlr-2.7.7.jar:./lib/antlr-3.3.jar:./lib/antlr-runtime-3.3.jar:./lib/stringtemplate-3.2.1.jar'
</I>&gt;<i>      &gt;&gt;
</I>&gt;<i>      &gt;&gt;
</I>&gt;<i>      &gt;&gt;
</I>&gt;<i>      &gt;&gt; What is really bothering my is that the the code generated from
</I>&gt;<i>      &gt;&gt; Antlrworks (when I Debug the grammar) is OK
</I>&gt;<i>      &gt;&gt;
</I>&gt;<i>      &gt;&gt; public final void synpred9_CoreConfiguration_fragment() throws
</I>&gt;<i>      &gt;&gt; RecognitionException {
</I>&gt;<i>      &gt;&gt; Token value=null;
</I>&gt;<i>      &gt;&gt;
</I>&gt;<i>      &gt;&gt; If I can get some pointers about where to look/what to look for
</I>&gt;<i>     in the
</I>&gt;<i>      &gt;&gt; code generators (eg: template fragments) I might be able to get more
</I>&gt;<i>      &gt;&gt; info on the code that's playing up. It could be a bad JAR that's
</I>&gt;<i>     being
</I>&gt;<i>      &gt;&gt; retrieved by my build system (Apache Ivy).
</I>&gt;<i>      &gt;&gt;
</I>&gt;<i>      &gt;&gt; Cheers,
</I>&gt;<i>      &gt;&gt;
</I>&gt;<i>      &gt;&gt; On 23/07/64 5:59 AM, Ivan Brezina wrote:
</I>&gt;<i>      &gt;&gt;&gt; Hi
</I>&gt;<i>      &gt;&gt;&gt; maybe you're hitting already discovered bug. This was
</I>&gt;<i>     introduced in the
</I>&gt;<i>      &gt;&gt;&gt; version 3.4. What does the output look like when you use ANTLR
</I>&gt;<i>     version
</I>&gt;<i>      &gt;&gt;&gt; 3.3?
</I>&gt;<i>      &gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt; Ivan
</I>&gt;<i>      &gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt; Quoting Kieran Simpson &lt;<A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">kierans777 at gmail.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">kierans777 at gmail.com</A>&gt;&gt;:
</I>&gt;<i>      &gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt;&gt; For my rule:
</I>&gt;<i>      &gt;&gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt;&gt; rule
</I>&gt;<i>      &gt;&gt;&gt;&gt; : OPTION1
</I>&gt;<i>      &gt;&gt;&gt;&gt; | value=TION2 -&gt; ($value)
</I>&gt;<i>      &gt;&gt;&gt;&gt; ;
</I>&gt;<i>      &gt;&gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt;&gt; with backtracking on (and memoize not that I think that's
</I>&gt;<i>     relevant) the
</I>&gt;<i>      &gt;&gt;&gt;&gt; synpredicate code generated has errors, both for the Java and
</I>&gt;<i>     C targets
</I>&gt;<i>      &gt;&gt;&gt;&gt; where the variable name is missing in the declaration
</I>&gt;<i>      &gt;&gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt;&gt; eg:
</I>&gt;<i>      &gt;&gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt;&gt; public final void synpred9_grammar_fragment() throws
</I>&gt;<i>      &gt;&gt;&gt;&gt; RecognitionException {
</I>&gt;<i>      &gt;&gt;&gt;&gt; Token =ll;
</I>&gt;<i>      &gt;&gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt;&gt; and
</I>&gt;<i>      &gt;&gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt;&gt; static void synpred9_grammar_fragment(pCoreConfigurationParser
</I>&gt;<i>     ctx )
</I>&gt;<i>      &gt;&gt;&gt;&gt; {
</I>&gt;<i>      &gt;&gt;&gt;&gt; pANTLR3_COMMON_TOKEN ;
</I>&gt;<i>      &gt;&gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt;&gt; =ULL;
</I>&gt;<i>      &gt;&gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt;&gt; Interestingly this grammar runs in debug mode when used with
</I>&gt;<i>     Antlrworks
</I>&gt;<i>      &gt;&gt;&gt;&gt; even though I'm using version 3.4 of Antlr with my project and
</I>&gt;<i>     3.4 is
</I>&gt;<i>      &gt;&gt;&gt;&gt; included with Antlrworks (1.4.3).
</I>&gt;<i>      &gt;&gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt;&gt; Just in case it's due to an out of date version, here are some
</I>&gt;<i>     md5sums
</I>&gt;<i>      &gt;&gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt;&gt; 9638f9b7b1b823fcaba977f06f0dd761 ./antlr/3.4/antlrworks-1.4.3.jar
</I>&gt;<i>      &gt;&gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt;&gt; 465472089d78cd80f926f5825a29ec7f ./lib/antlr-3.4.jar
</I>&gt;<i>      &gt;&gt;&gt;&gt; 0e0318be407e51fdf7ba6777eabfdf73 ./lib/antlr-runtime-3.4.jar
</I>&gt;<i>      &gt;&gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt;&gt; Is something out of date here or is this a bug with the
</I>&gt;<i>     backtracking
</I>&gt;<i>      &gt;&gt;&gt;&gt; generation?
</I>&gt;<i>      &gt;&gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt;&gt; Cheers,
</I></PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="044258.html">[antlr-interest] Backtracking and labels
</A></li>
	<LI>Next message: <A HREF="044266.html">[antlr-interest] Backtracking and labels
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44265">[ date ]</a>
              <a href="thread.html#44265">[ thread ]</a>
              <a href="subject.html#44265">[ subject ]</a>
              <a href="author.html#44265">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://www.antlr.org/mailman/listinfo/antlr-interest">More information about the antlr-interest
mailing list</a><br>
</body></html>
