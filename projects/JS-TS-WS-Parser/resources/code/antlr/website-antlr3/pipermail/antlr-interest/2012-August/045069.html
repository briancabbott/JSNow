<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [antlr-interest] &#31572;&#22797;: antlr-interest Digest, Vol 93, Issue 15
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:antlr-interest%40antlr.org?Subject=Re:%20%5Bantlr-interest%5D%20%3D%3Fgb2312%3Fb%3FtPC4tDogYW50bHItaW50ZXJlc3QgRGlnZXN0%3F%3D%0A%09%3D%3Fgb2312%3Fb%3FLCBWb2wgOTMsIElzc3VlIDE1%3F%3D&In-Reply-To=%3C502c49cd.21bf440a.759f.ffff8079%40mx.google.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="045067.html">
   <LINK REL="Next"  HREF="045077.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[antlr-interest] &#31572;&#22797;: antlr-interest Digest, Vol 93, Issue 15</H1>
    <B>Martin Zhang</B> 
    <A HREF="mailto:antlr-interest%40antlr.org?Subject=Re:%20%5Bantlr-interest%5D%20%3D%3Fgb2312%3Fb%3FtPC4tDogYW50bHItaW50ZXJlc3QgRGlnZXN0%3F%3D%0A%09%3D%3Fgb2312%3Fb%3FLCBWb2wgOTMsIElzc3VlIDE1%3F%3D&In-Reply-To=%3C502c49cd.21bf440a.759f.ffff8079%40mx.google.com%3E"
       TITLE="[antlr-interest] &#31572;&#22797;: antlr-interest Digest, Vol 93, Issue 15">martin.zhang717 at gmail.com
       </A><BR>
    <I>Wed Aug 15 18:16:21 PDT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="045067.html">[antlr-interest] Testing a grammar with output=template setting	through gUnit
</A></li>
        <LI>Next message: <A HREF="045077.html">[antlr-interest] ANTLR 3.4: missing parameter in the method generated for a syntactic predicate for a rule with a parameter
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#45069">[ date ]</a>
              <a href="thread.html#45069">[ thread ]</a>
              <a href="subject.html#45069">[ subject ]</a>
              <a href="author.html#45069">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello, I do not want these mails any more, but I forgot my password, can
anyone help?

Thanks, 
Martin

-----&#37038;&#20214;&#21407;&#20214;-----
&#21457;&#20214;&#20154;: <A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">antlr-interest-bounces at antlr.org</A>
[mailto:<A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">antlr-interest-bounces at antlr.org</A>] &#20195;&#34920; <A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">antlr-interest-request at antlr.</A>
org
&#21457;&#36865;&#26102;&#38388;: 2012&#24180;8&#26376;16&#26085; 3:00
&#25910;&#20214;&#20154;: <A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">antlr-interest at antlr.org</A>
&#20027;&#39064;: antlr-interest Digest, Vol 93, Issue 15

Send antlr-interest mailing list submissions to
	<A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">antlr-interest at antlr.org</A>

To subscribe or unsubscribe via the World Wide Web, visit
	<A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">http://www.antlr.org/mailman/listinfo/antlr-interest</A>
or, via email, send a message with subject or body 'help' to
	<A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">antlr-interest-request at antlr.org</A>

You can reach the person managing the list at
	<A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">antlr-interest-owner at antlr.org</A>

When replying, please edit your Subject line so it is more specific
than &quot;Re: Contents of antlr-interest digest...&quot;


Today's Topics:

   1. AUTO: Noel Dcosta is out of the office (returning	08/16/2012)
      (Noel Dcosta)
   2. Re: problem about &quot;the code for the static initializer is
      exceeding the 65535 bytes limit&quot; (Francis ANDRE)
   3. Re: problem about &quot;the code for the static initializer is
      exceeding the 65535 bytes limit&quot; (Zhaohui Yang)
   4. big lexer problem (Zhaohui Yang)
   5. Re: problem about &quot;the code for the static initializer is
      exceeding the 65535 bytes limit&quot; (Francis ANDRE)
   6. Re: big lexer problem (Jim Idle)
   7. Re: problem about &quot;the code for the static initializer is
      exceeding the 65535 bytes limit&quot; (Jim Idle)


----------------------------------------------------------------------

Message: 1
Date: Wed, 15 Aug 2012 04:08:26 +0530
From: Noel Dcosta &lt;<A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">nodcosta at in.ibm.com</A>&gt;
Subject: [antlr-interest] AUTO: Noel Dcosta is out of the office
	(returning	08/16/2012)
To: <A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">antlr-interest at antlr.org</A>
Message-ID:
	
&lt;<A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">OF1E12170B.D9CCF0DA-ON65257A5A.007C5E6F-65257A5A.007C5E6F at in.ibm.com</A>&gt;
Content-Type: text/plain; charset=US-ASCII


I am out of the office until 08/16/2012.

Holiday at ISL


Note: This is an automated response to your message  &quot;antlr-interest
Digest, Vol 93, Issue 14&quot; sent on 15/08/2012 0:30:01.

This is the only notification you will receive while this person is away.



------------------------------

Message: 2
Date: Wed, 15 Aug 2012 05:37:13 +0200
From: Francis ANDRE &lt;<A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">francis.andre.kampbell at orange.fr</A>&gt;
Subject: Re: [antlr-interest] problem about &quot;the code for the static
	initializer is exceeding the 65535 bytes limit&quot;
To: Zhaohui Yang &lt;<A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">yezonghui at gmail.com</A>&gt;
Cc: <A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">antlr-interest at antlr.org</A>
Message-ID: &lt;<A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">502B1969.1070700 at orange.fr</A>&gt;
Content-Type: text/plain; charset=ISO-8859-1; format=flowed

Hi Zhaohui

I am currently working on fixing this issues with antlr3.4... Once I will
have a 
proper patch, would you be interested in testing it??

FA
Le 14/08/2012 18:05, Zhaohui Yang a ?crit :
&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> Here we have a big grammar and the generated parser.java got a compilation
</I>&gt;<i> : &quot;the code for the static initializer is exceeding the 65535 bytes
</I>limit&quot;.
&gt;<i>
</I>&gt;<i> I've searched the net for a while and found that is a widely known limit
</I>in
&gt;<i> JVM or Javac compiler, and not yet has an option to change it higher.
</I>&gt;<i>
</I>&gt;<i> On the ANTLR side, I found 2 solutions proposed by others, but neither of
</I>&gt;<i> them is totally satisfying:
</I>&gt;<i>
</I>&gt;<i> 1. Seperate the big grammar into 2 *.g files, import one from the other.
</I>&gt;<i>     Yes, this removes the compilation error with genereated Java. But
</I>&gt;<i> ANTLRWorks does not support imported grammar well. E.g., I can not
</I>&gt;<i> interpret a rule in the imported grammar, it's simply not in the rule list
</I>&gt;<i> for interpreting. And gunit always fail with rules defined in imported
</I>&gt;<i> grammar.
</I>&gt;<i>
</I>&gt;<i> 2. Modify the generated Java source, seperate the &quot;FOLLOW_xxx_in_yyy&quot;
</I>&gt;<i> constants into several static classes and change references to them
</I>&gt;<i> accordingly.
</I>&gt;<i>     This is proposed here -
</I>&gt;<i> <A HREF="http://www.antlr.org/pipermail/antlr-interest/2009-November/036608.html">http://www.antlr.org/pipermail/antlr-interest/2009-November/036608.html</A> .
</I>&gt;<i> The author of the post actually has a solution into ANTLR source code
</I>(some
&gt;<i> string template). But I can't find the attachment he referred to. And
</I>&gt;<i> that's in 2009, I suspect the fix could be incompatible with current ANTLR
</I>&gt;<i> version.
</I>&gt;<i>     Without this fix we have to do the modificaiton manually or write a
</I>&gt;<i> script for that. The script is not that easy.
</I>&gt;<i>
</I>&gt;<i> And we found a 3rd solution by ourself, that also involve changing the
</I>&gt;<i> generated Java:
</I>&gt;<i>
</I>&gt;<i> 3. Remove those FOLLOW_... constant completely, and replace the references
</I>&gt;<i> with &quot;null&quot;.
</I>&gt;<i>     Surprisingly this works, just no error recovery after this, not a
</I>&gt;<i> problem for us. But we really worry this is unsafe, since it's not
</I>&gt;<i> documented anywhere.
</I>&gt;<i>
</I>&gt;<i> After all, we're looking for any other solution that is easier to apply,
</I>&gt;<i> asumming we'll be constantly changing the grammar and recompile the
</I>parser.
&gt;<i>
</I>&gt;<i>   Maybe there is a way to get ANTLRWorks and gunit play well with imported
</I>&gt;<i> grammar?
</I>&gt;<i> Maybe there is already a commandline option for antlr Tool, that can
</I>&gt;<i> genereate FOLLOW_... constants in seperate classes?
</I>&gt;<i> Maybe there is already a commandline option for antlr Tool, that can
</I>&gt;<i> supress FOLLOW_... constants code generation?
</I>&gt;<i>
</I>


------------------------------

Message: 3
Date: Wed, 15 Aug 2012 22:17:18 +0800
From: Zhaohui Yang &lt;<A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">yezonghui at gmail.com</A>&gt;
Subject: Re: [antlr-interest] problem about &quot;the code for the static
	initializer is exceeding the 65535 bytes limit&quot;
To: <A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">francis.andre.kampbell at orange.fr</A>
Cc: <A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">antlr-interest at antlr.org</A>
Message-ID:
	&lt;CAO51=<A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">GTn42+SZk0E_0y-KPdXzJ-P_cwU9hjJqkR_u6jT37nc6A at mail.gmail.com</A>&gt;
Content-Type: text/plain; charset=UTF-8

It's great someone is already trying a fix. I'd be glad to test your fix
when it's out.

Would you please introduce a bit what kind of fix is that? Is it for
ANTLRWorks or ANTLR tool, is it a command line option for seperating FOLLOW
set or supressing that, or something else?

2012/8/15 Francis ANDRE &lt;<A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">francis.andre.kampbell at orange.fr</A>&gt;

&gt;<i> Hi Zhaohui
</I>&gt;<i>
</I>&gt;<i> I am currently working on fixing this issues with antlr3.4... Once I will
</I>&gt;<i> have a proper patch, would you be interested in testing it??
</I>&gt;<i>
</I>&gt;<i> FA
</I>&gt;<i> Le 14/08/2012 18:05, Zhaohui Yang a ?crit :
</I>&gt;<i>
</I>&gt;<i> Hi,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Here we have a big grammar and the generated parser.java got a
</I>compilation
&gt;&gt;<i> : &quot;the code for the static initializer is exceeding the 65535 bytes
</I>&gt;&gt;<i> limit&quot;.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I've searched the net for a while and found that is a widely known limit
</I>&gt;&gt;<i> in
</I>&gt;&gt;<i> JVM or Javac compiler, and not yet has an option to change it higher.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On the ANTLR side, I found 2 solutions proposed by others, but neither of
</I>&gt;&gt;<i> them is totally satisfying:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 1. Seperate the big grammar into 2 *.g files, import one from the other.
</I>&gt;&gt;<i>     Yes, this removes the compilation error with genereated Java. But
</I>&gt;&gt;<i> ANTLRWorks does not support imported grammar well. E.g., I can not
</I>&gt;&gt;<i> interpret a rule in the imported grammar, it's simply not in the rule
</I>list
&gt;&gt;<i> for interpreting. And gunit always fail with rules defined in imported
</I>&gt;&gt;<i> grammar.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 2. Modify the generated Java source, seperate the &quot;FOLLOW_xxx_in_yyy&quot;
</I>&gt;&gt;<i> constants into several static classes and change references to them
</I>&gt;&gt;<i> accordingly.
</I>&gt;&gt;<i>     This is proposed here -
</I>&gt;&gt;<i> <A HREF="http://www.antlr.org/**pipermail/antlr-interest/2009-**">http://www.antlr.org/**pipermail/antlr-interest/2009-**</A>
</I>&gt;&gt;<i>
</I>November/036608.html&lt;<A HREF="http://www.antlr.org/pipermail/antlr-interest/2009-Nove">http://www.antlr.org/pipermail/antlr-interest/2009-Nove</A>
mber/036608.html&gt;.
&gt;&gt;<i> The author of the post actually has a solution into ANTLR source code
</I>&gt;&gt;<i> (some
</I>&gt;&gt;<i> string template). But I can't find the attachment he referred to. And
</I>&gt;&gt;<i> that's in 2009, I suspect the fix could be incompatible with current
</I>ANTLR
&gt;&gt;<i> version.
</I>&gt;&gt;<i>     Without this fix we have to do the modificaiton manually or write a
</I>&gt;&gt;<i> script for that. The script is not that easy.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> And we found a 3rd solution by ourself, that also involve changing the
</I>&gt;&gt;<i> generated Java:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 3. Remove those FOLLOW_... constant completely, and replace the
</I>references
&gt;&gt;<i> with &quot;null&quot;.
</I>&gt;&gt;<i>     Surprisingly this works, just no error recovery after this, not a
</I>&gt;&gt;<i> problem for us. But we really worry this is unsafe, since it's not
</I>&gt;&gt;<i> documented anywhere.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> After all, we're looking for any other solution that is easier to apply,
</I>&gt;&gt;<i> asumming we'll be constantly changing the grammar and recompile the
</I>&gt;&gt;<i> parser.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   Maybe there is a way to get ANTLRWorks and gunit play well with
</I>imported
&gt;&gt;<i> grammar?
</I>&gt;&gt;<i> Maybe there is already a commandline option for antlr Tool, that can
</I>&gt;&gt;<i> genereate FOLLOW_... constants in seperate classes?
</I>&gt;&gt;<i> Maybe there is already a commandline option for antlr Tool, that can
</I>&gt;&gt;<i> supress FOLLOW_... constants code generation?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>

-- 
Regards,

Yang, Zhaohui


------------------------------

Message: 4
Date: Wed, 15 Aug 2012 23:17:58 +0800
From: Zhaohui Yang &lt;<A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">yezonghui at gmail.com</A>&gt;
Subject: [antlr-interest] big lexer problem
To: <A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">antlr-interest at antlr.org</A>
Message-ID:
	&lt;CAO51=GRXpR8teCYw=<A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">D5G-4pGATvOKa9XQhD-N0LFU8vQUW4kyA at mail.gmail.com</A>&gt;
Content-Type: text/plain; charset=UTF-8

Hi,

I'm having big problem with big generated Lexer.java. Any help appreciated.

The language is COBOL. And I found multiple reasons that the lexer get's
too big:

1. I'm adding semantic predicate into the lexer, to simulate &quot;lexer state&quot;
as in YACC and JavaCC. It's like

       PICTURE_STRING: {lexerState==PIXTURE_STATE}?=&gt; blah blah //
matching things like AXX(9).99 after a 'PIC' key word

   The lexer without semantic predicates is 18K lines.
   When I add predicates to one or two of the lexer rules, it grows to more
than 20K.
   When I add a single more, it explodes to more than 60K and ANTLR give up
generating lexer with error: code is too long.

2. COBOL has a LOT of key words, that may explain the original 18K lines.

3. I have tokens referencing other tokens.
   I've inlined most of them now, as suggested by others. But the size has
not reduced much.

So the question could be:
1. how to generate smaller lexer without removing semantic predicate?
2. If that's not possible, how to simulate &quot;lexer state&quot; without semantic
predicate?
3. Any other solution?

Thanks.

-- 
Regards,

Yang, Zhaohui


------------------------------

Message: 5
Date: Wed, 15 Aug 2012 19:14:03 +0200
From: Francis ANDRE &lt;<A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">francis.andre.kampbell at orange.fr</A>&gt;
Subject: Re: [antlr-interest] problem about &quot;the code for the static
	initializer is exceeding the 65535 bytes limit&quot;
To: Zhaohui Yang &lt;<A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">yezonghui at gmail.com</A>&gt;
Cc: <A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">antlr-interest at antlr.org</A>
Message-ID: &lt;<A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">502BD8DB.3010605 at orange.fr</A>&gt;
Content-Type: text/plain; charset=UTF-8; format=flowed

Le 15/08/2012 16:17, Zhaohui Yang a ?crit :
&gt;<i> It's great someone is already trying a fix. I'd be glad to test your 
</I>&gt;<i> fix when it's out.
</I>&gt;<i>
</I>&gt;<i> Would you please introduce a bit what kind of fix is that? Is it for 
</I>&gt;<i> ANTLRWorks or ANTLR tool, is it a command line option for seperating 
</I>&gt;<i> FOLLOW set or supressing that, or something else?
</I>The 64K syndrone is a pure Java problem due to the constraint that the 
JVM does not support static initializer greater than 64K  -- shame on it 
--. Thus if you look to the generated lexer and parser, you will see 
certainly a lot of DFA classes, each of them having some static 
initializer values. The point is that the sum of the static initializer 
of all those DFAs is greater than 64K while the static initialization of 
each DFA is somewhat small or in most of case les than 64K. Thus, one 
solution is to extract all those DFAs classes and put them outside the 
lexer or the parser in fixed directories like the following pattern:

Let &lt;grammar&gt; the directory of the grammar to generate, then all the 
generated DFAs will go in

for the lexer's DFAs:    package &lt;grammar&gt;.lexer;
for the parser's DAFs: package &lt;grammar&gt;.parser;

and the reference of all those DFAs will be
in the lexer:                 import &lt;grammar&gt;.lexer.*;
in the parser                import &lt;grammar&gt;.parser.*;

But hold on, the fix has to be approved by Terr and I did not yet submit 
it. It need to pass all unit tests of the ANTLR3.4 and I am working on 
it... there is a real challenge getting the parser/lexer compiled for 
java code generated without a package...; and all those unit tests are 
producing java parser/lexer at the top level directory.
&gt;<i>
</I>&gt;<i> 2012/8/15 Francis ANDRE &lt;<A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">francis.andre.kampbell at orange.fr</A> 
</I>&gt;<i> &lt;mailto:<A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">francis.andre.kampbell at orange.fr</A>&gt;&gt;
</I>&gt;<i>
</I>&gt;<i>     Hi Zhaohui
</I>&gt;<i>
</I>&gt;<i>     I am currently working on fixing this issues with antlr3.4... Once
</I>&gt;<i>     I will have a proper patch, would you be interested in testing it??
</I>&gt;<i>
</I>&gt;<i>     FA
</I>&gt;<i>     Le 14/08/2012 18:05, Zhaohui Yang a ?crit :
</I>&gt;<i>
</I>&gt;<i>         Hi,
</I>&gt;<i>
</I>&gt;<i>         Here we have a big grammar and the generated parser.java got a
</I>&gt;<i>         compilation
</I>&gt;<i>         : &quot;the code for the static initializer is exceeding the 65535
</I>&gt;<i>         bytes limit&quot;.
</I>&gt;<i>
</I>&gt;<i>         I've searched the net for a while and found that is a widely
</I>&gt;<i>         known limit in
</I>&gt;<i>         JVM or Javac compiler, and not yet has an option to change it
</I>&gt;<i>         higher.
</I>&gt;<i>
</I>&gt;<i>         On the ANTLR side, I found 2 solutions proposed by others, but
</I>&gt;<i>         neither of
</I>&gt;<i>         them is totally satisfying:
</I>&gt;<i>
</I>&gt;<i>         1. Seperate the big grammar into 2 *.g files, import one from
</I>&gt;<i>         the other.
</I>&gt;<i>             Yes, this removes the compilation error with genereated
</I>&gt;<i>         Java. But
</I>&gt;<i>         ANTLRWorks does not support imported grammar well. E.g., I can not
</I>&gt;<i>         interpret a rule in the imported grammar, it's simply not in
</I>&gt;<i>         the rule list
</I>&gt;<i>         for interpreting. And gunit always fail with rules defined in
</I>&gt;<i>         imported
</I>&gt;<i>         grammar.
</I>&gt;<i>
</I>&gt;<i>         2. Modify the generated Java source, seperate the
</I>&gt;<i>         &quot;FOLLOW_xxx_in_yyy&quot;
</I>&gt;<i>         constants into several static classes and change references to
</I>&gt;<i>         them
</I>&gt;<i>         accordingly.
</I>&gt;<i>             This is proposed here -
</I>&gt;<i>
</I><A HREF="http://www.antlr.org/pipermail/antlr-interest/2009-November/036608.html">http://www.antlr.org/pipermail/antlr-interest/2009-November/036608.html</A>
&gt;<i>         .
</I>&gt;<i>         The author of the post actually has a solution into ANTLR
</I>&gt;<i>         source code (some
</I>&gt;<i>         string template). But I can't find the attachment he referred
</I>&gt;<i>         to. And
</I>&gt;<i>         that's in 2009, I suspect the fix could be incompatible with
</I>&gt;<i>         current ANTLR
</I>&gt;<i>         version.
</I>&gt;<i>             Without this fix we have to do the modificaiton manually
</I>&gt;<i>         or write a
</I>&gt;<i>         script for that. The script is not that easy.
</I>&gt;<i>
</I>&gt;<i>         And we found a 3rd solution by ourself, that also involve
</I>&gt;<i>         changing the
</I>&gt;<i>         generated Java:
</I>&gt;<i>
</I>&gt;<i>         3. Remove those FOLLOW_... constant completely, and replace
</I>&gt;<i>         the references
</I>&gt;<i>         with &quot;null&quot;.
</I>&gt;<i>             Surprisingly this works, just no error recovery after
</I>&gt;<i>         this, not a
</I>&gt;<i>         problem for us. But we really worry this is unsafe, since it's not
</I>&gt;<i>         documented anywhere.
</I>&gt;<i>
</I>&gt;<i>         After all, we're looking for any other solution that is easier
</I>&gt;<i>         to apply,
</I>&gt;<i>         asumming we'll be constantly changing the grammar and
</I>&gt;<i>         recompile the parser.
</I>&gt;<i>
</I>&gt;<i>           Maybe there is a way to get ANTLRWorks and gunit play well
</I>&gt;<i>         with imported
</I>&gt;<i>         grammar?
</I>&gt;<i>         Maybe there is already a commandline option for antlr Tool,
</I>&gt;<i>         that can
</I>&gt;<i>         genereate FOLLOW_... constants in seperate classes?
</I>&gt;<i>         Maybe there is already a commandline option for antlr Tool,
</I>&gt;<i>         that can
</I>&gt;<i>         supress FOLLOW_... constants code generation?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> -- 
</I>&gt;<i> Regards,
</I>&gt;<i>
</I>&gt;<i> Yang, Zhaohui
</I>&gt;<i>
</I>


------------------------------

Message: 6
Date: Wed, 15 Aug 2012 11:32:08 -0700
From: Jim Idle &lt;<A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">jimi at temporal-wave.com</A>&gt;
Subject: Re: [antlr-interest] big lexer problem
To: <A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">antlr-interest at antlr.org</A>
Message-ID: &lt;<A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">d97497be4a0866591621e45230ff9041 at mail.gmail.com</A>&gt;
Content-Type: text/plain; charset=UTF-8

This really means that your lexer is too complicated and I suspect that
you are just trying to type in a grammar from a normative spec without
thinking ahead a little (not trying to insult you here). The specs are
usually designed to explain the language/syntax, not necessarily to be
copied straight in to a parser grammar.

You should really post your grammar files to get better help, but
generally you are trying to introduce context/state in to the lexer, which
is not necessary in all but a few cases. For instance, why do you care
about the token type in the lexer if the same pattern is used for two
token types? Take a token that matches a PIC pattern generally, then
verify that the pattern is a good PIC spec when you are walking the tree,
not in the lexer.

On top of this, if you are trying to drive the lexer state from the
parser, then it is very unlikely it will work anyway.

Try to take a step back, and reduce the number of tokens to a minimum,
remove any state that you can, move all the error checking and validation
as far away from the lexer as you can (at the lexer level you have a
minimum context, at the tree walk level you have much more information and
can issue much better errors/warnings).

Next, you don't need a 'fix' for ANTLR. You will find that as you simplify
the grammar and spend time on left factoring the rules, that all/a lot of
your problems will go away. If you still have issues with generated code
size at that point, then you need to start importing grammars and
debugging remotely (do not use the interpreter in ANTLRWorks anyway), not
trying to change the output of ANTLR. The only time I have had to use
imports is for a full TSQL grammar, which is huge because SQL is so
terrible. COBOL is pretty big, but nothing like SQL.


Jim






&gt;<i> -----Original Message-----
</I>&gt;<i> From: <A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">antlr-interest-bounces at antlr.org</A> [mailto:antlr-interest-
</I>&gt;<i> <A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">bounces at antlr.org</A>] On Behalf Of Zhaohui Yang
</I>&gt;<i> Sent: Wednesday, August 15, 2012 8:18 AM
</I>&gt;<i> To: <A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">antlr-interest at antlr.org</A>
</I>&gt;<i> Subject: [antlr-interest] big lexer problem
</I>&gt;<i>
</I>&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> I'm having big problem with big generated Lexer.java. Any help
</I>&gt;<i> appreciated.
</I>&gt;<i>
</I>&gt;<i> The language is COBOL. And I found multiple reasons that the lexer
</I>&gt;<i> get's too big:
</I>&gt;<i>
</I>&gt;<i> 1. I'm adding semantic predicate into the lexer, to simulate &quot;lexer
</I>&gt;<i> state&quot;
</I>&gt;<i> as in YACC and JavaCC. It's like
</I>&gt;<i>
</I>&gt;<i>        PICTURE_STRING: {lexerState==PIXTURE_STATE}?=&gt; blah blah //
</I>&gt;<i> matching things like AXX(9).99 after a 'PIC' key word
</I>&gt;<i>
</I>&gt;<i>    The lexer without semantic predicates is 18K lines.
</I>&gt;<i>    When I add predicates to one or two of the lexer rules, it grows to
</I>&gt;<i> more than 20K.
</I>&gt;<i>    When I add a single more, it explodes to more than 60K and ANTLR
</I>&gt;<i> give up generating lexer with error: code is too long.
</I>&gt;<i>
</I>&gt;<i> 2. COBOL has a LOT of key words, that may explain the original 18K
</I>&gt;<i> lines.
</I>&gt;<i>
</I>&gt;<i> 3. I have tokens referencing other tokens.
</I>&gt;<i>    I've inlined most of them now, as suggested by others. But the size
</I>&gt;<i> has not reduced much.
</I>&gt;<i>
</I>&gt;<i> So the question could be:
</I>&gt;<i> 1. how to generate smaller lexer without removing semantic predicate?
</I>&gt;<i> 2. If that's not possible, how to simulate &quot;lexer state&quot; without
</I>&gt;<i> semantic predicate?
</I>&gt;<i> 3. Any other solution?
</I>&gt;<i>
</I>&gt;<i> Thanks.
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Regards,
</I>&gt;<i>
</I>&gt;<i> Yang, Zhaohui
</I>&gt;<i>
</I>&gt;<i> List: <A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">http://www.antlr.org/mailman/listinfo/antlr-interest</A>
</I>&gt;<i> Unsubscribe: <A HREF="http://www.antlr.org/mailman/options/antlr-interest/your-">http://www.antlr.org/mailman/options/antlr-interest/your-</A>
</I>&gt;<i> email-address
</I>

------------------------------

Message: 7
Date: Wed, 15 Aug 2012 11:38:54 -0700
From: Jim Idle &lt;<A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">jimi at temporal-wave.com</A>&gt;
Subject: Re: [antlr-interest] problem about &quot;the code for the static
	initializer is exceeding the 65535 bytes limit&quot;
Cc: <A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">antlr-interest at antlr.org</A>
Message-ID: &lt;<A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">925ce1df1c75295afe33be1ab5c7d9c9 at mail.gmail.com</A>&gt;
Content-Type: text/plain; charset=UTF-8

It does not need a fix. It is the grammar that needs to be improved. The
huge DFAs are indicative of your grammars being overly complicated or poorly
left factored. ANTLR might do better than it does in some cases, and v4 may
well get around a lot of similar issues, but in general, improve your
grammar files.

First, look at the generated DFA. What rule, or combination of rules is
generating this? Start there. Left factor. Simplify. Stop trying to do much
of anything in the lexer other than match the simplest common token set.
Stop trying to impose semantics in the parser (&quot;you can only have at most
two of 'these' here&quot; - push such things in the tree walk, or add semantic
checks (allow any number of 'these', count how many you got, then issue a
semantic error).

Writing good grammars is not easy. In some ways, because it is easy to just
type stuff in and give it a whirl, ANTLR can cause you to shoot yourself in
the foot!

Step back and consider your grammar files. Do you really want a grammar that
generates such huge decision tables? What is going wrong? It usually is not
ANTLR itself.


Jim


&gt;<i> -----Original Message-----
</I>&gt;<i> From: <A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">antlr-interest-bounces at antlr.org</A> [mailto:antlr-interest-
</I>&gt;<i> <A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">bounces at antlr.org</A>] On Behalf Of Francis ANDRE
</I>&gt;<i> Sent: Wednesday, August 15, 2012 10:14 AM
</I>&gt;<i> To: Zhaohui Yang
</I>&gt;<i> Cc: <A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">antlr-interest at antlr.org</A>
</I>&gt;<i> Subject: Re: [antlr-interest] problem about &quot;the code for the static
</I>&gt;<i> initializer is exceeding the 65535 bytes limit&quot;
</I>&gt;<i>
</I>&gt;<i> Le 15/08/2012 16:17, Zhaohui Yang a ?crit :
</I>&gt;<i> &gt; It's great someone is already trying a fix. I'd be glad to test your
</I>&gt;<i> &gt; fix when it's out.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Would you please introduce a bit what kind of fix is that? Is it for
</I>&gt;<i> &gt; ANTLRWorks or ANTLR tool, is it a command line option for seperating
</I>&gt;<i> &gt; FOLLOW set or supressing that, or something else?
</I>&gt;<i> The 64K syndrone is a pure Java problem due to the constraint that the
</I>&gt;<i> JVM does not support static initializer greater than 64K  -- shame on
</I>&gt;<i> it --. Thus if you look to the generated lexer and parser, you will see
</I>&gt;<i> certainly a lot of DFA classes, each of them having some static
</I>&gt;<i> initializer values. The point is that the sum of the static initializer
</I>&gt;<i> of all those DFAs is greater than 64K while the static initialization
</I>&gt;<i> of each DFA is somewhat small or in most of case les than 64K. Thus,
</I>&gt;<i> one solution is to extract all those DFAs classes and put them outside
</I>&gt;<i> the lexer or the parser in fixed directories like the following
</I>&gt;<i> pattern:
</I>&gt;<i>
</I>&gt;<i> Let &lt;grammar&gt; the directory of the grammar to generate, then all the
</I>&gt;<i> generated DFAs will go in
</I>&gt;<i>
</I>&gt;<i> for the lexer's DFAs:    package &lt;grammar&gt;.lexer;
</I>&gt;<i> for the parser's DAFs: package &lt;grammar&gt;.parser;
</I>&gt;<i>
</I>&gt;<i> and the reference of all those DFAs will be
</I>&gt;<i> in the lexer:                 import &lt;grammar&gt;.lexer.*;
</I>&gt;<i> in the parser                import &lt;grammar&gt;.parser.*;
</I>&gt;<i>
</I>&gt;<i> But hold on, the fix has to be approved by Terr and I did not yet
</I>&gt;<i> submit it. It need to pass all unit tests of the ANTLR3.4 and I am
</I>&gt;<i> working on it... there is a real challenge getting the parser/lexer
</I>&gt;<i> compiled for java code generated without a package...; and all those
</I>&gt;<i> unit tests are producing java parser/lexer at the top level directory.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 2012/8/15 Francis ANDRE &lt;<A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">francis.andre.kampbell at orange.fr</A>
</I>&gt;<i> &gt; &lt;mailto:<A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">francis.andre.kampbell at orange.fr</A>&gt;&gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     Hi Zhaohui
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     I am currently working on fixing this issues with antlr3.4...
</I>&gt;<i> Once
</I>&gt;<i> &gt;     I will have a proper patch, would you be interested in testing
</I>&gt;<i> it??
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     FA
</I>&gt;<i> &gt;     Le 14/08/2012 18:05, Zhaohui Yang a ?crit :
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;         Hi,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;         Here we have a big grammar and the generated parser.java got
</I>&gt;<i> a
</I>&gt;<i> &gt;         compilation
</I>&gt;<i> &gt;         : &quot;the code for the static initializer is exceeding the 65535
</I>&gt;<i> &gt;         bytes limit&quot;.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;         I've searched the net for a while and found that is a widely
</I>&gt;<i> &gt;         known limit in
</I>&gt;<i> &gt;         JVM or Javac compiler, and not yet has an option to change it
</I>&gt;<i> &gt;         higher.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;         On the ANTLR side, I found 2 solutions proposed by others,
</I>&gt;<i> but
</I>&gt;<i> &gt;         neither of
</I>&gt;<i> &gt;         them is totally satisfying:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;         1. Seperate the big grammar into 2 *.g files, import one from
</I>&gt;<i> &gt;         the other.
</I>&gt;<i> &gt;             Yes, this removes the compilation error with genereated
</I>&gt;<i> &gt;         Java. But
</I>&gt;<i> &gt;         ANTLRWorks does not support imported grammar well. E.g., I
</I>&gt;<i> can not
</I>&gt;<i> &gt;         interpret a rule in the imported grammar, it's simply not in
</I>&gt;<i> &gt;         the rule list
</I>&gt;<i> &gt;         for interpreting. And gunit always fail with rules defined in
</I>&gt;<i> &gt;         imported
</I>&gt;<i> &gt;         grammar.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;         2. Modify the generated Java source, seperate the
</I>&gt;<i> &gt;         &quot;FOLLOW_xxx_in_yyy&quot;
</I>&gt;<i> &gt;         constants into several static classes and change references
</I>&gt;<i> to
</I>&gt;<i> &gt;         them
</I>&gt;<i> &gt;         accordingly.
</I>&gt;<i> &gt;             This is proposed here -
</I>&gt;<i> &gt;         <A HREF="http://www.antlr.org/pipermail/antlr-interest/2009-">http://www.antlr.org/pipermail/antlr-interest/2009-</A>
</I>&gt;<i> November/036608.html
</I>&gt;<i> &gt;         .
</I>&gt;<i> &gt;         The author of the post actually has a solution into ANTLR
</I>&gt;<i> &gt;         source code (some
</I>&gt;<i> &gt;         string template). But I can't find the attachment he referred
</I>&gt;<i> &gt;         to. And
</I>&gt;<i> &gt;         that's in 2009, I suspect the fix could be incompatible with
</I>&gt;<i> &gt;         current ANTLR
</I>&gt;<i> &gt;         version.
</I>&gt;<i> &gt;             Without this fix we have to do the modificaiton manually
</I>&gt;<i> &gt;         or write a
</I>&gt;<i> &gt;         script for that. The script is not that easy.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;         And we found a 3rd solution by ourself, that also involve
</I>&gt;<i> &gt;         changing the
</I>&gt;<i> &gt;         generated Java:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;         3. Remove those FOLLOW_... constant completely, and replace
</I>&gt;<i> &gt;         the references
</I>&gt;<i> &gt;         with &quot;null&quot;.
</I>&gt;<i> &gt;             Surprisingly this works, just no error recovery after
</I>&gt;<i> &gt;         this, not a
</I>&gt;<i> &gt;         problem for us. But we really worry this is unsafe, since
</I>&gt;<i> it's not
</I>&gt;<i> &gt;         documented anywhere.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;         After all, we're looking for any other solution that is
</I>&gt;<i> easier
</I>&gt;<i> &gt;         to apply,
</I>&gt;<i> &gt;         asumming we'll be constantly changing the grammar and
</I>&gt;<i> &gt;         recompile the parser.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;           Maybe there is a way to get ANTLRWorks and gunit play well
</I>&gt;<i> &gt;         with imported
</I>&gt;<i> &gt;         grammar?
</I>&gt;<i> &gt;         Maybe there is already a commandline option for antlr Tool,
</I>&gt;<i> &gt;         that can
</I>&gt;<i> &gt;         genereate FOLLOW_... constants in seperate classes?
</I>&gt;<i> &gt;         Maybe there is already a commandline option for antlr Tool,
</I>&gt;<i> &gt;         that can
</I>&gt;<i> &gt;         supress FOLLOW_... constants code generation?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; --
</I>&gt;<i> &gt; Regards,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Yang, Zhaohui
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> List: <A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">http://www.antlr.org/mailman/listinfo/antlr-interest</A>
</I>&gt;<i> Unsubscribe: <A HREF="http://www.antlr.org/mailman/options/antlr-interest/your-">http://www.antlr.org/mailman/options/antlr-interest/your-</A>
</I>&gt;<i> email-address
</I>

------------------------------

_______________________________________________
antlr-interest mailing list
<A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">antlr-interest at antlr.org</A>
<A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">http://www.antlr.org/mailman/listinfo/antlr-interest</A>

End of antlr-interest Digest, Vol 93, Issue 15
**********************************************

</PRE>



















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="045067.html">[antlr-interest] Testing a grammar with output=template setting	through gUnit
</A></li>
	<LI>Next message: <A HREF="045077.html">[antlr-interest] ANTLR 3.4: missing parameter in the method generated for a syntactic predicate for a rule with a parameter
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#45069">[ date ]</a>
              <a href="thread.html#45069">[ thread ]</a>
              <a href="subject.html#45069">[ subject ]</a>
              <a href="author.html#45069">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://www.antlr.org/mailman/listinfo/antlr-interest">More information about the antlr-interest
mailing list</a><br>
</body></html>
