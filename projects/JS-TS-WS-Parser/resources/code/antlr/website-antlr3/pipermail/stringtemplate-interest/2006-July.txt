From miha.valencic at gmail.com  Tue Jul  4 13:08:04 2006
From: miha.valencic at gmail.com (Miha Valencic)
Date: Tue Jul  4 13:08:08 2006
Subject: [stringtemplate-interest] Attribute not found exception?
Message-ID: <233dfa1d0607041308q3787aa4diaeafed2216597700@mail.gmail.com>

Terence,

I to would like to know which attributes are needed in a given template.
Either by catching exception messages or by getting  a list of "used"
attributes in the list. I kind of though that Attributes property would
contain those, but found out that this collection is populated after the
SetAttribute method calls.

So, for now, I am using the block pasted below. Is there a better way to
achieve this? (I hope I am missing something :)). Good work though, thanks!
(I am using the C# version)

  Miha.

code to get all the required properties:

            StringTemplate st = new StringTemplate("I like $colour$ colour
and $temperature$ beer.");

            foreach (object o in st.Chunks) {
                if (o.GetType().ToString() == "
Antlr.StringTemplate.Language.ASTExpr") {
                    // do something with the attribute
                    st.SetAttribute(o.ToString().Trim(), "[value]");
                    // or
                    requiredAttributes.Add(o.ToString().Trim());
                }
            }

Terence wrote:
>On Mar 28, 2006, at 12:59 PM, David Moshal wrote:

>> Ter - I think the question was a little different. In actual use,
>> the system doesn't complain if you set an attribute which
>> doesn't exist, which becomes very hard to debug. One needs to look
>> at the generated code.

>Oh!  Right, Yes, that is a very big problem!  You are right. the
>problem is, how do you know what the complete set of attributes is?

>Ter
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.antlr.org:8080/pipermail/stringtemplate-interest/attachments/20060704/1b016f4a/attachment.html
From o.flege at market-maker.de  Thu Jul  6 00:23:27 2006
From: o.flege at market-maker.de (Oliver Flege)
Date: Thu Jul  6 00:23:31 2006
Subject: [stringtemplate-interest] Renderer "modes" 
Message-ID: <44ACBA6F.3000708@market-maker.de>

Hi,

I'm currently trying to switch our web frontends from Velocity to ST
and stumbled upon the 'Renderer "modes"' thread (mid June), because I also have
the need to support long and short forms for Date objects etc.

The recommendation back then was basically to subclass StringTemplate
as described in http://www.cs.usfca.edu/~parrt/papers/i18n.pdf
and to override the setAttribute method to add a wrapper object to the
model. For me, that's just not practical as it does not work for
attribute properties and it would be just too awkward to add each
property as a first-class attribute.

But I also agree with the comments in the mentioned thread that it does
not make sense to add the name of the format/rendering-method as a parameter
(e.g., ...;format="js")

Instead, I'd suggest the following:

1. define a group with required templates
  group foo;
  shortDate() ::= "<it>"
  longDate() ::= "<it>"

2. register custom attribute renderers for the _templates_:
  group.lookupTemplate("shortDate").registerRenderer(Date.class, new DateRenderer("MMM yy"));
  group.lookupTemplate("longDate").registerRenderer(Date.class, new DateRenderer("yyyy-MM-dd HH:mm:ss"));

3. apply templates:
    $d:shortDate()$          to format an attribute d using short format
    $bar.date:longDate()$    to format bar's date property using long format

To support this, it is at least necessary to
add the following line to StringTemplate.dup(...) (which is missing anyway):
         to.attributeRenderers = from.attributeRenderers;

In addition to that, it would be helpful to add methods to StringTemplateGroup to
register renderers for templates:
  registerRenderer(String templateName, Class c, Object o)
The group could then store this information and re-register the renderers whenever
it reloads the template (esp. during development).



Oliver

From praki.prakash at gmail.com  Thu Jul  6 14:01:50 2006
From: praki.prakash at gmail.com (Praki Prakash)
Date: Thu Jul  6 14:01:52 2006
Subject: [stringtemplate-interest] Problem in multivalued attribute handling?
Message-ID: <dca1034a0607061401k1043f7ddo3ef164d7ffd41971@mail.gmail.com>

Hi,

While using the Python version of StringTemplate, I noticed that my
multivalued attribute was missing all the zero values. The following snippet
demonstrates the problem. I am using version 2.2. Is this a bug? Is there a
workaround?

>>> import stringtemplate
>>> st=stringtemplate.StringTemplate("$[0,1,0,1]:{$it$}$")
>>> print st
11

Thanks
Praki
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.antlr.org:8080/pipermail/stringtemplate-interest/attachments/20060706/b003f911/attachment.html
From o.flege at market-maker.de  Fri Jul  7 01:13:49 2006
From: o.flege at market-maker.de (Oliver Flege)
Date: Fri Jul  7 01:13:52 2006
Subject: [stringtemplate-interest] ST in multi-threaded environment
Message-ID: <44AE17BD.20208@market-maker.de>

Hi,

when I first considered ST as a replacement for Velocity, I took it for granted
that ST would be thread-safe. Finding out that it is not, I'd like to ask
those of you who render Web-Pages with ST:

How do you use ST in a multi-threaded environment (i.e., a web-server)?
Do you just ignore thread-safety and hope for the best?
Do you rely on external synchronization?
Or...?

 Oliver


From parrt at cs.usfca.edu  Fri Jul  7 07:45:01 2006
From: parrt at cs.usfca.edu (Terence Parr)
Date: Fri Jul  7 07:45:02 2006
Subject: [stringtemplate-interest] ST in multi-threaded environment
In-Reply-To: <44AE17BD.20208@market-maker.de>
References: <44AE17BD.20208@market-maker.de>
Message-ID: <C64AF7A5-15A3-4B80-9DA3-BFB14E6D5D6D@cs.usfca.edu>


On Jul 7, 2006, at 1:13 AM, Oliver Flege wrote:

> Hi,
>
> when I first considered ST as a replacement for Velocity, I took it  
> for granted
> that ST would be thread-safe. Finding out that it is not, I'd like  
> to ask
> those of you who render Web-Pages with ST:
>
> How do you use ST in a multi-threaded environment (i.e., a web- 
> server)?
> Do you just ignore thread-safety and hope for the best?
> Do you rely on external synchronization?
> Or...?

Hi.  I used it for jGuru w/o issue.  I only had one thread generating  
each page, which is the normal case.  Remember multiple threads are  
never a problem if they work on different object instances. :)

Terence

From dmoshal at gmail.com  Fri Jul  7 07:48:56 2006
From: dmoshal at gmail.com (David Moshal)
Date: Fri Jul  7 07:48:58 2006
Subject: [stringtemplate-interest] ST in multi-threaded environment
In-Reply-To: <C64AF7A5-15A3-4B80-9DA3-BFB14E6D5D6D@cs.usfca.edu>
References: <44AE17BD.20208@market-maker.de>
	<C64AF7A5-15A3-4B80-9DA3-BFB14E6D5D6D@cs.usfca.edu>
Message-ID: <537739b70607070748n242aca05p6daf70c3eb9962df@mail.gmail.com>

agreed, besides, thread-safety comes with a performance penalty.
BTW - Ter are you using StringBuffers or StringBuilders internally?

Dave


On 7/7/06, Terence Parr <parrt@cs.usfca.edu> wrote:
>
>
> On Jul 7, 2006, at 1:13 AM, Oliver Flege wrote:
>
> > Hi,
> >
> > when I first considered ST as a replacement for Velocity, I took it
> > for granted
> > that ST would be thread-safe. Finding out that it is not, I'd like
> > to ask
> > those of you who render Web-Pages with ST:
> >
> > How do you use ST in a multi-threaded environment (i.e., a web-
> > server)?
> > Do you just ignore thread-safety and hope for the best?
> > Do you rely on external synchronization?
> > Or...?
>
> Hi.  I used it for jGuru w/o issue.  I only had one thread generating
> each page, which is the normal case.  Remember multiple threads are
> never a problem if they work on different object instances. :)
>
> Terence
>
> _______________________________________________
> stringtemplate-interest mailing list
> stringtemplate-interest@antlr.org
> http://www.antlr.org:8080/mailman/listinfo/stringtemplate-interest
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.antlr.org:8080/pipermail/stringtemplate-interest/attachments/20060707/79ef1131/attachment.html
From parrt at cs.usfca.edu  Fri Jul  7 07:57:02 2006
From: parrt at cs.usfca.edu (Terence Parr)
Date: Fri Jul  7 07:57:04 2006
Subject: [stringtemplate-interest] ST in multi-threaded environment
In-Reply-To: <537739b70607070748n242aca05p6daf70c3eb9962df@mail.gmail.com>
References: <44AE17BD.20208@market-maker.de>
	<C64AF7A5-15A3-4B80-9DA3-BFB14E6D5D6D@cs.usfca.edu>
	<537739b70607070748n242aca05p6daf70c3eb9962df@mail.gmail.com>
Message-ID: <20CE9482-4081-4CA8-85CB-3D1CE3FAB74B@cs.usfca.edu>


On Jul 7, 2006, at 7:48 AM, David Moshal wrote:

> agreed, besides, thread-safety comes with a performance penalty.
> BTW - Ter are you using StringBuffers or StringBuilders internally?
>

Neither...my goal was a straight pipe to the output writer, either a  
StringWriter by default or a writer that you provide.  I don't buffer  
up anything.  I compute and spit! :)  Believe me, that is a challenge  
when you want to remove whitespace and do auto indentation!

Ter

From parrt at cs.usfca.edu  Fri Jul  7 09:52:37 2006
From: parrt at cs.usfca.edu (Terence Parr)
Date: Fri Jul  7 09:51:01 2006
Subject: [stringtemplate-interest] ST in multi-threaded environment
In-Reply-To: <537739b70607070945ifdd2346x8a7a3bd2f2ece91a@mail.gmail.com>
References: <44AE17BD.20208@market-maker.de>
	<C64AF7A5-15A3-4B80-9DA3-BFB14E6D5D6D@cs.usfca.edu>
	<537739b70607070748n242aca05p6daf70c3eb9962df@mail.gmail.com>
	<20CE9482-4081-4CA8-85CB-3D1CE3FAB74B@cs.usfca.edu>
	<537739b70607070945ifdd2346x8a7a3bd2f2ece91a@mail.gmail.com>
Message-ID: <24424FBA-F2A2-4840-B9C7-B321745755EF@cs.usfca.edu>


On Jul 7, 2006, at 9:45 AM, David Moshal wrote:

> Interesting, so is it possible to pass in the  
> ServeletResponse.getWriter(), wrapped as a StringTemplateWriter, as  
> spit directly to that?

It should be, yes.

Ter
From Andrew.Goodnough at wicourts.gov  Fri Jul  7 10:18:48 2006
From: Andrew.Goodnough at wicourts.gov (Andrew Goodnough)
Date: Fri Jul  7 10:19:04 2006
Subject: ST examples in a web context (was [stringtemplate-interest] ST
	in multi-threaded environment)
In-Reply-To: <24424FBA-F2A2-4840-B9C7-B321745755EF@cs.usfca.edu>
References: <44AE17BD.20208@market-maker.de>
	<C64AF7A5-15A3-4B80-9DA3-BFB14E6D5D6D@cs.usfca.edu>
	<537739b70607070748n242aca05p6daf70c3eb9962df@mail.gmail.com>
	<20CE9482-4081-4CA8-85CB-3D1CE3FAB74B@cs.usfca.edu>
	<537739b70607070945ifdd2346x8a7a3bd2f2ece91a@mail.gmail.com>
	<24424FBA-F2A2-4840-B9C7-B321745755EF@cs.usfca.edu>
Message-ID: <44AE5128.954F.0081.0@wicourts.gov>

Anybody got a good (working or not) example of using ST in a web
context?  Terence already mentioned using ST (or an earlier incarnation)
for the jGuru site.  Is this available anywhere for download?  In my
imagination, one servlet could be responsible for joining the data with
the template but I'd love to see how someone's dealt with it.  I think
it would be a great fit with Struts where Struts takes care of the
application flow and ST does the rendering. 

Andy

>>> Terence Parr <parrt@cs.usfca.edu> 07/07/06 11:52 am >>>

On Jul 7, 2006, at 9:45 AM, David Moshal wrote:

> Interesting, so is it possible to pass in the 
> ServeletResponse.getWriter(), wrapped as a StringTemplateWriter, as 
> spit directly to that?

It should be, yes.

Ter
_______________________________________________
stringtemplate-interest mailing list
stringtemplate-interest@antlr.org
http://www.antlr.org:8080/mailman/listinfo/stringtemplate-interest

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.antlr.org:8080/pipermail/stringtemplate-interest/attachments/20060707/fcde9ffb/attachment.html
From parrt at cs.usfca.edu  Fri Jul  7 10:44:11 2006
From: parrt at cs.usfca.edu (Terence Parr)
Date: Fri Jul  7 10:42:36 2006
Subject: ST examples in a web context (was [stringtemplate-interest] ST in
	multi-threaded environment)
In-Reply-To: <44AE5128.954F.0081.0@wicourts.gov>
References: <44AE17BD.20208@market-maker.de>
	<C64AF7A5-15A3-4B80-9DA3-BFB14E6D5D6D@cs.usfca.edu>
	<537739b70607070748n242aca05p6daf70c3eb9962df@mail.gmail.com>
	<20CE9482-4081-4CA8-85CB-3D1CE3FAB74B@cs.usfca.edu>
	<537739b70607070945ifdd2346x8a7a3bd2f2ece91a@mail.gmail.com>
	<24424FBA-F2A2-4840-B9C7-B321745755EF@cs.usfca.edu>
	<44AE5128.954F.0081.0@wicourts.gov>
Message-ID: <61E9A92C-7591-4A84-B192-B6F9F4A97756@cs.usfca.edu>


On Jul 7, 2006, at 10:18 AM, Andrew Goodnough wrote:

> Anybody got a good (working or not) example of using ST in a web  
> context?  Terence already mentioned using ST (or an earlier  
> incarnation) for the jGuru site.  Is this available anywhere for  
> download?  In my imagination, one servlet could be responsible for  
> joining the data with the template but I'd love to see how  
> someone's dealt with it.  I think it would be a great fit with  
> Struts where Struts takes care of the application flow and ST does  
> the rendering
Have you taken a look at:

http://www.cs.usfca.edu/~parrt/course/601/lectures/page.generation.html

That explains my philosophy a bit.  But, perhaps I should put up a  
tarball of the antlr.org site.  I *think* I open sourced my old  
peerscope site as well.

Ter
From parrt at cs.usfca.edu  Fri Jul  7 10:46:46 2006
From: parrt at cs.usfca.edu (Terence Parr)
Date: Fri Jul  7 10:45:13 2006
Subject: [stringtemplate-interest] Re: followup: ST examples in a web context
In-Reply-To: <61E9A92C-7591-4A84-B192-B6F9F4A97756@cs.usfca.edu>
References: <44AE17BD.20208@market-maker.de>
	<C64AF7A5-15A3-4B80-9DA3-BFB14E6D5D6D@cs.usfca.edu>
	<537739b70607070748n242aca05p6daf70c3eb9962df@mail.gmail.com>
	<20CE9482-4081-4CA8-85CB-3D1CE3FAB74B@cs.usfca.edu>
	<537739b70607070945ifdd2346x8a7a3bd2f2ece91a@mail.gmail.com>
	<24424FBA-F2A2-4840-B9C7-B321745755EF@cs.usfca.edu>
	<44AE5128.954F.0081.0@wicourts.gov>
	<61E9A92C-7591-4A84-B192-B6F9F4A97756@cs.usfca.edu>
Message-ID: <2A15DF5B-0D57-4150-8C33-0E2C7C17D42F@cs.usfca.edu>

Also, see:

http://www.cs.usfca.edu/~parrt/course/601/lectures/stringtemplate.html

Ter
On Jul 7, 2006, at 10:44 AM, Terence Parr wrote:

>
> On Jul 7, 2006, at 10:18 AM, Andrew Goodnough wrote:
>
>> Anybody got a good (working or not) example of using ST in a web  
>> context?  Terence already mentioned using ST (or an earlier  
>> incarnation) for the jGuru site.  Is this available anywhere for  
>> download?  In my imagination, one servlet could be responsible for  
>> joining the data with the template but I'd love to see how  
>> someone's dealt with it.  I think it would be a great fit with  
>> Struts where Struts takes care of the application flow and ST does  
>> the rendering
> Have you taken a look at:
>
> http://www.cs.usfca.edu/~parrt/course/601/lectures/ 
> page.generation.html
>
> That explains my philosophy a bit.  But, perhaps I should put up a  
> tarball of the antlr.org site.  I *think* I open sourced my old  
> peerscope site as well.
>
> Ter
> _______________________________________________
> stringtemplate-interest mailing list
> stringtemplate-interest@antlr.org
> http://www.antlr.org:8080/mailman/listinfo/stringtemplate-interest

From parrt at cs.usfca.edu  Fri Jul  7 14:28:41 2006
From: parrt at cs.usfca.edu (Terence Parr)
Date: Fri Jul  7 14:27:07 2006
Subject: [stringtemplate-interest] pageforge link with antlr.org /
	peerscope.com source
In-Reply-To: <44AE5B10.954F.0081.0@wicourts.gov>
References: <44AE17BD.20208@market-maker.de>
	<C64AF7A5-15A3-4B80-9DA3-BFB14E6D5D6D@cs.usfca.edu>
	<537739b70607070748n242aca05p6daf70c3eb9962df@mail.gmail.com>
	<20CE9482-4081-4CA8-85CB-3D1CE3FAB74B@cs.usfca.edu>
	<537739b70607070945ifdd2346x8a7a3bd2f2ece91a@mail.gmail.com>
	<24424FBA-F2A2-4840-B9C7-B321745755EF@cs.usfca.edu>
	<44AE5128.954F.0081.0@wicourts.gov>
	<61E9A92C-7591-4A84-B192-B6F9F4A97756@cs.usfca.edu>
	<44AE5B10.954F.0081.0@wicourts.gov>
Message-ID: <EDF3BB46-553F-40A8-BCF1-F642E5DEC6AE@cs.usfca.edu>

Ok, i found the open source software and here it is:

http://www.antlr.org/download/pageforge-1.0.4.tar.gz

Ter
On Jul 7, 2006, at 11:01 AM, Andrew Goodnough wrote:

> Thanks for the links.  The first one was new to me and close to  
> what I was looking for.  A tarball would be great, too.
>
>
> Andy
>
>

From Kunle_Odutola at hotmail.com  Fri Jul  7 14:42:51 2006
From: Kunle_Odutola at hotmail.com (Kunle Odutola)
Date: Fri Jul  7 14:29:26 2006
Subject: ST examples in a web context (was [stringtemplate-interest] STin
	multi-threaded environment)
References: <44AE17BD.20208@market-maker.de><C64AF7A5-15A3-4B80-9DA3-BFB14E6D5D6D@cs.usfca.edu><537739b70607070748n242aca05p6daf70c3eb9962df@mail.gmail.com><20CE9482-4081-4CA8-85CB-3D1CE3FAB74B@cs.usfca.edu><537739b70607070945ifdd2346x8a7a3bd2f2ece91a@mail.gmail.com><24424FBA-F2A2-4840-B9C7-B321745755EF@cs.usfca.edu>
	<44AE5128.954F.0081.0@wicourts.gov>
Message-ID: <BAY101-DAV180756D055547F1DF5917781740@phx.gbl>

> From: "Andrew Goodnough"
> Anybody got a good (working or not) example of using ST in a web
> context?

Castle MonoRail has a StringTemplate view engine.
So does Maverick.NET

Both are C# projects. As frameworks, they might be more complex that what
you seek. More like the Struts comment than a basic ST use in web apps.

Kunle
From ccbean at gmail.com  Fri Jul  7 14:55:16 2006
From: ccbean at gmail.com (Colin Bean)
Date: Fri Jul  7 14:55:19 2006
Subject: [stringtemplate-interest] Problem in multivalued attribute
	handling?
In-Reply-To: <dca1034a0607061401k1043f7ddo3ef164d7ffd41971@mail.gmail.com>
References: <dca1034a0607061401k1043f7ddo3ef164d7ffd41971@mail.gmail.com>
Message-ID: <29a6ca010607071455x4453ebfdg7ac9e97ec5b55ba9@mail.gmail.com>

Hi Praki,

I noticed a similar issue recently; I hadn't gotten around to looking
at it in depth (I also hadn't verified it in 2.2 yet, but sounds like
its still there).  As far as I know, PyST won't render any attribute
(that's passed as an int or float) with a value of zero.  I haven't
looked at the source code, but I assume that somewhere there's a
conditional that checks for the value/existence of an attribute, then
checks it in such a way that a 0 evaluates to false and ST doesn't
think that the attribute exists.  If you're passing integer values
into a template, casting them to a string before passing them causes
all zero values to render correctly (that's the workaround I've been
using for now, anyway).

So I haven't verified if this is expected behavior or if this is
unique to the python implementation, but I've noticed the same
behavior.   I'm on vacation this weekend, so I don't have any ST code
near at hand, but when I get back I'll verify the above assumptions
and report back ;)

Anyone else?  Is this a feature or a bug?

Thanks,
-Colin

On 7/6/06, Praki Prakash <praki.prakash@gmail.com> wrote:
> Hi,
>
> While using the Python version of StringTemplate, I noticed that my
> multivalued attribute was missing all the zero values. The following snippet
> demonstrates the problem. I am using version 2.2. Is this a bug? Is there a
> workaround?
>
> >>> import stringtemplate
> >>> st=stringtemplate.StringTemplate("$[0,1,0,1]:{$it$}$")
> >>> print st
> 11
>
> Thanks
> Praki
> _______________________________________________
> stringtemplate-interest mailing list
> stringtemplate-interest@antlr.org
> http://www.antlr.org:8080/mailman/listinfo/stringtemplate-interest
>
>
>
From praki.prakash at gmail.com  Sat Jul  8 12:11:18 2006
From: praki.prakash at gmail.com (Praki Prakash)
Date: Sat Jul  8 12:11:21 2006
Subject: [stringtemplate-interest] Problem in multivalued attribute
	handling?
In-Reply-To: <29a6ca010607071455x4453ebfdg7ac9e97ec5b55ba9@mail.gmail.com>
References: <dca1034a0607061401k1043f7ddo3ef164d7ffd41971@mail.gmail.com>
	<29a6ca010607071455x4453ebfdg7ac9e97ec5b55ba9@mail.gmail.com>
Message-ID: <dca1034a0607081211r49fdf937k276f8918d43539f0@mail.gmail.com>

Hi Colin,

Thanks for your response.

I suspect as much that the code is written as "if attr:" which would cause
all numerical zeros to evaluate to false. From my perspective, this is a
terrible bug making ST completely unusable. My model is full of
multi-dimensional data and quite a bit of it is 0. Unfortunately, the
workaround you suggest is not really usable as I need numerical data to do
computations and having to generate a stringified version is too much work
and inelegant.

I tried to hack the code a bit. I found a method, convertAnythingToList and
tried to alter the way it checks attributes. My intuition proved to be wrong
and it didn't fix the issue. I suspect there is more code elsewhere that
needs change. Unfortunately, I don't have time to look into this and have
had to suspend the use of StringTemplate in project for now. If you come up
with patches, please post :)

Thanks,
Praki

On 7/7/06, Colin Bean <ccbean@gmail.com> wrote:
>
> Hi Praki,
>
> I noticed a similar issue recently; I hadn't gotten around to looking
> at it in depth (I also hadn't verified it in 2.2 yet, but sounds like
> its still there).  As far as I know, PyST won't render any attribute
> (that's passed as an int or float) with a value of zero.  I haven't
> looked at the source code, but I assume that somewhere there's a
> conditional that checks for the value/existence of an attribute, then
> checks it in such a way that a 0 evaluates to false and ST doesn't
> think that the attribute exists.  If you're passing integer values
> into a template, casting them to a string before passing them causes
> all zero values to render correctly (that's the workaround I've been
> using for now, anyway).
>
> So I haven't verified if this is expected behavior or if this is
> unique to the python implementation, but I've noticed the same
> behavior.   I'm on vacation this weekend, so I don't have any ST code
> near at hand, but when I get back I'll verify the above assumptions
> and report back ;)
>
> Anyone else?  Is this a feature or a bug?
>
> Thanks,
> -Colin
>
> On 7/6/06, Praki Prakash <praki.prakash@gmail.com> wrote:
> > Hi,
> >
> > While using the Python version of StringTemplate, I noticed that my
> > multivalued attribute was missing all the zero values. The following
> snippet
> > demonstrates the problem. I am using version 2.2. Is this a bug? Is
> there a
> > workaround?
> >
> > >>> import stringtemplate
> > >>> st=stringtemplate.StringTemplate("$[0,1,0,1]:{$it$}$")
> > >>> print st
> > 11
> >
> > Thanks
> > Praki
> > _______________________________________________
> > stringtemplate-interest mailing list
> > stringtemplate-interest@antlr.org
> > http://www.antlr.org:8080/mailman/listinfo/stringtemplate-interest
> >
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.antlr.org:8080/pipermail/stringtemplate-interest/attachments/20060708/bcdedb39/attachment.html
From parrt at cs.usfca.edu  Sat Jul  8 16:43:09 2006
From: parrt at cs.usfca.edu (Terence Parr)
Date: Sat Jul  8 16:43:12 2006
Subject: [stringtemplate-interest] Problem in multivalued attribute
	handling?
In-Reply-To: <dca1034a0607081211r49fdf937k276f8918d43539f0@mail.gmail.com>
References: <dca1034a0607061401k1043f7ddo3ef164d7ffd41971@mail.gmail.com>
	<29a6ca010607071455x4453ebfdg7ac9e97ec5b55ba9@mail.gmail.com>
	<dca1034a0607081211r49fdf937k276f8918d43539f0@mail.gmail.com>
Message-ID: <479A89EA-08CF-48B5-B29C-348E45E37FF6@cs.usfca.edu>


On Jul 8, 2006, at 12:11 PM, Praki Prakash wrote:

> Hi Colin,
>
> Thanks for your response.
>
> I suspect as much that the code is written as "if attr:" which  
> would cause all numerical zeros to evaluate to false.

Could it be that Python treats 0 as false for some reason?  Python  
has booleans, right?

0 is not missing by definition; so must be a Python bug that's  
all...I'm cc'ing Python guy Marq.

Ter


> From my perspective, this is a terrible bug making ST completely  
> unusable. My model is full of multi-dimensional data and quite a  
> bit of it is 0. Unfortunately, the workaround you suggest is not  
> really usable as I need numerical data to do computations and  
> having to generate a stringified version is too much work and  
> inelegant.
>
> I tried to hack the code a bit. I found a method,  
> convertAnythingToList and tried to alter the way it checks  
> attributes. My intuition proved to be wrong and it didn't fix the  
> issue. I suspect there is more code elsewhere that needs change.  
> Unfortunately, I don't have time to look into this and have had to  
> suspend the use of StringTemplate in project for now. If you come  
> up with patches, please post :)
>
> Thanks,
> Praki
>
> On 7/7/06, Colin Bean <ccbean@gmail.com> wrote: Hi Praki,
>
> I noticed a similar issue recently; I hadn't gotten around to looking
> at it in depth (I also hadn't verified it in 2.2 yet, but sounds like
> its still there).  As far as I know, PyST won't render any attribute
> (that's passed as an int or float) with a value of zero.  I haven't
> looked at the source code, but I assume that somewhere there's a
> conditional that checks for the value/existence of an attribute, then
> checks it in such a way that a 0 evaluates to false and ST doesn't
> think that the attribute exists.  If you're passing integer values
> into a template, casting them to a string before passing them causes
> all zero values to render correctly (that's the workaround I've been
> using for now, anyway).
>
> So I haven't verified if this is expected behavior or if this is
> unique to the python implementation, but I've noticed the same
> behavior.   I'm on vacation this weekend, so I don't have any ST code
> near at hand, but when I get back I'll verify the above assumptions
> and report back ;)
>
> Anyone else?  Is this a feature or a bug?
>
> Thanks,
> -Colin
>
> On 7/6/06, Praki Prakash <praki.prakash@gmail.com> wrote:
> > Hi,
> >
> > While using the Python version of StringTemplate, I noticed that my
> > multivalued attribute was missing all the zero values. The  
> following snippet
> > demonstrates the problem. I am using version 2.2. Is this a bug?  
> Is there a
> > workaround?
> >
> > >>> import stringtemplate
> > >>> st=stringtemplate.StringTemplate("$[0,1,0,1]:{$it$}$")
> > >>> print st
> > 11
> >
> > Thanks
> > Praki
> > _______________________________________________
> > stringtemplate-interest mailing list
> > stringtemplate-interest@antlr.org
> > http://www.antlr.org:8080/mailman/listinfo/stringtemplate-interest
> >
> >
> >
>
> _______________________________________________
> stringtemplate-interest mailing list
> stringtemplate-interest@antlr.org
> http://www.antlr.org:8080/mailman/listinfo/stringtemplate-interest

From praki.prakash at gmail.com  Sat Jul  8 18:27:16 2006
From: praki.prakash at gmail.com (Praki Prakash)
Date: Sat Jul  8 18:27:18 2006
Subject: [stringtemplate-interest] Problem in multivalued attribute
	handling?
In-Reply-To: <479A89EA-08CF-48B5-B29C-348E45E37FF6@cs.usfca.edu>
References: <dca1034a0607061401k1043f7ddo3ef164d7ffd41971@mail.gmail.com>
	<29a6ca010607071455x4453ebfdg7ac9e97ec5b55ba9@mail.gmail.com>
	<dca1034a0607081211r49fdf937k276f8918d43539f0@mail.gmail.com>
	<479A89EA-08CF-48B5-B29C-348E45E37FF6@cs.usfca.edu>
Message-ID: <dca1034a0607081827u50551b0by1d033635b2ff20ec@mail.gmail.com>

Terence,

Thanks for the response. Allow me to say that your String Template design is
excellent and I hope it catches on. As someone who has had to fix a
ColdFusion based application with absolutely no concept of model-view and
their separation, I can see how a well-defined template engine can prevent
monstrosities being created. StringTemplate is certainly a good example of
less being more!

As far as my problem, Python's definition of True/False is below:

In the context of Boolean operations, and also when expressions are used by
control flow statements, the following values are interpreted as false:
False, None, numeric zero of all types, and empty strings and containers
(including strings, tuples, lists, dictionaries, sets and frozensets). All
other values are interpreted as true.

The Pythonic way to explicitly check for non-existent values is "if x is
None:". My quick glance at the Python code seemed to contain "if x:".

Thanks,
Praki



On 7/8/06, Terence Parr <parrt@cs.usfca.edu> wrote:
>
>
> On Jul 8, 2006, at 12:11 PM, Praki Prakash wrote:
>
> > Hi Colin,
> >
> > Thanks for your response.
> >
> > I suspect as much that the code is written as "if attr:" which
> > would cause all numerical zeros to evaluate to false.
>
> Could it be that Python treats 0 as false for some reason?  Python
> has booleans, right?
>
> 0 is not missing by definition; so must be a Python bug that's
> all...I'm cc'ing Python guy Marq.
>
> Ter
>
>
> > From my perspective, this is a terrible bug making ST completely
> > unusable. My model is full of multi-dimensional data and quite a
> > bit of it is 0. Unfortunately, the workaround you suggest is not
> > really usable as I need numerical data to do computations and
> > having to generate a stringified version is too much work and
> > inelegant.
> >
> > I tried to hack the code a bit. I found a method,
> > convertAnythingToList and tried to alter the way it checks
> > attributes. My intuition proved to be wrong and it didn't fix the
> > issue. I suspect there is more code elsewhere that needs change.
> > Unfortunately, I don't have time to look into this and have had to
> > suspend the use of StringTemplate in project for now. If you come
> > up with patches, please post :)
> >
> > Thanks,
> > Praki
> >
> > On 7/7/06, Colin Bean <ccbean@gmail.com> wrote: Hi Praki,
> >
> > I noticed a similar issue recently; I hadn't gotten around to looking
> > at it in depth (I also hadn't verified it in 2.2 yet, but sounds like
> > its still there).  As far as I know, PyST won't render any attribute
> > (that's passed as an int or float) with a value of zero.  I haven't
> > looked at the source code, but I assume that somewhere there's a
> > conditional that checks for the value/existence of an attribute, then
> > checks it in such a way that a 0 evaluates to false and ST doesn't
> > think that the attribute exists.  If you're passing integer values
> > into a template, casting them to a string before passing them causes
> > all zero values to render correctly (that's the workaround I've been
> > using for now, anyway).
> >
> > So I haven't verified if this is expected behavior or if this is
> > unique to the python implementation, but I've noticed the same
> > behavior.   I'm on vacation this weekend, so I don't have any ST code
> > near at hand, but when I get back I'll verify the above assumptions
> > and report back ;)
> >
> > Anyone else?  Is this a feature or a bug?
> >
> > Thanks,
> > -Colin
> >
> > On 7/6/06, Praki Prakash <praki.prakash@gmail.com> wrote:
> > > Hi,
> > >
> > > While using the Python version of StringTemplate, I noticed that my
> > > multivalued attribute was missing all the zero values. The
> > following snippet
> > > demonstrates the problem. I am using version 2.2. Is this a bug?
> > Is there a
> > > workaround?
> > >
> > > >>> import stringtemplate
> > > >>> st=stringtemplate.StringTemplate("$[0,1,0,1]:{$it$}$")
> > > >>> print st
> > > 11
> > >
> > > Thanks
> > > Praki
> > > _______________________________________________
> > > stringtemplate-interest mailing list
> > > stringtemplate-interest@antlr.org
> > > http://www.antlr.org:8080/mailman/listinfo/stringtemplate-interest
> > >
> > >
> > >
> >
> > _______________________________________________
> > stringtemplate-interest mailing list
> > stringtemplate-interest@antlr.org
> > http://www.antlr.org:8080/mailman/listinfo/stringtemplate-interest
>
> _______________________________________________
> stringtemplate-interest mailing list
> stringtemplate-interest@antlr.org
> http://www.antlr.org:8080/mailman/listinfo/stringtemplate-interest
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.antlr.org:8080/pipermail/stringtemplate-interest/attachments/20060708/2c75b649/attachment.html
From o.flege at market-maker.de  Sun Jul  9 23:37:01 2006
From: o.flege at market-maker.de (Oliver Flege)
Date: Sun Jul  9 23:37:05 2006
Subject: [stringtemplate-interest] ST in multi-threaded environment
In-Reply-To: <537739b70607070748n242aca05p6daf70c3eb9962df@mail.gmail.com>
References: <44AE17BD.20208@market-maker.de>	<C64AF7A5-15A3-4B80-9DA3-BFB14E6D5D6D@cs.usfca.edu>
	<537739b70607070748n242aca05p6daf70c3eb9962df@mail.gmail.com>
Message-ID: <44B1F58D.6070302@market-maker.de>

Hi,

David Moshal wrote:
> agreed, besides, thread-safety comes with a performance penalty.
of course, but compared to the rendering a complete web-page, the
required synchronization cost would be marginal (less than 1% I'd guess).
Besides, if you use a program in a multi-threaded environment, you just
don't have a choice: either it's thread-safe or it will break (sooner or
later) (see: "Java Concurrency in Practice" by Brian Goetz)

> BTW - Ter are you using StringBuffers or StringBuilders internally?

StringTemplate's toString method uses a StringWriter which internally
uses a StringBuffer.

On 7/7/06, Terence Parr <parrt@cs.usfca.edu> wrote:
>     Hi.  I used it for jGuru w/o issue.  I only had one thread generating
>     each page, which is the normal case.  Remember multiple threads are
>     never a problem if they work on different object instances. :)

Even if each page is rendered by a single thread (which is the normal
case for me, too), those threads do _not_ work exclusively on different object instances.
They most likely share the same StringTemplateGroup to access templates -- and even
if they don't, there are still issues with static Maps in StringTemplateGroup.

In the end, there are multiple threads that manipulate shared state w/o synchronization.
Just calling put/get from multiple threads on the same HashMap will sooner or later
fail if no synchronization is used.


 OLiver






From parrt at cs.usfca.edu  Mon Jul 10 10:55:52 2006
From: parrt at cs.usfca.edu (Terence Parr)
Date: Mon Jul 10 10:54:07 2006
Subject: [stringtemplate-interest] Problem in multivalued attribute
	handling?
In-Reply-To: <dca1034a0607081827u50551b0by1d033635b2ff20ec@mail.gmail.com>
References: <dca1034a0607061401k1043f7ddo3ef164d7ffd41971@mail.gmail.com>
	<29a6ca010607071455x4453ebfdg7ac9e97ec5b55ba9@mail.gmail.com>
	<dca1034a0607081211r49fdf937k276f8918d43539f0@mail.gmail.com>
	<479A89EA-08CF-48B5-B29C-348E45E37FF6@cs.usfca.edu>
	<dca1034a0607081827u50551b0by1d033635b2ff20ec@mail.gmail.com>
Message-ID: <22EAB94D-FA5F-48E7-89BC-B17AAF573975@cs.usfca.edu>


On Jul 8, 2006, at 6:27 PM, Praki Prakash wrote:

> Terence,
>
> Thanks for the response. Allow me to say that your String Template  
> design is excellent and I hope it catches on.

It is rapidly gaining ground.  Last year at this time we had 200  
downloads a month...i believe it's 600/month now.

> As someone who has had to fix a ColdFusion based application with  
> absolutely no concept of model-view and their separation, I can see  
> how a well-defined template engine can prevent monstrosities being  
> created. StringTemplate is certainly a good example of less being  
> more!
>
> As far as my problem, Python's definition of True/False is below:
>
> In the context of Boolean operations, and also when expressions are  
> used by control flow statements, the following values are  
> interpreted as false: False, None, numeric zero of all types, and  
> empty strings and containers (including strings, tuples, lists,  
> dictionaries, sets and frozensets). All other values are  
> interpreted as true.

Hmm...should be only Boolean objects that are exceptions.  Anything  
else is "presence/absence"?

> The Pythonic way to explicitly check for non-existent values is "if  
> x is None:". My quick glance at the Python code seemed to contain  
> "if x:".

Any other Python folks wanna comment on IF processing?

Ter

From parrt at cs.usfca.edu  Mon Jul 10 11:00:12 2006
From: parrt at cs.usfca.edu (Terence Parr)
Date: Mon Jul 10 10:58:25 2006
Subject: [stringtemplate-interest] ST in multi-threaded environment
In-Reply-To: <44B1F58D.6070302@market-maker.de>
References: <44AE17BD.20208@market-maker.de>	<C64AF7A5-15A3-4B80-9DA3-BFB14E6D5D6D@cs.usfca.edu>
	<537739b70607070748n242aca05p6daf70c3eb9962df@mail.gmail.com>
	<44B1F58D.6070302@market-maker.de>
Message-ID: <9014AD4C-F593-411D-80EE-D5A8B552E6BD@cs.usfca.edu>


On Jul 9, 2006, at 11:37 PM, Oliver Flege wrote:

> Hi,
>
> David Moshal wrote:
>> agreed, besides, thread-safety comes with a performance penalty.
> of course, but compared to the rendering a complete web-page, the
> required synchronization cost would be marginal (less than 1% I'd  
> guess).
> Besides, if you use a program in a multi-threaded environment, you  
> just
> don't have a choice: either it's thread-safe or it will break  
> (sooner or
> later) (see: "Java Concurrency in Practice" by Brian Goetz)

The surest way to create deadlock is to make everything "threadsafe"  
by putting synchronized everywhere.  ;)  Not that that is what you  
are suggesting, but one must be careful...

ST cannot change values and so multi-threads are free to create  
multiple instances at any time.  jGuru does this as do all my other  
sites.  No problem.  Only problem you have is when your data  
structures change out from underneath ST, which it cannot prevent.   
You can choose to pass in Vector not ArrayList and that should solve  
that problem.  i create ArrayList objects for multi-attributes, but  
you don't have a ptr to it and can't muck with it.

I don't think we have a threading issue...can somebody point out a  
scenario?  I'd be very happy to address it in the code or at least  
doc ;)

Ter
From parrt at cs.usfca.edu  Mon Jul 10 11:01:23 2006
From: parrt at cs.usfca.edu (Terence Parr)
Date: Mon Jul 10 10:59:35 2006
Subject: [stringtemplate-interest] Problem in multivalued attribute
	handling?
In-Reply-To: <29a6ca010607071455x4453ebfdg7ac9e97ec5b55ba9@mail.gmail.com>
References: <dca1034a0607061401k1043f7ddo3ef164d7ffd41971@mail.gmail.com>
	<29a6ca010607071455x4453ebfdg7ac9e97ec5b55ba9@mail.gmail.com>
Message-ID: <96392FFD-9717-42C5-B343-9E7BFCFAA4AF@cs.usfca.edu>


On Jul 7, 2006, at 2:55 PM, Colin Bean wrote:

> Hi Praki,
>
> I noticed a similar issue recently; I hadn't gotten around to looking
> at it in depth (I also hadn't verified it in 2.2 yet, but sounds like
> its still there).  As far as I know, PyST won't render any attribute
> (that's passed as an int or float) with a value of zero.  I haven't
> looked at the source code, but I assume that somewhere there's a
> conditional that checks for the value/existence of an attribute, then
> checks it in such a way that a 0 evaluates to false and ST doesn't
> think that the attribute exists.  If you're passing integer values
> into a template, casting them to a string before passing them causes
> all zero values to render correctly (that's the workaround I've been
> using for now, anyway).

I think this is simply a disconnect; I'll work with Marq to figure  
this out when he pops his head up :) He must be very busy right now.

Ter

From ccbean at gmail.com  Tue Jul 11 09:24:07 2006
From: ccbean at gmail.com (Colin Bean)
Date: Tue Jul 11 09:24:12 2006
Subject: [stringtemplate-interest] Problem in multivalued attribute
	handling?
In-Reply-To: <96392FFD-9717-42C5-B343-9E7BFCFAA4AF@cs.usfca.edu>
References: <dca1034a0607061401k1043f7ddo3ef164d7ffd41971@mail.gmail.com>
	<29a6ca010607071455x4453ebfdg7ac9e97ec5b55ba9@mail.gmail.com>
	<96392FFD-9717-42C5-B343-9E7BFCFAA4AF@cs.usfca.edu>
Message-ID: <29a6ca010607110924r612d4e5aq5bcfedc9a454fd73@mail.gmail.com>

Okay, I've got the beginnings of a fix.  The problem is indeed in
checking for the existence of an attribute.  As Praki mentioned
earlier, using a conditional like "if x:" looks like it should simply
check for the existence of x, but in fact evaluates to false not only
if x is None, but also if x is an empty container or a numeric zero.
It's a weird little python feature that has bitten me a couple of
times; the solution is to explicitly check if a value is None.
I'm sure that there are many other places in the code that could use a
review for this, the following changes made PyST correctly evaluate a
(single or multi-valued) attribute with the integer value of zero.  I
changed one line in StringTemplate.py, where it checks for the
attribute's existence before setting it, and one in
language/ASTExpr.py, where it again checks existence before writing an
attribute out.  I ran the code through the unit tests and it was fine,
but other than that and my "zero" test I haven't run this code
anywhere else -- ymmv.  Here's a diff of the changes:

--- StringTemplateOrig.py       2006-07-10 15:53:44.000000000 -0700
+++ StringTemplate.py   2006-07-10 15:59:49.000000000 -0700
@@ -677,7 +677,7 @@
             # a normal call to setAttribute with unknown attribute
             raise KeyError("no such attribute: " + name +
                " in template context " +
self.getEnclosingInstanceStackString())
-        if value:
+        if value is not None:
             attributes[name] = value
         elif isinstance(value, list) or \
              isinstance(value, dict) or \
--- language/ASTExprOrig.py     2006-07-10 15:57:35.000000000 -0700
+++ language/ASTExpr.py 2006-07-10 15:11:35.000000000 -0700
@@ -390,7 +390,7 @@
         return self._write(this, o, out, separator)

     def _write(self, this, o, out, separator):
-        if not o:
+        if o is None:
             return 0
         n = 0
         try:


If I find anything else relevant to this I'll post it.
Regards,
-Colin
From parrt at cs.usfca.edu  Tue Jul 11 12:58:24 2006
From: parrt at cs.usfca.edu (Terence Parr)
Date: Tue Jul 11 12:56:32 2006
Subject: [stringtemplate-interest] Problem in multivalued attribute
	handling?
In-Reply-To: <29a6ca010607110924r612d4e5aq5bcfedc9a454fd73@mail.gmail.com>
References: <dca1034a0607061401k1043f7ddo3ef164d7ffd41971@mail.gmail.com>
	<29a6ca010607071455x4453ebfdg7ac9e97ec5b55ba9@mail.gmail.com>
	<96392FFD-9717-42C5-B343-9E7BFCFAA4AF@cs.usfca.edu>
	<29a6ca010607110924r612d4e5aq5bcfedc9a454fd73@mail.gmail.com>
Message-ID: <70D99E87-C5D2-4250-9F29-33328C2CE080@cs.usfca.edu>


On Jul 11, 2006, at 9:24 AM, Colin Bean wrote:

> Okay, I've got the beginnings of a fix.  The problem is indeed in
> checking for the existence of an attribute.  As Praki mentioned
> earlier, using a conditional like "if x:" looks like it should simply
> check for the existence of x, but in fact evaluates to false not only
> if x is None, but also if x is an empty container or a numeric zero.

Empty container is correct, but 0 is incorrect ;)

> It's a weird little python feature that has bitten me a couple of
> times; the solution is to explicitly check if a value is None.
> I'm sure that there are many other places in the code that could use a
> review for this, the following changes made PyST correctly evaluate a
> (single or multi-valued) attribute with the integer value of zero.  I
> changed one line in StringTemplate.py, where it checks for the
> attribute's existence before setting it, and one in
> language/ASTExpr.py, where it again checks existence before writing an
> attribute out.  I ran the code through the unit tests and it was fine,
> but other than that and my "zero" test I haven't run this code
> anywhere else -- ymmv.  Here's a diff of the changes:

Sweet!  Thanks, Colin :)  I'm CC'ing Marq in case he misses this.

Ter
> --- StringTemplateOrig.py       2006-07-10 15:53:44.000000000 -0700
> +++ StringTemplate.py   2006-07-10 15:59:49.000000000 -0700
> @@ -677,7 +677,7 @@
>             # a normal call to setAttribute with unknown attribute
>             raise KeyError("no such attribute: " + name +
>                " in template context " +
> self.getEnclosingInstanceStackString())
> -        if value:
> +        if value is not None:
>             attributes[name] = value
>         elif isinstance(value, list) or \
>              isinstance(value, dict) or \
> --- language/ASTExprOrig.py     2006-07-10 15:57:35.000000000 -0700
> +++ language/ASTExpr.py 2006-07-10 15:11:35.000000000 -0700
> @@ -390,7 +390,7 @@
>         return self._write(this, o, out, separator)
>
>     def _write(self, this, o, out, separator):
> -        if not o:
> +        if o is None:
>             return 0
>         n = 0
>         try:
>
>
> If I find anything else relevant to this I'll post it.
> Regards,
> -Colin
> _______________________________________________
> stringtemplate-interest mailing list
> stringtemplate-interest@antlr.org
> http://www.antlr.org:8080/mailman/listinfo/stringtemplate-interest

From ccbean at gmail.com  Tue Jul 11 13:38:11 2006
From: ccbean at gmail.com (Colin Bean)
Date: Tue Jul 11 13:38:16 2006
Subject: [stringtemplate-interest] Problem in multivalued attribute
	handling?
In-Reply-To: <70D99E87-C5D2-4250-9F29-33328C2CE080@cs.usfca.edu>
References: <dca1034a0607061401k1043f7ddo3ef164d7ffd41971@mail.gmail.com>
	<29a6ca010607071455x4453ebfdg7ac9e97ec5b55ba9@mail.gmail.com>
	<96392FFD-9717-42C5-B343-9E7BFCFAA4AF@cs.usfca.edu>
	<29a6ca010607110924r612d4e5aq5bcfedc9a454fd73@mail.gmail.com>
	<70D99E87-C5D2-4250-9F29-33328C2CE080@cs.usfca.edu>
Message-ID: <29a6ca010607111338r495705e6p9d2fc3c0bb5587bd@mail.gmail.com>

Sounds good!  However, after experimenting further, I realize there's
a couple of problems with my changes after I tried some more complex
templates.  A value of zero passed as an element in a list (to a
template that iterates over it) is not displayed -- not surprising
since I didn't examine that part of the code.  Also, passing a zero in
as an attribute property throws an error :(  I'll look at it further
tonight and get a complete set of changes together.
I wanted to mention that the unit tests don't seem to pass in a zero
at any point; this might be worth including in the future (although
Python is one of the few languages where this would matter).
Lastly, I want to say thanks to Marq for the new Python versions (and
Terrence for ST -- goes without saying ;)  It's a great tool and very
much appreciated.

-Colin

On 7/11/06, Terence Parr <parrt@cs.usfca.edu> wrote:

>
> On Jul 11, 2006, at 9:24 AM, Colin Bean wrote:
>
> > Okay, I've got the beginnings of a fix.  The problem is indeed in
> > checking for the existence of an attribute.  As Praki mentioned
> > earlier, using a conditional like "if x:" looks like it should simply
> > check for the existence of x, but in fact evaluates to false not only
> > if x is None, but also if x is an empty container or a numeric zero.
>
> Empty container is correct, but 0 is incorrect ;)
>
> > It's a weird little python feature that has bitten me a couple of
> > times; the solution is to explicitly check if a value is None.
> > I'm sure that there are many other places in the code that could use a
> > review for this, the following changes made PyST correctly evaluate a
> > (single or multi-valued) attribute with the integer value of zero.  I
> > changed one line in StringTemplate.py, where it checks for the
> > attribute's existence before setting it, and one in
> > language/ASTExpr.py, where it again checks existence before writing an
> > attribute out.  I ran the code through the unit tests and it was fine,
> > but other than that and my "zero" test I haven't run this code
> > anywhere else -- ymmv.  Here's a diff of the changes:
>
> Sweet!  Thanks, Colin :)  I'm CC'ing Marq in case he misses this.
>
> Ter
> > --- StringTemplateOrig.py       2006-07-10 15:53:44.000000000 -0700
> > +++ StringTemplate.py   2006-07-10 15:59:49.000000000 -0700
> > @@ -677,7 +677,7 @@
> >             # a normal call to setAttribute with unknown attribute
> >             raise KeyError("no such attribute: " + name +
> >                " in template context " +
> > self.getEnclosingInstanceStackString())
> > -        if value:
> > +        if value is not None:
> >             attributes[name] = value
> >         elif isinstance(value, list) or \
> >              isinstance(value, dict) or \
> > --- language/ASTExprOrig.py     2006-07-10 15:57:35.000000000 -0700
> > +++ language/ASTExpr.py 2006-07-10 15:11:35.000000000 -0700
> > @@ -390,7 +390,7 @@
> >         return self._write(this, o, out, separator)
> >
> >     def _write(self, this, o, out, separator):
> > -        if not o:
> > +        if o is None:
> >             return 0
> >         n = 0
> >         try:
> >
> >
> > If I find anything else relevant to this I'll post it.
> > Regards,
> > -Colin
> > _______________________________________________
> > stringtemplate-interest mailing list
> > stringtemplate-interest@antlr.org
> > http://www.antlr.org:8080/mailman/listinfo/stringtemplate-interest
>
> _______________________________________________
> stringtemplate-interest mailing list
> stringtemplate-interest@antlr.org
> http://www.antlr.org:8080/mailman/listinfo/stringtemplate-interest
>
From parrt at cs.usfca.edu  Tue Jul 11 13:47:20 2006
From: parrt at cs.usfca.edu (Terence Parr)
Date: Tue Jul 11 13:45:28 2006
Subject: [stringtemplate-interest] ST in multi-threaded environment
In-Reply-To: <44B34F59.4090902@market-maker.de>
References: <44AE17BD.20208@market-maker.de>	<C64AF7A5-15A3-4B80-9DA3-BFB14E6D5D6D@cs.usfca.edu>	<537739b70607070748n242aca05p6daf70c3eb9962df@mail.gmail.com>	<44B1F58D.6070302@market-maker.de>
	<9014AD4C-F593-411D-80EE-D5A8B552E6BD@cs.usfca.edu>
	<44B34F59.4090902@market-maker.de>
Message-ID: <E13AA5A6-5F0F-40ED-943E-2CBDA7D292B7@cs.usfca.edu>


On Jul 11, 2006, at 12:12 AM, Oliver Flege wrote:

> Hi,
>
>> I don't think we have a threading issue...can somebody point out a
>> scenario?
>
> let me point you to some examples:
>
> In my web application, a StringTemplateGroup is created at startup  
> [servlet container main thread]
> StringTemplateGroup g = new StringTemplateGroup(name, rootDir)
>
> Every servlet that needs to render a page, uses that group (which  
> can be obtained from
> the ServletContext) as follows:
>
> StringTemplate st = g.getInstanceOf(templateName)

Makes sense so far...

> getInstanceOf invokes lookupTemplate, which uses the "templates"  
> Map: it might
> clear it, it calls get to lookup a template, and maybe put if it  
> had to load the template
> All of these actions are performed in the context of the servlet's  
> thread. So when the
> servlet container uses a thread-pool to run servlets (as most of  
> them do), the actions
> on the "templates" Map in StringTemplateGroup are performed by  
> multiple threads
> and without synchronization => threading issue, as HashMap cannot  
> cope reliably with
> multiple threads accessing it in parallel.

I see.  Yes, the group of templates could be unsafe due to caching.   
If all templates are loaded up front then this would be avoided I  
suppose.  Technically though you are absolutely correct.  Loading of  
templates is not safe.  Shall I wrap the Map in a thread-safety thing  
or just use Hashtable?

> Once st.write(...) gets called, an ASTExpr may need to access the  
> property of some object,
> so it calls StringTemplateGroup's getCachedClassProperty and maybe  
> later cacheClassProperty.
> Both of these static methods access the "classPropertyCache" static  
> Map, again w/o synchronization,
> although multiple servlet threads may invoke these operations in  
> parallel => another threading issue.

Yes, I just *knew* that would cause trouble...i'm thinking of taking  
out..not sure it's worth the complexity.

> StringTemplateGroup's attributeRenderers Map can be replaced or  
> renderers can be added to it
> without synchronization. If a servlet's thread later calls  
> getAttributeRenderer, again w/o sync,
> one would assume that it should be able to access those renderers  
> right away, but this assumption
> is plain wrong* => yet another threading issue.

That is an ordering issue.  The real issue is that a read thread  
could catch a write thread in the act of updating the data structure.
> => For each mutable state variable in both StringTemplateGroup and  
> StringTemplate that may be
> accessed by more than one thread, all accesses (not just writes,  
> also reads) should be performed
> with the same lock held, so that the variable is guarded by that  
> lock. Ideally, the documentation
> would state which lock has to be used for each variable (important  
> since there are so many protected
> variables that subclasses or other package level classes can access).

ST objects should be ok.  It's the group, as you point out, that has  
issues.

> I hope this clarifies my concers about ST's tread-safety.

it does, thanks!

> PS: I know I am somewhat picky about this issue, but we develop  
> heavily threaded systems for
> stock market data feed processing and neglecting thread-safety is  
> just not an option for us :)

I'm glad you're paranoid then!

Ok, i did this:

o made static maps in STG synchronized, also synchronized the look
up/def methods for templates in STG.

also added a comment on map defs:

	/** Define a map for this group; not thread safe...do not keep adding
	 *  these while you reference them.
	 */

Hmm...I should really do a heavy analysis on the whole STG thing...I  
use it now in a very diff env than the web where all templates are  
loaded via a group file.

How much are synchronized methods slowed down these days for  
uncontentious locks?  I'm worried that I just slowed antlr down.  Did  
I just kill performance?

Ter
From parrt at cs.usfca.edu  Tue Jul 11 14:19:42 2006
From: parrt at cs.usfca.edu (Terence Parr)
Date: Tue Jul 11 14:17:52 2006
Subject: [stringtemplate-interest] caching property lookup (sync issue too)
Message-ID: <B59F62E3-4656-4580-8AF0-08C30ECC01E0@cs.usfca.edu>

Hi,

Well, i just profiled ANTLR generating the thousands of lines of Java  
code for a C grammar.  The reflection part took 120microseconds so  
about an 1/8 of 1ms.  This is w/o the property caching.  I have  
commented out for simplicity in the source and avoided a synch.  
problem at same time.

Ter
From wsurowiec at gmail.com  Wed Jul 12 10:45:57 2006
From: wsurowiec at gmail.com (William Surowiec)
Date: Wed Jul 12 10:46:01 2006
Subject: [stringtemplate-interest] trouble loading templates from a file
Message-ID: <570acb770607121045g2eae87ecg772596c966bc3b66@mail.gmail.com>

Dumb question: is there any magic to loading templates from a file under
windows? I have moved the template file to almost all of the usual suspect
locations (but not, obviously, the right one.) I have tried the root of the
hard drive, the root of the application (where the application is able to
find other files), down where the source code lives - all to no avail.

The error message  does not complain about finding the file, but loading the
first template from within the file. At the risk of boring people, here is
the contents for the template file (two templates are contained within the
one file):

group updates;

update (site,auditLogin,auditPassword,customerId,d) ::= <<

<easyAccess dateformat="MM/dd/yyyy">
  <getSite name="$site$">
   <getCustomer login="$auditLogin$" password="$auditPassword$"
ip="{null}"><getID result="audituserid"/></getCustomer>
   <getUser id="{audituserid}" result="audituser"/>
  </getSite>
  <startTransaction audituser="{audituser}">
    <getSite name="$site$">
      <getUser id="$customerId$">
      $if(d)$
        <getDemographics result="demographics">
          $d:changeDemographics()$
        <setDemographics props="{demographics}"/>
            $endif$
      </getUser>
    </getSite>
    <rollback/>
  </startTransaction>
</easyAccess>

>>

changeDemographics (name,value) :: <<
<setproperty properties="{demographics}" propname="$name$"
propvalue="$value$"/>

>>


and here is the offending code:

        group = new StringTemplateGroup(templateFileName);
        stUpdates = group.getInstanceOf("update");

The error message says it cannot find update.st.

I am using the stringtemplate-2.3b7 jar and the antlr-2.7.6 jar.

I am stuck, willing to consider sacrificing a chicken or a virgin, but I
live in New York City where one is frowned upon and the other difficult.

Bill
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.antlr.org:8080/pipermail/stringtemplate-interest/attachments/20060712/d5d08cbf/attachment.html
From jose.sanleandro at ventura24.es  Wed Jul 12 10:46:17 2006
From: jose.sanleandro at ventura24.es (Jose San Leandro)
Date: Wed Jul 12 10:51:12 2006
Subject: [stringtemplate-interest] trouble loading templates from a file
In-Reply-To: <570acb770607121045g2eae87ecg772596c966bc3b66@mail.gmail.com>
References: <570acb770607121045g2eae87ecg772596c966bc3b66@mail.gmail.com>
Message-ID: <200607121946.19308.jose.sanleandro@ventura24.es>

Have you tried starting the file path with a slash?

group = new StringTemplateGroup("/" + templateFileName);
From ccbean at gmail.com  Wed Jul 12 11:10:28 2006
From: ccbean at gmail.com (Colin Bean)
Date: Wed Jul 12 11:10:30 2006
Subject: [stringtemplate-interest] trouble loading templates from a file
In-Reply-To: <570acb770607121045g2eae87ecg772596c966bc3b66@mail.gmail.com>
References: <570acb770607121045g2eae87ecg772596c966bc3b66@mail.gmail.com>
Message-ID: <29a6ca010607121110l5c4a53a3g9d072cdf4f16b31a@mail.gmail.com>

Hi William,

Since you're using a group file, I believe you have to open your group
file with a FileReader, and pass the FileReader into the
StringTemplateGroup constructor.  AFIK, just passing a path creates an
ST group based on a directory, and expects each template to be an .st
file in that directory (that's why its complaining about update.st).
Passing a character stream creates an ST group that's actually based
on your file.

Try something like:
gFile = new FileReader(templateFileName);
group = new StringTemplateGroup(gFile);
stUpdates = group.getInstanceOf("update");

The documentation is a little sparse on this, but if you look under
"String Template Group Files" in the main documentation, there's an
example of doing this with a StringReader.

Regards,
Colin

On 7/12/06, William Surowiec <wsurowiec@gmail.com> wrote:
> Dumb question: is there any magic to loading templates from a file under
> windows? I have moved the template file to almost all of the usual suspect
> locations (but not, obviously, the right one.) I have tried the root of the
> hard drive, the root of the application (where the application is able to
> find other files), down where the source code lives - all to no avail.
>
> The error message  does not complain about finding the file, but loading the
> first template from within the file. At the risk of boring people, here is
> the contents for the template file (two templates are contained within the
> one file):
>
> group updates;
>
> update (site,auditLogin,auditPassword,customerId,d) ::= <<
>
> <easyAccess dateformat="MM/dd/yyyy">
>   <getSite name="$site$">
>    <getCustomer login="$auditLogin$" password="$auditPassword$"
> ip="{null}"><getID result="audituserid"/></getCustomer>
>    <getUser id="{audituserid}" result="audituser"/>
>   </getSite>
>   <startTransaction audituser="{audituser}">
>     <getSite name="$site$">
>       <getUser id="$customerId$">
>       $if(d)$
>         <getDemographics result="demographics">
>           $d:changeDemographics()$
>         <setDemographics props="{demographics}"/>
>             $endif$
>        </getUser>
>     </getSite>
>     <rollback/>
>   </startTransaction>
> </easyAccess>
>
> >>
>
> changeDemographics (name,value) :: <<
> <setproperty properties="{demographics}" propname="$name$"
> propvalue="$value$"/>
>
> >>
>
>
> and here is the offending code:
>
>         group = new StringTemplateGroup(templateFileName);
>         stUpdates = group.getInstanceOf("update");
>
> The error message says it cannot find update.st.
>
> I am using the stringtemplate-2.3b7 jar and the antlr-2.7.6 jar.
>
> I am stuck, willing to consider sacrificing a chicken or a virgin, but I
> live in New York City where one is frowned upon and the other difficult.
>
> Bill
>
> _______________________________________________
> stringtemplate-interest mailing list
> stringtemplate-interest@antlr.org
> http://www.antlr.org:8080/mailman/listinfo/stringtemplate-interest
>
>
>
From wsurowiec at gmail.com  Wed Jul 12 11:57:38 2006
From: wsurowiec at gmail.com (William Surowiec)
Date: Wed Jul 12 11:57:41 2006
Subject: Fwd: [stringtemplate-interest] trouble loading templates from a file
In-Reply-To: <570acb770607121120r498ca8e8p3248dd33c31050d8@mail.gmail.com>
References: <570acb770607121045g2eae87ecg772596c966bc3b66@mail.gmail.com>
	<29a6ca010607121110l5c4a53a3g9d072cdf4f16b31a@mail.gmail.com>
	<570acb770607121120r498ca8e8p3248dd33c31050d8@mail.gmail.com>
Message-ID: <570acb770607121157y3917cdbayf8c806f63dd3a3e0@mail.gmail.com>

I may only have responded to Colin in my last post, so I am enclosing my
reply and an update.

I can move the template file back to the root of the application and
reference it just as template.stg. The cure was Colin's code suggestion (use
a File reader):
            group = new StringTemplateGroup(new
FileReader(templateFileName));


But parsing the file has surfaced a problem. The first '<' encountered
throws:

action parse error in group updates line 3; template context is [update]
line 1:1: unexpected token: getSite
    at org.antlr.stringtemplate.language.ActionParser.primaryExpr(
ActionParser.java:642)

The above message happens when I remove the first '<' from easyAccess (a few
lines down):

group updates;

update (site,auditLogin,auditPassword,customerId,d) ::= <<
<easyAccess dateformat="MM/dd/yyyy">
  <getSite name="$site$">

(The rest removed for this email)

So, another dumb question: how does one use <> as text within a template?

Thanks,

Bill

---------- Forwarded message ----------
From: William Surowiec <wsurowiec@gmail.com>
Date: Jul 12, 2006 2:20 PM
Subject: Re: [stringtemplate-interest] trouble loading templates from a file
To: Colin Bean

On target! The code found the template (and problems of course.)

Many thanks to the community, especially Jose and Colin.

Bill




On 7/12/06, Colin Bean  wrote:
>
> Hi William,
>
> Since you're using a group file, I believe you have to open your group
> file with a FileReader, and pass the FileReader into the
> StringTemplateGroup constructor.  AFIK, just passing a path creates an
> ST group based on a directory, and expects each template to be an .st
> file in that directory (that's why its complaining about update.st).
> Passing a character stream creates an ST group that's actually based
> on your file.
>
> Try something like:
> gFile = new FileReader(templateFileName);
> group = new StringTemplateGroup(gFile);
> stUpdates = group.getInstanceOf("update");
>
> The documentation is a little sparse on this, but if you look under
> "String Template Group Files" in the main documentation, there's an
> example of doing this with a StringReader.
>
> Regards,
> Colin
>
> On 7/12/06, William Surowiec <wsurowiec@gmail.com> wrote:
> > Dumb question: is there any magic to loading templates from a file under
>
> > windows? I have moved the template file to almost all of the usual
> suspect
> > locations (but not, obviously, the right one.) I have tried the root of
> the
> > hard drive, the root of the application (where the application is able
> to
> > find other files), down where the source code lives - all to no avail.
> >
> > The error message  does not complain about finding the file, but loading
> the
> > first template from within the file. At the risk of boring people, here
> is
> > the contents for the template file (two templates are contained within
> the
> > one file):
> >
> > group updates;
> >
> > update (site,auditLogin,auditPassword,customerId,d) ::= <<
> >
> > <easyAccess dateformat="MM/dd/yyyy">
> >   <getSite name="$site$">
> >    <getCustomer login="$auditLogin$" password="$auditPassword$"
> > ip="{null}"><getID result="audituserid"/></getCustomer>
> >    <getUser id="{audituserid}" result="audituser"/>
> >   </getSite>
> >   <startTransaction audituser="{audituser}">
> >     <getSite name="$site$">
> >       <getUser id="$customerId$">
> >       $if(d)$
> >         <getDemographics result="demographics">
> >           $d:changeDemographics()$
> >         <setDemographics props="{demographics}"/>
> >             $endif$
> >        </getUser>
> >     </getSite>
> >     <rollback/>
> >   </startTransaction>
> > </easyAccess>
> >
> > >>
> >
> > changeDemographics (name,value) :: <<
> > <setproperty properties="{demographics}" propname="$name$"
> > propvalue="$value$"/>
> >
> > >>
> >
> >
> > and here is the offending code:
> >
> >         group = new StringTemplateGroup(templateFileName);
> >         stUpdates = group.getInstanceOf("update");
> >
> > The error message says it cannot find update.st .
> >
> > I am using the stringtemplate-2.3b7 jar and the antlr-2.7.6 jar.
> >
> > I am stuck, willing to consider sacrificing a chicken or a virgin, but I
> > live in New York City where one is frowned upon and the other difficult.
>
> >
> > Bill
> >
> > _______________________________________________
> > stringtemplate-interest mailing list
> > stringtemplate-interest@antlr.org
> > http://www.antlr.org:8080/mailman/listinfo/stringtemplate-interest
> >
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.antlr.org:8080/pipermail/stringtemplate-interest/attachments/20060712/8b8d63b3/attachment.html
From wsurowiec at gmail.com  Wed Jul 12 15:55:49 2006
From: wsurowiec at gmail.com (William Surowiec)
Date: Wed Jul 12 15:55:53 2006
Subject: Fwd: [stringtemplate-interest] trouble loading templates from a file
In-Reply-To: <570acb770607121157y3917cdbayf8c806f63dd3a3e0@mail.gmail.com>
References: <570acb770607121045g2eae87ecg772596c966bc3b66@mail.gmail.com>
	<29a6ca010607121110l5c4a53a3g9d072cdf4f16b31a@mail.gmail.com>
	<570acb770607121120r498ca8e8p3248dd33c31050d8@mail.gmail.com>
	<570acb770607121157y3917cdbayf8c806f63dd3a3e0@mail.gmail.com>
Message-ID: <570acb770607121555r7a77fac3g699a782e362a6617@mail.gmail.com>

Well, I can report one facet affecting me in this thread: I can get my code
working with version 2.2 of stringtemplate but not 2.3b7.

I've done a lot of code changes today and possibly I've created something
that shouldn't  work in 2.2 and does not work in 2.3 - but I know i will not
find that out tonight.

I will share what I find, even if it supports my wife's conviction that I am
an idiot.

Bill
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.antlr.org:8080/pipermail/stringtemplate-interest/attachments/20060712/6a3b135d/attachment.html
From ccbean at gmail.com  Wed Jul 12 16:35:01 2006
From: ccbean at gmail.com (Colin Bean)
Date: Wed Jul 12 16:35:03 2006
Subject: [stringtemplate-interest] trouble loading templates from a file
In-Reply-To: <570acb770607121555r7a77fac3g699a782e362a6617@mail.gmail.com>
References: <570acb770607121045g2eae87ecg772596c966bc3b66@mail.gmail.com>
	<29a6ca010607121110l5c4a53a3g9d072cdf4f16b31a@mail.gmail.com>
	<570acb770607121120r498ca8e8p3248dd33c31050d8@mail.gmail.com>
	<570acb770607121157y3917cdbayf8c806f63dd3a3e0@mail.gmail.com>
	<570acb770607121555r7a77fac3g699a782e362a6617@mail.gmail.com>
Message-ID: <29a6ca010607121635t3003c956oe5a5886a7c597d9d@mail.gmail.com>

Actually, I think this is partially 2.3b7's fault.  According to
Terrence (link below), the default group delimiter in 2.3b7 has
changed from "$..$" to "<...>", so in your example 2.3b7 thinks that
"getSite" is an attribute.
http://www.antlr.org:8080/pipermail/stringtemplate-interest/2006-May/000407.html

To answer your first question, you can include a literal $ or <
(whichever the delimiter is)by just escaping it with a backslash (\$,
\<), but 2.3b will probaby have trouble with the $..$ attributes.  To
change the default delimiter, you need to pass a different lexer to
the StringTemplateGroup constructor.  Here's what's available for 2.2
(so to get 2.2 to behave like 2.3 beta, you'd use an
AngleBracketTemplateLexer):
http://www.stringtemplate.org/doc/api/org/antlr/stringtemplate/language/package-summary.html

Don't know what your options are in 2.3b (don't have a copy of it on
hand), but hopefully if you examine the package the names will be be
self explanitory.

-Colin

On 7/12/06, William Surowiec <wsurowiec@gmail.com> wrote:
> Well, I can report one facet affecting me in this thread: I can get my code
> working with version 2.2 of stringtemplate but not 2.3b7.
>
> I've done a lot of code changes today and possibly I've created something
> that shouldn't  work in 2.2 and does not work in 2.3 - but I know i will not
> find that out tonight.
>
> I will share what I find, even if it supports my wife's conviction that I am
> an idiot.
>
> Bill
>
> _______________________________________________
> stringtemplate-interest mailing list
> stringtemplate-interest@antlr.org
> http://www.antlr.org:8080/mailman/listinfo/stringtemplate-interest
>
>
>
From open.zone at virgin.net  Sat Jul 15 03:07:37 2006
From: open.zone at virgin.net (Micheal J)
Date: Sat Jul 15 02:49:30 2006
Subject: [stringtemplate-interest] caching property lookup (sync issue too)
In-Reply-To: <B59F62E3-4656-4580-8AF0-08C30ECC01E0@cs.usfca.edu>
Message-ID: <025201c6a7f6$80dfecb0$c704a8c0@hercules>

> On July 11 2006, Terence Parr wrote:
> 
> Well, i just profiled ANTLR generating the thousands of lines 
> of Java  
> code for a C grammar.  The reflection part took 120microseconds so  
> about an 1/8 of 1ms.  This is w/o the property caching.  I have  
> commented out for simplicity in the source and avoided a synch.  
> problem at same time.

It might just be that your particular test case(s) do a minimal amount of
reflection. I imagine that ST-based web page generation is likely a heavier
user of reflection - in general - than source code generation. If only
because of the much-longer lifetime of ST group instances...

Just a thought.


Micheal

From parrt at cs.usfca.edu  Sat Jul 15 07:46:05 2006
From: parrt at cs.usfca.edu (Terence Parr)
Date: Sat Jul 15 07:46:05 2006
Subject: [stringtemplate-interest] caching property lookup (sync issue too)
In-Reply-To: <025201c6a7f6$80dfecb0$c704a8c0@hercules>
References: <025201c6a7f6$80dfecb0$c704a8c0@hercules>
Message-ID: <34A8621F-7BFB-4C85-8485-9F51C34404AE@cs.usfca.edu>


On Jul 15, 2006, at 3:07 AM, Micheal J wrote:

>> On July 11 2006, Terence Parr wrote:
>>
>> Well, i just profiled ANTLR generating the thousands of lines
>> of Java
>> code for a C grammar.  The reflection part took 120microseconds so
>> about an 1/8 of 1ms.  This is w/o the property caching.  I have
>> commented out for simplicity in the source and avoided a synch.
>> problem at same time.
>
> It might just be that your particular test case(s) do a minimal  
> amount of
> reflection. I imagine that ST-based web page generation is likely a  
> heavier
> user of reflection - in general - than source code generation. If only
> because of the much-longer lifetime of ST group instances...
>
> Just a thought.

Well, I suspect that ANTLR is a much heavier user since any x.y uses  
reflection unless it's a Map.  ANTLR's output templates are much  
bigger and more complicated than a web page so I'm hoping we're ok  
removing it. :)

Ter

From galendunkleberger at gmail.com  Mon Jul 17 10:00:45 2006
From: galendunkleberger at gmail.com (Galen Dunkleberger)
Date: Mon Jul 17 10:00:06 2006
Subject: [stringtemplate-interest] Turning off
	checkNullAttributeAgainstFormalArguments
In-Reply-To: <34A8621F-7BFB-4C85-8485-9F51C34404AE@cs.usfca.edu>
Message-ID: <44bbc214.3017d579.6e9b.7dc9@mx.gmail.com>

I don't use group files. I use ST for web interface generation and so I have
many st files for pages and then common pieces of the interface broken out
into their own files which get included. There are occasions where I want to
have an enclosing template specify an override to some part of one of those
common interface pieces. Therefore in the common template I have an 'if'
statement something like.

 

 
$if(the_enclosing_template_specifies_this_overriden_argument)$

 
$the_enclosing_template_specifies_this_overriden_argument$

                              $else$

                                    $print_the_normal_stuff$

                              $endif$

 

That way I can do an include like

      

 
$common_piece(the_enclosing_template_specifies_this_overriden_argument={$pri
nt_something_different$})$

      

where I need to do an override and then just have 

                        

$common_piece()$

 

everywhere else.

 

The problem is that the checkNullAttributeAgainstFormalArguments ends up
throwing an exception for the enclosing templates that don't specify the
override. I am wonder if there could be a way to turn off the check in the
next version of ST. Since you can only define formal arguments when using a
group file I wouldn't expect the check to occur when not using a group file.
I would just expect the 'if' statement to evaluate to false since the
attribute doesn't exist.

 

                                          Thanks,

                                                Galen

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.antlr.org:8080/pipermail/stringtemplate-interest/attachments/20060717/18141311/attachment.html
From parrt at cs.usfca.edu  Mon Jul 17 11:10:36 2006
From: parrt at cs.usfca.edu (Terence Parr)
Date: Mon Jul 17 11:08:21 2006
Subject: [stringtemplate-interest] Re: Turning off
	checkNullAttributeAgainstFormalArguments
In-Reply-To: <44bbc214.3017d579.6e9b.7dc9@mx.gmail.com>
References: <44bbc214.3017d579.6e9b.7dc9@mx.gmail.com>
Message-ID: <43B1E801-3E2C-49B3-A86E-8EBD278F85FF@cs.usfca.edu>


On Jul 17, 2006, at 10:00 AM, Galen Dunkleberger wrote:
> The problem is that the checkNullAttributeAgainstFormalArguments  
> ends up throwing an exception for the enclosing templates that  
> don?t specify the override. I am wonder if there could be a way to  
> turn off the check in the next version of ST. Since you can only  
> define formal arguments when using a group file I wouldn?t expect  
> the check to occur when not using a group file. I would just expect  
> the ?if? statement to evaluate to false since the attribute doesn?t  
> exist.

Hi.  my intention (and as it is in java version) is that that chk is  
only done with group files.  Perhaps Kunle and crew can reply.
Ter
From ccbean at gmail.com  Mon Jul 17 14:40:39 2006
From: ccbean at gmail.com (Colin Bean)
Date: Mon Jul 17 14:40:42 2006
Subject: [stringtemplate-interest] PyST Zero-valued attributes patch (was
	Problem in multivalued attribute handling?)
Message-ID: <29a6ca010607171440n2a84aac9q4acf81cc4c9b318e@mail.gmail.com>

Hi all,

I've finally got a more complete patch to make PyST correctly handle
an attribute with a numeric value of zero.
In my previous post I mentioned that in my patched version, setting an
attribute property to zero causes an error.  Upon further inspection,
it seems like this also causes an error in the standard 2.2 release (I
tested this on a clean build).  In order to duplicate it, do something
like:

import stringtemplate
test = stringtemplate.StringTemplate('$foo.a$')
test['foo'] = {'a':0}
print test

PyST should fail on the print statement.  This is not a problem in
2.1, it seems newly introduced in 2.2.

The patch below fixes this bug, and causes zero values to render
correctly in single value attributes, multivalued attributes, lists,
and as object properties.  I still haven't tested zero values
inherited in nested templates, so ymmv.  I'll post if I make a more
complete patch, but this should fix basic zero attribute problems;
code changes are below.

Regards,
-Colin

--- StringTemplateOrig.py       2006-07-10 15:53:44.000000000 -0700
+++ StringTemplate.py   2006-07-10 23:14:10.000000000 -0700
@@ -677,7 +677,7 @@
             # a normal call to setAttribute with unknown attribute
             raise KeyError("no such attribute: " + name +
                " in template context " +
self.getEnclosingInstanceStackString())
-        if value:
+        if value is not None:
             attributes[name] = value
         elif isinstance(value, list) or \
              isinstance(value, dict) or \
--- language/ASTExprOrig.py     2006-07-10 15:57:35.000000000 -0700
+++ language/ASTExpr.py 2006-07-11 07:13:38.000000000 -0700
@@ -177,7 +177,7 @@
                     i += 1
             else:
                 for ithValue in attributeValue:
-                    if not ithValue:
+                    if ithValue is None:
                         # weird...a None value in the list; ignore
                         continue

@@ -270,7 +270,7 @@
                 value = o[propertyName]
             except:
                 value = None
-            if not value:
+            if value is None:
                 # no property defined; if a map in this group
                 # then there may be a default value
                 value = o[ASTExpr.DEFAULT_MAP_VALUE_NAME]
@@ -390,7 +390,7 @@
         return self._write(this, o, out, separator)

     def _write(self, this, o, out, separator):
-        if not o:
+        if o is None:
             return 0
         n = 0
         try:
From parrt at cs.usfca.edu  Tue Jul 18 17:42:28 2006
From: parrt at cs.usfca.edu (Terence Parr)
Date: Tue Jul 18 17:40:11 2006
Subject: [stringtemplate-interest] Re: StringTemplate
In-Reply-To: <44BD559F.8000802@emmeskay.com>
References: <44BD4E05.40300@emmeskay.com>
	<467E1203-73AE-4A8B-9B24-8707789022EE@cs.usfca.edu>
	<44BD559F.8000802@emmeskay.com>
Message-ID: <77C80B21-4F02-42D1-AB28-6EC9423F207E@cs.usfca.edu>


On Jul 18, 2006, at 2:41 PM, Michael Tiller wrote:
> I'm running into similar things
> with HashMaps as well.  I can't ask for the keySet (because it isn't a
> property).  This makes emitting HashMaps quite tedious.  In other  
> words,
> I'd like to do this:
>
> <ul>
> $hashmap.keyset:{ key |
>   <li>hashmap.(key)</li>
> }$
> </ul>

I think in the old days, $hashmap$ returned the values; does it  
return the keys now by default?

Ah. still on todo list:

o We need to be able to walk maps as maps not lists.  Maps are ok as
it's a data relationship not a type.  Have to use $m.key$ and $m.value$
rather than $map:\{key,value|...}$ as it breaks idea of parallel list
walking that args must match number of lists to walk.  Maybe this:
<<
$map:{m|$m.key$ $m.value$}$
$map$ -> keys
$map.keys$
$map.values$
$map.bob$
 >>

> I'm realizing in all this that I like HashMaps and I use them all over
> the place.  It would be nice if StringTemplate had some kind of  
> expanded
> handling for HashMaps.

agreed.

> Or am I missing something?

nope, you're dead on!

Ter

From asingh05 at vt.edu  Tue Jul 18 18:25:05 2006
From: asingh05 at vt.edu (Amrinder Singh)
Date: Tue Jul 18 18:31:29 2006
Subject: [stringtemplate-interest] printing using string template
Message-ID: <44D456FB@zathras>

Hello,
I was gong through the Mantra codgen.g and observed that some of the rules did 
not have any string template actions on it. How are these rules handled. Also, 
after building a walker, I want to try printing the file using string 
template, what are the minimum actions that I must add to just print the file 
as it is.

Thanks

Amrinder


From parrt at cs.usfca.edu  Tue Jul 18 18:35:56 2006
From: parrt at cs.usfca.edu (Terence Parr)
Date: Tue Jul 18 18:33:36 2006
Subject: [stringtemplate-interest] printing using string template
In-Reply-To: <44D456FB@zathras>
References: <44D456FB@zathras>
Message-ID: <818AC3A9-3335-4173-826B-CBB436AAEB93@cs.usfca.edu>


On Jul 18, 2006, at 6:25 PM, Amrinder Singh wrote:

> Hello,
> I was gong through the Mantra codgen.g and observed that some of  
> the rules did
> not have any string template actions on it. How are these rules  
> handled.

Those do not return a ST by default.

> Also,
> after building a walker, I want to try printing the file using string
> template, what are the minimum actions that I must add to just  
> print the file
> as it is.

well, print is different than build an ST.  First you build the ST  
with antlr and then you call toString.  or, you add println  
statements to the tree walker.

Ter

From asingh05 at vt.edu  Tue Jul 18 20:11:29 2006
From: asingh05 at vt.edu (Amrinder Singh)
Date: Tue Jul 18 20:17:52 2006
Subject: [stringtemplate-interest] printing using string template
Message-ID: <44D56311@zathras>

I figured out that we need to build an ST and then use the toString method. 
But when I try to run the statement 
StringTemplateGroup templates =	new StringTemplateGroup(br, 
AngleBracketTemplateLexer.class);
I get the error, NoClassDefFoundError:  antlr/TokenStream
This sems strange since I have both the antlr as well as stringtemplate jar 
files in my classpath.

Amrinder


From o.flege at market-maker.de  Tue Jul 18 23:12:43 2006
From: o.flege at market-maker.de (Oliver Flege)
Date: Tue Jul 18 23:12:46 2006
Subject: [stringtemplate-interest] Re: StringTemplate, Maps
In-Reply-To: <77C80B21-4F02-42D1-AB28-6EC9423F207E@cs.usfca.edu>
References: <44BD4E05.40300@emmeskay.com>	<467E1203-73AE-4A8B-9B24-8707789022EE@cs.usfca.edu>	<44BD559F.8000802@emmeskay.com>
	<77C80B21-4F02-42D1-AB28-6EC9423F207E@cs.usfca.edu>
Message-ID: <44BDCD5B.2080403@market-maker.de>

Hi,

Terence Parr wrote:
> Ah. still on todo list:
> 
> o We need to be able to walk maps as maps not lists.  Maps are ok as
> it's a data relationship not a type.  Have to use $m.key$ and $m.value$
> rather than $map:\{key,value|...}$ as it breaks idea of parallel list
> walking that args must match number of lists to walk.  Maybe this:
> <<
> $map:{m|$m.key$ $m.value$}$

+1, so m would be a Map.Entry object, which I think is the "natural" way to
iterate a Map. The problem would of course be that it breaks old code, as
ASTExpr.convertAnythingToIterator currently returns an iterator for the values
and not for the entries.

> $map$ -> keys

-1, $map$ -> entries  would be more appropriate (and consistent with the iterator above)

> $map.keys$
> $map.values$

-1, not really necessary if Entry iterator is available, indistinguishable from "$map.bob$"
unless "keys" and "values" are introduced as keywords, which would prevent me from using
them as keys in my maps => confusion.


=> In order to support iterating map entries, it would be sufficient to replace

		else if ( o instanceof Map ) {
			iter = ((Map)o).values().iterator();
with
		else if ( o instanceof Map ) {
			iter = ((Map)o).entrySet().iterator();

in ASTExpr.convertAnythingToIterator (if breaking old code is acceptable).

Oliver



From asingh05 at vt.edu  Wed Jul 19 12:47:42 2006
From: asingh05 at vt.edu (Amrinder Singh)
Date: Wed Jul 19 12:54:07 2006
Subject: [stringtemplate-interest] Mantra handling modifiers
Message-ID: <44E083EA@zathras>

This is just a follow up to my earlier question. You said if there are no 
string template actions for a rule in the walker it does not return a ST by 
default. However, in codegen.g, there are no ST actions for the rule 
modifiers. Yet, the modifiers appear in the java file created. Does this have 
something to do with TokenRewriteStream.
Thanks

Amrinder


From endigitalmind at yahoo.co.uk  Wed Jul 19 13:07:29 2006
From: endigitalmind at yahoo.co.uk (Phil Ritchie)
Date: Wed Jul 19 13:07:33 2006
Subject: [stringtemplate-interest] StringTemplate st returns null.
Message-ID: <20060719200729.79145.qmail@web25815.mail.ukl.yahoo.com>

[Using antlrworks-1.0ea11]
 
The ParserRuleReturnScope member variables "st" in my generated grammar are returning null to the System.out.println(r.getTemplate().toString()) call. Can anyone point me at what the cause of this might be? I'm not getting any errors relating to my *.stg file.
 
Phil.
From parrt at cs.usfca.edu  Thu Jul 20 13:12:46 2006
From: parrt at cs.usfca.edu (Terence Parr)
Date: Thu Jul 20 13:10:20 2006
Subject: [stringtemplate-interest] new "null" option for ST expressions
Message-ID: <2AAD883A-43C2-4363-9C8A-9D30772B5B43@cs.usfca.edu>

hi.  There is an inefficiency when dealing with big sparse lists of  
ints; creating new Integer objects with, say, -1 to fill the other  
spots is super wasteful and slow (otherwise no value shows up--ST  
skips it).  With ANTLR codegen, it takes 20% extra on entire exec  
time to do this.

This led me to a null option:

o Added null=expr option on expressions.

For null values in iterated attributes and single attributes that are
null, use this value instead of skipping.  For single valued
attributes like <name; null="n/a">

It's a shorthand for

<if(name)><name><else>n/a<endif>

For iterated values

<values; null="0", separator=",">

you get 0 for or null list values.  Works for template application
like this also:

<values:{v| <v>}; null="0">

BUT!  This forced me to make a more clear distinction between empty  
and null:

o BACKWARD INCOMPATIBLE: I had to make a more clear distinction
between empty and null.  Null means there is nothing there whereas
empty means the value is there but renders to an empty string.  IF
conditionals now evaluate to empty if condition is false.

THIS led me to:

o BACKWARD INCOMPATIBLE: Changed how separators are generated.  Now I
generate a separator for any non-null value in the list even if that
value is a conditional that evaluates to false.  Iterated empty values
always get a separator.  Note that empty is not the same thing as
missing.  "" is not missing and hence will get a separator.

This made the ASTExpr.write separator computation much simpler and
allowed me to properly handle the new "null" option.

This actually didn't break anything but I had to alter a unit test to  
a different meaning.

Pushed in depot.

Ter
From open.zone at virgin.net  Thu Jul 20 15:32:40 2006
From: open.zone at virgin.net (Micheal J)
Date: Thu Jul 20 15:14:32 2006
Subject: [stringtemplate-interest] Re: Turning off
	checkNullAttributeAgainstFormalArguments
In-Reply-To: <43B1E801-3E2C-49B3-A86E-8EBD278F85FF@cs.usfca.edu>
Message-ID: <021701c6ac4c$69aac8d0$c704a8c0@hercules>

> Hi.  my intention (and as it is in java version) is that that chk is  
> only done with group files.  Perhaps Kunle and crew can 
> reply. Ter_______________________________________________

I suspect that he's actually using the java version. ST# doesn't have a
method named "checkNullAttributeAgainstFormalArguments" afaict.


Micheal

-----------------------
The best way to contact me is via the list/forum. My time is very limited.

From brian at protexis.com  Mon Jul 24 11:05:31 2006
From: brian at protexis.com (brian@protexis.com)
Date: Mon Jul 24 11:05:36 2006
Subject: [stringtemplate-interest] Templates and groups
Message-ID: <34831.10.238.10.71.1153764331.webmail@10.238.10.71>

Hi

Using the current release of the C# string template library, is it
possible to reference a map stored in a group file (i.e. the stf file)
from a template (i.e. the st file).

Thanks

From brian at protexis.com  Mon Jul 24 11:21:40 2006
From: brian at protexis.com (brian@protexis.com)
Date: Mon Jul 24 11:21:54 2006
Subject: [stringtemplate-interest] Search the mailing list
Message-ID: <55134.10.238.10.71.1153765300.webmail@10.238.10.71>

Hi

Is there any way to perform text searches on the mailing list?

Thanks

From parrt at cs.usfca.edu  Mon Jul 24 11:50:41 2006
From: parrt at cs.usfca.edu (Terence Parr)
Date: Mon Jul 24 11:47:59 2006
Subject: [stringtemplate-interest] Search the mailing list
In-Reply-To: <55134.10.238.10.71.1153765300.webmail@10.238.10.71>
References: <55134.10.238.10.71.1153765300.webmail@10.238.10.71>
Message-ID: <3CCE9908-684A-4D45-9DF8-721E94B00BAD@cs.usfca.edu>


On Jul 24, 2006, at 11:21 AM, brian@protexis.com wrote:

> Hi
>
> Is there any way to perform text searches on the mailing list?

my searchbox (using Google) doesn't seem to pick it up...hmm...ok,  
added to todo list.

Ter

From kroepke at dolphin-services.de  Mon Jul 24 12:21:19 2006
From: kroepke at dolphin-services.de (Kay Roepke)
Date: Mon Jul 24 12:21:25 2006
Subject: [stringtemplate-interest] Search the mailing list
In-Reply-To: <3CCE9908-684A-4D45-9DF8-721E94B00BAD@cs.usfca.edu>
References: <55134.10.238.10.71.1153765300.webmail@10.238.10.71>
	<3CCE9908-684A-4D45-9DF8-721E94B00BAD@cs.usfca.edu>
Message-ID: <1A7E5E03-C650-4649-94E2-C367C87ED1C6@dolphin-services.de>


On 24. Jul 2006, at 20:50 Uhr, Terence Parr wrote:

>
> On Jul 24, 2006, at 11:21 AM, brian@protexis.com wrote:
>
>> Hi
>>
>> Is there any way to perform text searches on the mailing list?
>
> my searchbox (using Google) doesn't seem to pick it up...hmm...ok,  
> added to todo list.

In the meantime I'd recommend downloading the archives' .gz files and  
import that into your favorite mail client.
Just follow the link at the bottom of each mail.

-k

From brian at protexis.com  Mon Jul 24 13:17:07 2006
From: brian at protexis.com (brian@protexis.com)
Date: Mon Jul 24 13:17:09 2006
Subject: [stringtemplate-interest] Search the mailing list
In-Reply-To: <1A7E5E03-C650-4649-94E2-C367C87ED1C6@dolphin-services.de>
References: <55134.10.238.10.71.1153765300.webmail@10.238.10.71>
	<3CCE9908-684A-4D45-9DF8-721E94B00BAD@cs.usfca.edu>
	<1A7E5E03-C650-4649-94E2-C367C87ED1C6@dolphin-services.de>
Message-ID: <50513.10.238.10.71.1153772227.webmail@10.238.10.71>

Thanks

I'll give that a try.

-----Original Message-----
From: "Kay Roepke"
Sent: Mon, July 24, 2006 12:21
To: "stringtemplate-interest"
Subject: Re: [stringtemplate-interest] Search the mailing list


On 24. Jul 2006, at 20:50 Uhr, Terence Parr wrote:

>
> On Jul 24, 2006, at 11:21 AM, brian@protexis.com wrote:
>
>> Hi
>>
>> Is there any way to perform text searches on the mailing list?
>
> my searchbox (using Google) doesn't seem to pick it up...hmm...ok,
> added to todo list.

In the meantime I'd recommend downloading the archives' .gz files and
import that into your favorite mail client.
Just follow the link at the bottom of each mail.

-k

_______________________________________________
stringtemplate-interest mailing list
stringtemplate-interest@antlr.org
http://www.antlr.org:8080/mailman/listinfo/stringtemplate-interest


From parrt at cs.usfca.edu  Mon Jul 24 17:57:21 2006
From: parrt at cs.usfca.edu (Terence Parr)
Date: Mon Jul 24 17:54:41 2006
Subject: [stringtemplate-interest] added length, strip operators to ST
Message-ID: <3FCB90AE-9C2C-4C97-B87F-2B327A2CDB5A@cs.usfca.edu>

Hi,

Kay Roepke needed length() operator for obj-c output of ANTLR.  Added:

07-24-2006

o added length(attribute) thanks to Kay Roepke.  For now it does not
work on strings; it works on attributes so length("foo") is 1 meaning
1 attribute.  Nulls are counted in lists so a list of 300 nulls is
length 300.  If you don't want to count nulls, use
length(strip(list)).

o added strip(attribute) that returns an iterator that
skips any null values.  strip(x)=x when x is a single-valued
attribute.  Added StripIterator to handle this.

Ter
From parrt at cs.usfca.edu  Mon Jul 24 18:06:59 2006
From: parrt at cs.usfca.edu (Terence Parr)
Date: Mon Jul 24 18:04:18 2006
Subject: [stringtemplate-interest] how to fix longstanding bug
Message-ID: <CE17CD94-CB3E-415F-ADC2-EE14094EDF8B@cs.usfca.edu>

Ok, so a bug exists with the rest(attribute) operator.  If you pass  
the result as a parameter it gets mess up if you ref that parameter  
 >1 time.  Here is the unit test that fails:

	/** BUG!  Fix this.  Iterator is not reset from first to second $x$
	 *  Either reset the iterator or pass an attribute that knows to get
	 *  the iterator each time.  Seems like first, tail do not
	 *  have same problem as they yield objects.
	 *
	 *  Maybe make a RestIterator like I have CatIterator.
	 */
	public void testRepeatedRestOpAsArg() throws Exception {
		String templates =
				"group test;" +newline+
				"root(names) ::= \"$other(rest(names))$\""+newline+
				"other(x) ::= \"$x$, $x$\""+newline
				;
		StringTemplateGroup group =
				new StringTemplateGroup(new StringReader(templates),
										DefaultTemplateLexer.class);
		StringTemplate e = group.getInstanceOf("root");
		e.setAttribute("names", "Ter");
		e.setAttribute("names", "Tom");
		String expecting = "Tom, Tom";
		assertEqual(e.toString(), expecting);
	}

It yields "Tom, " not "Tom, Tom".  I said, "oh, just reset iterator  
when you hit the end".  There *is* no reset method!  i cannot reset  
any incoming attributes as the following unit test shows:

	/** If an iterator is sent into ST, it must be cannot be reset after  
each
	 *  use so repeated refs yield empty values.  This would
	 *  work if we passed in a List not an iterator.  Avoid sending in  
iterators
	 *  if you ref it twice.
	 */
	public void testRepeatedIteratedAttrFromArg() throws Exception {
		String templates =
				"group test;" +newline+
				"root(names) ::= \"$other(names)$\""+newline+
				"other(x) ::= \"$x$, $x$\""+newline
				;
		StringTemplateGroup group =
				new StringTemplateGroup(new StringReader(templates),
										DefaultTemplateLexer.class);
		StringTemplate e = group.getInstanceOf("root");
		List names = new ArrayList();
		names.add("Ter");
		names.add("Tom");
		e.setAttribute("names", names.iterator());
		String expecting = "TerTom, ";  // This does not give TerTom twice!!
		assertEqual(e.toString(), expecting);
	}

Suggestions?  I'd really like at least the iterators I create to be  
"reusable" within same template.

Ter
From Kunle_Odutola at hotmail.com  Mon Jul 24 18:53:44 2006
From: Kunle_Odutola at hotmail.com (Kunle Odutola)
Date: Mon Jul 24 18:35:41 2006
Subject: [stringtemplate-interest] how to fix longstanding bug
References: <CE17CD94-CB3E-415F-ADC2-EE14094EDF8B@cs.usfca.edu>
Message-ID: <BAY101-DAV15DBC30162BF0058DEA603815A0@phx.gbl>

Ter,

> Ok, so a bug exists with the rest(attribute) operator.  If you pass
> the result as a parameter it gets mess up if you ref that parameter
>  >1 time.  Here is the unit test that fails:
>
> /** BUG!  Fix this.  Iterator is not reset from first to second $x$
> *  Either reset the iterator or pass an attribute that knows to get
> *  the iterator each time.  Seems like first, tail do not
> *  have same problem as they yield objects.
> *
> *  Maybe make a RestIterator like I have CatIterator.
> */
> public void testRepeatedRestOpAsArg() throws Exception {

ST# has a RestCollection that handles this so, this unit tests passes in
ST#.

> It yields "Tom, " not "Tom, Tom".  I said, "oh, just reset iterator
> when you hit the end".  There *is* no reset method!  i cannot reset
> any incoming attributes as the following unit test shows:

C# IEnumerators can be reset. They aren't at the moment though.

> /** If an iterator is sent into ST, it must be cannot be reset after
> each
> *  use so repeated refs yield empty values.  This would
> *  work if we passed in a List not an iterator.  Avoid sending in
> iterators
> *  if you ref it twice.
> */
> public void testRepeatedIteratedAttrFromArg() throws Exception {

Fails on C# too (i.e. prints ietrator contents only one).

> Suggestions?  I'd really like at least the iterators I create to be
> "reusable" within same template.

Only sure way is to wrap *all* incoming iterators in a collection of some
sort. A bit like RestCollection does. Heavy-ish overhead unless, it is
possible to detect in advance if an iterator is indeed used repeatedly.

C# also has the option of simply Reset()-ing iterators but that breaks with
"positioned iterators" (i.e. iterators deliberately positioned at a specific
point in the underlying collection).


Kunle
From asingh05 at vt.edu  Mon Jul 24 19:16:29 2006
From: asingh05 at vt.edu (Amrinder Singh)
Date: Mon Jul 24 19:23:14 2006
Subject: [stringtemplate-interest] Pretty printer
Message-ID: <44D4AB1F@zathras>

I wanted to know if there is some specific technique which can be used to 
build a pretty printer during code generation which adds proper indentations 
to the new lines of code added using ST.

Amrinder


From o.flege at market-maker.de  Tue Jul 25 01:18:23 2006
From: o.flege at market-maker.de (Oliver Flege)
Date: Tue Jul 25 01:18:30 2006
Subject: [stringtemplate-interest] how to fix longstanding bug
In-Reply-To: <BAY101-DAV15DBC30162BF0058DEA603815A0@phx.gbl>
References: <CE17CD94-CB3E-415F-ADC2-EE14094EDF8B@cs.usfca.edu>
	<BAY101-DAV15DBC30162BF0058DEA603815A0@phx.gbl>
Message-ID: <44C5D3CF.3070706@market-maker.de>

Hi,

Kunle Odutola wrote:
>> Suggestions?  I'd really like at least the iterators I create to be
>> "reusable" within same template.
> 
> Only sure way is to wrap *all* incoming iterators in a collection of some
> sort. A bit like RestCollection does. Heavy-ish overhead unless, it is
> possible to detect in advance if an iterator is indeed used repeatedly.
> 
> C# also has the option of simply Reset()-ing iterators but that breaks with
> "positioned iterators" (i.e. iterators deliberately positioned at a specific
> point in the underlying collection).

in my local (Java) ST code, I fixed this issue by introducing an STIterator class
in the StringTemplate class (see below).
That class is used to wrap any iterator that is either set with setAttribute or
that is created during template evaluation; its reset() method is called whenever
a local attribute is retrieved in StringTemplate#get that is-a STIterator, thus
referencing an iterable object more than once always yields a "fresh" iterator.

The cost for copying all elements into a private list upon construction
is (at least for me) negligible:
On a 2GHz P4 machine, I can create 1000 STIterators with 100 elements each in about 10ms.


 Oliver




    public static final class STIterator implements Iterator {
        private final List list;
        private final Iterator it;

        public static STIterator create(Map m) {
            return new STIterator(m.entrySet());
        }

        public static STIterator create(Collection c) {
            return new STIterator(c);
        }

        public static STIterator create(Iterator i) {
            return new STIterator(i);
        }

        private STIterator(Collection c) {
            this.list = new ArrayList(c.size());
            this.list.addAll(c);
            this.it = this.list.iterator();
        }

        private STIterator(Iterator it) {
            this.list = new ArrayList();
            while (it.hasNext())
                this.list.add(it.next());
            this.it = this.list.iterator();
        }

        private STIterator(List list) {
            this.list = list;
            this.it = this.list.iterator();
        }

        public boolean hasNext() {
            return this.it.hasNext();
        }

        public Object next() {
            return this.it.next();
        }

        public void remove() {
            throw new UnsupportedOperationException();
        }

        public STIterator reset() {
            return new STIterator(this.list);
        }

        public STIterator rest() {
            if (this.list.size() < 2) {
                return null;
            }
            return new STIterator(this.list.subList(1, this.list.size()));
        }
    }

From parrt at cs.usfca.edu  Tue Jul 25 09:20:56 2006
From: parrt at cs.usfca.edu (Terence Parr)
Date: Tue Jul 25 09:18:10 2006
Subject: [stringtemplate-interest] how to fix longstanding bug
In-Reply-To: <BAY101-DAV15DBC30162BF0058DEA603815A0@phx.gbl>
References: <CE17CD94-CB3E-415F-ADC2-EE14094EDF8B@cs.usfca.edu>
	<BAY101-DAV15DBC30162BF0058DEA603815A0@phx.gbl>
Message-ID: <3EB98801-088A-42B0-9CFE-E96EB9DC8F87@cs.usfca.edu>


On Jul 24, 2006, at 6:53 PM, Kunle Odutola wrote:
>
> Fails on C# too (i.e. prints ietrator contents only one).

This is ok I think as you are passing in something that has  
sideeffects, the iterator cursor.  so not our fault.  it is our fault  
when you say rest(names) and ref it twice with bad effect.

>> Suggestions?  I'd really like at least the iterators I create to be
>> "reusable" within same template.
>
> Only sure way is to wrap *all* incoming iterators in a collection  
> of some
> sort. A bit like RestCollection does. Heavy-ish overhead unless, it is
> possible to detect in advance if an iterator is indeed used  
> repeatedly.

no way to detect...i think if i keep a ptr to original datastructure  
it would work by creating new iterator off that each time.  Won't  
solve rest(rest(names)) however as rest would return an  
iterator...hmm..could I make that work?  Each call to next() or  
hasNext() would force a new cached iterator...I'd have to have  
special case code in a few places.   ick.  Apparently this isn't much  
of a problem; I say we punt!

Ter
From parrt at cs.usfca.edu  Tue Jul 25 09:23:10 2006
From: parrt at cs.usfca.edu (Terence Parr)
Date: Tue Jul 25 09:20:25 2006
Subject: [stringtemplate-interest] how to fix longstanding bug
In-Reply-To: <44C5D3CF.3070706@market-maker.de>
References: <CE17CD94-CB3E-415F-ADC2-EE14094EDF8B@cs.usfca.edu>
	<BAY101-DAV15DBC30162BF0058DEA603815A0@phx.gbl>
	<44C5D3CF.3070706@market-maker.de>
Message-ID: <5214CE86-5AEF-479C-9E9B-8FE7305D06D4@cs.usfca.edu>


On Jul 25, 2006, at 1:18 AM, Oliver Flege wrote:

> Hi,
>
> Kunle Odutola wrote:
>>> Suggestions?  I'd really like at least the iterators I create to be
>>> "reusable" within same template.
>>
>> Only sure way is to wrap *all* incoming iterators in a collection  
>> of some
>> sort. A bit like RestCollection does. Heavy-ish overhead unless,  
>> it is
>> possible to detect in advance if an iterator is indeed used  
>> repeatedly.
>>
>> C# also has the option of simply Reset()-ing iterators but that  
>> breaks with
>> "positioned iterators" (i.e. iterators deliberately positioned at  
>> a specific
>> point in the underlying collection).
>
> in my local (Java) ST code, I fixed this issue by introducing an  
> STIterator class
> in the StringTemplate class (see below).
> That class is used to wrap any iterator that is either set with  
> setAttribute or
> that is created during template evaluation; its reset() method is  
> called whenever
> a local attribute is retrieved in StringTemplate#get that is-a  
> STIterator, thus
> referencing an iterable object more than once always yields a  
> "fresh" iterator.
>
> The cost for copying all elements into a private list upon  
> construction
> is (at least for me) negligible:
> On a 2GHz P4 machine, I can create 1000 STIterators with 100  
> elements each in about 10ms.

Well, ANTLR is noticing a slow down now for building big iterated  
arrays of elements.  I need to be careful not to slow everything down  
just to handle this case.  Damn!  Hm....

Nice solution for your needs though!  Good work.

Ter
From brian at protexis.com  Wed Jul 26 07:31:18 2006
From: brian at protexis.com (brian@protexis.com)
Date: Wed Jul 26 07:31:26 2006
Subject: [stringtemplate-interest] Mappings inside of string template
Message-ID: <45522.10.238.10.70.1153924278.webmail@10.238.10.70>

Hi

Is it possible to define a mapping inside of a string template rather than
using a string template goup. If so, how?

Thanks



From parrt at cs.usfca.edu  Wed Jul 26 10:08:27 2006
From: parrt at cs.usfca.edu (Terence Parr)
Date: Wed Jul 26 10:08:30 2006
Subject: [stringtemplate-interest] Mappings inside of string template
In-Reply-To: <45522.10.238.10.70.1153924278.webmail@10.238.10.70>
References: <45522.10.238.10.70.1153924278.webmail@10.238.10.70>
Message-ID: <73603DAB-FACD-4092-BD53-2577CB8CCE84@cs.usfca.edu>


On Jul 26, 2006, at 7:31 AM, brian@protexis.com wrote:

> Hi
>
> Is it possible to define a mapping inside of a string template  
> rather than
> using a string template goup. If so, how?

Nope...sorry.  What are you needing to do?
Ter

From brian at protexis.com  Wed Jul 26 10:24:09 2006
From: brian at protexis.com (brian@protexis.com)
Date: Wed Jul 26 10:24:15 2006
Subject: [stringtemplate-interest] Mappings inside of string template
Message-ID: <58423.10.238.10.71.1153934649.webmail@10.238.10.71>

Hi

I asked the previous question because either there is a bug in the VS 2005
String Template library or I'm stupid. I think it's because I'm stupid. :)

If I create the following stg file ...

group test;

mapping ::= ["One":"1", default:"0"]

.. then I create the following st file ....

$mapping.One$

.. then the results are an empty string.

Am I doing something wrong? Should I include my C# code as well.



-----Original Message-----
From: "Terence Parr"
Sent: Wed, July 26, 2006 10:08
To: "stringtemplate-interest"
Subject: Re: [stringtemplate-interest] Mappings inside of string template


On Jul 26, 2006, at 7:31 AM, brian@protexis.com wrote:

> Hi
>
> Is it possible to define a mapping inside of a string template
> rather than
> using a string template goup. If so, how?

Nope...sorry.  What are you needing to do?
Ter

_______________________________________________
stringtemplate-interest mailing list
stringtemplate-interest@antlr.org
http://www.antlr.org:8080/mailman/listinfo/stringtemplate-interest




From Kunle_Odutola at hotmail.com  Wed Jul 26 11:11:48 2006
From: Kunle_Odutola at hotmail.com (Kunle Odutola)
Date: Wed Jul 26 10:53:56 2006
Subject: [stringtemplate-interest] Mappings inside of string template
References: <58423.10.238.10.71.1153934649.webmail@10.238.10.71>
Message-ID: <BAY101-DAV32DF8D04530E3A4A6650C815B0@phx.gbl>

Brian

> Hi
>
> I asked the previous question because either there is a bug in the VS 2005
> String Template library or I'm stupid. I think it's because I'm stupid. :)
>
> If I create the following stg file ...
>
> group test;
>
> mapping ::= ["One":"1", default:"0"]
>
> .. then I create the following st file ....
>
> $mapping.One$
>
> .. then the results are an empty string.
>
> Am I doing something wrong? Should I include my C# code as well.

Can't say yet but, I am not aware of any outstanding issues with maps in the
ST#.  And, yeah...paste the relevant C# code.

>From your description above above, I suspect that you are talking about two
separate files here (i.e. the template is not defined in the group file but
in a separate *.st file).

Kunle
From parrt at cs.usfca.edu  Wed Jul 26 14:27:44 2006
From: parrt at cs.usfca.edu (Terence Parr)
Date: Wed Jul 26 14:27:50 2006
Subject: [stringtemplate-interest] Re: [antlr-dev] crap,
	we need to fix the map issue with ST
In-Reply-To: <36CCF4CD-7A2F-4547-82E3-85C11AC42D0A@cs.usfca.edu>
References: <36CCF4CD-7A2F-4547-82E3-85C11AC42D0A@cs.usfca.edu>
Message-ID: <D0CAA72C-E8D1-4C50-9C38-3EA9CF36C970@cs.usfca.edu>

Ok, I changed my mind as it just bit hard right on the arse!  Too  
hard to go find all the places that you ref a map as it's untyped in  
the templates.  Ok, simpler solution.  Leave:

<aMap>

to iterate over the values.  We add keys special property:

<aMap.keys:{key|...}>

to iterate over the keys.  values would be the default:  
<aMap.values>.  Make sense?

Ter

On Jul 26, 2006, at 12:46 PM, Terence Parr wrote:

> I hope Kunle concurs and you folks do to: I must break backward  
> compatibility with how ST handles maps.  Currently, <aMap> iterates  
> over the values. :(  How do you get the keys?  It should iterate  
> over the keys and then if you need the values you can get:
>
> <aMap:{key| <key> maps to <aMap.key>}>
>
> That *should* work and allows us to iterate maps without any  
> special new notation or concepts.
>
> Anybody have an opinion?  I have a few other backward incompat.  
> issues already for 2.3 so it's not alone.  2.3 should be clean  
> rather than force perfect back. compat.
>
> Ter
> _______________________________________________
> antlr-dev mailing list
> antlr-dev@antlr.org
> http://www.antlr.org:8080/mailman/listinfo/antlr-dev

From parrt at cs.usfca.edu  Wed Jul 26 14:37:17 2006
From: parrt at cs.usfca.edu (Terence Parr)
Date: Wed Jul 26 14:37:21 2006
Subject: [stringtemplate-interest] Re: [antlr-dev] crap,
	we need to fix the map issue with ST
In-Reply-To: <D0CAA72C-E8D1-4C50-9C38-3EA9CF36C970@cs.usfca.edu>
References: <36CCF4CD-7A2F-4547-82E3-85C11AC42D0A@cs.usfca.edu>
	<D0CAA72C-E8D1-4C50-9C38-3EA9CF36C970@cs.usfca.edu>
Message-ID: <83738321-4E2E-4154-A41F-FC7AB0943DA2@cs.usfca.edu>

Ok, slight adjustment, must use <aMap.(k)> because k is not the  
literal k--it's a variable that holds the key name:

	public void testMapKeys() throws Exception {
		StringTemplateGroup group =
			new StringTemplateGroup("dummy", ".",  
AngleBracketTemplateLexer.class);
		StringTemplate t =
			new StringTemplate(group,
				"<aMap.keys:{k|<k>:<aMap.(k)>}; separator=\", \">");
		HashMap map = new LinkedHashMap();
		map.put("int","0");
		map.put("float","0.0");
		t.setAttribute("aMap", map);
		assertEqual(t.toString(), "int:0, float:0.0");
	}

Pushed. [change 2833]

Ter

From erewhon at flatland.org  Wed Jul 26 17:42:18 2006
From: erewhon at flatland.org (Steven Byrnes)
Date: Wed Jul 26 17:25:32 2006
Subject: [stringtemplate-interest] Maps vs aggregates vs beans
Message-ID: <20060727004218.GA2699@terminus.home.flatland.org>

Hi,

I'm running into a problem with aggregates and multi-valued attributes.  Not sure if it's lack of 
understanding on my part or something else... I'm running String Template 2.3b7.

For the following template:

  StringTemplate t = new StringTemplate("$name:{ <b>$it.a$ - $it.b$</b> }$");

if I use 1 or more aggregate attribute calls, it works, e.g.:

  t.setAttribute("name.{a,b}", "foo", "blah");
  t.setAttribute("name.{a,b}", "bar", "brap");

same thing for a simple bean.  One or more setAttributes() will work.

  t.setAttribute("name", new data("foo", "bar"));  // where data() has getA() and getB() methods

If I use setAttribute() for multiple Hashmaps, it works.  But if I only use one, I get an error, e.g.:

  HashMap<String,String> m = new HashMap<String,String>();
  m.put("a", "foo"); m.put("b", "blah");
  t.setAttribute("name", m);
  System.out.println(t.toString());

  =>

  Class java.lang.String has no such attribute: a in template context [anonymous anonymous]
  java.lang.NoSuchFieldException: a
        at java.lang.Class.getField(Class.java:1507)
        at org.antlr.stringtemplate.language.ASTExpr.rawGetObjectProperty(ASTExpr.java:410)
        at org.antlr.stringtemplate.language.ASTExpr.getObjectProperty(ASTExpr.java:314)
  ....

Any ideas?

Thanks,
Steven
From robertdavidrowland at gmail.com  Thu Jul 27 00:55:58 2006
From: robertdavidrowland at gmail.com (Robert Rowland)
Date: Thu Jul 27 00:56:03 2006
Subject: [stringtemplate-interest] Maps vs aggregates vs beans
In-Reply-To: <20060727004218.GA2699@terminus.home.flatland.org>
References: <20060727004218.GA2699@terminus.home.flatland.org>
Message-ID: <5e4a82840607270055x319f9fd3jebf7563d9a4245a9@mail.gmail.com>

If you only have one hashmap and your template was as follows it would
work fine.

StringTemplate t = new StringTemplate("<b>$name.a$ - $name.b$</b>");

So something is behaveing differently depending depending on whether
you a single hashmap or multiple hashmaps set for a given attribute.
I'm guessing this is intended behaviour but others will know the
answer to that better than me.

In situations where you may have 1 or more hashmaps then this is the
work around I've used.

StringTemplate t = new StringTemplate("$name:{n|$if(n)$<b>$it.a$ -
$it.b$</b>$endif$}$");

Then after I've set my 1 or more hashmaps, I go and set an empty one
as well, which is ignored because of the $if(n)$

while(myloopmaybe_0_1_or_many_items) {

Hashmap name = new Hashmap();
name.put("a", "first value");
name.put("b", "second value");
template.setAttribute("name", name);

Hashmap name = new Hashmap();
template.setAttribute("name", name);


On 7/27/06, Steven Byrnes <erewhon@flatland.org> wrote:
> Hi,
>
> I'm running into a problem with aggregates and multi-valued attributes.  Not sure if it's lack of
> understanding on my part or something else... I'm running String Template 2.3b7.
>
> For the following template:
>
>  StringTemplate t = new StringTemplate("$name:{ <b>$it.a$ - $it.b$</b> }$");
>
> if I use 1 or more aggregate attribute calls, it works, e.g.:
>
>  t.setAttribute("name.{a,b}", "foo", "blah");
>  t.setAttribute("name.{a,b}", "bar", "brap");
>
> same thing for a simple bean.  One or more setAttributes() will work.
>
>  t.setAttribute("name", new data("foo", "bar"));  // where data() has getA() and getB() methods
>
> If I use setAttribute() for multiple Hashmaps, it works.  But if I only use one, I get an error, e.g.:
>
>  HashMap<String,String> m = new HashMap<String,String>();
>  m.put("a", "foo"); m.put("b", "blah");
>  t.setAttribute("name", m);
>  System.out.println(t.toString());
>
>  =>
>
>  Class java.lang.String has no such attribute: a in template context [anonymous anonymous]
>  java.lang.NoSuchFieldException: a
>        at java.lang.Class.getField(Class.java:1507)
>        at org.antlr.stringtemplate.language.ASTExpr.rawGetObjectProperty(ASTExpr.java:410)
>        at org.antlr.stringtemplate.language.ASTExpr.getObjectProperty(ASTExpr.java:314)
>  ....
>
> Any ideas?
>
> Thanks,
> Steven
> _______________________________________________
> stringtemplate-interest mailing list
> stringtemplate-interest@antlr.org
> http://www.antlr.org:8080/mailman/listinfo/stringtemplate-interest
>
From robertdavidrowland at gmail.com  Thu Jul 27 00:58:06 2006
From: robertdavidrowland at gmail.com (Robert Rowland)
Date: Thu Jul 27 00:58:09 2006
Subject: [stringtemplate-interest] Maps vs aggregates vs beans
In-Reply-To: <5e4a82840607270055x319f9fd3jebf7563d9a4245a9@mail.gmail.com>
References: <20060727004218.GA2699@terminus.home.flatland.org>
	<5e4a82840607270055x319f9fd3jebf7563d9a4245a9@mail.gmail.com>
Message-ID: <5e4a82840607270058u56e6239yf04f0046685b15b3@mail.gmail.com>

Sorry I sent this too early . . . the example at the bottom is now complete.


If you only have one hashmap and your template was as follows it would
work fine.

StringTemplate t = new StringTemplate("<b>$name.a$ - $name.b$</b>");

So something is behaveing differently depending depending on whether
you a single hashmap or multiple hashmaps set for a given attribute.
I'm guessing this is intended behaviour but others will know the
answer to that better than me.

In situations where you may have 1 or more hashmaps then this is the
work around I've used.

StringTemplate t = new StringTemplate("$name:{n|$if(n)$<b>$it.a$ -
$it.b$</b>$endif$}$");

Then after I've set my 1 or more hashmaps, I go and set an empty one
as well, which is ignored because of the $if(n)$

while(myloopmaybe_0_1_or_many_items) {
    Hashmap name = new Hashmap();
    name.put("a", "first value");
    name.put("b", "second value");
    template.setAttribute("name", name);
}

Hashmap emptyName = new Hashmap();
template.setAttribute("name", emptyName);

I hope this helps.  I'll be interested to know if the behaviour that
requires this work around is a bug or is intended behaviour.

> On 7/27/06, Steven Byrnes <erewhon@flatland.org> wrote:
> > Hi,
> >
> > I'm running into a problem with aggregates and multi-valued attributes.  Not sure if it's lack of
> > understanding on my part or something else... I'm running String Template 2.3b7.
> >
> > For the following template:
> >
> >  StringTemplate t = new StringTemplate("$name:{ <b>$it.a$ - $it.b$</b> }$");
> >
> > if I use 1 or more aggregate attribute calls, it works, e.g.:
> >
> >  t.setAttribute("name.{a,b}", "foo", "blah");
> >  t.setAttribute("name.{a,b}", "bar", "brap");
> >
> > same thing for a simple bean.  One or more setAttributes() will work.
> >
> >  t.setAttribute("name", new data("foo", "bar"));  // where data() has getA() and getB() methods
> >
> > If I use setAttribute() for multiple Hashmaps, it works.  But if I only use one, I get an error, e.g.:
> >
> >  HashMap<String,String> m = new HashMap<String,String>();
> >  m.put("a", "foo"); m.put("b", "blah");
> >  t.setAttribute("name", m);
> >  System.out.println(t.toString());
> >
> >  =>
> >
> >  Class java.lang.String has no such attribute: a in template context [anonymous anonymous]
> >  java.lang.NoSuchFieldException: a
> >        at java.lang.Class.getField(Class.java:1507)
> >        at org.antlr.stringtemplate.language.ASTExpr.rawGetObjectProperty(ASTExpr.java:410)
> >        at org.antlr.stringtemplate.language.ASTExpr.getObjectProperty(ASTExpr.java:314)
> >  ....
> >
> > Any ideas?
> >
> > Thanks,
> > Steven
> > _______________________________________________
> > stringtemplate-interest mailing list
> > stringtemplate-interest@antlr.org
> > http://www.antlr.org:8080/mailman/listinfo/stringtemplate-interest
> >
>
From brian at protexis.com  Thu Jul 27 10:09:36 2006
From: brian at protexis.com (brian@protexis.com)
Date: Thu Jul 27 10:09:40 2006
Subject: [stringtemplate-interest] Mappings inside of string template
In-Reply-To: <BAY101-DAV32DF8D04530E3A4A6650C815B0@phx.gbl>
References: <58423.10.238.10.71.1153934649.webmail@10.238.10.71>
	<BAY101-DAV32DF8D04530E3A4A6650C815B0@phx.gbl>
Message-ID: <52917.10.238.10.70.1154020176.webmail@10.238.10.70>

Hey

I'm sorry but nothing is wrong. I was just using the embedded loaders
incorrectly. I apoligize for wasting your time.

I've really found the lack of detailed VS 2005 samples to be a problem in
learning how to use the string template library correctly. If I create a
couple example projects using string template would you be willing to add
them to the string template site?

Thanks




-----Original Message-----
From: "Kunle Odutola"
Sent: Wed, July 26, 2006 11:11
To: stringtemplate-interest@antlr.org
Subject: Re: [stringtemplate-interest] Mappings inside of string template

Brian

> Hi
>
> I asked the previous question because either there is a bug in the VS 2005
> String Template library or I'm stupid. I think it's because I'm stupid. :)
>
> If I create the following stg file ...
>
> group test;
>
> mapping ::= ["One":"1", default:"0"]
>
> .. then I create the following st file ....
>
> $mapping.One$
>
> .. then the results are an empty string.
>
> Am I doing something wrong? Should I include my C# code as well.

Can't say yet but, I am not aware of any outstanding issues with maps in the
ST#.  And, yeah...paste the relevant C# code.

>From your description above above, I suspect that you are talking about two
separate files here (i.e. the template is not defined in the group file but
in a separate *.st file).

Kunle
_______________________________________________
stringtemplate-interest mailing list
stringtemplate-interest@antlr.org
http://www.antlr.org:8080/mailman/listinfo/stringtemplate-interest


From parrt at cs.usfca.edu  Thu Jul 27 10:51:07 2006
From: parrt at cs.usfca.edu (Terence Parr)
Date: Thu Jul 27 10:51:10 2006
Subject: [stringtemplate-interest] Mappings inside of string template
In-Reply-To: <52917.10.238.10.70.1154020176.webmail@10.238.10.70>
References: <58423.10.238.10.71.1153934649.webmail@10.238.10.71>
	<BAY101-DAV32DF8D04530E3A4A6650C815B0@phx.gbl>
	<52917.10.238.10.70.1154020176.webmail@10.238.10.70>
Message-ID: <357EF6D9-5221-40B1-98F4-32F91A726AAC@cs.usfca.edu>


On Jul 27, 2006, at 10:09 AM, brian@protexis.com wrote:

> Hey
>
> I'm sorry but nothing is wrong. I was just using the embedded loaders
> incorrectly. I apoligize for wasting your time.

No problem, we all have to figure these details out together.   When  
ANTLR gets more stable I'll be entering a writing phase.

> I've really found the lack of detailed VS 2005 samples to be a  
> problem in
> learning how to use the string template library correctly. If I  
> create a
> couple example projects using string template would you be willing  
> to add
> them to the string template site?

You can add them yourself :)  But I'll handle it for you if you  
want.  You can add under articles or file sharing :)

Ter
From parrt at cs.usfca.edu  Fri Jul 28 10:36:02 2006
From: parrt at cs.usfca.edu (Terence Parr)
Date: Fri Jul 28 10:36:12 2006
Subject: [stringtemplate-interest] ownership/rights for wiki content
Message-ID: <A0AFEA24-E0F0-4690-86C4-D090675CC8B8@cs.usfca.edu>

Hi,

My current strategy of BSD license for ANTLR and my insistence on  
contributors guaranteeing that they have the rights to contribute  
their work has led to many more (big) companies being able to use the  
new ANTLR.  Previously the weird "almost public domain" license  
bothered some companies.  More importantly, however, they wanted  
signatures from 15 years of contributors indicating nothing had been  
stolen from elsewhere and put into ANTLR (tainting source code).   
Think "SCO linux lawsuit".  My new feedback page circumvents this  
legal issue.

Anyway, as I intend to write a book which includes the raw reference  
manual that we are building (I note some serious contributions from  
Kunle last night!  Thanks!), I will need to have the right to do  
that.  I am proposing an identical "certificate of origin with teeth  
(indemnification)" (that all major code contributors will have to  
sign shortly):

http://www.antlr.org/ANTLR-contributor-agreement.pdf

So for the wiki, you would guarantee that you are not copying  
somebody else's work into the wiki and that you grant the antlr  
project license to publish the work without compensating you.

If we can agree on this, then I will alter the wiki signup to include  
this "click-wrap license" just like I have on the bottom of the  
feedback page:

http://www.antlr.org/misc/feedback

So, you will still own your work but you are granting me a license to  
publish it or whatever.

Yes, this legal crap is a pain but is a reality today.  I'm about to  
close a deal with a big player if they think that the contributor's  
cert. of origin is ok; so, this stuff really matters and is good for  
the project.

Terence
From parrt at cs.usfca.edu  Fri Jul 28 10:53:15 2006
From: parrt at cs.usfca.edu (Terence Parr)
Date: Fri Jul 28 10:53:21 2006
Subject: [stringtemplate-interest] tutorials
Message-ID: <E1162C1B-85B3-44AD-AE51-044881FA11CB@cs.usfca.edu>

Added a page for people to stick tutorials under:

http://www.antlr.org/wiki/display/ANTLR3/Tutorials

and

http://www.antlr.org/wiki/display/ST/Tutorials

Terence
From rw1836 at yahoo.com  Mon Jul 31 12:15:51 2006
From: rw1836 at yahoo.com (John RW)
Date: Mon Jul 31 12:15:55 2006
Subject: [stringtemplate-interest] conditional separator
In-Reply-To: <B6266161-E523-479F-A2D4-5F5AA8C131FA@cs.usfca.edu>
Message-ID: <20060731191551.116.qmail@web56903.mail.re3.yahoo.com>

Hi
   
  I have a multivalue attribute, and want to concatenate the values with a comma separator, only if the value itself has an attribute "foo" equals true. Is it possible to do this in stringtemplate?
   
  the point is I want to apply the separator only if some_func returns not null.
   
  $values:some_func(); separator=","$
   
  some_func ::= <<
  $if (it.foo)$
  $it.value$
  $endif$
  >>
   
  Thanks,
  John

 __________________________________________________
Do You Yahoo!?
Tired of spam?  Yahoo! Mail has the best spam protection around 
http://mail.yahoo.com 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.antlr.org:8080/pipermail/stringtemplate-interest/attachments/20060731/bc40a436/attachment.html
